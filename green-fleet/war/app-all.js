/*
Copyright(c) 2011 HeartyOh.com
*/
Ext.define("GreenFleet.mixin.Msg",function(){var b;function a(d,e){return'<div class="msg"><h3>'+d+"</h3><p>"+e+"</p></div>"}function c(e,f){if(!b){b=Ext.core.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}var f=Ext.String.format.apply(String,Array.prototype.slice.call(arguments,1));var d=Ext.core.DomHelper.append(b,a(e,f),true);d.hide();d.slideIn("t").ghost("t",{delay:1000,remove:true})}return{msg:c}}());Ext.define("GreenFleet.mixin.User",function(){var b=login.username;function a(c){if(c!==undefined){b=c}return b}return{login:{id:a,name:a}}}());Ext.define("GreenFleet.mixin.Mixin",{mixin:function(b,a){try{switch(typeof(b)){case"string":Ext.apply(Ignite,Ext.create(b,a));return;case"object":Ext.apply(Ignite,b)}}catch(c){console.log(c.stack)}}});Ext.define("GreenFleet.mixin.UI",{addSystemMenu:function(a,b){try{var d=Ext.getCmp("system_menu");var g=Ext.create(a,b);d.insert(0,g);var c=6;d.items.each(function(e){c+=e.getWidth()});d.setSize(c,d.getHeight())}catch(f){}},addContentView:function(a){this.showBusy();var b;if(typeof(a)==="string"){b=Ext.create(a,{closable:true})}else{b=a}Ext.getCmp("content").add(b).show();this.clearStatus()},getMenu:function(a){return Ext.getCmp("content").getComponent(a)},doMenu:function(b){var a=Ext.getCmp("content");a.getLayout().setActiveItem(a.getComponent(b))}});Ext.define("GreenFleet.mixin.State",function(){return{show_running_vehicle:true,show_idle_vehicle:true,show_incident_vehicle:true}}());Ext.define("GreenFleet.mixin.SubItem",function(){Ext.Container.implement({sub:function(a){if(!this.subitems){this.subitems={}}if(!this.subitems[a]){this.subitems[a]=this.down("[itemId="+a+"]")}return this.subitems[a]}});return{}}());Ext.define("GreenFleet.mixin.Import",function(){function a(){var c=Ext.getCmp("content");var b=c.getLayout().getActiveItem();if(b.importUrl){Ext.create("GreenFleet.view.common.ImportPopup",{importUrl:b.importUrl,client:b}).show()}}return{importData:a}}());Ext.define("GreenFleet.view.Viewport",{extend:"Ext.container.Viewport",layout:"border",cls:"wrap",defaults:{split:false,collapsible:false},items:[{xtype:"viewport.north",region:"north",cls:"header",height:62},{xtype:"viewport.west",region:"west",cls:"tool",width:50},{xtype:"viewport.east",region:"east",cls:"summaryBoard",width:200},{xtype:"viewport.center",region:"center"}]});Ext.define("GreenFleet.view.viewport.Center",{extend:"Ext.panel.Panel",id:"content",alias:"widget.viewport.center",layout:"card",listeners:{add:function(a,c){if(a!==this){return}var b=Ext.getCmp("menutab");b.add({text:c.title,itemId:c.itemId,tooltip:c.title,handler:function(e){var f=Ext.getCmp("content");var d=f.getComponent(e.itemId);f.getLayout().setActiveItem(d)},closable:false}).setCard(c)},remove:function(a,c){if(a!==this){return}var b=Ext.getCmp("menutab");b.remove(c.itemId)}},defaults:{listeners:{activate:function(c){var b=Ext.getCmp("menutab");var a=b.getComponent(c.itemId);b.setActiveTab(a)}}},items:[{title:"Dashboard",xtype:"monitor_map",itemId:"map"},{title:"Info",xtype:"monitor_information",itemId:"information"},{title:"Incident Info",xtype:"monitor_incident",itemId:"monitor_incident"}]});Ext.define("GreenFleet.view.viewport.North",{extend:"Ext.Container",alias:"widget.viewport.north",layout:{type:"hbox",align:"stretch"},items:[{xtype:"brand",width:135},{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"main_menu",flex:1},{xtype:"side_menu",width:180}]},{xtype:"tabbar",id:"menutab",height:23}]}]});Ext.define("GreenFleet.view.viewport.West",{extend:"Ext.panel.Panel",alias:"widget.viewport.west",cls:"tool",layout:{type:"vbox"},items:[{xtype:"button",cls:"btnAdd",html:"add"},{xtype:"button",cls:"btnRemove",html:"remove"},{xtype:"button",cls:"btnRefresh",html:"refresh"},{xtype:"button",cls:"btnEvent",html:"import",handler:function(){GreenFleet.importData()}},{xtype:"button",cls:"btnSave",html:"save"},{xtype:"button",cls:"btnExport",html:"export",}]});Ext.define("GreenFleet.view.viewport.East",{extend:"Ext.panel.Panel",alias:"widget.viewport.east",id:"east",cls:"summaryBoard",width:200,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.callParent();var a=this;this.sub("state_running").on("click",function(){GreenFleet.show_running_vehicle=true;if(GreenFleet.show_idle_vehicle){GreenFleet.show_idle_vehicle=false;GreenFleet.show_incident_vehicle=false}else{GreenFleet.show_idle_vehicle=true;GreenFleet.show_incident_vehicle=true}});this.sub("state_idle").on("click",function(){GreenFleet.show_idle_vehicle=true;if(GreenFleet.show_incident_vehicle){GreenFleet.show_running_vehicle=false;GreenFleet.show_incident_vehicle=false}else{GreenFleet.show_running_vehicle=true;GreenFleet.show_incident_vehicle=true}});this.sub("state_incident").on("click",function(){GreenFleet.show_incident_vehicle=true;if(GreenFleet.show_running_vehicle){GreenFleet.show_running_vehicle=false;GreenFleet.show_idle_vehicle=false}else{GreenFleet.show_running_vehicle=true;GreenFleet.show_idle_vehicle=true}});setInterval(function(){a.sub("time").update(Ext.Date.format(new Date(),"D Y-m-d H:i:s"))},1000);this.on("afterrender",function(){Ext.getStore("RecentIncidentStore").on("load",a.refreshIncidents,a);Ext.getStore("RecentIncidentStore").load()})},refreshVehicleCounts:function(){var b=Ext.getStore("VehicleStore");var e=b.count();var a=0;var c=0;var d=0;b.each(function(f){switch(f.get("status")){case"Running":a++;break;case"Idle":c++;break;case"Incident":d++;break}});this.sub("state_running").update("Driving</br><span>"+a+"</span>");this.sub("state_idle").update("Idle</br><span>"+c+"</span>");this.sub("state_incident").update("Incident</br><span>"+d+"</span>");this.sub("vehicle_count").update("Total Running Vehicles : "+e)},refreshIncidents:function(a){if(!a){a=Ext.getStore("RecentIncidentsStore")}this.sub("incidents").removeAll();var d=a.count()>5?5:a.count();for(var b=0;b<d;b++){var c=a.getAt(b);this.sub("incidents").add({xtype:"button",listeners:{click:function(e){GreenFleet.doMenu("monitor_incident");GreenFleet.getMenu("monitor_incident").setIncident(e.incident,true)}},incident:c,html:'<a href="#">'+c.get("vehicle")+", "+c.get("driver")+"<span>"+Ext.Date.format(c.get("incidentTime"),"D Y-m-d H:i:s")+"</span></a>"})}},items:[{xtype:"combo",cls:"searchField",fieldLabel:"Search",labelWidth:50,labelSeparator:"",itemId:"search"},{xtype:"component",cls:"time",itemId:"time",html:Ext.Date.format(new Date(),"D Y-m-d H:i:s")},{xtype:"box",cls:"count",itemId:"vehicle_count",html:"Total Running Vehicles : 0"},{xtype:"panel",title:"상황별 운행 현황",cls:"statusPanel",items:[{xtype:"button",itemId:"state_running",flex:1,cls:"btnDriving"},{xtype:"button",itemId:"state_idle",flex:1,cls:"btnStop"},{xtype:"button",itemId:"state_incident",flex:1,cls:"btnIncident"}]},{xtype:"panel",title:"Group",cls:"groupPanel",items:[{html:'<a href="#">강남 ~ 분당노선 1 <span>(14)</span></a><a href="#">강남 ~ 분당노선 1 <span>(14)</span></a>'}]},{xtype:"panel",title:"Incidents Alarm",itemId:"incidents",cls:"incidentPanel"}]});Ext.define("GreenFleet.view.Brand",{extend:"Ext.panel.Panel",alias:"widget.brand",html:"<a></a>"});Ext.define("GreenFleet.view.MainMenu",{extend:"Ext.toolbar.Toolbar",cls:"appMenu",alias:"widget.main_menu",defaults:{handler:function(c){var e=Ext.getCmp("content");var a=e.query("[closable=true]");for(var b=0;b<a.length;b++){e.remove(a[b])}var f=null;for(b=0;b<c.submenus.length;b++){c.submenus[b]["listeners"]={activate:function(i){var h=Ext.getCmp("menutab");var g=h.getComponent(i.itemId);h.setActiveTab(g)}};var d=e.add(c.submenus[b]);f=f||d}if(f){GreenFleet.doMenu(f.itemId)}}},items:[{text:"Dashboard",submenus:[{title:"File",xtype:"filemanager",itemId:"filemanager",closable:true}]},{text:"Company",submenus:[{title:T("company"),xtype:"management_company",itemId:"company",closable:true},{title:"Code Mgmt.",xtype:"management_code",itemId:"code",closable:true}]},{text:"Vehicle",submenus:[{title:T("vehicle"),xtype:"management_vehicle",itemId:"vehicle",closable:true},{title:T("incident"),xtype:"management_incident",itemId:"incident",closable:true},{title:T("track"),xtype:"management_track",itemId:"track",closable:true},{title:"ControlData",xtype:"management_control_data",itemId:"control_data",closable:true}]},{text:T("employee"),submenus:[{title:"Driver",xtype:"management_driver",itemId:"driver",closable:true}]},{text:T("terminal"),submenus:[{title:"Terminal",xtype:"management_terminal",itemId:"terminal",closable:true}]},{text:"Reservation",submenus:[{title:"Reservation",xtype:"management_reservation",itemId:"reservation",closable:true}]},{text:"Maintenance",submenus:[]}]});Ext.define("GreenFleet.view.SideMenu",{extend:"Ext.toolbar.Toolbar",alias:"widget.side_menu",cls:"sideMenu",items:[{type:"help",text:login.username,handler:function(){}},{itemId:"home",type:"home",cls:"btnHome",handler:function(){}},{itemId:"report",type:"report",cls:"btnReport",handler:function(){}},{itemId:"setting",type:"setting",cls:"btnSetting",handler:function(){}},{itemId:"logout",type:"logout",cls:"btnLogout",handler:function(){Ext.MessageBox.confirm("Confirm","Are you sure you want to do that?",function(a){if(a==="yes"){document.location.href="/logout.htm"}})}}]});Ext.define("GreenFleet.view.management.Company",{extend:"Ext.container.Container",alias:"widget.management_company",title:"Company",layout:{align:"stretch",type:"vbox"},initComponent:function(){Ext.applyIf(this,{items:[],});this.items=[{html:'<div class="listTitle">Company List</div>'},this.buildList(this),this.buildForm(this)],this.callParent(arguments)},buildList:function(a){return{xtype:"gridpanel",store:"CompanyStore",flex:3,columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"id",text:"ID"},{dataIndex:"name",text:"Name"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{render:function(b){b.store.load()},itemclick:function(c,b){var d=a.down("form");d.loadRecord(b)}},onSearch:function(c){var b=c.down("textfield[name=idFilter]");var d=c.down("textfield[name=nameFilter]");c.store.clearFilter();c.store.filter([{property:"id",value:b.getValue()},{property:"name",value:d.getValue()}])},onReset:function(b){b.down("textfield[name=idFilter]").setValue("");b.down("textfield[name=nameFilter]").setValue("")},tbar:["ID",{xtype:"textfield",name:"idFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},"NAME",{xtype:"textfield",name:"nameFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find Company",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}]}},buildForm:function(a){return{xtype:"form",bodyPadding:10,cls:"hIndexbar",title:"Company Details",flex:2,items:[{xtype:"textfield",name:"key",fieldLabel:"Key",anchor:"100%",hidden:true},{xtype:"textfield",name:"id",fieldLabel:"ID",anchor:"100%"},{xtype:"textfield",name:"name",fieldLabel:"Name",anchor:"100%"},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:F("datetime"),anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"company/save",success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"company/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Reset",handler:function(){this.up("form").getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.management.Code",{extend:"Ext.container.Container",alias:"widget.management_code",title:"Code Mgmt.",layout:{align:"stretch",type:"vbox"},importUrl:"code/import",afterImport:function(){this.sub("codelist").store.load();this.sub("form").getForm().reset()},initComponent:function(){Ext.applyIf(this,{items:[],});this.items=[{html:'<div class="listTitle">Code List</div>'},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.zgrouplist,{xtype:"container",flex:1,layout:{align:"stretch",type:"vbox"},items:[this.zcodelist,this.zform]}]}],this.callParent(arguments);var a=this;this.down("[itemId=save]").on("click",function(){var b=a.sub("form").getForm();if(b.isValid()){b.submit({url:"code/save",success:function(d,e){var c=a.sub("codelist").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}});this.down("[itemId=delete]").on("click",function(){var b=a.sub("form").getForm();if(b.isValid()){b.submit({url:"code/delete",success:function(c,d){a.sub("codelist").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}});this.down("[itemId=reset]").on("click",function(){a.sub("form").getForm().reset()});this.sub("codelist").on("itemclick",function(c,b){a.sub("form").loadRecord(b)})},zgrouplist:{xtype:"gridpanel",store:"CodeGroupStore",itemId:"grouplist",title:"Code Group",width:320,columns:[{dataIndex:"group",text:"Group",width:100},{dataIndex:"desc",text:"Description",width:220}]},zcodelist:{xtype:"gridpanel",store:"CodeStore",itemId:"codelist",title:"Code List",flex:1,columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"group",text:"Group"},{dataIndex:"code",text:"Code"},{dataIndex:"desc",text:"Description"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}]},zform:{xtype:"form",bodyPadding:10,cls:"hIndexbar",title:"Code Details",itemId:"form",height:200,items:[{xtype:"textfield",name:"key",fieldLabel:"Key",anchor:"100%",hidden:true},{xtype:"combo",name:"group",fieldLabel:"Group",queryMode:"local",store:"CodeGroupStore",displayField:"group",valueField:"group",anchor:"100%"},{xtype:"textfield",name:"code",fieldLabel:"Code",anchor:"100%"},{xtype:"textfield",name:"desc",fieldLabel:"Description",anchor:"100%"},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:F("datetime"),anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",itemId:"save",text:"Save"},{xtype:"button",itemId:"delete",text:"Delete"},{xtype:"button",itemId:"reset",text:"Reset"}]}]}});Ext.define("GreenFleet.view.management.Vehicle",{extend:"Ext.container.Container",alias:"widget.management_vehicle",title:"Vehicle",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">Vehicle List</div>'},initComponent:function(){this.callParent(arguments);this.list=this.add(this.buildList(this));var a=this.add(this.buildForm(this));this.form=a.down("form")},importUrl:"vehicle/import",afterImport:function(){this.down("gridpanel").store.load();this.form.getForm().reset()},buildList:function(a){return{xtype:"gridpanel",store:"VehicleStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"id",text:"Vehicle Id",type:"string"},{dataIndex:"registrationNumber",text:"RegistrationNumber",type:"string"},{dataIndex:"manufacturer",text:"Manufacturer",type:"string"},{dataIndex:"vehicleType",text:"VehicleType",type:"string"},{dataIndex:"birthYear",text:"BirthYear",type:"string"},{dataIndex:"ownershipType",text:"OwnershipType",type:"string"},{dataIndex:"status",text:"Status",type:"string"},{dataIndex:"totalDistance",text:"TotalDistance",type:"string"},{dataIndex:"remainingFuel",text:"RemainingFuel",type:"string"},{dataIndex:"distanceSinceNewOil",text:"DistanceSinceNewOil",type:"string"},{dataIndex:"engineOilStatus",text:"EngineOilStatus",type:"string"},{dataIndex:"fuelFilterStatus",text:"FuelFilterStatus",type:"string"},{dataIndex:"brakeOilStatus",text:"BrakeOilStatus",type:"string"},{dataIndex:"brakePedalStatus",text:"BrakePedalStatus",type:"string"},{dataIndex:"coolingWaterStatus",text:"CoolingWaterStatus",type:"string"},{dataIndex:"timingBeltStatus",text:"TimingBeltStatus",type:"string"},{dataIndex:"sparkPlugStatus",text:"SparkPlugStatus",type:"string"},{dataIndex:"lattitude",text:"Lattitude"},{dataIndex:"longitude",text:"Longitude"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{render:function(b){b.store.load()},itemclick:function(c,b){var d=a.form;d.loadRecord(b)}},onSearch:function(c){var b=c.down("textfield[name=idFilter]");var d=c.down("textfield[name=nameFilter]");c.store.clearFilter();c.store.filter([{property:"id",value:b.getValue()},{property:"registrationNumber",value:d.getValue()}])},onReset:function(b){b.down("textfield[name=idFilter]").setValue("");b.down("textfield[name=nameFilter]").setValue("")},tbar:["ID",{xtype:"textfield",name:"idFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},"Registeration Number",{xtype:"textfield",name:"nameFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find Vehicle",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"Reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}]}},buildForm:function(a){return{xtype:"panel",bodyPadding:10,cls:"hIndexbar",title:"Vehicle Details",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"form",flex:1,autoScroll:true,defaults:{anchor:"100%",},items:[{xtype:"textfield",name:"key",fieldLabel:"Key",hidden:true},{xtype:"textfield",name:"id",fieldLabel:"Vehicle Id",anchor:"100%"},{xtype:"textfield",name:"registrationNumber",fieldLabel:"Registration Number",anchor:"100%"},{xtype:"combo",name:"manufacturer",queryMode:"local",store:"ManufacturerStore",displayField:"name",valueField:"name",fieldLabel:"Manufacturer",anchor:"100%"},{xtype:"combo",name:"vehicleType",queryMode:"local",store:"VehicleTypeStore",displayField:"desc",valueField:"name",fieldLabel:"Vehicle Type",anchor:"100%"},{xtype:"filefield",name:"imageFile",fieldLabel:"Image Upload",msgTarget:"side",allowBlank:true,anchor:"100%",buttonText:"file..."},{xtype:"textfield",name:"birthYear",fieldLabel:"BirthYear",anchor:"100%"},{xtype:"combo",name:"ownershipType",queryMode:"local",store:"OwnershipStore",displayField:"desc",valueField:"name",fieldLabel:"Ownership Type",anchor:"100%"},{xtype:"combo",name:"status",queryMode:"local",store:"VehicleStatusStore",displayField:"desc",valueField:"status",fieldLabel:"Status",anchor:"100%"},{xtype:"textfield",name:"totalDistance",fieldLabel:"Total Distance",anchor:"100%"},{xtype:"textfield",name:"remainingFuel",fieldLabel:"Remaining Fuel",anchor:"100%"},{xtype:"textfield",name:"distanceSinceNewOil",fieldLabel:"Distance Since NewOil",anchor:"100%"},{xtype:"textfield",name:"engineOilStatus",fieldLabel:"EngineOil Status",anchor:"100%"},{xtype:"textfield",name:"fuelFilterStatus",fieldLabel:"FuelFilter Status",anchor:"100%"},{xtype:"textfield",name:"brakeOilStatus",fieldLabel:"BrakeOil Status",anchor:"100%"},{xtype:"textfield",name:"brakePedalStatus",fieldLabel:"BrakePedal Status",anchor:"100%"},{xtype:"textfield",name:"coolingWaterStatus",fieldLabel:"CoolingWater Status",anchor:"100%"},{xtype:"textfield",name:"timingBeltStatus",fieldLabel:"TimingBeltStatus",anchor:"100%"},{xtype:"textfield",name:"sparkPlugStatus",fieldLabel:"SparkPlugStatus",anchor:"100%"},{xtype:"textfield",name:"lattitude",fieldLabel:"Lattitude",disabled:true,anchor:"100%"},{xtype:"textfield",name:"longitude",fieldLabel:"Longitude",disabled:true,anchor:"100%"},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:F("datetime"),anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"},{xtype:"displayfield",name:"imageClip",hidden:true,listeners:{change:function(d,c){var b=a.form.nextSibling("container").down("image");if(c!=null&&c.length>0){b.setSrc("download?blob-key="+c)}else{b.setSrc("resources/image/bgVehicle.png")}}}}]},{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},cls:"noImage paddingLeft10",items:[{xtype:"image",height:"100%",itemId:"image"}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"vehicle/save",success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"vehicle/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result)}})}}},{xtype:"button",text:"New",handler:function(){a.form.getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.management.Terminal",{extend:"Ext.container.Container",alias:"widget.management_terminal",title:"Terminal",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">Terminal List</div>'},initComponent:function(){this.callParent(arguments);this.list=this.add(this.buildList(this));var a=this.add(this.buildForm(this));this.form=a.down("form")},importUrl:"terminal/import",afterImport:function(){this.down("gridpanel").store.load();this.form.getForm().reset()},buildList:function(a){return{xtype:"gridpanel",store:"TerminalStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"id",text:"Terminal Id",type:"string"},{dataIndex:"serialNo",text:"Serial No.",type:"string"},{dataIndex:"buyingDate",text:"Buying Date",xtype:"datecolumn",format:F("date")},{dataIndex:"comment",text:"Comment",type:"string",width:160},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{render:function(b){b.store.load()},itemclick:function(c,b){var d=a.form;d.loadRecord(b)}},onSearch:function(c){var b=c.down("textfield[name=idFilter]");var d=c.down("textfield[name=serialNoFilter]");c.store.clearFilter();c.store.filter([{property:"id",value:b.getValue()},{property:"serialNo",value:d.getValue()}])},onReset:function(b){b.down("textfield[name=idFilter]").setValue("");b.down("textfield[name=serialNoFilter]").setValue("")},tbar:["ID",{xtype:"textfield",name:"idFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},"Name",{xtype:"textfield",name:"serialNoFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find Terminal",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"Reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}]}},buildForm:function(a){return{xtype:"panel",itemId:"details",bodyPadding:10,cls:"hIndexbar",title:"Terminal Details",autoScroll:true,layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"form",flex:1,items:[{xtype:"textfield",name:"key",fieldLabel:"Key",anchor:"100%",hidden:true},{xtype:"textfield",name:"id",fieldLabel:"Terminal Id",anchor:"100%"},{xtype:"textfield",name:"serialNo",fieldLabel:"Serial No.",anchor:"100%"},{xtype:"datefield",name:"buyingDate",fieldLabel:"Buying Date",anchor:"100%",format:F("date"),submitFormat:"U"},{xtype:"textarea",name:"comment",fieldLabel:"Comment",anchor:"100%"},{xtype:"filefield",name:"imageFile",fieldLabel:"Image Upload",msgTarget:"side",allowBlank:true,anchor:"100%",buttonText:"file..."},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:F("datetime"),anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"},{xtype:"displayfield",name:"imageClip",hidden:true,listeners:{change:function(d,c){var b=a.form.nextSibling("container").down("image");if(c!=null&&c.length>0){b.setSrc("download?blob-key="+c)}else{b.setSrc("resources/image/bgTerminal.png")}}}}]},{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},cls:"noImage paddingLeft10",items:[{xtype:"image",height:"100%",itemId:"image"}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"terminal/save",headers:{"Content-Type":"multipart/form-data; charset=UTF-8"},success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"terminal/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result)}})}}},{xtype:"button",text:"New",handler:function(){a.form.getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.management.Reservation",{extend:"Ext.container.Container",alias:"widget.management_reservation",title:"Reservation",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">Reservation List</div>'},initComponent:function(){this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this))},buildList:function(a){return{xtype:"gridpanel",store:"ReservationStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"id",text:"ID",type:"string"},{dataIndex:"reservedDate",text:"Reserved Date",type:"string",format:F("date")},{dataIndex:"driver",text:"Driver",type:"string"},{dataIndex:"vehicle",text:"Vehicle",type:"string"},{dataIndex:"vehicleType",text:"Vehicle Type",type:"string"},{dataIndex:"deliveryPlace",text:"Delivery Place",type:"string"},{dataIndex:"destination",text:"Destination",type:"string"},{dataIndex:"purpose",text:"Purpose",type:"string"},{dataIndex:"status",text:"Status",type:"string"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{itemclick:function(c,b){var d=a.down("form");d.loadRecord(b)}},onSearch:function(b){var c=b.down("textfield[name=idFilter]");var d=b.down("textfield[name=vehicleFilter]");b.store.load({filters:[{property:"id",value:c.getValue()},{property:"vehicle",value:d.getValue()}]})},onReset:function(b){b.down("textfield[name=idFilter]").setValue("");b.down("textfield[name=vehicleFilter]").setValue("")},tbar:["Reservation ID",{xtype:"textfield",name:"idFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},"Vehicle",{xtype:"textfield",name:"vehicleFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find Reservation",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}]}},buildForm:function(a){return{xtype:"form",bodyPadding:10,cls:"hIndexbar",title:"Reservation Details",autoScroll:true,flex:1,items:[{xtype:"textfield",name:"key",fieldLabel:"Key",anchor:"100%",hidden:true},{xtype:"textfield",name:"id",fieldLabel:"Reservation ID",anchor:"100%"},{xtype:"datefield",name:"reservedDate",disabled:true,fieldLabel:"Reserved Date",format:F("date"),anchor:"100%"},{xtype:"textfield",name:"vehicleType",fieldLabel:"Vehicle Type",anchor:"100%"},{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"key",fieldLabel:"Vehicle",anchor:"100%"},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"name",valueField:"key",fieldLabel:"Driver",anchor:"100%"},{xtype:"textfield",name:"status",fieldLabel:"Status",anchor:"100%"},{xtype:"textfield",name:"deliveryPlace",fieldLabel:"Delivery Place",anchor:"100%"},{xtype:"textfield",name:"destination",fieldLabel:"Destination",anchor:"100%"},{xtype:"textfield",name:"purpose",fieldLabel:"Purpose",anchor:"100%"},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:F("datetime"),anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"reservation/save",success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){console.log(d);GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"reservation/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Reset",handler:function(){this.up("form").getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.management.Incident",{extend:"Ext.container.Container",alias:"widget.management_incident",title:"Incident",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">Incident List</div>'},initComponent:function(){this.callParent(arguments);this.list=this.add(this.buildList(this));var a=this.add(this.buildForm(this));this.form=a.down("form")},buildList:function(a){return{xtype:"gridpanel",store:"IncidentStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"incidentTime",text:"Incident Time",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"driver",text:"Driver",type:"string"},{dataIndex:"vehicle",text:"Vehicle",type:"string"},{dataIndex:"terminal",text:"Terminal",type:"string"},{dataIndex:"lattitude",text:"Lattitude",type:"number"},{dataIndex:"longitude",text:"Longitude",type:"number"},{dataIndex:"impulse",text:"Impulse",type:"number"},{dataIndex:"impulseThreshold",text:"Impulse Threshold",type:"number"},{dataIndex:"obdConnected",text:"OBD Connected",type:"boolean"},{dataIndex:"engineTemp",text:"Engine Temp.",type:"number"},{dataIndex:"engineTempThreshold",text:"Engine Temp. Threshold",type:"number"},{dataIndex:"remainingFuel",text:"Remaining Fuel",type:"number"},{dataIndex:"fuelThreshold",text:"Fuel Threshold",type:"number"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime")},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime")}],viewConfig:{},listeners:{itemclick:function(c,b){var d=a.down("form");d.loadRecord(b)}},onSearch:function(b){var d=b.down("textfield[name=vehicleFilter]");var c=b.down("textfield[name=driverFilter]");b.store.load({filters:[{property:"vehicle",value:d.getValue()},{property:"driver",value:c.getValue()}]})},onReset:function(b){b.down("textfield[name=vehicleFilter]").setValue("");b.down("textfield[name=driverFilter]").setValue("")},tbar:[{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle",name:"vehicleFilter",width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver",name:"driverFilter",width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find Incident",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"Reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}],}},buildForm:function(a){return{xtype:"panel",bodyPadding:10,cls:"hIndexbar",title:"Incident Details",autoScroll:true,layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"form",flex:1,autoScroll:true,defaults:{anchor:"100%"},items:[{xtype:"textfield",name:"key",fieldLabel:"Key",hidden:true},{xtype:"datefield",name:"incidentTime",fieldLabel:"Incident Time",submitFormat:"U"},{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle"},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver"},{xtype:"combo",name:"terminal",queryMode:"local",store:"TerminalStore",displayField:"id",valueField:"id",fieldLabel:"Terminal"},{xtype:"textfield",name:"lattitude",fieldLabel:"Lattitude"},{xtype:"textfield",name:"longitude",fieldLabel:"Longitude"},{xtype:"textfield",name:"impulse",fieldLabel:"Impulse"},{xtype:"textfield",name:"impulseThreshold",fieldLabel:"Impulse Threshold"},{xtype:"checkbox",name:"obdConnected",fieldLabel:"OBD Connected"},{xtype:"textfield",name:"engineTemp",fieldLabel:"Engine Temp."},{xtype:"textfield",name:"engineTempThreshold",fieldLabel:"Engine Temp. Threshold"},{xtype:"textfield",name:"remainingFuel",fieldLabel:"Remaining Fuel"},{xtype:"textfield",name:"fuelThreshold",fieldLabel:"Fuel Threshhold"},{xtype:"filefield",name:"videoFile",fieldLabel:"Video Upload",msgTarget:"side",allowBlank:true,buttonText:"file..."},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:"d-m-Y H:i:s"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:"d-m-Y H:i:s"},{xtype:"displayfield",name:"videoClip",hidden:true,listeners:{change:function(d,c){var b=a.form.nextSibling("container").getComponent("video");b.update({value:c})}}}]},{xtype:"panel",cls:"incidentVOD paddingLeft10",flex:1,layout:{type:"vbox",align:"stretch",itemCls:"test"},items:[{xtype:"box",itemId:"video",cls:" incidentDetail",tpl:['<video width="100%" height="95%" controls="controls">','<source src="download?blob-key={value}" type="video/mp4" />',"Your browser does not support the video tag.","</video>"]},{xtype:"box",html:'<div class="btnFullscreen"></div>',handler:function(b){if(!Ext.isWebKit){return}var c=b.up("container").getComponent("video");c.getEl().dom.getElementsByTagName("video")[0].webkitEnterFullscreen()}}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"incident/save",success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"incident/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Reset",handler:function(){a.form.getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.management.Driver",{extend:"Ext.container.Container",alias:"widget.management_driver",title:"Driver",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">Driver List</div>'},initComponent:function(){this.callParent(arguments);this.list=this.add(this.buildList(this));var a=this.add(this.buildForm(this));this.form=a.down("form")},importUrl:"driver/import",afterImport:function(){this.down("gridpanel").store.load();this.form.getForm().reset()},buildList:function(a){return{xtype:"gridpanel",store:"DriverStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"name",text:"Name",type:"string"},{dataIndex:"id",text:"Employee Id",type:"string"},{dataIndex:"division",text:"Division",type:"string"},{dataIndex:"title",text:"Title",type:"string"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{render:function(b){b.store.load()},itemclick:function(c,b){var d=a.form;d.loadRecord(b)}},onSearch:function(c){var b=c.down("textfield[name=idFilter]");var d=c.down("textfield[name=nameFilter]");c.store.clearFilter();c.store.filter([{property:"id",value:b.getValue()},{property:"name",value:d.getValue()}])},onReset:function(b){b.down("textfield[name=idFilter]").setValue("");b.down("textfield[name=nameFilter]").setValue("")},tbar:["ID",{xtype:"textfield",name:"idFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},"Name",{xtype:"textfield",name:"nameFilter",hideLabel:true,width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find Driver",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"Reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}]}},buildForm:function(a){return{xtype:"panel",itemId:"details",bodyPadding:10,cls:"hIndexbar",title:"Driver Details",autoScroll:true,layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"form",flex:1,items:[{xtype:"textfield",name:"key",fieldLabel:"Key",anchor:"100%",hidden:true},{xtype:"textfield",name:"name",fieldLabel:"Name",anchor:"100%"},{xtype:"textfield",name:"id",fieldLabel:"Employee Id",anchor:"100%"},{xtype:"textfield",name:"division",fieldLabel:"Division",anchor:"100%"},{xtype:"textfield",name:"title",fieldLabel:"Title",anchor:"100%"},{xtype:"filefield",name:"imageFile",fieldLabel:"Image Upload",msgTarget:"side",allowBlank:true,anchor:"100%",buttonText:"file..."},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:F("datetime"),anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"},{xtype:"displayfield",name:"imageClip",hidden:true,listeners:{change:function(d,c){var b=a.form.nextSibling("container").down("image");if(c!=null&&c.length>0){b.setSrc("download?blob-key="+c)}else{b.setSrc("resources/image/bgDriver.png")}}}}]},{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},cls:"noImage paddingLeft10",items:[{xtype:"image",height:"100%",itemId:"image"}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"driver/save",headers:{"Content-Type":"multipart/form-data; charset=UTF-8"},success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=a.form.getForm();if(b.isValid()){b.submit({url:"driver/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result)}})}}},{xtype:"button",text:"New",handler:function(){a.form.getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.management.Track",{extend:"Ext.container.Container",alias:"widget.management_track",title:"Track",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">Incident List</div>'},initComponent:function(){this.callParent(arguments);this.list=this.add(this.buildList(this));this.form=this.add(this.buildForm(this))},importUrl:"track/import",afterImport:function(){this.down("gridpanel").store.load();this.form.getForm().reset()},buildList:function(a){return{xtype:"gridpanel",store:"TrackStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"vehicle",text:"Vehicle",type:"string"},{dataIndex:"driver",text:"Driver",type:"string"},{dataIndex:"lattitude",text:"Lattitude",type:"number"},{dataIndex:"longitude",text:"Longitude",type:"number"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{itemclick:function(c,b){var d=a.form;d.loadRecord(b)}},onSearch:function(b){var d=b.down("textfield[name=vehicleFilter]");var c=b.down("textfield[name=driverFilter]");b.store.load({filters:[{property:"vehicle",value:d.getValue()},{property:"driver",value:c.getValue()}]})},onReset:function(b){b.down("textfield[name=vehicleFilter]").setValue("");b.down("textfield[name=driverFilter]").setValue("")},tbar:[{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle",name:"vehicleFilter",width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver",name:"driverFilter",width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find Track",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"Reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}]}},buildForm:function(a){return{xtype:"form",bodyPadding:10,cls:"hIndexbar",title:"Tracking Details",autoScroll:true,flex:1,items:[{xtype:"textfield",name:"key",fieldLabel:"Key",anchor:"100%",hidden:true},{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle",anchor:"100%"},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver",anchor:"100%"},{xtype:"textfield",name:"lattitude",fieldLabel:"Lattitude",anchor:"100%"},{xtype:"textfield",name:"longitude",fieldLabel:"Longitude",anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"track/save",success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"track/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Reset",handler:function(){this.up("form").getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.management.ControlData",{extend:"Ext.container.Container",alias:"widget.management_control_data",title:"ControlData",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">ControlData List</div>'},initComponent:function(){this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this))},buildList:function(a){return{xtype:"gridpanel",store:"ControlDataStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"vehicle",text:"Vehicle",},{dataIndex:"driver",text:"Driver",},{dataIndex:"date",text:"Date",xtype:"datecolumn",format:F("date")},{dataIndex:"startTime",text:"Start Time",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"endTime",text:"End Time",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"distance",text:"Distance",},{dataIndex:"runningTime",text:"Running Time",},{dataIndex:"averageSpeed",text:"Average Speed",},{dataIndex:"highestSpeed",text:"Highest Speed",},{dataIndex:"suddenAccelCount",text:"Sudden Accel Count",},{dataIndex:"suddenBrakeCount",text:"Sudden Brake Count",},{dataIndex:"econoDrivingRatio",text:"Econo Driving Ratio",},{dataIndex:"fuelEfficiency",text:"Fuel Efficiency",},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{itemclick:function(c,b){var d=a.down("form");d.loadRecord(b)}},onSearch:function(b){var d=b.down("textfield[name=vehicleFilter]");var c=b.down("textfield[name=driverFilter]");b.store.load({filters:[{property:"vehicle",value:d.getValue()},{property:"driver",value:c.getValue()}]})},onReset:function(b){b.down("textfield[name=vehicleFilter]").setValue("");b.down("textfield[name=driverFilter]").setValue("")},tbar:[{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle",name:"vehicleFilter",width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver",name:"driverFilter",width:200,listeners:{specialkey:function(d,c){if(c.getKey()==c.ENTER){var b=this.up("gridpanel");b.onSearch(b)}}}},{xtype:"button",text:"Search",tooltip:"Find ControlData",handler:function(){var b=this.up("gridpanel");b.onSearch(b)}},{text:"Reset",handler:function(){var b=this.up("gridpanel");b.onReset(b)}}]}},buildForm:function(a){return{xtype:"form",bodyPadding:10,cls:"hIndexbar",title:"ControlData Details",autoScroll:true,flex:1,items:[{xtype:"textfield",name:"key",fieldLabel:"Key",anchor:"100%",hidden:true},{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle",anchor:"100%"},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver",anchor:"100%"},{xtype:"datefield",name:"date",fieldLabel:"Date",format:F("date"),submitFormat:"U",anchor:"100%"},{xtype:"datefield",name:"startTime",fieldLabel:"Start Time",format:F("datetime"),submitFormat:"U",anchor:"100%"},{xtype:"datefield",name:"endTime",fieldLabel:"End Time",format:F("datetime"),submitFormat:"U",anchor:"100%"},{name:"distance",fieldLabel:"Distance",anchor:"100%"},{xtype:"textfield",name:"runningTime",fieldLabel:"Running Time",anchor:"100%"},{xtype:"textfield",name:"averageSpeed",fieldLabel:"Average Speed",anchor:"100%"},{xtype:"textfield",name:"highestSpeed",fieldLabel:"Highest Speed",anchor:"100%"},{xtype:"textfield",name:"suddenAccelCount",fieldLabel:"Sudden Accel Count",anchor:"100%"},{xtype:"textfield",name:"suddenBrakeCount",fieldLabel:"Sudden Brake Count",anchor:"100%"},{xtype:"textfield",name:"econoDrivingRatio",fieldLabel:"Econo Driving Ratio",anchor:"100%"},{xtype:"textfield",name:"fuelEfficiency",fieldLabel:"Fuel Efficiency",anchor:"100%"},{xtype:"datefield",name:"createdAt",disabled:true,fieldLabel:"Created At",format:F("datetime"),anchor:"100%"},{xtype:"datefield",name:"updatedAt",disabled:true,fieldLabel:"Updated At",format:F("datetime"),anchor:"100%"}],dockedItems:[{xtype:"toolbar",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{xtype:"button",text:"Save",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"control_data/save",success:function(d,e){var c=a.down("gridpanel").store;c.load(function(){d.loadRecord(c.findRecord("key",e.result.key))})},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Delete",handler:function(){var b=this.up("form").getForm();if(b.isValid()){b.submit({url:"control_data/delete",success:function(c,d){a.down("gridpanel").store.load();c.reset()},failure:function(c,d){GreenFleet.msg("Failed",d.result.msg)}})}}},{xtype:"button",text:"Reset",handler:function(){this.up("form").getForm().reset()}}]}]}}});Ext.define("GreenFleet.view.monitor.Map",{extend:"Ext.Container",alias:"widget.monitor_map",title:"Maps",layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[this.ztitle,this.zmap];this.callParent();var a=this;this.on("afterrender",function(){var b=Ext.getStore("VehicleStore");b.on("load",a.refreshMap,a);b.on("load",Ext.getCmp("east").refreshVehicleCounts,Ext.getCmp("east"));b.load()});this.on("activate",function(){google.maps.event.trigger(a.getMap(),"resize");if(a.sub("autofit").getValue()){a.refreshMap(Ext.getStore("VehicleStore"))}});Ext.getCmp("east").sub("state_running").on("click",function(){a.refreshMarkers()});Ext.getCmp("east").sub("state_idle").on("click",function(){a.refreshMarkers()});Ext.getCmp("east").sub("state_incident").on("click",function(){a.refreshMarkers()});this.sub("autofit").on("change",function(b,c){if(c){a.refreshMap(Ext.getStore("VehicleStore"))}})},refreshMarkers:function(){var d=this.getMarkers();var e=this.getLabels();for(var c in d){var a=d[c];var b=e[c];switch(a.status){case"Running":a.setVisible(GreenFleet.show_running_vehicle);b.setVisible(GreenFleet.show_running_vehicle);break;case"Idle":a.setVisible(GreenFleet.show_idle_vehicle);b.setVisible(GreenFleet.show_idle_vehicle);break;case"Incident":a.setVisible(GreenFleet.show_incident_vehicle);b.setVisible(GreenFleet.show_incident_vehicle);break}}},getMap:function(){if(!this.map){this.map=new google.maps.Map(this.sub("mapbox").getEl().down(".map").dom,{zoom:10,center:new google.maps.LatLng(System.props.lattitude,System.props.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP})}return this.map},getMarkers:function(){if(!this.markers){this.markers={}}return this.markers},getLabels:function(){if(!this.labels){this.labels={}}return this.labels},resetLabels:function(){for(var a in this.labels){this.labels[a].setMap(null)}this.labels={}},resetMarkers:function(){for(var a in this.markers){google.maps.event.clearListeners(this.markers[a]);this.markers[a].setMap(null)}this.markers={}},refreshMap:function(b){this.resetMarkers();this.resetLabels();var a={Running:"resources/image/statusDriving.png",Idle:"resources/image/statusStop.png",Incident:"resources/image/statusIncident.png"};var c;b.each(function(f){var i=f.get("id");var h=f.get("driver");var e=Ext.getStore("DriverStore").findRecord("id",h);var j=new google.maps.LatLng(f.get("lattitude"),f.get("longitude"));var d=new google.maps.Marker({position:j,map:this.getMap(),status:f.get("status"),icon:a[f.get("status")],title:e?e.get("name"):h,tooltip:f.get("registrationNumber")+"("+(e?e.get("name"):h)+")"});if(!c){c=new google.maps.LatLngBounds(j,j)}else{c.extend(j)}var g=new Label({map:this.getMap()});g.bindTo("position",d,"position");g.bindTo("text",d,"tooltip");this.getMarkers()[i]=d;this.getLabels()[i]=g;google.maps.event.addListener(d,"click",function(){GreenFleet.doMenu("information");GreenFleet.getMenu("information").setVehicle(f)})},this);if(!c||c.isEmpty()||c.getNorthEast().equals(c.getSouthWest())){this.getMap().setCenter(new google.maps.LatLng(System.props.lattitude,System.props.longitude))}else{this.getMap().fitBounds(c)}this.refreshMarkers()},ztitle:{xtype:"container",cls:"pageTitle",height:35,layout:{type:"hbox",align:"stretch"},items:[{flex:1,html:"<h1>Information</h1>"},{xtype:"checkboxgroup",width:80,defaults:{boxLabelAlign:"before",width:80,checked:true,labelWidth:50,labelSeparator:""},items:[{fieldLabel:"Autofit",itemId:"autofit"}]}]},zmap:{xtype:"panel",flex:1,itemId:"mapbox",html:'<div class="map" style="height:100%"></div>'}});Ext.define("GreenFleet.view.monitor.ControlByVehicle",{extend:"Ext.grid.Panel",alias:"widget.monitor_control_by_vehicle",title:"Control By Vehicle",store:"ControlDataStore",autoScroll:true,listeners:{},onSearch:function(a){var c=a.down("textfield[name=vehicleFilter]");var b=a.down("textfield[name=driverFilter]");a.store.load({filters:[{property:"vehicle",value:c.getValue()},{property:"driver",value:b.getValue()}]})},onReset:function(a){a.down("textfield[name=vehicleFilter]").setValue("");a.down("textfield[name=driverFilter]").setValue("")},tbar:[{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle",name:"vehicleFilter",width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver",name:"driverFilter",width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},{xtype:"button",text:"Search",tooltip:"Find ControlData",handler:function(){var a=this.up("gridpanel");a.onSearch(a)}},{text:"Reset",handler:function(){var a=this.up("gridpanel");a.onReset(a)}}],columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"vehicle",text:"Vehicle",},{dataIndex:"driver",text:"Driver",},{dataIndex:"date",text:"Date",xtype:"datecolumn",format:"d-m-Y"},{dataIndex:"startTime",text:"Start Time",xtype:"datecolumn",format:"d-m-Y H:i:s"},{dataIndex:"endTime",text:"End Time",xtype:"datecolumn",format:"d-m-Y H:i:s"},{dataIndex:"distance",text:"Distance",},{dataIndex:"runningTime",text:"Running Time",},{dataIndex:"averageSpeed",text:"Average Speed",},{dataIndex:"highestSpeed",text:"Highest Speed",},{dataIndex:"suddenAccelCount",text:"Sudden Accel Count",},{dataIndex:"suddenBrakeCount",text:"Sudden Brake Count",},{dataIndex:"econoDrivingRatio",text:"Econo Driving Ratio",},{dataIndex:"fuelEfficiency",text:"Fuel Efficiency",},{dataIndex:"longitude",text:"Longitude",},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}]});Ext.define("GreenFleet.view.monitor.InfoByVehicle",{extend:"Ext.grid.Panel",alias:"widget.monitor_info_by_vehicle",title:"Information By Vehicle",store:"VehicleStore",autoScroll:true,columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"id",text:"Vehicle Id"},{dataIndex:"registrationNumber",text:"RegistrationNumber"},{dataIndex:"manufacturer",text:"Manufacturer"},{dataIndex:"vehicleType",text:"VehicleType",width:80},{dataIndex:"birthYear",text:"BirthYear",width:40,align:"right"},{dataIndex:"ownershipType",text:"OwnershipType",width:40,align:"center"},{dataIndex:"status",text:"Status",type:"string",width:60,align:"center"},{dataIndex:"imageClip",text:"ImageClip",type:"string",hidden:true},{dataIndex:"totalDistance",text:"TotalDistance",width:60,align:"right"},{dataIndex:"remainingFuel",text:"RemainingFuel",width:60,align:"right"},{dataIndex:"distanceSinceNewOil",text:"DistanceSinceNewOil",width:60,align:"right"},{dataIndex:"engineOilStatus",text:"EngineOilStatus",width:60,align:"right"},{dataIndex:"fuelFilterStatus",text:"FuelFilterStatus",width:60,align:"right"},{dataIndex:"brakeOilStatus",text:"BrakeOilStatus",width:60,align:"center"},{dataIndex:"brakePedalStatus",text:"BrakePedalStatus",width:60,align:"center"},{dataIndex:"coolingWaterStatus",text:"CoolingWaterStatus",width:60,align:"center"},{dataIndex:"timingBeltStatus",text:"TimingBeltStatus",width:60,align:"center"},{dataIndex:"sparkPlugStatus",text:"SparkPlugStatus",width:60,align:"center"},{dataIndex:"lattitude",text:"Lattitude",width:60,align:"right"},{dataIndex:"longitude",text:"Longitude",width:60,align:"right"},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{render:function(a){a.store.load()},itemclick:function(b,a){var c=b.up("monitor_information").down("form");c.loadRecord(a)}},onSearch:function(b){var a=b.down("textfield[name=idFilter]");var c=b.down("textfield[name=nameFilter]");b.store.clearFilter();b.store.filter([{property:"id",value:a.getValue()},{property:"registrationNumber",value:c.getValue()}])},onReset:function(a){a.down("textfield[name=idFilter]").setValue("");a.down("textfield[name=nameFilter]").setValue("")},tbar:["ID",{xtype:"textfield",name:"idFilter",hideLabel:true,width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},"Registeration Number",{xtype:"textfield",name:"nameFilter",hideLabel:true,width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},{xtype:"button",text:"Search",tooltip:"Find Vehicle",handler:function(){var a=this.up("gridpanel");a.onSearch(a)}},{text:"Reset",handler:function(){var a=this.up("gridpanel");a.onReset(a)}}]});Ext.define("GreenFleet.view.monitor.Information",{extend:"Ext.Container",alias:"widget.monitor_information",id:"monitor_information",layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[this.ztitle,{xtype:"container",height:300,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",width:620,layout:{type:"vbox",align:"stretch"},items:[this.zvehicleinfo,this.zincidents]},this.zmap]},this.ztabpanel];this.callParent();var a=this;this.sub("map").on("afterrender",function(b){var c={zoom:10,center:new google.maps.LatLng(System.props.lattitude,System.props.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};a.setMap(new google.maps.Map(b.getEl().down(".map").dom,c));google.maps.event.addListener(a.getMap(),"click",function(d){Ext.Ajax.request({url:"track/save",method:"POST",params:{vehicle:a.getVehicle(),driver:a.getDriver(),lattitude:d.latLng.lat(),longitude:d.latLng.lng()},success:function(g,e){var f=a.getTrackLine().getPath();f.insertAt(0,d.latLng);Ext.getStore("VehicleStore").load()},failure:function(f,e){console.log("Failed");console.log(f)}})})});this.on("activate",function(){google.maps.event.trigger(a.getMap(),"resize")});this.getTrackStore().on("load",function(){a.refreshTrack()});this.getIncidentStore().on("load",function(){if(a.isVisible(true)){a.refreshIncidents()}});this.sub("id").on("change",function(m,e){var j=a.getForm().getRecord();var k=Ext.getStore("VehicleStore");var i=k.findRecord("id",j.get("id"));var h=i.get("imageClip");if(h){a.sub("vehicleImage").setSrc("download?blob-key="+h)}else{a.sub("vehicleImage").setSrc("resources/image/bgVehicle.png")}a.sub("title").vehicle.dom.innerHTML=e+"["+i.get("registrationNumber")+"]";var g=Ext.getStore("DriverStore");var c=g.findRecord("id",j.get("driver"));var o=c.get("id");var f=c.get("imageClip");if(f){a.sub("driverImage").setSrc("download?blob-key="+f)}else{a.sub("driverImage").setSrc("resources/image/bgDriver.png")}a.sub("title").driver.dom.innerHTML=o+"["+c.get("name")+"]";var n=j.get("location");if(n==null||n.length==0){var l=j.get("lattitude");var b=j.get("longitude");if(!l||!b){return}var d=new google.maps.LatLng(l,b);geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:d},function(r,q){if(q==google.maps.GeocoderStatus.OK){if(r[0]){var p=r[0].formatted_address;j.set("location",p);a.sub("location").setValue(p)}}else{console.log("Geocoder failed due to: "+q)}})}a.getTrackStore().clearFilter(true);a.getTrackStore().filter("vehicle",e);a.getTrackStore().load();a.getIncidentStore().clearFilter(true);a.getIncidentStore().filter("vehicle",e);a.getIncidentStore().load()})},setVehicle:function(a){this.getForm().loadRecord(a)},getForm:function(){if(!this.form){this.form=this.down("form")}return this.form},getMap:function(){return this.map},setMap:function(a){this.map=a},getTrackLine:function(){return this.trackline},setTrackLine:function(a){if(this.trackline){this.trackline.setMap(null)}this.trackline=a},getMarker:function(){return this.marker},setMarker:function(a){if(this.marker){this.marker.setMap(null)}this.marker=a},resetMarkers:function(){if(this.markers){this.markers.setMap(null)}this.markers=null},getTrackStore:function(){if(!this.trackStore){this.trackStore=Ext.getStore("TrackByVehicleStore")}return this.trackStore},getIncidentStore:function(){if(!this.incidentStore){this.incidentStore=Ext.getStore("IncidentStore")}return this.incidentStore},getVehicle:function(){return this.sub("id").getValue()},getDriver:function(){return this.sub("driver").getValue()},refreshTrack:function(){this.setTrackLine(new google.maps.Polyline({map:this.getMap(),strokeColor:"#770000",strokeOpacity:0.7,strokeWeight:4}));this.setMarker(null);var c=this.getTrackLine().getPath();var a;var e;this.getTrackStore().each(function(f){e=new google.maps.LatLng(f.get("lattitude"),f.get("longitude"));c.push(e);if(!a){a=new google.maps.LatLngBounds(e,e)}else{a.extend(e)}});if(!a){var b=new google.maps.LatLng(System.props.lattitude,System.props.longitude);a=new google.maps.LatLngBounds(b,b)}if(a.isEmpty()||a.getNorthEast().equals(a.getSouthWest())){this.getMap().setCenter(a.getNorthEast())}else{this.getMap().fitBounds(a)}var d=this.getTrackStore().first();if(d){this.setMarker(new google.maps.Marker({position:new google.maps.LatLng(d.get("lattitude"),d.get("longitude")),map:this.getMap()}))}},incidentHandler:function(c,a,b){GreenFleet.doMenu("monitor_incident");GreenFleet.getMenu("monitor_incident").setIncident(b,true)},refreshIncidents:function(){this.sub("incidents").removeAll();var a=this.getIncidentStore().count()>4?4:this.getIncidentStore().count();for(var c=0;c<a;c++){var d=this.getIncidentStore().getAt(c);var b=this;this.sub("incidents").add({xtype:"box",cls:"incidentThumb",listeners:{render:function(){this.getEl().on("click",b.incidentHandler,b,d)}},html:'<div class="vehicle">'+d.get("vehicle")+'</div><div class="driver">'+d.get("driver")+'</div><div class="date">'+Ext.Date.format(d.get("incidentTime"),"Y-m-d H:i:s")+"</div>"})}},ztitle:{xtype:"box",cls:"pageTitle",itemId:"title",renderSelectors:{vehicle:"span.vehicle",driver:"span.driver"},renderTpl:'<h1>Vehicle : <span class="vehicle">Vehicle</span>, Driver : <span class="driver">Driver</span></h1>',height:35},ztabpanel:{xtype:"tabpanel",flex:1,items:[{xtype:"monitor_info_by_vehicle",},{xtype:"monitor_control_by_vehicle",title:"Control By Vehicle"},{xtype:"monitor_control_by_vehicle",title:"Control By Driver"},{xtype:"monitor_control_by_vehicle",title:"Maintenance"}]},zvehicleinfo:{xtype:"panel",title:"Vehicle Information",cls:"paddingPanel",layout:{type:"hbox"},items:[{xtype:"image",itemId:"vehicleImage",cls:"imgVehicle"},{xtype:"image",itemId:"driverImage",cls:"imgDriver"},{xtype:"form",height:140,flex:1,defaults:{labelWidth:60,labelSeparator:"",anchor:"100%"},items:[{xtype:"displayfield",name:"id",fieldLabel:"Vehicle",cls:"dotUnderline",itemId:"id"},{xtype:"displayfield",name:"driver",fieldLabel:"Driver",cls:"dotUnderline",itemId:"driver"},{xtype:"displayfield",name:"location",fieldLabel:"Location",cls:"dotUnderline",itemId:"location"},{xtype:"displayfield",name:"distance",cls:"dotUnderline",fieldLabel:"Run. Dist."},{xtype:"displayfield",name:"runningTime",fieldLabel:"Run. Time",cls:"dotUnderline"}]}]},zincidents:{xtype:"panel",title:"Incidents",layout:"fit",cls:"paddingPanel",height:115,items:[{xtype:"container",itemId:"incidents",layout:{type:"hbox",align:"left"}}]},zmap:{xtype:"panel",title:"Tracking Recent Driving",cls:"paddingPanel backgroundGray borderLeftGray",itemId:"map",flex:1,html:'<div class="map"></div>'}});Ext.define("GreenFleet.view.monitor.IncidentView",{extend:"Ext.container.Container",alias:"widget.monitor_incident",title:"Incident View",layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[{xtype:"container",autoScroll:true,layout:{type:"vbox",align:"stretch"},flex:1,items:[this.zInfo,this.zVideoAndMap]},this.zList];this.callParent(arguments);var a=this;this.sub("map").on("afterrender",function(){var b={zoom:10,center:new google.maps.LatLng(System.props.lattitude,System.props.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};a.map=new google.maps.Map(a.sub("map").getEl().down(".map").dom,b)});this.on("activate",function(b){google.maps.event.trigger(a.getMap(),"resize")});this.down("button[itemId=search]").on("click",function(){a.refreshIncidentList()});this.down("button[itemId=reset]").on("click",function(){a.resetIncidentList()});this.down("displayfield[name=videoClip]").on("change",function(c,b){a.sub("video").update({value:b})});this.down("datefield[name=incidentTime]").on("change",function(c,b){a.sub("incident_time").setValue(Ext.Date.format(b,"D Y-m-d H:i:s"))});this.down("displayfield[name=driver]").on("change",function(g,f){var e=Ext.getStore("DriverStore");var b=e.findRecord("id",f);var d=b.get("id");var c=b.get("imageClip");if(c){a.sub("driverImage").setSrc("download?blob-key="+c)}else{a.sub("driverImage").setSrc("resources/image/bgDriver.png")}});this.sub("driverFilter").on("specialkey",function(c,b){if(b.getKey()==b.ENTER){a.refreshIncidentList()}});this.sub("vehicleFilter").on("specialkey",function(c,b){if(b.getKey()==b.ENTER){a.refreshIncidentList()}});this.sub("grid").on("itemclick",function(c,b){a.setIncident(b,false)});this.sub("fullscreen").on("afterrender",function(b){b.getEl().on("click",function(){if(!Ext.isWebKit){return}a.sub("video").getEl().dom.getElementsByTagName("video")[0].webkitEnterFullscreen()})})},setIncident:function(b,a){this.incident=b;if(a){this.sub("vehicleFilter").setValue(b.get("vehicle"));this.sub("driverFilter").reset();this.refreshIncidentList()}this.sub("incident_form").loadRecord(b);this.refreshMap()},getIncident:function(){return this.incident},refreshIncidentList:function(){this.sub("grid").store.load({filters:[{property:"vehicle",value:this.sub("vehicleFilter").getValue()},{property:"driver",value:this.sub("driverFilter").getValue()}]})},resetIncidentList:function(){this.sub("vehicleFilter").reset();this.sub("driverFilter").reset();this.refreshIncidentList()},getMarker:function(){return this.marker},setMarker:function(a){if(this.marker){this.marker.setMap(null)}this.marker=a},refreshMap:function(){this.setMarker(null);var b=this.getIncident();var a=null;if(!b){a=new google.maps.LatLng(System.props.lattitude,System.props.longitude)}else{a=new google.maps.LatLng(b.get("lattitude"),b.get("longitude"))}this.getMap().setCenter(a);if(b){this.setMarker(new google.maps.Marker({position:a,map:this.getMap()}))}},getMap:function(){return this.map},zInfo:{xtype:"form",itemId:"incident_form",cls:"incidentSummary",height:50,layout:{type:"hbox",align:"stretch"},autoScroll:true,defaults:{anchor:"100%",labelAlign:"top",cls:"summaryCell"},items:[{xtype:"image",itemId:"driverImage",cls:"imgDriverSmall",height:37},{xtype:"datefield",name:"incidentTime",hidden:true,fieldLabel:"Incident Time"},{xtype:"displayfield",itemId:"incident_time",width:160,fieldLabel:"Incident Time"},{xtype:"displayfield",name:"vehicle",width:100,fieldLabel:"Vehicle"},{xtype:"displayfield",name:"driver",width:100,fieldLabel:"Driver"},{xtype:"displayfield",name:"impulse",width:100,fieldLabel:"Impulse"},{xtype:"displayfield",name:"engineTemp",width:100,fieldLabel:"Engine Temp."},{xtype:"displayfield",name:"remainingFuel",width:100,fieldLabel:"Remaining Fuel"},{xtype:"displayfield",name:"videoClip",hidden:true}]},zVideoAndMap:{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",title:"Incident Details",cls:"paddingPanel incidentVOD",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",itemId:"fullscreen",html:'<div class="btnFullscreen"></div>'},{xtype:"box",cls:" incidentDetail",itemId:"video",tpl:['<video width="100%" height="95%" controls="controls">','<source src="download?blob-key={value}" type="video/mp4" />',"Your browser does not support the video tag.","</video>"]}]},{xtype:"panel",title:"Position of Incident",cls:"paddingPanel backgroundGray borderLeftGray",flex:1,itemId:"map",html:'<div class="map"></div>'}]},zList:{xtype:"gridpanel",itemId:"grid",cls:"hIndexbar",title:"Incident List",store:"IncidentStore",autoScroll:true,flex:1,columns:[{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"incidentTime",text:"Incident Time",xtype:"datecolumn",width:120,format:"d-m-Y H:i:s"},{dataIndex:"driver",text:"Driver",type:"string",width:80},{dataIndex:"vehicle",text:"Vehicle",type:"string",width:80},{dataIndex:"lattitude",text:"Lattitude",type:"number",width:80},{dataIndex:"longitude",text:"Longitude",type:"number",width:80},{dataIndex:"impulse",text:"Impulse",type:"number",width:80},{dataIndex:"impulseThreshold",text:"Impulse Threshold",type:"number",width:80},{dataIndex:"obdConnected",text:"OBD Connected",type:"boolean",width:80},{dataIndex:"engineTemp",text:"Engine Temp.",type:"number",width:80},{dataIndex:"engineTempThreshold",text:"Engine Temp. Threshold",type:"number",width:80},{dataIndex:"remainingFuel",text:"Remaining Fuel",type:"number",width:80},{dataIndex:"fuelThreshold",text:"Fuel Threshold",type:"number",width:80},{dataIndex:"createdAt",text:"Created At",xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updatedAt",text:"Updated At",xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[{xtype:"combo",queryMode:"local",store:"VehicleStore",displayField:"id",valueField:"id",fieldLabel:"Vehicle",itemId:"vehicleFilter",width:200},{xtype:"combo",queryMode:"local",store:"DriverStore",displayField:"id",valueField:"id",fieldLabel:"Driver",itemId:"driverFilter",width:200},{xtype:"button",itemId:"search",text:"Search",tooltip:"Find Incident"},{xtype:"button",itemId:"reset",text:"Reset"}]}});Ext.define("GreenFleet.store.CompanyStore",{extend:"Ext.data.Store",autoLoad:true,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"name",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"company",reader:{type:"json"}}});Ext.define("GreenFleet.store.CodeGroupStore",{extend:"Ext.data.Store",autoLoad:true,fields:[{name:"group",type:"string"},{name:"desc",type:"string"}],data:[{group:"V-Type1",desc:"Type 1 of Vehicles"},{group:"V-Type2",desc:"Type 2 of Vehicles"},{group:"V-Type3",desc:"Type 3 of Vehicles"},{group:"V-Size",desc:"Size of Vehicles"},{group:"V-Maker",desc:"Vehicle Makers"},{group:"V-Model",desc:"Vehicle Model"},{group:"V-BirthYear",desc:"Vehicle Birth-Years"},{group:"V-Seat",desc:"Count of Seat of Vehicle"},{group:"V-Fuel",desc:"Types of Fuel of Vehicle"},{group:"ResvPurpose",desc:"Type of Reservation Purpose"},{group:"ResvStatus",desc:"Status of Reservation"},{group:"EmployeeTitle",desc:"Titles of Employee"},{group:"Division",desc:"Devisions of Company"},{group:"Consumable",desc:"Kinds of Consumables"}]});Ext.define("GreenFleet.store.CodeStore",{extend:"Ext.data.Store",autoLoad:true,fields:[{name:"key",type:"string"},{name:"group",type:"string"},{name:"code",type:"string"},{name:"desc",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"code",reader:{type:"json"}}});Ext.define("GreenFleet.store.VehicleStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"registrationNumber",type:"string"},{name:"manufacturer",type:"string"},{name:"vehicleType",type:"string"},{name:"birthYear",type:"int"},{name:"ownershipType",type:"string"},{name:"status",type:"string"},{name:"imageClip",type:"string"},{name:"totalDistance",type:"float"},{name:"remainingFuel",type:"float"},{name:"distanceSinceNewOil",type:"float"},{name:"engineOilStatus",type:"string"},{name:"fuelFilterStatus",type:"string"},{name:"brakeOilStatus",type:"string"},{name:"brakePedalStatus",type:"string"},{name:"coolingWaterStatus",type:"string"},{name:"timingBeltStatus",type:"string"},{name:"sparkPlugStatus",type:"string"},{name:"driver",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"location",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"vehicle",reader:{type:"json"}}});Ext.define("GreenFleet.store.DriverStore",{extend:"Ext.data.Store",autoLoad:true,fields:[{name:"key",type:"string"},{name:"name",type:"string"},{name:"id",type:"string"},{name:"division",type:"string"},{name:"title",type:"string"},{name:"imageClip",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"driver",reader:{type:"json"}}});Ext.define("GreenFleet.store.ReservationStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"reservedDate",type:"date",dateFormat:"timestamp"},{name:"driver",type:"string"},{name:"vehicle",type:"string"},{name:"vehicleType",type:"string"},{name:"deliveryPlace",type:"string"},{name:"destination",type:"string"},{name:"purpose",type:"string"},{name:"status",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"reservation",reader:{type:"json"}}});Ext.define("GreenFleet.store.IncidentStore",{extend:"Ext.data.Store",autoLoad:false,remoteFilter:true,remoteSort:true,fields:[{name:"key",type:"string"},{name:"incidentTime",type:"date",dateFormat:"time"},{name:"driver",type:"string"},{name:"vehicle",type:"string"},{name:"terminal",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"impulse",type:"float"},{name:"impulseThreshold",type:"float"},{name:"obdConnected",type:"boolean"},{name:"engineTemp",type:"float"},{name:"engineTempThreshold",type:"float"},{name:"remainingFuel",type:"float"},{name:"fuelThreshold",type:"float"},{name:"videoClip",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"incident",reader:{type:"json"}}});Ext.define("GreenFleet.store.TrackStore",{extend:"Ext.data.Store",autoLoad:false,remoteFilter:true,remoteSort:true,fields:[{name:"key",type:"string"},{name:"vehicle",type:"string"},{name:"driver",type:"string"},{name:"lattitude",type:"number"},{name:"longitude",type:"number"},{name:"createdAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"track",reader:{type:"json"}}});Ext.define("GreenFleet.store.ManufacturerStore",{extend:"Ext.data.Store",storeId:"manufacturer_store",fields:["name"],data:[{name:"Audi"},{name:"Volkswagon"},{name:"Mercedes-Benz"},{name:"Hyundai"},{name:"Kia"}]});Ext.define("GreenFleet.store.VehicleTypeStore",{extend:"Ext.data.Store",storeId:"vehicletype_store",fields:["name","desc"],data:[{name:"A",desc:"A 800-"},{name:"B",desc:"B 800~1000"},{name:"C",desc:"C 1000~1500"},{name:"D",desc:"D 1500~1800"},{name:"E",desc:"E 1800~2000"},{name:"F",desc:"F 2000+"}]});Ext.define("GreenFleet.store.OwnershipStore",{extend:"Ext.data.Store",storeId:"ownership_store",fields:["name","desc"],data:[{name:"A",desc:"A Self"},{name:"B",desc:"B Company"},{name:"C",desc:"C Rent"}]});Ext.define("GreenFleet.store.VehicleStatusStore",{extend:"Ext.data.Store",storeId:"vehiclestatus_store",fields:["status","desc"],data:[{status:"Running",desc:"Running"},{status:"Incident",desc:"Incident"},{status:"Idle",desc:"Idle"}]});Ext.define("GreenFleet.store.ControlDataStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"vehicle",type:"string"},{name:"driver",type:"string"},{name:"distance",type:"float"},{name:"runningTime",type:"float"},{name:"averageSpeed",type:"float"},{name:"highestSpeed",type:"float"},{name:"suddenAccelCount",type:"float"},{name:"suddenBrakeCount",type:"float"},{name:"econoDrivingRatio",type:"float"},{name:"fuelEfficiency",type:"float"},{name:"date",type:"date",dateFormat:"time"},{name:"startTime",type:"date",dateFormat:"time"},{name:"endTime",type:"date",dateFormat:"time"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"control_data",reader:{type:"json"}}});Ext.define("GreenFleet.store.TrackByVehicleStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"vehicle",type:"string"},{name:"driver",type:"string"},{name:"lattitude",type:"number"},{name:"longitude",type:"number"},{name:"createdAt",type:"date",dateFormat:"time"}],sorters:[{property:"createdAt",direction:"DESC"}],proxy:{type:"ajax",url:"track",reader:{type:"json"}}});Ext.define("GreenFleet.store.RecentIncidentStore",{extend:"Ext.data.Store",autoLoad:false,remoteFilter:true,remoteSort:true,fields:[{name:"key",type:"string"},{name:"incidentTime",type:"date",dateFormat:"time"},{name:"driver",type:"string"},{name:"vehicle",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"impulse",type:"float"},{name:"videoClip",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"incident",reader:{type:"json"}}});Ext.define("GreenFleet.store.TerminalStore",{extend:"Ext.data.Store",autoLoad:true,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"serialNo",type:"string"},{name:"buyingDate",type:"date",dateFormat:"time"},{name:"comment",type:"string"},{name:"imageClip",type:"string"},{name:"createdAt",type:"date",dateFormat:"time"},{name:"updatedAt",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"terminal",reader:{type:"json"}}});Ext.define("GreenFleet.model.File",{extend:"Ext.data.Model",fields:[{name:"filename",type:"string"},{name:"creation",type:"number"},{name:"md5_hash",type:"string"},{name:"content_type",type:"string"},{name:"size",type:"string"}]});Ext.define("GreenFleet.view.file.FileManager",{extend:"Ext.panel.Panel",alias:"widget.filemanager",title:"FileManager",layout:{type:"vbox",align:"stretch",pack:"start"},initComponent:function(){this.callParent();this.add(Ext.create("GreenFleet.view.file.FileViewer",{flex:1}));this.add(Ext.create("GreenFleet.view.file.FileUploader",{flex:1}));this.add(Ext.create("GreenFleet.view.file.FileList",{flex:2}))}});Ext.define("GreenFleet.store.FileStore",{extend:"Ext.data.Store",storeId:"filestore",model:"GreenFleet.model.File",proxy:{type:"ajax",url:"/data/files.json",reader:{type:"json"}},autoLoad:true});Ext.define("GreenFleet.controller.ApplicationController",{extend:"Ext.app.Controller",stores:["CompanyStore","CodeGroupStore","CodeStore","VehicleStore","DriverStore","ReservationStore","IncidentStore","TrackStore","ManufacturerStore","VehicleTypeStore","OwnershipStore","VehicleStatusStore","ControlDataStore","TrackByVehicleStore","RecentIncidentStore","TerminalStore"],models:[],views:["viewport.Center","viewport.North","viewport.West","viewport.East","Brand","MainMenu","SideMenu","management.Company","management.Code","management.Vehicle","management.Terminal","management.Reservation","management.Incident","management.Driver","management.Track","management.ControlData","monitor.Map","monitor.ControlByVehicle","monitor.InfoByVehicle","monitor.Information","monitor.IncidentView"],init:function(){this.control({viewport:{afterrender:this.onViewportRendered}})},onViewportRendered:function(){}});Ext.define("GreenFleet.controller.FileController",{extend:"Ext.app.Controller",stores:["FileStore"],models:["File"],views:["file.FileManager"],init:function(){this.control({viewport:{afterrender:this.onViewportRendered}})},onViewportRendered:function(){}});Ext.Loader.setConfig({enabled:true,paths:{GreenFleet:"app"}});Ext.define("GreenFleet",{singleton:true,mixins:{msg:"GreenFleet.mixin.Msg",user:"GreenFleet.mixin.User",mixin:"GreenFleet.mixin.Mixin",ui:"GreenFleet.mixin.UI",state:"GreenFleet.mixin.State",subitem:"GreenFleet.mixin.SubItem",util:"GreenFleet.mixin.Import"}});var console=console||{log:function(){},trace:function(){}};Ext.require("GreenFleet.view.Viewport");Ext.onReady(function(){Ext.application({name:"GreenFleet",autoCreateViewport:false,controllers:["GreenFleet.controller.ApplicationController","GreenFleet.controller.FileController"],launch:function(){Ext.create("GreenFleet.view.Viewport").show()}})});
