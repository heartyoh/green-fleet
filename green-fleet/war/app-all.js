/*
Copyright(c) 2011 HeartyOh.com
*/
Ext.define("GreenFleet.mixin.Msg",function(){var b;function a(d,e){return'<div class="msg"><h3>'+d+"</h3><p>"+e+"</p></div>"}function c(e,f){if(!b){b=Ext.core.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}var f=Ext.String.format.apply(String,Array.prototype.slice.call(arguments,1));var d=Ext.core.DomHelper.append(b,a(e,f),true);d.hide();d.slideIn("t").ghost("t",{delay:3000,remove:true})}return{msg:c}}());Ext.define("GreenFleet.mixin.User",function(){return{login:{key:login.key,email:login.email,id:login.username,name:login.username,language:login.language}}}());Ext.define("GreenFleet.mixin.Mixin",{mixin:function(b,a){try{switch(typeof(b)){case"string":Ext.apply(Ignite,Ext.create(b,a));return;case"object":Ext.apply(Ignite,b)}}catch(c){console.log(c.stack)}}});Ext.define("GreenFleet.mixin.UI",{addSystemMenu:function(a,b){try{var d=Ext.getCmp("system_menu");var g=Ext.create(a,b);d.insert(0,g);var c=6;d.items.each(function(e){c+=e.getWidth()});d.setSize(c,d.getHeight())}catch(f){}},addContentView:function(a){this.showBusy();var b;if(typeof(a)==="string"){b=Ext.create(a,{closable:true})}else{b=a}Ext.getCmp("content").add(b).show();this.clearStatus()},getMenu:function(a){return Ext.getCmp("content").getComponent(a)},doMenu:function(b){var a=Ext.getCmp("content");a.getLayout().setActiveItem(a.getComponent(b))}});Ext.define("GreenFleet.mixin.State",function(){return{show_running_vehicle:true,show_idle_vehicle:true,show_incident_vehicle:true}}());Ext.define("GreenFleet.mixin.SubItem",function(){Ext.Container.implement({sub:function(a){if(!this.subitems){this.subitems={}}if(!this.subitems[a]){this.subitems[a]=this.down("[itemId="+a+"]")}return this.subitems[a]}});return{}}());Ext.define("GreenFleet.mixin.Import",function(){function b(){var e=Ext.getCmp("content");var d=e.getLayout().getActiveItem();if(d.importUrl){Ext.create("GreenFleet.view.common.ImportPopup",{importUrl:d.importUrl,client:d,title:T("menu.import_data")}).show()}}function c(){Ext.create("GreenFleet.view.common.ImportPopup",{importUrl:"incident/upload_log",title:"Upload Incident Log"}).show()}function a(){Ext.create("GreenFleet.view.common.ImportPopup",{importUrl:"incident/upload_video",title:"Upload Incident Video"}).show()}return{importData:b,uploadIncidentLog:c,uploadIncidentVideo:a}}());Ext.define("GreenFleet.view.Viewport",{extend:"Ext.container.Viewport",layout:"border",cls:"wrap",initComponent:function(){this.callParent()},defaults:{split:false,collapsible:false},items:[{xtype:"viewport.north",region:"north",cls:"header",height:62},{xtype:"viewport.west",region:"west",cls:"tool",width:50},{xtype:"viewport.east",region:"east",cls:"summaryBoard",width:200},{xtype:"viewport.center",region:"center"}]});Ext.define("GreenFleet.controller.MainController",{extend:"Ext.app.Controller",requires:[],refs:[{ref:"content",selector:"#content"},{ref:"nav",selector:"#nav"}],control:{}});Ext.define("GreenFleet.store.IncidentLogChartStore",{extend:"Ext.data.Store",fields:[{name:"datetime",type:"date",dateFormat:"time"},{name:"velocity",type:"float"},{name:"accelate_x",type:"float"},{name:"accelate_y",type:"float"},{name:"accelate_z",type:"float"}],sorters:[{property:"datetime",direction:"ASC"}],data:[]});Ext.define("GreenFleet.view.management.Profile",{extend:"Ext.window.Window",title:T("menu.profile"),modal:true,width:560,height:360,initComponent:function(){this.callParent(arguments);var a=this;this.down("[itemId=close]").on("click",function(b){a.close()});this.down("[itemId=save]").on("click",function(b){var c=a.down("form").getForm();if(c.isValid()){c.submit({url:"/user/save",success:function(d,e){a.reload()},failure:function(d,e){GreenFleet.msg("Failed",e.result)}})}});this.down("#image_clip").on("change",function(d,b){var c=a.sub("image");if(b!=null&&b.length>0){c.setSrc("download?blob-key="+b)}else{c.setSrc("resources/image/bgDriver.png")}});this.reload()},reload:function(){this.down("form").load({url:"/user/find",method:"GET",params:{key:GreenFleet.login.key}})},items:[{xtype:"form",itemId:"form",bodyPadding:10,flex:1,autoScroll:true,layout:{type:"table",columns:2},defaults:{xtype:"textfield",anchor:"100%"},items:[{xtype:"container",rowspan:11,width:260,height:260,layout:{type:"vbox",align:"stretch"},cls:"noImage",items:[{xtype:"image",height:"100%",itemId:"image"}]},{name:"key",fieldLabel:"Key",hidden:true},{name:"name",fieldLabel:T("label.name")},{name:"email",fieldLabel:T("label.email")},{xtype:"checkbox",name:"enabled",fieldLabel:T("label.enabled"),uncheckedValue:"off"},{xtype:"checkbox",name:"admin",fieldLabel:T("label.admin"),uncheckedValue:"off"},{name:"company",fieldLabel:T("label.company"),disabled:true},{xtype:"combo",name:"language",store:"LanguageCodeStore",queryMode:"local",displayField:"display",valueField:"value",fieldLabel:T("label.language")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")},{xtype:"displayfield",name:"image_clip",itemId:"image_clip",hidden:true},{xtype:"filefield",name:"image_file",fieldLabel:T("label.image_upload"),msgTarget:"side",allowBlank:true,buttonText:T("button.file")}]}],buttons:[{text:T("button.save"),itemId:"save"},{text:T("button.close"),itemId:"close"}]});Ext.define("GreenFleet.view.common.ImportPopup",{extend:"Ext.window.Window",modal:true,width:350,height:150,items:[{xtype:"form",cls:"paddingAll10",items:[{xtype:"filefield",name:"file",fieldLabel:"Import(CSV)",msgTarget:"side",buttonText:"file..."}]}],buttons:[{text:"Import",itemId:"import"},{text:"Close",itemId:"close"}],initComponent:function(){this.callParent(arguments);var a=this;this.down("[itemId=close]").on("click",function(b){a.close()});this.down("[itemId=import]").on("click",function(b){var c=a.down("form").getForm();if(c.isValid()){c.submit({url:a.importUrl,success:function(d,e){if(a.client&&a.client.afterImport instanceof Function){a.client.afterImport()}a.close()},failure:function(d,e){GreenFleet.msg("Failed",e.result)}})}})}});Ext.define("GreenFleet.model.File",{extend:"Ext.data.Model",fields:[{name:"filename",type:"string"},{name:"creation",type:"number"},{name:"md5_hash",type:"string"},{name:"content_type",type:"string"},{name:"size",type:"string"}]});Ext.define("GreenFleet.view.file.FileManager",{extend:"Ext.panel.Panel",alias:"widget.filemanager",title:"FileManager",layout:{type:"vbox",align:"stretch",pack:"start"},initComponent:function(){this.callParent();this.add(Ext.create("GreenFleet.view.file.FileViewer",{flex:1}));this.add(Ext.create("GreenFleet.view.file.FileUploader",{flex:1}));this.add(Ext.create("GreenFleet.view.file.FileList",{flex:2}))}});Ext.define("GreenFleet.store.FileStore",{extend:"Ext.data.Store",storeId:"filestore",model:"GreenFleet.model.File",proxy:{type:"ajax",url:"/data/files.json",reader:{type:"json",root:"items",totalProperty:"total"}},autoLoad:false});Ext.define("GreenFleet.controller.FileController",{extend:"Ext.app.Controller",stores:["FileStore"],models:["File"],views:["file.FileManager"],init:function(){this.control({viewport:{afterrender:this.onViewportRendered}})},onViewportRendered:function(){}});Ext.define("GreenFleet.model.Code",{extend:"Ext.data.Model",fields:[{name:"code",type:"string"},{name:"desc",type:"number"}]});Ext.define("GreenFleet.view.viewport.Center",{extend:"Ext.panel.Panel",id:"content",alias:"widget.viewport.center",layout:"card",listeners:{add:function(a,c){if(a!==this){return}var b=Ext.getCmp("menutab");b.add({text:c.title,itemId:c.itemId,tooltip:c.title,handler:function(e){var f=Ext.getCmp("content");var d=f.getComponent(e.itemId);f.getLayout().setActiveItem(d)},closable:false}).setCard(c)},remove:function(a,c){if(a!==this){return}var b=Ext.getCmp("menutab");b.remove(c.itemId)}},initComponent:function(){this.callParent();var a=this;Ext.getCmp("menutab").getComponent("overview").hide();Ext.getCmp("menutab").getComponent("monitor_map").hide();Ext.getCmp("menutab").getComponent("information").hide();Ext.getCmp("menutab").getComponent("monitor_incident").hide()},defaults:{listeners:{activate:function(c){var b=Ext.getCmp("menutab");var a=b.getComponent(c.itemId);b.setActiveTab(a)}}},items:[{xtype:"overview",itemId:"overview",listeners:{activate:function(d){var a=Ext.getCmp("west");var b=a.getComponent(d.itemId);b.addClass("active");var c=Ext.getCmp("menutab");var b=c.getComponent(d.itemId);c.setActiveTab(b)},deactivate:function(c){var b=Ext.getCmp("west");var a=b.getComponent(c.itemId);a.removeCls("active")}}},{xtype:"monitor_map",itemId:"monitor_map",listeners:{activate:function(d){var a=Ext.getCmp("west");var b=a.getComponent(d.itemId);b.addClass("active");var c=Ext.getCmp("menutab");var b=c.getComponent(d.itemId);c.setActiveTab(b)},deactivate:function(c){var b=Ext.getCmp("west");var a=b.getComponent(c.itemId);a.removeCls("active")}}},{xtype:"monitor_information",itemId:"information",listeners:{activate:function(d){var a=Ext.getCmp("west");var b=a.getComponent(d.itemId);b.addClass("active");var c=Ext.getCmp("menutab");var b=c.getComponent(d.itemId);c.setActiveTab(b)},deactivate:function(c){var b=Ext.getCmp("west");var a=b.getComponent(c.itemId);a.removeCls("active")}}},{xtype:"monitor_incident",itemId:"monitor_incident",listeners:{activate:function(d){var a=Ext.getCmp("west");var b=a.getComponent(d.itemId);b.addClass("active");var c=Ext.getCmp("menutab");var b=c.getComponent(d.itemId);c.setActiveTab(b)},deactivate:function(c){var b=Ext.getCmp("west");var a=b.getComponent(c.itemId);a.removeCls("active")}}}]});Ext.define("GreenFleet.view.viewport.North",{extend:"Ext.Container",alias:"widget.viewport.north",layout:{type:"hbox",align:"stretch"},items:[{xtype:"brand",width:135},{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"main_menu",flex:2},{xtype:"side_menu",flex:1}]},{xtype:"tabbar",id:"menutab",height:23,dock:"top"}]}]});Ext.define("GreenFleet.view.viewport.West",{extend:"Ext.panel.Panel",alias:"widget.viewport.west",id:"west",cls:"tool",layout:{type:"vbox"},items:[{xtype:"button",itemId:"overview",cls:"btnDashboard",text:T("menu.overview"),handler:function(){GreenFleet.doMenu("overview")}},{xtype:"button",itemId:"monitor_map",cls:"btnDashboard",text:T("menu.map"),handler:function(){GreenFleet.doMenu("monitor_map")}},{xtype:"button",itemId:"information",cls:"btnInfo",text:T("menu.info"),handler:function(){GreenFleet.doMenu("information")}},{xtype:"button",itemId:"monitor_incident",cls:"btnIncidentInfo",text:T("menu.incident"),handler:function(){GreenFleet.doMenu("monitor_incident")}},{xtype:"button",cls:"btnImport",text:T("menu.import_data"),handler:function(){GreenFleet.importData()}},{xtype:"button",cls:"btnExport",text:T("menu.export_data")}]});Ext.define("GreenFleet.view.viewport.East",{extend:"Ext.panel.Panel",alias:"widget.viewport.east",id:"east",cls:"summaryBoard",width:200,layout:{type:"vbox",align:"stretch"},initComponent:function(){this.callParent();var a=this;this.sub("state_running").on("click",function(){GreenFleet.doMenu("monitor_map");var b=Ext.getStore("VehicleFilteredStore");b.clearFilter();a.sub("search").setValue("");GreenFleet.show_running_vehicle=true;if(GreenFleet.show_idle_vehicle){GreenFleet.show_idle_vehicle=false;GreenFleet.show_incident_vehicle=false;GreenFleet.show_maint_vehicle=false;b.filter([{property:"status",value:"Running"}])}else{GreenFleet.show_idle_vehicle=true;GreenFleet.show_incident_vehicle=true;GreenFleet.show_maint_vehicle=true}});this.sub("state_idle").on("click",function(){GreenFleet.doMenu("monitor_map");var b=Ext.getStore("VehicleFilteredStore");b.clearFilter();a.sub("search").setValue("");GreenFleet.show_idle_vehicle=true;if(GreenFleet.show_incident_vehicle){GreenFleet.show_running_vehicle=false;GreenFleet.show_incident_vehicle=false;GreenFleet.show_maint_vehicle=false;b.filter([{property:"status",value:"Idle"}])}else{GreenFleet.show_running_vehicle=true;GreenFleet.show_incident_vehicle=true;GreenFleet.show_maint_vehicle=true}});this.sub("state_incident").on("click",function(){GreenFleet.doMenu("monitor_map");var b=Ext.getStore("VehicleFilteredStore");b.clearFilter();a.sub("search").setValue("");GreenFleet.show_incident_vehicle=true;if(GreenFleet.show_running_vehicle){GreenFleet.show_running_vehicle=false;GreenFleet.show_idle_vehicle=false;GreenFleet.show_maint_vehicle=false;b.filter([{property:"status",value:"Incident"}])}else{GreenFleet.show_running_vehicle=true;GreenFleet.show_idle_vehicle=true;GreenFleet.show_maint_vehicle=true}});this.sub("state_maint").on("click",function(){GreenFleet.doMenu("monitor_map");var b=Ext.getStore("VehicleFilteredStore");b.clearFilter();a.sub("search").setValue("");GreenFleet.show_maint_vehicle=true;if(GreenFleet.show_running_vehicle){GreenFleet.show_running_vehicle=false;GreenFleet.show_idle_vehicle=false;GreenFleet.show_incident_vehicle=false;b.filter([{property:"status",value:"Maint"}])}else{GreenFleet.show_running_vehicle=true;GreenFleet.show_idle_vehicle=true;GreenFleet.show_incident_vehicle=true}});setInterval(function(){if(a.isHidden()){return}a.sub("time").update(Ext.Date.format(new Date(),"D Y-m-d H:i:s"))},1000);this.on("afterrender",function(){Ext.getStore("VehicleMapStore").on("load",a.refreshVehicleCounts,a);Ext.getStore("RecentIncidentStore").on("load",a.refreshIncidents,a);Ext.getStore("VehicleGroupCountStore").on("load",a.refreshVehicleGroups,a)});Ext.getStore("RecentIncidentStore").load()},initChannel:function(){var a=this;Ext.Ajax.request({url:"/channel/init",method:"POST",success:function(b){a.openChannel(b.responseText)},failure:function(b){Ext.Msg.alert(T("label.failure"),b.responseText)}})},openChannel:function(c){var b=this;var d=new goog.appengine.Channel(c);var a=d.open();a.onopen=function(){GreenFleet.msg("Channel","Channel opened!")};a.onmessage=function(e){var f=Ext.String.trim(e.data);if(f=="Incident"){Ext.Msg.alert("Incident","There seems to be an accident. Please check!");Ext.getStore("RecentIncidentStore").load()}else{GreenFleet.msg("Message arrived",f)}};a.onerror=function(e){Ext.Msg.alert("Channel","There was a problem with the channel connection!")};a.onclose=function(){Ext.Msg.alert("Channel","Channel closed!")}},toggleHide:function(){if(this.isVisible()){this.hide()}else{this.show()}},refreshVehicleCounts:function(){if(this.isHidden()){return}var c=Ext.getStore("VehicleMapStore");var f=c.count();var b=0;var d=0;var e=0;var a=0;c.each(function(g){switch(g.get("status")){case"Running":b++;break;case"Idle":d++;break;case"Incident":e++;break;case"Maint":a++;break}});this.sub("state_running").update(T("label.state_driving")+"</br><span>"+b+"</span>");this.sub("state_idle").update(T("label.state_idle")+"</br><span>"+d+"</span>");this.sub("state_incident").update(T("label.state_incident")+"</br><span>"+e+"</span>");this.sub("state_maint").update(T("label.state_maint")+"</br><span>"+a+"</span>");this.sub("vehicle_count").update(T("title.total_running_vehicles")+" : "+f)},refreshIncidents:function(a){if(!a){a=Ext.getStore("RecentIncidentStore")}var c=this.sub("incidents");if(!c){c=this.up("viewport.east").sub("incidents")}c.removeAll();var e=a.count()>5?5:a.count();for(var b=0;b<e;b++){var d=a.getAt(b);c.add({xtype:"button",listeners:{click:function(f){GreenFleet.doMenu("monitor_incident");GreenFleet.getMenu("monitor_incident").setIncident(f.incident,true)}},incident:d,text:'<a href="#">'+d.get("vehicle_id")+", "+d.get("driver_id")+"<span>"+Ext.Date.format(d.get("datetime"),"D Y-m-d H:i:s")+"</span></a>"})}},refreshVehicleGroups:function(){if(this.isHidden()){return}var a=this;a.sub("vehicle_groups").removeAll();Ext.getStore("VehicleGroupCountStore").each(function(b){a.sub("vehicle_groups").add({xtype:"button",listeners:{click:a.findVehiclesOnMap,scope:a},vehicleGroup:b,text:'<a href="#">'+b.data.expl+"<span>("+b.data.count+")</span></a>"})})},findVehiclesOnMap:function(c){var a=this;GreenFleet.doMenu("monitor_map");this.sub("search").setValue("");var b=c.vehicleGroup.get("id");Ext.Ajax.request({url:"/vehicle_group/vehicles",method:"GET",params:{vehicle_group_id:b,select_mode:"vehicle_id_only"},success:function(d){var e=Ext.JSON.decode(d.responseText);if(e.success){var f=e.items;a.filterByVehicleGroup(f)}else{Ext.MessageBox.alert(T("label.failure"),e.msg)}},failure:function(d){Ext.MessageBox.alert(T("label.failure"),d.responseText)}})},filterByVehicleGroup:function(b){var a=Ext.getStore("VehicleFilteredStore");a.clearFilter();a.filter([{filterFn:function(c){var d=c.get("id");if(Ext.Array.indexOf(b,d)>=0){return true}}}])},items:[{xtype:"searchfield",cls:"searchField",fieldLabel:T("button.search"),labelWidth:50,labelSeparator:"",itemId:"search"},{xtype:"component",cls:"time",itemId:"time",html:Ext.Date.format(new Date(),"D Y-m-d H:i:s")},{xtype:"box",cls:"count",itemId:"vehicle_count",html:T("title.total_running_vehicles")+" : 0"},{xtype:"panel",title:T("title.vehicle_status"),cls:"statusPanel",items:[{xtype:"button",itemId:"state_running",flex:1,cls:"btnDriving"},{xtype:"button",itemId:"state_idle",flex:1,cls:"btnStop"},{xtype:"button",itemId:"state_incident",flex:1,cls:"btnIncident"},{xtype:"button",itemId:"state_maint",flex:1,cls:"btnMaint"}]},{xtype:"panel",title:T("title.vehicle_group"),cls:"groupPanel",itemId:"vehicle_groups"},{xtype:"panel",title:T("title.incidents_alarm"),itemId:"incidents",cls:"incidentPanel"}]});Ext.define("GreenFleet.view.Brand",{extend:"Ext.panel.Panel",alias:"widget.brand",html:"<a></a>"});Ext.define("GreenFleet.view.MainMenu",{extend:"Ext.toolbar.Toolbar",cls:"appMenu",alias:"widget.main_menu",initComponent:function(){var b=this;var d;function c(g){var f=Ext.getCmp("menutab");var e=f.getComponent(g.itemId);f.setActiveTab(e)}function a(f){if(f===d){return}var j=Ext.getCmp("content");var g=[];j.items.each(function(i){if(i.closable){g.push(i)}});for(var e=0;e<g.length;e++){j.remove(g[e])}var k=null;for(e=0;e<f.submenus.length;e++){var h=j.add(f.submenus[e]);k=k||h}if(d){d.removeCls("menuActive")}f.addCls("menuActive");d=f;if(k){GreenFleet.doMenu(k.itemId)}}Ext.Array.each(this.items,function(e){e.handler=a;Ext.Array.each(e.submenus,function(f){f.listeners={activate:c}})});this.callParent()},items:[{text:T("menu.company"),submenus:[{title:T("menu.company"),xtype:"management_company",itemId:"company",closable:true},{title:T("menu.user"),xtype:"management_user",itemId:"user",closable:true},{title:T("menu.code"),xtype:"management_code",itemId:"code",closable:true},{title:T("menu.vehicle_group"),xtype:"management_vehicle_group",itemId:"vehicle_group",closable:true},{title:T("menu.driver_group"),xtype:"management_driver_group",itemId:"driver_group",closable:true},{title:T("menu.consumable_code"),xtype:"management_consumable_code",itemId:"consumable_code",closable:true},{title:T("menu.location"),xtype:"management_location",itemId:"location",closable:true},{title:T("menu.alarm"),xtype:"management_alarm",itemId:"alarm",closable:true}]},{text:T("menu.vehicle"),submenus:[{title:T("menu.vehicle"),xtype:"management_vehicle",itemId:"vehicle",closable:true},{title:T("menu.incident"),xtype:"management_incident",itemId:"incident",closable:true},{title:T("menu.track"),xtype:"management_track",itemId:"track",closable:true},{title:T("menu.checkin_data"),xtype:"management_checkin_data",itemId:"checkin_data",closable:true},{title:T("menu.vehicle_runstatus"),xtype:"management_vehicle_runstatus",itemId:"vehicle_runstatus",closable:true}]},{text:T("menu.driver"),submenus:[{title:T("menu.driver"),xtype:"management_driver",itemId:"driver",closable:true},{title:T("menu.driver_runstatus"),xtype:"management_driver_runstatus",itemId:"driver_runstatus",closable:true},{title:T("menu.driver_speed_section"),xtype:"management_driver_speed",itemId:"driver_speed",closable:true}]},{text:T("menu.terminal"),submenus:[{title:T("menu.terminal"),xtype:"management_terminal",itemId:"terminal",closable:true}]},{text:T("menu.reservation"),submenus:[{title:T("menu.reservation"),xtype:"management_reservation",itemId:"reservation",closable:true}]},{text:T("menu.maintenance"),submenus:[{title:T("menu.consumables"),xtype:"pm_consumable",itemId:"consumable",closable:true},{title:T("menu.maintenance"),xtype:"pm_maintenance",itemId:"maintenance",closable:true},{title:T("menu.vehicle_health"),xtype:"dashboard_vehicle_health",itemId:"vehicle_health",closable:true},{title:T("menu.consumable_health"),xtype:"dashboard_consumable_health",itemId:"consumable_health",closable:true}]},{text:T("menu.dashboard"),submenus:[{title:T("menu.dashboard"),xtype:"dashboard_report",itemId:"dashboard_report",closable:true}]},{text:T("menu.schedule"),submenus:[{title:T("menu.schedule"),xtype:"management_schedule",itemId:"management_schedule",closable:true}]}]});Ext.define("GreenFleet.view.SideMenu",{extend:"Ext.toolbar.Toolbar",alias:"widget.side_menu",cls:"sideMenu",items:["->",{type:"help",text:login.username,handler:function(){Ext.create("GreenFleet.view.management.Profile").show()}},{itemId:"home",type:"home",cls:"btnHome",handler:function(){}},{itemId:"report",type:"report",cls:"btnReport",handler:function(){}},{itemId:"setting",type:"setting",cls:"btnEastHidden",handler:function(){Ext.getCmp("east").toggleHide()}},{itemId:"logout",type:"logout",cls:"btnLogout",handler:function(){Ext.MessageBox.confirm("Confirm","Are you sure you want to do that?",function(a){if(a==="yes"){document.location.href="/logout.htm"}})}}]});Ext.define("GreenFleet.view.management.Company",{extend:"Ext.container.Container",alias:"widget.management_company",title:T("title.company"),entityUrl:"company",layout:{align:"stretch",type:"vbox"},items:{html:'<div class="listTitle">'+T("title.company_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b);var e=a.sub("image");var d=b.raw.image_clip;if(d!=null&&d.length>0){e.setSrc("download?blob-key="+d)}else{e.setSrc("resources/image/bgVehicle.png")}});this.sub("grid").on("render",function(b){b.store.load()});this.sub("id_filter").on("change",function(c,b){a.search()});this.sub("name_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("id_filter").setValue("");a.sub("name_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").store.load()});this.down("#image_clip").on("change",function(d,b){var c=a.sub("image");if(b!=null&&b.length>0){c.setSrc("download?blob-key="+b)}else{c.setSrc("resources/image/bgVehicle.png")}})},search:function(){this.sub("grid").store.clearFilter();this.sub("grid").store.filter([{property:"id",value:this.sub("id_filter").getValue()},{property:"name",value:this.sub("name_filter").getValue()}])},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"CompanyStore",flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"id",text:T("label.id")},{dataIndex:"name",text:T("label.name")},{dataIndex:"desc",text:T("label.desc")},{dataIndex:"timezone",text:T("label.timezone")},{dataIndex:"language",text:T("label.language")},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},onReset:function(b){b.down("textfield[name=id_filter]").setValue("");b.down("textfield[name=name_filter]").setValue("")},tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",hideLabel:true,width:200},T("label.name"),{xtype:"textfield",name:"name_filter",itemId:"name_filter",hideLabel:true,width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}]}},buildForm:function(a){return{xtype:"panel",bodyPadding:10,cls:"hIndexbar",title:T("title.company_details"),height:290,layout:{type:"hbox",align:"stretch"},items:[{xtype:"form",itemId:"form",flex:1,autoScroll:true,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{name:"id",fieldLabel:T("label.id")},{name:"name",fieldLabel:T("label.name")},{name:"desc",fieldLabel:T("label.desc")},{xtype:"tzcombo",name:"timezone",fieldLabel:T("label.timezone")},{xtype:"combo",name:"language",store:"LanguageCodeStore",queryMode:"local",displayField:"display",valueField:"value",fieldLabel:T("label.language")},{xtype:"filefield",name:"image_file",fieldLabel:T("label.image_upload"),msgTarget:"side",allowBlank:true,buttonText:T("button.file")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")},{xtype:"displayfield",name:"image_clip",itemId:"image_clip",hidden:true}]},{xtype:"container",flex:1,layout:"fit",cls:"noImage paddingLeft10",items:[{xtype:"image",itemId:"image"}]}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.User",{extend:"Ext.container.Container",alias:"widget.management_user",title:T("title.user"),entityUrl:"user",layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.user_list")+"</div>"},this.buildList(this),this.buildForm(this)],this.callParent(arguments);this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){b.store.load()});this.sub("email_filter").on("change",function(c,b){a.search()});this.sub("name_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("email_filter").setValue("");a.sub("name_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").store.load()});this.down("#image_clip").on("change",function(d,b){var c=a.sub("image");if(b!=null&&b.length>0){c.setSrc("download?blob-key="+b)}else{c.setSrc("resources/image/bgDriver.png")}})},search:function(){this.sub("grid").store.clearFilter();this.sub("grid").store.filter([{property:"email",value:this.sub("email_filter").getValue()},{property:"name",value:this.sub("name_filter").getValue()}])},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"UserStore",flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"email",text:T("label.email")},{dataIndex:"name",text:T("label.name")},{dataIndex:"enabled",text:T("label.enabled")},{dataIndex:"admin",text:T("label.admin")},{dataIndex:"company",text:T("label.company")},{dataIndex:"language",text:T("label.language")},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[T("label.email"),{xtype:"textfield",itemId:"email_filter",name:"email_filter",hideLabel:true,width:200},T("label.name"),{xtype:"textfield",itemId:"name_filter",name:"name_filter",hideLabel:true,width:200},{xtype:"button",itemId:"search",text:T("button.search"),tooltip:"Find User"},{text:T("button.reset"),itemId:"search_reset"}],bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:"UserStore",cls:"pagingtoolbar",displayInfo:true,displayMsg:"Displaying users {0} - {1} of {2}",emptyMsg:"No users to display"}}},buildForm:function(a){return{xtype:"panel",bodyPadding:10,cls:"hIndexbar",title:T("title.user_details"),layout:{type:"hbox",align:"stretch"},height:380,items:[{xtype:"container",width:300,layout:"fit",cls:"noImage",items:[{xtype:"image",itemId:"image"}]},{xtype:"form",itemId:"form",bodyPadding:10,flex:1,autoScroll:true,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{name:"email",fieldLabel:T("label.email")},{name:"name",fieldLabel:T("label.name")},{xtype:"checkbox",name:"enabled",fieldLabel:T("label.enabled"),uncheckedValue:"off"},{xtype:"checkbox",name:"admin",fieldLabel:T("label.admin"),uncheckedValue:"off"},{name:"company",fieldLabel:T("label.company"),disable:true},{xtype:"combo",name:"language",store:"LanguageCodeStore",queryMode:"local",displayField:"display",valueField:"value",fieldLabel:T("label.language")},{xtype:"filefield",name:"image_file",fieldLabel:T("label.image_upload"),msgTarget:"side",allowBlank:true,buttonText:T("button.file")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")},{xtype:"displayfield",name:"image_clip",itemId:"image_clip",hidden:true}]}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.Code",{extend:"Ext.container.Container",alias:"widget.management_code",title:T("title.code"),entityUrl:"code",importUrl:"code/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.code_list")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.buildGroupList(this),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.buildCodeList(this),this.buildForm(this)]}]}],this.callParent(arguments);this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){b.store.clearFilter(true);var c=a.sub("grouplist").store.first().get("group");b.store.filter("group",c);a.sub("form").getForm().setValues({group:c})});this.sub("grouplist").on("itemclick",function(c,b){a.sub("grid").store.clearFilter(true);a.sub("grid").store.filter("group",b.get("group"));a.sub("form").getForm().reset();a.sub("form").getForm().setValues({group:b.get("group")})})},buildGroupList:function(a){return{xtype:"gridpanel",itemId:"grouplist",store:"CodeGroupStore",title:T("title.code_group"),width:320,columns:[new Ext.grid.RowNumberer(),{dataIndex:"group",text:T("label.group"),width:100},{dataIndex:"desc",text:T("label.desc"),width:220}]}},buildCodeList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"CodeStore",title:T("title.code_list"),flex:1,cls:"hIndexbarZero",columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"group",text:T("label.group")},{dataIndex:"code",text:T("label.code")},{dataIndex:"desc",text:T("label.desc")},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}]}},buildForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.code_details"),height:200,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{xtype:"combo",name:"group",fieldLabel:T("label.group"),queryMode:"local",store:"CodeGroupStore",displayField:"group",valueField:"group"},{name:"code",fieldLabel:T("label.code")},{name:"desc",fieldLabel:T("label.desc")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.VehicleGroup",{extend:"Ext.container.Container",alias:"widget.management_vehicle_group",title:T("title.vehicle_group"),entityUrl:"vehicle_group",importUrl:"vehicle_group/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},currentVehicleGroup:"",initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.vehicle_group_list")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.buildVehicleGroupList(this),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.buildVehicleGroupForm(this),this.buildGroupedVehicleList(this)]}]}],this.callParent(arguments);this.sub("grid").on("itemclick",function(c,b){a.currentVehicleGroup=b.get("id");a.sub("form").getForm().reset();a.sub("form").loadRecord(b)});this.sub("form_vehicle_group_key").on("change",function(d,c){if(c){var b=a.sub("grid").store.findRecord("key",c);if(b){a.currentVehicleGroup=b.get("id");a.sub("grouped_vehicles_grid").setTitle(T("title.drivers_by_group")+" ["+b.get("id")+"]");a.sub("form").setTitle(T("title.group_details")+" ["+b.get("id")+"]");a.searchGroupedVehicles()}}});this.sub("grouped_vehicles_grid").store.on("beforeload",function(c,b,d){b.params=b.params||{};b.params.vehicle_group_id=a.currentVehicleGroup});this.down("#search_all_vehicles").on("click",function(){a.searchAllVehicles(true)});this.down("#search_reset_all_vehicles").on("click",function(){a.sub("all_vehicles_id_filter").setValue("");a.sub("all_vehicles_reg_no_filter").setValue("")});this.sub("all_vehicles_id_filter").on("change",function(c,b){a.searchAllVehicles(false)});this.sub("all_vehicles_reg_no_filter").on("change",function(c,b){a.searchAllVehicles(false)});this.sub("all_vehicles_grid").store.on("beforeload",function(c,b,d){b.params=b.params||{};var e=a.sub("all_vehicles_id_filter");var f=a.sub("all_vehicles_reg_no_filter");b.params.vehicle_id=e.getSubmitValue();b.params.registration_number=f.getSubmitValue()});this.down("button[itemId=moveLeft]").on("click",function(c){if(!a.currentVehicleGroup){Ext.MessageBox.alert(T("msg.none_selected"),T("msg.select_x_first",{x:T("label.vehicle_group")}));return}var d=a.sub("all_vehicles_grid").getSelectionModel().getSelection();if(!d||d.length==0){Ext.MessageBox.alert(T("msg.none_selected"),"Select the vehicles to add vehicle group ["+a.currentVehicleGroup+"]");return}var e=[];for(var b=0;b<d.length;b++){e.push(d[b].data.id)}Ext.Ajax.request({url:"/vehicle_relation/save",method:"POST",params:{vehicle_group_id:a.currentVehicleGroup,vehicle_id:e},success:function(f){var g=Ext.JSON.decode(f.responseText);if(g.success){a.sub("all_vehicles_grid").getSelectionModel().deselectAll(true);a.searchGroupedVehicles();GreenFleet.msg(T("label.success"),g.msg);a.changedGroupedVehicleCount()}else{Ext.MessageBox.alert(T("label.failure"),g.msg)}},failure:function(f){Ext.MessageBox.alert(T("label.failure"),f.responseText)}})});this.down("button[itemId=moveRight]").on("click",function(c){if(!a.currentVehicleGroup){Ext.Msg.alert(T("msg.none_selected"),T("msg.select_x_first",{x:T("label.vehicle_group")}));return}var d=a.sub("grouped_vehicles_grid").getSelectionModel().getSelection();if(!d||d.length==0){Ext.Msg.alert(T("msg.none_selected"),"Select the vehicles to remove from vehicle group ["+a.currentVehicleGroup+"]");return}var e=[];for(var b=0;b<d.length;b++){e.push(d[b].data.id)}Ext.Ajax.request({url:"/vehicle_relation/delete",method:"POST",params:{vehicle_group_id:a.currentVehicleGroup,vehicle_id:e},success:function(f){var g=Ext.JSON.decode(f.responseText);if(g.success){a.searchGroupedVehicles();GreenFleet.msg(T("label.success"),g.msg);a.changedGroupedVehicleCount()}else{Ext.MessageBox.alert(T("label.failure"),g.msg)}},failure:function(f){Ext.MessageBox.alert(T("label.failure"),f.responseText)}})})},searchAllVehicles:function(b){if(b){this.sub("all_vehicles_grid").store.load()}else{this.sub("all_vehicles_grid").store.clearFilter(true);var a=this.sub("all_vehicles_id_filter").getValue();var c=this.sub("all_vehicles_reg_no_filter").getValue();if(a||c){this.sub("all_vehicles_grid").store.filter([{property:"id",value:a},{property:"registration_number",value:c}])}}},searchGroupedVehicles:function(){this.sub("grouped_vehicles_pagingtoolbar").moveFirst()},changedGroupedVehicleCount:function(){Ext.getStore("VehicleGroupStore").load()},buildVehicleGroupList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"VehicleGroupStore",title:T("title.vehicle_group"),width:320,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"id",text:T("label.group"),width:100},{dataIndex:"desc",text:T("label.desc"),width:220}]}},buildGroupedVehicleList:function(a){return{xtype:"panel",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",itemId:"grouped_vehicles_grid",store:"VehicleByGroupStore",title:T("title.vehicles_by_group"),flex:15,cls:"hIndexbarZero",selModel:new Ext.selection.CheckboxModel(),columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"id",text:T("label.id")},{dataIndex:"registration_number",text:T("label.reg_no")},{dataIndex:"manufacturer",text:T("label.manufacturer"),type:"string"},{dataIndex:"vehicle_type",text:T("label.x_type",{x:T("label.vehicle")}),type:"string"},{dataIndex:"birth_year",text:T("label.birth_year"),type:"string"},{dataIndex:"ownership_type",text:T("label.x_type",{x:T("label.ownership")}),type:"string"},{dataIndex:"status",text:T("label.status"),type:"string"},{dataIndex:"total_distance",text:T("label.total_x",{x:T("label.distance")}),type:"string"}],bbar:{xtype:"pagingtoolbar",itemId:"grouped_vehicles_pagingtoolbar",store:"VehicleByGroupStore",cls:"pagingtoolbar",displayInfo:true,displayMsg:"Displaying vehicles {0} - {1} of {2}",emptyMsg:"No vehicles to display"}},{xtype:"panel",flex:1,layout:{type:"vbox",align:"center",pack:"center"},items:[{xtype:"button",itemId:"moveLeft",text:"<<"},{xtype:"label",margins:"5 0 5 0"},{xtype:"button",itemId:"moveRight",text:">>"}]},{xtype:"gridpanel",itemId:"all_vehicles_grid",store:"VehicleImageBriefStore",title:T("title.vehicle_list"),flex:10,cls:"hIndexbarZero",autoScroll:true,selModel:new Ext.selection.CheckboxModel(),columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"image_clip",text:"Image",renderer:function(b){var c="<img src='";if(b){c+="download?blob-key="+b}else{c+="resources/image/bgVehicle.png"}c+="' width='80' height='80'/>";return c}},{dataIndex:"id",text:T("label.id")},{dataIndex:"registration_number",text:T("label.reg_no")}],tbar:[T("label.id"),{xtype:"textfield",name:"all_vehicles_id_filter",itemId:"all_vehicles_id_filter",hideLabel:true,width:70},T("label.reg_no"),{xtype:"textfield",name:"all_vehicles_reg_no_filter",itemId:"all_vehicles_reg_no_filter",hideLabel:true,width:70}," ",{text:T("button.search"),itemId:"search_all_vehicles"}," ",{text:T("button.reset"),itemId:"search_reset_all_vehicles"}],bbar:{xtype:"pagingtoolbar",itemId:"all_vehicles_pagingtoolbar",store:"VehicleImageBriefStore",cls:"pagingtoolbar",displayInfo:true,displayMsg:"Displaying vehicles {0} - {1} of {2}",emptyMsg:"No vehicles to display"}}]}},buildVehicleGroupForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.group_details"),height:170,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true,itemId:"form_vehicle_group_key"},{name:"id",fieldLabel:T("label.group")},{name:"desc",fieldLabel:T("label.desc")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",confirmMsgSave:T("msg.confirm_save"),confirmMsgDelete:T("msg.confirm_delete"),loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.ConsumableCode",{extend:"Ext.container.Container",alias:"widget.management_consumable_code",title:T("titla.consumable_code"),entityUrl:"consumable_code",importUrl:"consumable_code/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.consumable_code_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){});this.sub("name_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("name_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").store.load()})},search:function(){this.sub("grid").store.clearFilter();this.sub("grid").store.filter([{property:"name",value:this.sub("name_filter").getValue()}])},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"ConsumableCodeStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"name",text:T("label.code"),type:"string"},{dataIndex:"repl_unit",text:T("label.repl_unit"),type:"string"},{dataIndex:"fst_repl_mileage",text:T("label.fst_repl_mileage"),type:"int"},{dataIndex:"fst_repl_time",text:T("label.fst_repl_time"),type:"int"},{dataIndex:"repl_mileage",text:T("label.repl_mileage"),type:"int"},{dataIndex:"repl_time",text:T("label.repl_time"),type:"int"},{dataIndex:"desc",text:T("label.desc"),type:"string"},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[T("label.code"),{xtype:"textfield",name:"name_filter",itemId:"name_filter",hideLabel:true,width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}]}},buildForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.consumable_code_details"),autoScroll:true,flex:1,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{name:"name",fieldLabel:T("label.code")},{name:"repl_unit",xtype:"codecombo",group:"ReplacementUnit",fieldLabel:T("label.repl_unit")},{name:"fst_repl_mileage",xtype:"numberfield",minValue:0,maxValue:500000,fieldLabel:T("label.fst_repl_mileage")+" (km)"},{name:"fst_repl_time",xtype:"numberfield",minValue:0,maxValue:300,fieldLabel:T("label.fst_repl_time")+"(month)"},{name:"repl_mileage",xtype:"numberfield",minValue:0,maxValue:500000,fieldLabel:T("label.repl_mileage")+" (km)"},{name:"repl_time",xtype:"numberfield",minValue:0,maxValue:300,fieldLabel:T("label.repl_time")+"(month)"},{name:"desc",fieldLabel:T("label.desc")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.Vehicle",{extend:"Ext.container.Container",alias:"widget.management_vehicle",title:T("title.vehicle"),entityUrl:"vehicle",importUrl:"vehicle/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.vehicle_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(d,b){a.sub("form").loadRecord(b);var c=a.sub("edit_consumables_grid").store;c.getProxy().extraParams.vehicle_id=b.get("id");c.load()});this.sub("grid").on("render",function(b){});this.sub("id_filter").on("change",function(c,b){a.search(false)});this.sub("registration_number_filter").on("change",function(c,b){a.search(false)});this.down("#search_reset").on("click",function(){a.sub("id_filter").setValue("");a.sub("registration_number_filter").setValue("")});this.down("#search").on("click",function(){a.search(true)});this.down("#image_clip").on("change",function(d,b){var c=a.sub("image");if(b!=null&&b.length>0){c.setSrc("download?blob-key="+b)}else{c.setSrc("resources/image/bgVehicle.png")}})},search:function(c){var a=this.sub("id_filter").getValue();var b=this.sub("registration_number_filter").getValue();this.sub("grid").store.clearFilter(true);this.sub("grid").store.filter([{property:"id",value:a},{property:"registration_number",value:b}]);if(c){this.sub("grid").store.load()}},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"VehicleStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"id",text:T("label.id"),type:"string"},{dataIndex:"registration_number",text:T("label.reg_no"),type:"string"},{dataIndex:"manufacturer",text:T("label.manufacturer"),type:"string"},{dataIndex:"fuel_type",text:T("label.fuel_type"),type:"string"},{dataIndex:"vehicle_type",text:T("label.x_type",{x:T("label.vehicle")}),type:"string"},{dataIndex:"birth_year",text:T("label.birth_year"),type:"string"},{dataIndex:"ownership_type",text:T("label.x_type",{x:T("label.ownership")}),type:"string"},{dataIndex:"status",text:T("label.status"),type:"string"},{dataIndex:"health_status",text:T("label.health"),type:"string"},{dataIndex:"total_distance",text:T("label.total_x",{x:T("label.distance")}),type:"string"},{dataIndex:"remaining_fuel",text:T("label.remaining_fuel"),type:"string"},{dataIndex:"lattitude",text:T("label.lattitude")},{dataIndex:"longitude",text:T("label.longitude")},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",hideLabel:true,width:133},T("label.reg_no"),{xtype:"textfield",name:"registration_number_filter",itemId:"registration_number_filter",hideLabel:true,width:133},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}]}},buildForm:function(a){return{xtype:"panel",bodyPadding:10,cls:"hIndexbar",title:T("title.vehicle_details"),layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"form",itemId:"form",flex:3.5,autoScroll:true,defaults:{xtype:"textfield",anchor:"100%"},items:[{xtype:"image",anchor:"25%",height:"150",itemId:"image",cls:"paddingBottom10"},{name:"key",fieldLabel:"Key",hidden:true},{name:"id",fieldLabel:T("label.id")},{name:"registration_number",fieldLabel:T("label.reg_no")},{xtype:"codecombo",name:"manufacturer",group:"V-Maker",fieldLabel:T("label.manufacturer")},{xtype:"codecombo",name:"vehicle_type",group:"V-Type1",fieldLabel:T("label.x_type",{x:T("label.vehicle")})},{xtype:"codecombo",name:"fuel_type",group:"V-Fuel",fieldLabel:T("label.fuel_type")},{xtype:"filefield",name:"image_file",fieldLabel:T("label.image_upload"),msgTarget:"side",allowBlank:true,buttonText:T("button.file")},{xtype:"codecombo",name:"birth_year",group:"V-BirthYear",name:"birth_year",fieldLabel:T("label.birth_year")},{xtype:"combo",name:"ownership_type",queryMode:"local",store:"OwnershipStore",displayField:"desc",valueField:"name",fieldLabel:T("label.x_type",{x:T("label.ownership")})},{xtype:"combo",name:"status",queryMode:"local",store:"VehicleStatusStore",displayField:"desc",valueField:"status",fieldLabel:T("label.status")},{name:"health_status",fieldLabel:T("label.health")},{name:"total_distance",fieldLabel:T("label.total_x",{x:T("label.distance")})},{name:"remaining_fuel",fieldLabel:T("label.remaining_fuel")},{name:"driver_id",fieldLabel:T("label.driver"),disabled:true},{name:"terminal_id",fieldLabel:T("label.terminal"),disabled:true},{name:"lattitude",fieldLabel:T("label.lattitude"),disabled:true},{name:"longitude",fieldLabel:T("label.longitude"),disabled:true},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")},{xtype:"displayfield",name:"image_clip",itemId:"image_clip",hidden:true}]},{xtype:"management_vehicle_consumable_grid",itemId:"editable_grid",flex:6.5,cls:"paddingLeft10"}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.Terminal",{extend:"Ext.container.Container",alias:"widget.management_terminal",title:T("title.terminal"),entityUrl:"terminal",importUrl:"terminal/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.terminal_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){});this.sub("id_filter").on("change",function(c,b){a.search()});this.sub("serial_no_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("id_filter").setValue("");a.sub("serial_no_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").store.load()});this.down("#image_clip").on("change",function(d,b){var c=a.sub("image");if(b!=null&&b.length>0){c.setSrc("download?blob-key="+b)}else{c.setSrc("resources/image/bgVehicle.png")}})},search:function(){this.sub("grid").store.clearFilter();this.sub("grid").store.filter([{property:"id",value:this.sub("id_filter").getValue()},{property:"serial_no",value:this.sub("serial_no_filter").getValue()}])},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"TerminalStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"id",text:T("label.id"),type:"string"},{dataIndex:"serial_no",text:T("label.x_no",{x:T("label.serial")}),type:"string"},{dataIndex:"buying_date",text:T("label.x_date",{x:T("label.buying")}),xtype:"datecolumn",format:F("date"),width:120},{dataIndex:"comment",text:T("label.comment"),type:"string",width:160},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",hideLabel:true,width:200},T("label.x_no",{x:T("label.serial")}),{xtype:"textfield",name:"serial_no_filter",itemId:"serial_no_filter",hideLabel:true,width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}]}},buildForm:function(a){return{xtype:"panel",itemId:"details",bodyPadding:10,cls:"hIndexbar",title:T("title.terminal_details"),layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"form",itemId:"form",autoScroll:true,flex:1,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{name:"id",fieldLabel:T("label.id")},{name:"serial_no",fieldLabel:T("label.x_no",{x:T("label.serial")})},{xtype:"datefield",name:"buying_date",fieldLabel:T("label.x_date",{x:T("label.buying")}),format:F("date")},{xtype:"textarea",name:"comment",fieldLabel:T("label.comment")},{xtype:"filefield",name:"image_file",fieldLabel:T("label.image_upload"),msgTarget:"side",allowBlank:true,buttonText:T("button.file")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")},{xtype:"displayfield",name:"image_clip",itemId:"image_clip",hidden:true}]},{xtype:"container",flex:1,layout:"fit",cls:"noImage paddingLeft10",items:[{xtype:"image",itemId:"image"}]}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.Reservation",{extend:"Ext.container.Container",alias:"widget.management_reservation",title:T("title.reservation"),entityUrl:"reservation",layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.reservation_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){});this.sub("vehicle_filter").on("change",function(c,b){a.search()});this.sub("reserved_date_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("vehicle_filter").setValue("");a.sub("reserved_date_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").search()})},search:function(a){this.sub("grid").store.load({filters:[{property:"vehicle_id",value:self.sub("vehicle_filter").getSubmitValue()},{property:"reserved_date",value:self.sub("reserved_date_filter").getSubmitValue()}],callback:a})},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"ReservationStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:T("label.id"),type:"string"},{dataIndex:"reserved_date",text:T("label.reserved_date"),xtype:"datecolumn",format:F("date"),width:120},{dataIndex:"driver_id",text:T("label.driver"),type:"string"},{dataIndex:"vehicle_id",text:T("label.vehicle"),type:"string"},{dataIndex:"vehicle_type",text:T("label.x_type",{x:T("label.vehicle")}),type:"string"},{dataIndex:"delivery_place",text:T("label.delivery_place"),type:"string"},{dataIndex:"destination",text:T("label.destination"),type:"string"},{dataIndex:"purpose",text:T("label.purpose"),type:"string"},{dataIndex:"status",text:T("label.status"),type:"string"},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[T("label.vehicle"),{xtype:"textfield",name:"vehicle_filter",itemId:"vehicle_filter",hideLabel:true,width:200},T("label.date"),{xtype:"datefield",name:"reserved_date_filter",itemId:"reserved_date_filter",hideLabel:true,width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}]}},buildForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.reservation_details"),autoScroll:true,flex:1,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:T("label.id"),disabled:true},{xtype:"datefield",name:"reserved_date",fieldLabel:T("label.reserved_date"),format:F("date")},{name:"vehicle_type",fieldLabel:T("label.x_type",{x:T("label.vehicle")})},{xtype:"combo",name:"vehicle_id",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle")},{xtype:"combo",name:"driver_id",queryMode:"local",store:"DriverBriefStore",displayField:"name",valueField:"id",fieldLabel:T("label.driver")},{name:"status",fieldLabel:T("label.status")},{name:"delivery_place",fieldLabel:T("label.delivery_place")},{name:"destination",fieldLabel:T("label.destination")},{name:"purpose",fieldLabel:T("label.purpose")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:a.search,scope:a}}]}}});Ext.define("GreenFleet.view.management.Incident",{extend:"Ext.container.Container",alias:"widget.management_incident",title:T("title.incident"),entityUrl:"incident",layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.incident_list")+"</div>"},initComponent:function(){var a=this;this.callParent();this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){});this.sub("vehicle_filter").on("change",function(c,b){});this.sub("driver_filter").on("change",function(c,b){});this.down("#search_reset").on("click",function(){a.sub("vehicle_filter").setValue("");a.sub("driver_filter").setValue("");a.sub("date_filter").setValue(new Date())});this.down("#search").on("click",function(){a.search()});this.down("#video_clip").on("change",function(e,d){var c=a.sub("video");var b="";if(d!=null&&d.length>1){b='src="download?blob-key='+d+'"'}c.update({value:b})});this.down("#grid").store.on("beforeload",function(c,b,d){b.params=b.params||{};b.params.vehicle_id=a.sub("vehicle_filter").getSubmitValue();b.params.driver_id=a.sub("driver_filter").getSubmitValue();b.params.date=a.sub("date_filter").getSubmitValue()});this.sub("fullscreen").on("afterrender",function(b){b.getEl().on("click",function(){if(!Ext.isWebKit){return}a.sub("video").getEl().dom.getElementsByTagName("video")[0].webkitEnterFullscreen()})})},search:function(){this.sub("pagingtoolbar").moveFirst()},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"IncidentStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"datetime",text:T("label.x_time",{x:T("label.incident")}),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"driver_id",text:T("label.driver"),type:"string"},{dataIndex:"vehicle_id",text:T("label.vehicle"),type:"string"},{dataIndex:"terminal_id",text:T("label.terminal"),type:"string"},{dataIndex:"lattitude",text:T("label.lattitude"),type:"number"},{dataIndex:"longitude",text:T("label.longitude"),type:"number"},{dataIndex:"velocity",text:T("label.velocity"),type:"number"},{dataIndex:"impulse_abs",text:T("label.impulse"),type:"number"},{dataIndex:"impulse_x",text:T("label.impulse_x",{x:"X"}),type:"number"},{dataIndex:"impulse_y",text:T("label.impulse_x",{x:"Y"}),type:"number"},{dataIndex:"impulse_z",text:T("label.impulse_x",{x:"Z"}),type:"number"},{dataIndex:"impulse_threshold",text:T("label.impulse_threshold"),type:"number"},{dataIndex:"engine_temp",text:T("label.engine_temp"),type:"number"},{dataIndex:"engine_temp_threshold",text:T("label.engine_temp_threshold"),type:"number"},{dataIndex:"obd_connected",text:T("label.obd_connected"),type:"boolean"},{dataIndex:"confirm",text:T("label.confirm"),type:"boolean"},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime")},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime")}],viewConfig:{},tbar:[{xtype:"combo",name:"vehicle",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle"),itemId:"vehicle_filter",name:"vehicle_filter",width:200},{xtype:"combo",name:"driver",queryMode:"local",store:"DriverBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.driver"),itemId:"driver_filter",name:"driver_filter",width:200},{xtype:"datefield",name:"date_filter",itemId:"date_filter",fieldLabel:T("label.date"),format:"Y-m-d",submitFormat:"U",maxValue:new Date(),value:new Date(),width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}],bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:"IncidentStore",displayInfo:true,cls:"pagingtoolbar",displayMsg:"Displaying incidents {0} - {1} of {2}",emptyMsg:"No incidents to display"}}},buildForm:function(a){return{xtype:"panel",bodyPadding:10,cls:"hIndexbar",title:T("title.incident_details"),layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"form",itemId:"form",flex:1,autoScroll:true,defaults:{anchor:"100%"},items:[{xtype:"textfield",name:"key",fieldLabel:"Key",hidden:true},{xtype:"datefield",name:"datetime",fieldLabel:T("label.x_time",{x:T("label.incident")}),submitFormat:F("datetime")},{xtype:"combo",name:"vehicle_id",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle")},{xtype:"combo",name:"driver_id",queryMode:"local",store:"DriverBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.driver")},{xtype:"combo",name:"terminal_id",queryMode:"local",store:"TerminalStore",displayField:"id",valueField:"id",fieldLabel:T("label.terminal")},{xtype:"textfield",name:"lattitude",fieldLabel:T("label.lattitude")},{xtype:"textfield",name:"longitude",fieldLabel:T("label.longitude")},{xtype:"textfield",name:"velocity",fieldLabel:T("label.velocity")},{xtype:"textfield",name:"impulse_abs",fieldLabel:T("label.impulse")},{xtype:"textfield",name:"impulse_x",fieldLabel:T("label.impulse_x",{x:"X"})},{xtype:"textfield",name:"impulse_y",fieldLabel:T("label.impulse_x",{x:"Y"})},{xtype:"textfield",name:"impulse_z",fieldLabel:T("label.impulse_x",{x:"Z"})},{xtype:"textfield",name:"impulse_threshold",fieldLabel:T("label.impulse_threshold")},{xtype:"textfield",name:"engine_temp",fieldLabel:T("label.engine_temp")},{xtype:"textfield",name:"engine_temp_threshold",fieldLabel:T("label.engine_temp_threshold")},{xtype:"checkbox",name:"obd_connected",uncheckedValue:"off",fieldLabel:T("label.obd_connected")},{xtype:"checkbox",name:"confirm",uncheckedValue:"off",fieldLabel:T("label.confirm")},{xtype:"filefield",name:"video_file",fieldLabel:T("label.video_upload"),msgTarget:"side",allowBlank:true,buttonText:T("button.file")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:"d-m-Y H:i:s"},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:"d-m-Y H:i:s"},{xtype:"displayfield",name:"video_clip",itemId:"video_clip",hidden:true}]},{xtype:"panel",flex:1,cls:"incidentVOD paddingLeft10",layout:{type:"vbox",align:"stretch",itemCls:"test"},items:[{xtype:"box",itemId:"fullscreen",html:'<div class="btnFullscreen"></div>',handler:function(b){if(!Ext.isWebKit){return}var c=b.up("container").getComponent("video");c.getEl().dom.getElementsByTagName("video")[0].webkitEnterFullscreen()}},{xtype:"box",itemId:"video",cls:"incidentDetail",tpl:['<video width="100%" height="100%" controls="controls">','<source {value} type="video/mp4" />',"Your browser does not support the video tag.","</video>"]}]}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:a.search,scope:a}}]}}});Ext.define("GreenFleet.view.management.Driver",{extend:"Ext.container.Container",alias:"widget.management_driver",title:T("title.driver"),entityUrl:"driver",importUrl:"driver/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.driver_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){});this.sub("id_filter").on("change",function(c,b){a.search()});this.sub("name_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("id_filter").setValue("");a.sub("name_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").store.load()});this.down("#image_clip").on("change",function(d,b){var c=a.sub("image");if(b!=null&&b.length>0){c.setSrc("download?blob-key="+b)}else{c.setSrc("resources/image/bgVehicle.png")}})},search:function(){this.sub("grid").store.clearFilter();this.sub("grid").store.filter([{property:"id",value:this.sub("id_filter").getValue()},{property:"name",value:this.sub("name_filter").getValue()}])},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"DriverStore",autoScroll:true,flex:2.5,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"id",text:T("label.id"),type:"string"},{dataIndex:"name",text:T("label.name"),type:"string"},{dataIndex:"division",text:T("label.division"),type:"string"},{dataIndex:"title",text:T("label.title"),type:"string"},{dataIndex:"social_id",text:T("label.x_id",{x:T("label.social")}),type:"string"},{dataIndex:"phone_no_1",text:T("label.phone_x",{x:1}),type:"string"},{dataIndex:"phone_no_2",text:T("label.phone_x",{x:2}),type:"string"},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",hideLabel:true,width:200},T("label.name"),{xtype:"textfield",name:"name_filter",itemId:"name_filter",hideLabel:true,width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}]}},buildForm:function(a){return{xtype:"panel",itemId:"details",bodyPadding:10,cls:"hIndexbar",title:T("title.driver_details"),layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"container",flex:1,layout:"fit",cls:"noImage",items:[{xtype:"image",itemId:"image"}]},{xtype:"form",itemId:"form",autoScroll:true,bodyPadding:10,flex:8,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{name:"id",fieldLabel:T("label.id")},{name:"name",fieldLabel:T("label.name")},{xtype:"codecombo",name:"division",group:"Division",fieldLabel:T("label.division")},{xtype:"codecombo",name:"title",group:"EmployeeTitle",fieldLabel:T("label.title")},{name:"social_id",fieldLabel:T("label.x_id",{x:T("label.social")})},{name:"phone_no_1",fieldLabel:T("label.phone_x",{x:1})},{name:"phone_no_2",fieldLabel:T("label.phone_x",{x:2})},{xtype:"filefield",name:"image_file",fieldLabel:T("label.image_upload"),msgTarget:"side",allowBlank:true,buttonText:T("button.file")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")},{xtype:"displayfield",name:"image_clip",itemId:"image_clip",hidden:true}]}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.management.Track",{extend:"Ext.container.Container",alias:"widget.management_track",title:T("title.track"),entityUrl:"track",importUrl:"track/import",afterImport:function(){this.search();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.tracking_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){});this.sub("vehicle_filter").on("change",function(c,b){});this.sub("date_filter").on("change",function(c,b){});this.down("#search_reset").on("click",function(){a.sub("vehicle_filter").setValue("");a.sub("date_filter").setValue(new Date())});this.down("#search").on("click",function(){a.search()});this.down("#grid").store.on("beforeload",function(c,b,d){b.params=b.params||{};b.params.vehicle_id=a.sub("vehicle_filter").getSubmitValue();b.params.date=a.sub("date_filter").getSubmitValue()})},search:function(){this.sub("pagingtoolbar").moveFirst()},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"TrackStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"terminal_id",text:T("label.terminal"),type:"string"},{dataIndex:"vehicle_id",text:T("label.vehicle"),type:"string"},{dataIndex:"driver_id",text:T("label.driver"),type:"string"},{dataIndex:"datetime",text:T("label.datetime"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"lattitude",text:T("label.lattitude"),type:"number"},{dataIndex:"longitude",text:T("label.longitude"),type:"number"},{dataIndex:"velocity",text:T("label.velocity"),type:"number"},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[{xtype:"combo",name:"vehicle_filter",itemId:"vehicle_filter",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle"),width:200},{xtype:"datefield",name:"date_filter",itemId:"date_filter",fieldLabel:T("label.date"),format:"Y-m-d",submitFormat:"U",maxValue:new Date(),value:new Date(),width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}],bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:"TrackStore",displayInfo:true,cls:"pagingtoolbar",displayMsg:"Displaying tracks {0} - {1} of {2}",emptyMsg:"No tracks to display"}}},buildForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.tracking_details"),autoScroll:true,flex:1,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{xtype:"combo",name:"terminal_id",queryMode:"local",store:"TerminalStore",displayField:T("label.id"),valueField:"id",fieldLabel:T("label.terminal")},{xtype:"combo",name:"vehicle_id",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle")},{xtype:"combo",name:"driver_id",queryMode:"local",store:"DriverBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.driver")},{xtype:"datefield",name:"datetime",fieldLabel:T("label.datetime"),format:F("datetime")},{name:"lattitude",fieldLabel:T("label.lattitude")},{name:"longitude",fieldLabel:T("label.longitude")},{name:"velocity",fieldLabel:T("label.velocity")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:a.search,scope:a}}]}}});Ext.define("GreenFleet.view.management.CheckinData",{extend:"Ext.container.Container",alias:"widget.management_checkin_data",entityUrl:"checkin_data",title:T("menu.checkin_data"),importUrl:"checkin_data/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.checkin_data_list")+"</div>"},initComponent:function(){var a=this;this.callParent();this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b)});this.sub("grid").on("render",function(b){});this.sub("vehicle_filter").on("change",function(c,b){});this.sub("driver_filter").on("change",function(c,b){});this.down("#search_reset").on("click",function(){a.sub("vehicle_filter").setValue("");a.sub("driver_filter").setValue("")});this.down("#search").on("click",function(){a.search()})},search:function(a){this.sub("grid").store.load({filters:[{property:"vehicle_id",value:this.sub("vehicle_filter").getValue()},{property:"driver_id",value:this.sub("driver_filter").getValue()},{property:"date",value:this.sub("date_filter").getSubmitValue()}],callback:a})},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"CheckinDataStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"terminal_id",text:T("label.terminal")},{dataIndex:"vehicle_id",text:T("label.vehicle")},{dataIndex:"driver_id",text:T("label.driver")},{dataIndex:"datetime",text:T("label.datetime"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"distance",text:T("label.x_distance",{x:T("label.running")})},{dataIndex:"running_time",text:T("label.x_time",{x:T("label.running")})},{dataIndex:"less_than_10km",text:T("label.lessthan_km",{km:10})},{dataIndex:"less_than_20km",text:T("label.lessthan_km",{km:20})},{dataIndex:"less_than_30km",text:T("label.lessthan_km",{km:30})},{dataIndex:"less_than_40km",text:T("label.lessthan_km",{km:40})},{dataIndex:"less_than_50km",text:T("label.lessthan_km",{km:50})},{dataIndex:"less_than_60km",text:T("label.lessthan_km",{km:60})},{dataIndex:"less_than_70km",text:T("label.lessthan_km",{km:70})},{dataIndex:"less_than_80km",text:T("label.lessthan_km",{km:80})},{dataIndex:"less_than_90km",text:T("label.lessthan_km",{km:90})},{dataIndex:"less_than_100km",text:T("label.lessthan_km",{km:100})},{dataIndex:"less_than_110km",text:T("label.lessthan_km",{km:110})},{dataIndex:"less_than_120km",text:T("label.lessthan_km",{km:120})},{dataIndex:"less_than_130km",text:T("label.lessthan_km",{km:130})},{dataIndex:"less_than_140km",text:T("label.lessthan_km",{km:140})},{dataIndex:"less_than_150km",text:T("label.lessthan_km",{km:150})},{dataIndex:"less_than_160km",text:T("label.lessthan_km",{km:160})},{dataIndex:"engine_start_time",text:T("label.x_time",{x:T("label.start")}),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"engine_end_time",text:T("label.x_time",{x:T("label.end")}),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"average_speed",text:T("label.average_speed")},{dataIndex:"max_speed",text:T("label.highest_speed")},{dataIndex:"fuel_consumption",text:T("label.fuel_consumption")},{dataIndex:"fuel_efficiency",text:T("label.fuel_efficiency")},{dataIndex:"sudden_accel_count",text:T("label.x_count",{x:T("label.sudden_accel")})},{dataIndex:"sudden_brake_count",text:T("label.x_count",{x:T("label.sudden_brake")})},{dataIndex:"idle_time",text:T("label.x_time",{x:T("label.idling")})},{dataIndex:"eco_driving_time",text:T("label.x_time",{x:T("label.eco_driving")})},{dataIndex:"over_speed_time",text:T("label.x_time",{x:T("label.over_speeding")})},{dataIndex:"co2_emissions",text:T("label.co2_emissions")},{dataIndex:"max_cooling_water_temp",text:T("label.max_cooling_water_temp")},{dataIndex:"avg_battery_volt",text:T("label.average_battery_voltage")},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[{xtype:"combo",name:"vehicle_id",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle"),name:"vehicle_filter",itemId:"vehicle_filter",width:200},{xtype:"combo",name:"driver_id",queryMode:"local",store:"DriverBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.driver"),name:"driver_filter",itemId:"driver_filter",width:200},{xtype:"datefield",name:"date_filter",itemId:"date_filter",fieldLabel:T("label.date"),format:"Y-m-d",submitFormat:"U",maxValue:new Date(),value:new Date(),width:200},{itemId:"search",text:T("button.search")},{text:T("button.reset"),itemId:"search_reset"}]}},buildForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.checkin_data_details"),autoScroll:true,flex:1,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{xtype:"combo",name:"vehicle_id",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle")},{xtype:"combo",name:"driver_id",queryMode:"local",store:"DriverBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.driver")},{xtype:"combo",name:"terminal_id",queryMode:"local",store:"TerminalStore",displayField:"id",valueField:"id",fieldLabel:T("label.terminal")},{xtype:"datefield",name:"datetime",fieldLabel:T("label.datetime"),format:F("datetime")},{name:"distance",fieldLabel:T("label.x_distance",{x:T("label.running")})},{name:"running_time",fieldLabel:T("label.x_time",{x:T("label.running")})},{name:"less_than_10km",fieldLabel:T("label.lessthan_km",{km:10})},{name:"less_than_20km",fieldLabel:T("label.lessthan_km",{km:20})},{name:"less_than_30km",fieldLabel:T("label.lessthan_km",{km:30})},{name:"less_than_40km",fieldLabel:T("label.lessthan_km",{km:40})},{name:"less_than_50km",fieldLabel:T("label.lessthan_km",{km:50})},{name:"less_than_60km",fieldLabel:T("label.lessthan_km",{km:60})},{name:"less_than_70km",fieldLabel:T("label.lessthan_km",{km:70})},{name:"less_than_80km",fieldLabel:T("label.lessthan_km",{km:80})},{name:"less_than_90km",fieldLabel:T("label.lessthan_km",{km:90})},{name:"less_than_100km",fieldLabel:T("label.lessthan_km",{km:100})},{name:"less_than_110km",fieldLabel:T("label.lessthan_km",{km:110})},{name:"less_than_120km",fieldLabel:T("label.lessthan_km",{km:120})},{name:"less_than_130km",fieldLabel:T("label.lessthan_km",{km:130})},{name:"less_than_140km",fieldLabel:T("label.lessthan_km",{km:140})},{name:"less_than_150km",fieldLabel:T("label.lessthan_km",{km:150})},{name:"less_than_160km",fieldLabel:T("label.lessthan_km",{km:160})},{xtype:"datefield",name:"engine_start_time",fieldLabel:T("label.x_time",{x:T("label.start")}),format:F("datetime")},{xtype:"datefield",name:"engine_end_time",fieldLabel:T("label.x_time",{x:T("label.end")}),format:F("datetime")},{name:"average_speed",fieldLabel:T("label.average_speed")},{name:"max_speed",fieldLabel:T("label.highest_speed")},{name:"fuel_consumption",fieldLabel:T("label.fuel_consumption")},{name:"fuel_efficiency",fieldLabel:T("label.fuel_efficiency")},{name:"sudden_accel_count",fieldLabel:T("label.x_count",{x:T("label.sudden_accel")})},{name:"sudden_brake_count",fieldLabel:T("label.x_count",{x:T("label.sudden_brake")})},{name:"idle_time",fieldLabel:T("label.x_time",{x:T("label.idling")})},{name:"eco_driving_time",fieldLabel:T("label.x_time",{x:T("label.eco_driving")})},{name:"over_speed_time",fieldLabel:T("label.x_time",{x:T("label.over_speeding")})},{name:"co2_emissions",fieldLabel:T("label.co2_emissions")},{name:"max_cooling_water_temp",fieldLabel:T("label.max_cooling_water_temp")},{name:"avg_battery_volt",fieldLabel:T("label.average_battery_voltage")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:a.search,scope:a}}]}}});Ext.define("GreenFleet.view.monitor.Map",{extend:"Ext.Container",alias:"widget.monitor_map",id:"monitor_map",layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[this.ztitle,this.zmap];this.callParent();var c=this;var b=null;var d=null;var a=null;this.on("afterrender",function(){d=Ext.getStore("VehicleMapStore");a=Ext.getStore("RecentIncidentStore");var e=Ext.getStore("VehicleFilteredStore");e.on("datachanged",function(){if(c.isVisible()){c.refreshMap(e,c.sub("autofit").getValue())}});d.load();b=setInterval(function(){d.load();a.load()},10000)});this.on("resize",function(){google.maps.event.trigger(c.getMap(),"resize")});this.on("activate",function(){google.maps.event.trigger(c.getMap(),"resize");if(c.sub("autofit").getValue()){c.refreshMap(Ext.getStore("VehicleFilteredStore"),true)}});this.sub("autofit").on("change",function(e,f){if(f){c.refreshMap(Ext.getStore("VehicleFilteredStore"),f)}});this.sub("refreshterm").on("change",function(f,e){if(e){clearInterval(b);b=setInterval(function(){d.load();a.load()},e*1000)}})},getMap:function(){if(!this.map){this.map=new google.maps.Map(this.sub("mapbox").getEl().down(".map").dom,{zoom:10,maxZoom:19,minZoom:3,center:new google.maps.LatLng(System.props.lattitude,System.props.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP})}return this.map},getMarkers:function(){if(!this.markers){this.markers={}}return this.markers},getLabels:function(){if(!this.labels){this.labels={}}return this.labels},resetLabels:function(){for(var a in this.labels){this.labels[a].setMap(null)}this.labels={}},resetMarkers:function(){for(var a in this.markers){google.maps.event.clearListeners(this.markers[a]);this.markers[a].setMap(null)}this.markers={}},refreshMap:function(b,d){this.resetMarkers();this.resetLabels();var a={Running:"resources/image/statusDriving.png",Idle:"resources/image/statusStop.png",Incident:"resources/image/statusIncident.png",Maint:"resources/image/statusMaint.png"};var c;b.each(function(g){var j=g.get("id");var i=g.get("driver_id");var f=Ext.getStore("DriverBriefStore").findRecord("id",i);var k=new google.maps.LatLng(g.get("lattitude"),g.get("longitude"));var e=new google.maps.Marker({position:k,map:this.getMap(),status:g.get("status"),icon:a[g.get("status")],title:f?f.get("name"):i,tooltip:g.get("registration_number")+"("+(f?f.get("name"):i)+")"});if(!c){c=new google.maps.LatLngBounds(k,k)}else{c.extend(k)}var h=new Label({map:this.getMap()});h.bindTo("position",e,"position");h.bindTo("text",e,"tooltip");this.getMarkers()[j]=e;this.getLabels()[j]=h;google.maps.event.addListener(e,"click",function(){GreenFleet.doMenu("information");GreenFleet.getMenu("information").setVehicle(g)})},this);if(!c){this.getMap().setCenter(new google.maps.LatLng(System.props.lattitude,System.props.longitude))}else{if(c.isEmpty()||c.getNorthEast().equals(c.getSouthWest())){this.getMap().setCenter(c.getNorthEast())}else{if(d){this.getMap().fitBounds(c)}}}},ztitle:{xtype:"container",cls:"pageTitle",height:35,layout:{type:"hbox",align:"stretch"},items:[{flex:1,html:"<h1>"+T("title.map")+"</h1>"},{xtype:"combo",valueField:"value",displayField:"display",value:10,width:180,labelWidth:110,labelAlign:"right",labelSeparator:"",store:Ext.create("Ext.data.Store",{data:[{value:3,display:"3"+T("label.second_s")},{value:5,display:"5"+T("label.second_s")},{value:10,display:"10"+T("label.second_s")},{value:30,display:"30"+T("label.second_s")},{value:60,display:"1"+T("label.minute_s")},{value:300,display:"5"+T("label.minute_s")}],fields:["value","display"]}),queryMode:"local",fieldLabel:T("label.refreshterm"),itemId:"refreshterm"},{xtype:"checkboxgroup",width:80,defaults:{boxLabelAlign:"before",width:80,checked:true,labelWidth:60,labelAlign:"right",labelSeparator:""},items:[{fieldLabel:T("label.autofit"),itemId:"autofit"}]}]},zmap:{xtype:"panel",flex:1,itemId:"mapbox",html:'<div class="map" style="height:100%"></div>'}});Ext.define("GreenFleet.view.monitor.CheckinByVehicle",{extend:"Ext.grid.Panel",alias:"widget.monitor_control_by_vehicle",title:T("tab.ctrl_by_vehicle"),store:"CheckinDataStore",autoScroll:true,listeners:{},initComponent:function(){this.columns=this.buildColumns();this.callParent()},onSearch:function(b){var c=b.down("textfield[name=vehicle_filter]");var a=b.down("textfield[name=driver_filter]");b.store.load({filters:[{property:"vehicle_id",value:c.getValue()},{property:"driver_id",value:a.getValue()}]})},onReset:function(a){a.down("textfield[name=vehicle_filter]").setValue("");a.down("textfield[name=driver_filter]").setValue("")},tbar:[{xtype:"combo",name:"vehicle_filter",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle"),width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},{xtype:"combo",name:"driver_filter",queryMode:"local",store:"DriverBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.driver"),width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},{xtype:"button",text:T("button.search"),tooltip:"Find Checkin Data",handler:function(){var a=this.up("gridpanel");a.onSearch(a)}},{text:T("button.reset"),handler:function(){var a=this.up("gridpanel");a.onReset(a)}}],buildColumns:function(){return[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"terminal_id",text:T("label.terminal")},{dataIndex:"vehicle_id",text:T("label.vehicle")},{dataIndex:"driver_id",text:T("label.driver")},{dataIndex:"datetime",text:T("label.date"),xtype:"datecolumn",format:F("date")},{dataIndex:"distance",text:T("label.x_distance",{x:T("label.running")})},{dataIndex:"running_time",text:T("label.x_time",{x:T("label.running")})},{dataIndex:"less_than_10km",text:T("label.lessthan_km",{km:10})},{dataIndex:"less_than_20km",text:T("label.lessthan_km",{km:20})},{dataIndex:"less_than_30km",text:T("label.lessthan_km",{km:30})},{dataIndex:"less_than_40km",text:T("label.lessthan_km",{km:40})},{dataIndex:"less_than_50km",text:T("label.lessthan_km",{km:50})},{dataIndex:"less_than_60km",text:T("label.lessthan_km",{km:60})},{dataIndex:"less_than_70km",text:T("label.lessthan_km",{km:70})},{dataIndex:"less_than_80km",text:T("label.lessthan_km",{km:80})},{dataIndex:"less_than_90km",text:T("label.lessthan_km",{km:90})},{dataIndex:"less_than_100km",text:T("label.lessthan_km",{km:100})},{dataIndex:"less_than_110km",text:T("label.lessthan_km",{km:110})},{dataIndex:"less_than_120km",text:T("label.lessthan_km",{km:120})},{dataIndex:"less_than_130km",text:T("label.lessthan_km",{km:130})},{dataIndex:"less_than_140km",text:T("label.lessthan_km",{km:140})},{dataIndex:"less_than_150km",text:T("label.lessthan_km",{km:150})},{dataIndex:"less_than_160km",text:T("label.lessthan_km",{km:160})},{dataIndex:"engine_start_time",text:T("label.x_time",{x:T("label.start")}),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"engine_end_time",text:T("label.x_time",{x:T("label.end")}),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"average_speed",text:T("label.average_speed")},{dataIndex:"max_speed",text:T("label.highest_speed")},{dataIndex:"fuel_consumption",text:T("label.fuel_consumption")},{dataIndex:"fuel_efficiency",text:T("label.fuel_efficiency")},{dataIndex:"sudden_accel_count",text:T("label.x_count",{x:T("label.sudden_accel")})},{dataIndex:"sudden_brake_count",text:T("label.x_count",{x:T("label.sudden_brake")})},{dataIndex:"idle_time",text:T("label.x_time",{x:T("label.idling")})},{dataIndex:"eco_driving_time",text:T("label.x_time",{x:T("label.eco_driving")})},{dataIndex:"over_speed_time",text:T("label.x_time",{x:T("label.over_speeding")})},{dataIndex:"co2_emissions",text:T("label.co2_emissions")},{dataIndex:"max_cooling_water_temp",text:T("label.max_cooling_water_temp")},{dataIndex:"avg_battery_volt",text:T("label.average_battery_voltage")},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}]}});Ext.define("GreenFleet.view.monitor.InfoByVehicle",{extend:"Ext.grid.Panel",alias:"widget.monitor_info_by_vehicle",title:T("tab.info_by_vehicle"),store:"VehicleInfoStore",autoScroll:true,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"id",text:T("label.id"),type:"string"},{dataIndex:"registration_number",text:T("label.reg_no"),type:"string"},{dataIndex:"manufacturer",text:T("label.manufacturer"),type:"string"},{dataIndex:"vehicle_type",text:T("label.x_type",{x:T("label.vehicle")}),type:"string"},{dataIndex:"birth_year",text:T("label.birth_year"),type:"string"},{dataIndex:"ownership_type",text:T("label.x_type",{x:T("label.ownership")}),type:"string"},{dataIndex:"status",text:T("label.status"),type:"string"},{dataIndex:"health_status",text:T("label.health"),type:"string"},{dataIndex:"total_distance",text:T("label.total_x",{x:T("label.distance")}),type:"string"},{dataIndex:"remaining_fuel",text:T("label.remaining_fuel"),type:"string"},{dataIndex:"lattitude",text:T("label.lattitude")},{dataIndex:"longitude",text:T("label.longitude")},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},listeners:{render:function(a){a.store.load()},itemclick:function(b,a){var c=b.up("monitor_information").down("form");c.loadRecord(a)}},onSearch:function(a){var c=a.down("textfield[name=id_filter]");var b=a.down("textfield[name=registration_number_field]");a.store.clearFilter();a.store.filter([{property:"id",value:c.getValue()},{property:"registration_number",value:b.getValue()}])},onReset:function(a){a.down("textfield[name=id_filter]").setValue("");a.down("textfield[name=registration_number_field]").setValue("")},tbar:["ID",{xtype:"textfield",name:"id_filter",hideLabel:true,width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},"Registeration Number",{xtype:"textfield",name:"registration_number_field",hideLabel:true,width:200,listeners:{specialkey:function(c,b){if(b.getKey()==b.ENTER){var a=this.up("gridpanel");a.onSearch(a)}}}},{xtype:"button",text:T("button.search"),tooltip:"Find Vehicle",handler:function(){var a=this.up("gridpanel");a.onSearch(a)}},{text:T("button.reset"),handler:function(){var a=this.up("gridpanel");a.onReset(a)}}]});Ext.define("GreenFleet.view.monitor.Information",{extend:"Ext.Container",alias:"widget.monitor_information",id:"monitor_information",layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[this.ztitle,{xtype:"container",height:320,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",width:620,layout:{type:"vbox",align:"stretch"},items:[this.zvehicleinfo,this.zincidents]},this.zmap]},this.ztabpanel];this.callParent();var a=this;this.sub("map").on("afterrender",function(b){var c={zoom:10,minZoom:3,maxZoom:19,center:new google.maps.LatLng(System.props.lattitude,System.props.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};a.setMap(new google.maps.Map(b.getEl().down(".map").dom,c))});this.on("activate",function(){google.maps.event.trigger(a.getMap(),"resize")});this.getTrackStore().on("load",function(){a.refreshTrack()});this.getIncidentStore().on("load",function(){if(a.isVisible(true)){a.refreshIncidents()}});this.sub("id").on("change",function(m,e){var j=a.getForm().getRecord();var k=Ext.getStore("VehicleBriefStore");var i=k.findRecord("id",j.get("id"));var h=i.get("image_clip");if(h){a.sub("vehicleImage").setSrc("download?blob-key="+h)}else{a.sub("vehicleImage").setSrc("resources/image/bgVehicle.png")}var g=Ext.getStore("DriverBriefStore");var c=g.findRecord("id",j.get("driver_id"));var o=c.get("id");var f=c.get("image_clip");if(f){a.sub("driverImage").setSrc("download?blob-key="+f)}else{a.sub("driverImage").setSrc("resources/image/bgDriver.png")}a.sub("title").update({vehicle:e+" ("+i.get("registration_number")+")",driver:o+" ("+c.get("name")+")"});var n=j.get("location");if(n==null||n.length==0){var l=j.get("lattitude");var b=j.get("longitude");if(l!==undefined&&b!==undefined){var d=new google.maps.LatLng(l,b);geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:d},function(r,q){if(q==google.maps.GeocoderStatus.OK){if(r[0]){var p=r[0].formatted_address;j.set("location",p);a.sub("location").setValue(p)}}else{console.log("Geocoder failed due to: "+q)}})}}a.getTrackStore().load({params:{vehicle_id:e,date:Math.round((new Date().getTime()-(60*60*24*1000))/1000),start:0,limit:1000}});a.getIncidentStore().load({params:{vehicle_id:e,confirm:false,start:0,limit:4}})})},setVehicle:function(a){this.getForm().loadRecord(a)},getForm:function(){if(!this.form){this.form=this.down("form")}return this.form},getMap:function(){return this.map},setMap:function(a){this.map=a},getTrackLine:function(){return this.trackline},setTrackLine:function(a){if(this.trackline){this.trackline.setMap(null)}this.trackline=a},getMarkers:function(){return this.markers},setMarkers:function(a){if(this.markers){Ext.each(this.markers,function(b){b.setMap(null)})}this.markers=a},resetMarkers:function(){if(this.markers){Ext.each(this.markers,function(a){a.setMap(null)})}this.markers=null},getTrackStore:function(){if(!this.trackStore){this.trackStore=Ext.getStore("TrackByVehicleStore")}return this.trackStore},getIncidentStore:function(){if(!this.incidentStore){this.incidentStore=Ext.getStore("IncidentByVehicleStore")}return this.incidentStore},getVehicle:function(){return this.sub("id").getValue()},getDriver:function(){return this.sub("driver").getValue()},getTerminal:function(){return this.sub("terminal").getValue()},refreshTrack:function(){this.setTrackLine(new google.maps.Polyline({map:this.getMap(),strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:4}));this.setMarkers(null);var k=this.getTrackLine().getPath();var a;var c;this.getTrackStore().each(function(l){var n=l.get("lattitude");var m=l.get("longitude");if(n!==0||m!==0){c=new google.maps.LatLng(n,m);k.push(c);if(!a){a=new google.maps.LatLngBounds(c,c)}else{a.extend(c)}}});if(k.getLength()===0){var g=this.getForm().getRecord();var h=g.get("lattitude");var i=g.get("longitude");var e=null;if(h===0&&i===0){e=new google.maps.LatLng(System.props.lattitude,System.props.longitude)}else{e=new google.maps.LatLng(h,i)}k.push(e);a=new google.maps.LatLngBounds(e,e)}if(a.isEmpty()||a.getNorthEast().equals(a.getSouthWest())){this.getMap().setCenter(a.getNorthEast())}else{this.getMap().fitBounds(a)}var f=k.getAt(0);if(f){var b=new google.maps.Marker({position:new google.maps.LatLng(f.lat(),f.lng()),map:this.getMap()});var j=k.getAt(k.getLength()-1);var d=new google.maps.Marker({position:new google.maps.LatLng(j.lat(),j.lng()),icon:"resources/image/iconStartPoint.png",map:this.getMap()});this.setMarkers([b,d])}},incidentHandler:function(c,a,b){GreenFleet.doMenu("monitor_incident");GreenFleet.getMenu("monitor_incident").setIncident(b,true)},refreshIncidents:function(){this.sub("incidents").removeAll();var a=this.getIncidentStore().count()>4?4:this.getIncidentStore().count();for(var c=0;c<a;c++){var d=this.getIncidentStore().getAt(c);var b=this;this.sub("incidents").add({xtype:"box",cls:"incidentThumb",listeners:{render:function(){this.getEl().on("click",b.incidentHandler,b,d)}},data:{vehicle_id:d.get("vehicle_id"),driver_id:d.get("driver_id"),datetime:Ext.Date.format(d.get("datetime"),"Y-m-d H:i:s")},tpl:['<div class="vehicle">{vehicle_id}</div>','<div class="driver">{driver_id}</div>','<div class="date">{datetime}</div>']})}},ztitle:{xtype:"box",cls:"pageTitle",itemId:"title",data:{vehicle:"Vehicle",driver:"Driver"},tpl:"<h1>"+T("label.vehicle")+' : <span class="vehicle">{vehicle}</span>, '+T("label.driver")+' : <span class="driver">{driver}</span></h1>',height:35},ztabpanel:{xtype:"tabpanel",flex:1,items:[{xtype:"monitor_info_by_vehicle"},{xtype:"monitor_control_by_vehicle",title:T("tab.ctrl_by_vehicle")},{xtype:"monitor_control_by_vehicle",title:T("tab.ctrl_by_driver")},{xtype:"monitor_control_by_vehicle",title:T("tab.maintenance")}]},zvehicleinfo:{xtype:"panel",title:T("title.vehicle_information"),cls:"paddingPanel",layout:{type:"hbox"},items:[{xtype:"image",itemId:"vehicleImage",cls:"imgVehicle"},{xtype:"image",itemId:"driverImage",cls:"imgDriver"},{xtype:"form",height:160,flex:1,defaults:{labelWidth:60,labelSeparator:"",anchor:"100%"},items:[{xtype:"displayfield",name:"id",fieldLabel:T("label.vehicle"),cls:"dotUnderline",itemId:"id"},{xtype:"displayfield",name:"driver_id",fieldLabel:T("label.driver"),cls:"dotUnderline",itemId:"driver"},{xtype:"displayfield",name:"terminal_id",fieldLabel:T("label.terminal"),cls:"dotUnderline",itemId:"terminal"},{xtype:"displayfield",name:"location",fieldLabel:T("label.location"),cls:"dotUnderline",itemId:"location"},{xtype:"displayfield",name:"distance",cls:"dotUnderline",fieldLabel:T("label.run_dist")},{xtype:"displayfield",name:"running_time",fieldLabel:T("label.run_time"),cls:"dotUnderline"}]}]},zincidents:{xtype:"panel",title:T("title.incidents"),layout:"fit",cls:"paddingPanel",height:115,items:[{xtype:"container",itemId:"incidents",layout:{type:"hbox",align:"left"}}]},zmap:{xtype:"panel",title:T("title.tracking_recent_driving"),cls:"paddingPanel backgroundGray borderLeftGray",itemId:"map",flex:1,html:'<div class="map"></div>'}});Ext.define("GreenFleet.view.monitor.IncidentView",{extend:"Ext.container.Container",alias:"widget.monitor_incident",title:T("title.incident_view"),layout:{type:"vbox",align:"stretch"},initComponent:function(){this.items=[{xtype:"container",autoScroll:true,layout:{type:"vbox",align:"stretch"},height:460,items:[this.zInfo,this.zVideoAndMap]},{xtype:"container",autoScroll:true,layout:{type:"hbox",align:"stretch"},flex:1,items:[this.zList]}];this.callParent(arguments);var a=this;this.sub("map").on("afterrender",function(){var b={zoom:12,minZoom:3,maxZoom:19,center:new google.maps.LatLng(System.props.lattitude,System.props.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP};a.map=new google.maps.Map(a.sub("map").getEl().down(".map").dom,b);a.getLogStore().on("load",function(d,c,e){a.refreshTrack()})});this.on("activate",function(b){google.maps.event.trigger(a.getMap(),"resize")});this.down("button[itemId=search]").on("click",function(){a.refreshIncidentList()});this.down("button[itemId=reset]").on("click",function(){a.sub("vehicle_filter").reset();a.sub("driver_filter").reset()});this.down("displayfield[name=video_clip]").on("change",function(d,c){var b="";if(c!=null&&c.length>1){if(c.indexOf("http")==0){b="src="+c}else{b='src="download?blob-key='+c+'"'}}a.sub("video").update({value:b})});this.down("datefield[name=datetime]").on("change",function(c,b){a.sub("incident_time").setValue(Ext.Date.format(b,"D Y-m-d H:i:s"))});this.down("displayfield[name=driver_id]").on("change",function(g,f){var e=Ext.getStore("DriverBriefStore");var b=e.findRecord("id",f);var d=b.get("id");var c=b.get("image_clip");if(c){a.sub("driverImage").setSrc("download?blob-key="+c)}else{a.sub("driverImage").setSrc("resources/image/bgDriver.png")}});this.sub("driver_filter").on("specialkey",function(c,b){if(b.getKey()==b.ENTER){a.refreshIncidentList()}});this.sub("vehicle_filter").on("specialkey",function(c,b){if(b.getKey()==b.ENTER){a.refreshIncidentList()}});this.sub("grid").on("itemclick",function(c,b){a.setIncident(b,false)});this.sub("fullscreen").on("afterrender",function(b){b.getEl().on("click",function(){if(!Ext.isWebKit){return}a.sub("video").getEl().dom.getElementsByTagName("video")[0].webkitEnterFullscreen()})});this.sub("incident_form").on("afterrender",function(){this.down("[itemId=confirm]").getEl().on("click",function(d,b){var c=a.sub("incident_form").getForm();if(c.getRecord()!=null){c.submit({url:"incident/save",success:function(e,f){a.sub("grid").store.findRecord("key",f.result.key).set("confirm",e.findField("confirm").getValue())},failure:function(e,f){GreenFleet.msg("Failed",f.result.msg);e.reset()}})}})});this.down("#grid").store.on("beforeload",function(c,b,d){b.params=b.params||{};b.params.vehicle_id=a.sub("vehicle_filter").getSubmitValue();b.params.driver_id=a.sub("driver_filter").getSubmitValue()})},getLogStore:function(){if(!this.logStore){this.logStore=Ext.getStore("IncidentLogStore")}return this.logStore},setIncident:function(b,a){this.incident=b;if(a){this.sub("vehicle_filter").setValue(b.get("vehicle_id"));this.sub("driver_filter").reset();this.refreshIncidentList()}this.sub("incident_form").loadRecord(b);this.refreshMap()},getIncident:function(){return this.incident},refreshIncidentList:function(){this.sub("pagingtoolbar").moveFirst()},getTrackLine:function(){return this.trackline},setTrackLine:function(a){if(this.trackline){this.trackline.setMap(null)}this.trackline=a},getMarker:function(){return this.marker},setMarker:function(a){if(this.marker){this.marker.setMap(null)}this.marker=a},refreshMap:function(){this.setMarker(null);var b=this.getIncident();var a=null;if(!b){a=new google.maps.LatLng(System.props.lattitude,System.props.longitude)}else{a=new google.maps.LatLng(b.get("lattitude"),b.get("longitude"))}this.getMap().setCenter(a);if(!b){return}this.setMarker(new google.maps.Marker({position:a,map:this.getMap()}));this.getLogStore().clearFilter(true);this.getLogStore().filter([{property:"incident",value:b.get("key")}]);this.getLogStore().load()},refreshTrack:function(){this.setTrackLine(new google.maps.Polyline({map:this.getMap(),strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:4}));var b=this.getTrackLine().getPath();var a;var c;this.getLogStore().each(function(d){c=new google.maps.LatLng(d.get("lattitude"),d.get("longitude"));b.push(c);if(!a){a=new google.maps.LatLngBounds(c,c)}else{a.extend(c)}});if(!a){return}if(a.isEmpty()||a.getNorthEast().equals(a.getSouthWest())){this.getMap().setCenter(a.getNorthEast())}else{this.getMap().fitBounds(a)}},getMap:function(){return this.map},zInfo:{xtype:"form",itemId:"incident_form",cls:"incidentSummary",height:50,layout:{type:"hbox",align:"stretch"},autoScroll:true,defaults:{anchor:"100%",labelAlign:"top",cls:"summaryCell"},items:[{xtype:"textfield",name:"key",hidden:true},{xtype:"image",itemId:"driverImage",cls:"imgDriverSmall",height:37},{xtype:"datefield",name:"datetime",hidden:true,format:"d-m-Y H:i:s"},{xtype:"displayfield",itemId:"incident_time",width:160,fieldLabel:T("label.x_time",{x:T("label.incident")})},{xtype:"displayfield",name:"vehicle_id",width:100,fieldLabel:T("label.vehicle")},{xtype:"displayfield",name:"driver_id",width:100,fieldLabel:T("label.driver")},{xtype:"displayfield",name:"impulse_abs",width:100,fieldLabel:T("label.impulse")},{xtype:"displayfield",name:"engine_temp",width:100,fieldLabel:T("label.engine_temp")},{xtype:"checkbox",name:"confirm",itemId:"confirm",fieldLabel:T("label.confirm"),uncheckedValue:"off",labelCls:"labelStyle1",cls:"backgroundNone"},{xtype:"displayfield",name:"video_clip",hidden:true}]},zVideoAndMap:{xtype:"container",layout:{type:"hbox",align:"stretch"},flex:1,items:[{xtype:"panel",cls:"paddingAll10 incidentVOD",width:690,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",itemId:"fullscreen",html:'<div class="btnFullscreen"></div>'},{xtype:"box",cls:"incidentDetail",flex:1,itemId:"video",tpl:['<video width="100%" height="100%" controls="controls">','<source {value} type="video/mp4" />',"Your browser does not support the video tag.","</video>"]}]},{xtype:"panel",cls:"backgroundGray borderLeftGray",flex:1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"box",itemId:"map",html:'<div class="map"></div>',flex:3},{xtype:"chart",itemId:"chart",flex:1,legend:{position:"bottom",itemSpacing:5,padding:0,labelFont:"10px Helvetica, sans-serif",boxStroke:"transparent",boxFill:"transparent"},store:"IncidentLogStore",axes:[{type:"Numeric",position:"left",fields:["accelate_x","accelate_y","accelate_z"]},{type:"Numeric",position:"right",fields:["velocity"]},{type:"Time",position:"bottom",fields:["datetime"],dateFormat:"H:i:s",step:[Ext.Date.SECOND,1],label:{rotate:{degrees:45}}}],series:[{type:"line",xField:"datetime",yField:"accelate_x",axis:"left",smooth:true},{type:"line",xField:"datetime",yField:"accelate_y",axis:"left",smooth:true},{type:"line",xField:"datetime",yField:"accelate_z",axis:"left",smooth:true},{type:"line",xField:"datetime",yField:"velocity",axis:"right",smooth:true}],flex:2}]}]},zList:{xtype:"gridpanel",itemId:"grid",cls:"hIndexbar",title:T("title.incident_list"),store:"IncidentViewStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",type:"string",hidden:true},{dataIndex:"video_clip",text:"V",renderer:function(b,a){return'<input type="checkbox" disabled="true" '+(!!b?"checked ":"")+'"/>'},width:20},{dataIndex:"confirm",text:T("label.confirm"),renderer:function(b,a){return'<input type="checkbox" disabled="true" '+(!!b?"checked ":"")+'"/>'},align:"center",width:50},{dataIndex:"datetime",text:T("label.x_time",{x:T("label.incident")}),xtype:"datecolumn",width:120,format:F("datetime")},{dataIndex:"driver_id",text:T("label.driver"),type:"string",width:80},{dataIndex:"vehicle_id",text:T("label.vehicle"),type:"string",width:80},{dataIndex:"terminal_id",text:T("label.terminal"),type:"string",width:80},{dataIndex:"lattitude",text:T("label.lattitude"),type:"number",width:80},{dataIndex:"longitude",text:T("label.longitude"),type:"number",width:80},{dataIndex:"velocity",text:T("label.velocity"),type:"number",width:80},{dataIndex:"impulse_abs",text:T("label.impulse"),type:"number",width:80},{dataIndex:"impulse_x",text:T("label.impulse_x",{x:"X"}),type:"number",width:80},{dataIndex:"impulse_y",text:T("label.impulse_x",{x:"Y"}),type:"number",width:80},{dataIndex:"impulse_z",text:T("label.impulse_x",{x:"Z"}),type:"number",width:80},{dataIndex:"impulse_threshold",text:T("label.impulse_threshold"),type:"number",width:80},{dataIndex:"obd_connected",text:T("label.obd"),renderer:function(b,a){return'<input type="checkbox" disabled="true" '+(!!b?"checked ":"")+'"/>'},align:"center",width:40},{dataIndex:"engine_temp",text:T("label.engine_temp"),type:"number",width:80},{dataIndex:"engine_temp_threshold",text:T("label.engine_temp_threshold"),type:"number",width:80},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[{xtype:"combo",queryMode:"local",store:"VehicleBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.vehicle"),itemId:"vehicle_filter",width:200},{xtype:"combo",queryMode:"local",store:"DriverBriefStore",displayField:"id",valueField:"id",fieldLabel:T("label.driver"),itemId:"driver_filter",width:200},{itemId:"search",text:T("button.search")},{itemId:"reset",text:T("button.reset")}],bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",cls:"pagingtoolbar",store:"IncidentViewStore",displayInfo:true,displayMsg:"Displaying incidents {0} - {1} of {2}",emptyMsg:"No incidents to display"}}});Ext.define("GreenFleet.view.common.CodeCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.codecombo",queryMode:"local",displayField:"code",matchFieldWidth:false,typeAhead:true,emptyText:"Alt+Q",group:"V-Maker",initComponent:function(){this.store=Ext.getStore("CodeStore").substore(this.group);this.emptyText=this.fieldLabel;this.callParent()},listConfig:{getInnerTpl:function(){return'<div class="codelist"><span class="code">{code}</span> ({desc})</div>'},minWidth:200}});Ext.define("GreenFleet.view.form.TimeZoneCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.tzcombo",fieldLabel:"Choose TimeZone",store:"TimeZoneStore",queryMode:"local",displayField:"display",valueField:"value"});Ext.define("GreenFleet.view.form.DateTimeField",{extend:"Ext.form.FieldContainer",alias:"widget.datetimex",cls:"hboxLine",layout:{type:"hbox",align:"top"},defaults:{margins:"0 3 0 0"},initComponent:function(){this.items=this.buildItems();this.callParent()},buildItems:function(){var b="valueField";var a=[this.buildValue(b)];if(this.type=="date"){a.push(this.buildDate(b,1))}else{if(this.type=="time"){a.push(this.buildTime(b,1))}else{if(this.type=="datetime"){a.push(this.buildDate(b,3),this.buildTime(b,2))}}}return a},buildValue:function(a){return{xtype:"textfield",hidden:true,name:this.name,itemId:a,value:this.getDefaultValue()}},buildDate:function(c,d){var b=this.getValueDateFormat();var a=this.getValueTimeFormat();return{listeners:{change:function(j,i,e){var h=this.up("fieldcontainer").getComponent(c);var g=this.up("fieldcontainer").getComponent("time"+c);var k="";var f="";if(i){f=Ext.Date.format(i,b)}if(g){k=g.getValue();if(!k){k=""}else{k=Ext.Date.format(k,a)}h.setValue(f+k)}else{h.setValue(f)}}},xtype:"datefield",format:this.getDateFormat(),name:this.name+"_date",value:this.defaultValue,itemId:"date"+c,flex:d}},buildTime:function(c,d){var b=this.getValueDateFormat();var a=this.getValueTimeFormat();return{listeners:{change:function(k,j,f){var i=this.up("fieldcontainer").getComponent(c);var h=this.up("fieldcontainer").getComponent("date"+c);var e="";var g="";if(j){g=Ext.Date.format(j,a)}if(h){e=h.getValue();if(!e){return}e=Ext.Date.format(e,b);i.setValue(e+g)}else{i.setValue(g)}}},xtype:"timefield",format:this.getTimeFormat(),name:this.name+"_time",value:this.defaultValue,itemId:"time"+c,flex:d}},getDefaultValue:function(){var a=this.getDateFormat()+this.getTimeFormat();if(this.defaultValue){if(this.type=="date"){valueFormatthis.getDateFormat()}else{if(this.type=="time"){a=this.getTimeFormat()}}return Ext.Date.format(this.defaultValue,a)}return""},getValueDateFormat:function(){if(this.valueDateFormat){return this.valueDateFormat}return"Ymd"},getValueTimeFormat:function(){if(this.valueTimeFormat){return this.valueTimeFormat}return"Hi"},getDateFormat:function(){if(this.dateFormat){return this.dateFormat}return"Y-m-d"},getTimeFormat:function(){if(this.timeFormat){return this.timeFormat}return"H:i"}});Ext.define("GreenFleet.view.form.SearchField",{extend:"Ext.form.field.ComboBox",alias:"widget.searchfield",queryMode:"local",displayField:"id",matchFieldWidth:false,typeAhead:true,emptyText:"Alt+Q",store:"VehicleBriefStore",initComponent:function(){this.callParent();var a=this;new Ext.util.KeyMap(document,{key:"q",alt:true,fn:this.focus,scope:this});this.store.load()},listConfig:{loadingText:T("msg.searching"),emptyText:T("msg.no_matching_data_found"),getInnerTpl:function(){return'<div class="appSearchItem"><span class="id">{id}</span> <span class="registration_number">{registration_number}</span></div>'},minWidth:190},listeners:{select:function(d,b,c){GreenFleet.doMenu("monitor_map");var a=Ext.getStore("VehicleFilteredStore");a.clearFilter(true);a.filter([{property:"id",value:b[0].get("id")}])}}});Ext.define("GreenFleet.view.common.EntityFormButtons",{extend:"Ext.toolbar.Toolbar",alias:"widget.entity_form_buttons",dock:"bottom",layout:{align:"middle",type:"hbox"},items:[{xtype:"tbfill"},{text:T("button.save"),itemId:"save"},{text:T("button.del"),itemId:"delete"},{text:T("button.reset"),itemId:"reset"}],confirmMsgSave:T("msg.confirm_save"),confirmMsgDelete:T("msg.confirm_delete"),initComponent:function(){this.callParent();var a=this;this.down("#save").on("click",function(){Ext.MessageBox.show({title:T("title.confirmation"),buttons:Ext.MessageBox.YESNO,msg:a.confirmMsgSave,modal:true,fn:function(d){if(d!="yes"){return}var b=a.up("[entityUrl]");var c=b.entityUrl;var e=b.sub("form").getForm();if(e.isValid()){e.submit({url:c+"/save",success:function(f,g){if(a.loader&&typeof(a.loader.fn)==="function"){a.loader.fn.call(a.loader.scope||b,function(i){var h=b.sub("grid").store;f.loadRecord(h.findRecord("key",g.result.key))})}if(g.result.success){GreenFleet.msg(T("label.success"),T("msg.processed_successfully"))}else{Ext.Msg.alert(T("msg.failed_to_save"),g.result.msg)}},failure:function(f,g){Ext.Msg.alert(T("msg.failed_to_save"),g.result.msg)}})}}})});this.down("#delete").on("click",function(){Ext.MessageBox.show({title:T("title.confirmation"),buttons:Ext.MessageBox.YESNO,msg:a.confirmMsgDelete,modal:true,fn:function(d){if(d!="yes"){return}var b=a.up("[entityUrl]");var c=b.entityUrl;var e=b.sub("form").getForm();if(e.isValid()){e.submit({url:c+"/delete",success:function(f,g){if(a.loader&&typeof(a.loader.fn)==="function"){a.loader.fn.call(a.loader.scope||b,null)}f.reset()},failure:function(f,g){Ext.Msg.alert(T("msg.failed_to_delete"),g.result.msg)}})}}})});this.down("#reset").on("click",function(){var b=a.up("[entityUrl]");b.sub("form").getForm().reset()})}});Ext.define("GreenFleet.view.dashboard.VehicleHealth",{extend:"Ext.Container",alias:"widget.dashboard_vehicle_health",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",cls:"pageTitle",height:35,html:"<h1>"+T("title.vehicle_health")+"</h1>"}],initComponent:function(){this.callParent();var b=this.add({xtype:"panel",flex:1,cls:"paddingAll10",layout:{type:"vbox",align:"stretch"}});var d=this.createRow(b);var a=this.createRow(b);var c=Ext.getStore("DashboardVehicleStore");c.load({scope:this,callback:function(f,e,j){var i=this.findRecord(f,"health");var g=this.findRecord(f,"age");var h=this.findRecord(f,"mileage");this.addHealthChartToRow(d,T("title.vehicle_health"),i);this.addChartToRow(d,T("title.running_distance"),h);this.addChartToRow(a,T("title.vehicle_age"),g);a.add(this.buildEmptyChart())}})},addHealthChartToRow:function(d,c,a){var b=Ext.create("Ext.data.JsonStore",{fields:[{name:"name",type:"string",convert:function(f,e){return T("label."+f)}},"value"],data:a.data.summary});d.add(this.buildHealthChart(c,b,"value"))},addChartToRow:function(d,c,a){var b=Ext.create("Ext.data.JsonStore",{fields:["name","value"],data:a.data.summary});d.add(this.buildHealthChart(c,b,"value"))},findRecord:function(a,b){for(var c=0;c<a.length;c++){if(a[c].data.name==b){return a[c]}}return null},createRow:function(a){return a.add({xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"}})},buildEmptyChart:function(){return{xtype:"panel",cls:"paddingPanel healthDashboard",flex:1,height:280}},buildHealthChart:function(c,b,a){return{xtype:"panel",title:c,cls:"paddingPanel healthDashboard",flex:1,height:280,items:[{xtype:"chart",animate:true,store:b,width:440,height:270,shadow:true,legend:{position:"right",labelFont:"10px",boxStroke:"#cfcfcf"},insetPadding:15,theme:"Base:gradients",series:[{type:"pie",field:a,showInLegend:true,donut:false,tips:{trackMouse:true,width:140,height:25,renderer:function(i,h){var g=0;b.each(function(j){g+=j.get(a)});var d=i.get("name");var f=i.get("value");var e=Math.round(f/g*100);this.setTitle(d+" : "+f+"("+e+"%)")}},highlight:{segment:{margin:20}},label:{field:"name",display:"rotate",contrast:true,font:"14px Arial"}}]}]}}});Ext.define("GreenFleet.view.dashboard.ConsumableHealth",{extend:"Ext.Container",alias:"widget.dashboard_consumable_health",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",cls:"pageTitle",height:35,html:"<h1>"+T("title.consumable_health")+"</h1>"}],initComponent:function(){this.callParent();var a=this.add({xtype:"panel",flex:1,cls:"paddingAll10",layout:{type:"vbox",align:"stretch"}});var b=Ext.getStore("DashboardConsumableStore");b.load({scope:this,callback:function(c,d,m){var k=0;var n=null;for(var f=0;f<c.length;f++){var g=c[f];var h=g.data.consumable;if(k==0){n=this.createRow(a);k++}else{if(k==1){k++}else{if(k==2){k=0}}}this.addToRow(n,h,g)}var l=3-k;if(l<3){for(var e=0;e<l;e++){n.add(this.buildEmptyChart())}}}})},addToRow:function(e,c,a){var d=a.data.summary;Ext.Array.each(d,function(f){f.consumable=c;f.desc=T("label."+f.name)});var b=Ext.create("Ext.data.JsonStore",{fields:["consumable","name","desc","value"],autoDestroy:true,data:d});e.add(this.buildHealthChart(c+" "+T("menu.health"),b,"value"))},createRow:function(a){return a.add({xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"}})},buildEmptyChart:function(){return{xtype:"panel",cls:"paddingPanel healthDashboard",flex:1,height:280}},buildHealthChart:function(c,b,a){return{xtype:"panel",title:c,cls:"paddingPanel healthDashboard",flex:1,height:280,items:[{xtype:"chart",animate:true,store:b,width:290,height:150,shadow:true,legend:{position:"right",labelFont:"10px",boxStroke:"#cfcfcf"},insetPadding:15,theme:"Base:gradients",series:[{type:"pie",field:a,showInLegend:true,donut:false,tips:{trackMouse:true,width:140,height:25,renderer:function(i,h){var g=0;b.each(function(j){g+=j.get(a)});var d=i.get("desc");var f=i.get("value");var e=Math.round(f/g*100);this.setTitle(d+" : "+f+"("+e+"%)")}},highlight:{segment:{margin:20}},label:{field:"desc",display:"rotate",contrast:true,font:"14px Arial"},listeners:{itemmousedown:function(e,d){GreenFleet.doMenu("consumable");var f=GreenFleet.getMenu("consumable");f.setConsumable(e.storeItem.data.consumable,e.storeItem.data.name)}}}]}]}}});Ext.define("GreenFleet.view.pm.Consumable",{extend:"Ext.Container",alias:"widget.pm_consumable",title:T("title.consumables"),layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.consumables_management")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.zvehiclelist(a),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.zvehicleinfo,{xtype:"container",flex:1.8,layout:{type:"hbox",align:"stretch"},items:[this.zconsumables,this.zcenter_separator,this.zconsumable_form]},this.zconsumable_history]}]}],this.callParent();this.sub("vehicle_info").on("itemclick",function(d,b){a.sub("form").loadRecord(b);a.sub("consumable_history_grid").store.loadRecords([]);var c=a.sub("consumable_grid").store;c.getProxy().extraParams.vehicle_id=b.data.id;c.load()});this.sub("consumable_grid").on("itemclick",function(c,b){a.sub("consumable_form").loadRecord(b);a.refreshConsumableHistory(b.data.vehicle_id,b.data.consumable_item)});this.sub("consumable_grid").on("itemdblclick",function(c,b){var d=this.up("pm_consumable");d.showConsumableStatus(b)})},setConsumable:function(c,a){var b=this.sub("vehicle_info");b.vehicleList(b,c,a)},refreshConsumableHistory:function(c,b){var a=this.sub("consumable_history_grid").store;a.getProxy().extraParams.vehicle_id=c;a.getProxy().extraParams.consumable_item=b;a.load()},zvehiclelist:function(a){return{xtype:"gridpanel",itemId:"vehicle_info",store:"VehicleByHealthStore",title:T("title.vehicle_list"),width:270,autoScroll:true,vehicleList:function(c,d,b){if(b=="Healthy"){c.sub("check_impending").setValue(false);c.sub("check_overdue").setValue(false);c.sub("check_healthy").setValue(true)}else{if(b=="Impending"){c.sub("check_healthy").setValue(false);c.sub("check_overdue").setValue(false);c.sub("check_impending").setValue(true)}else{if(b=="Overdue"){c.sub("check_healthy").setValue(false);c.sub("check_impending").setValue(false);c.sub("check_overdue").setValue(true)}}}c.sub("consumables_combo").setValue(d)},filterVehicleList:function(f){var g=f.sub("consumables_combo").getValue();var b=f.sub("check_healthy").getValue();var i=f.sub("check_impending").getValue();var e=f.sub("check_overdue").getValue();var h=[];if(b){h.push("Healthy")}if(i){h.push("Impending")}if(e){h.push("Overdue")}if(h.length>0){var c=f.store;var d=c.getProxy();d.extraParams.consumable_item=g;d.extraParams.health_status=h;c.load()}else{f.store.loadRecords([])}},columns:[{xtype:"templatecolumn",tpl:'<div class="iconHealth{health_status}" style="width:20px;height:20px;background-position:5px 3px"></div>',width:35},{dataIndex:"id",text:T("label.id"),flex:1},{dataIndex:"registration_number",text:T("label.reg_no"),flex:1}],tbar:[{xtype:"combo",itemId:"consumables_combo",store:"ConsumableCodeStore",queryMode:"local",displayField:"name",valueField:"name",emptyText:T("msg.select_a_consumable"),listeners:{render:function(b){b.store.load()},change:function(e,d,c){var b=e.up("grid");b.filterVehicleList(b)}}},"   ",{xtype:"fieldcontainer",defaultType:"checkboxfield",cls:"paddingLeft5",items:[{cls:"iconHealthHealthy floatLeft",name:"healthy",inputValue:"1",itemId:"check_healthy",width:40,checked:true,handler:function(b){var c=b.up("grid");c.filterVehicleList(c)}},{cls:"iconHealthImpending floatLeft",name:"impending",inputValue:"1",itemId:"check_impending",width:40,checked:true,handler:function(b){var c=b.up("grid");c.filterVehicleList(c)}},{cls:"iconHealthOverdue floatLeft",name:"overdue",inputValue:"1",itemId:"check_overdue",width:40,checked:true,handler:function(b){var c=b.up("grid");c.filterVehicleList(c)}}]}]}},zvehicleinfo:{xtype:"form",itemId:"form",cls:"hIndexbarZero",bodyCls:"paddingAll10",title:T("title.vehicle_details"),height:90,layout:{type:"hbox",align:"stretch"},items:[{xtype:"panel",flex:1,defaultType:"textfield",items:[{fieldLabel:T("label.id"),name:"id"},{fieldLabel:T("label.health"),name:"health_status"}]},{xtype:"panel",flex:1,defaultType:"textfield",items:[{fieldLabel:T("label.reg_no"),name:"registration_number"},{fieldLabel:T("label.total_x",{x:T("label.dist")}),name:"total_distance",itemId:"vehicle_mileage"}]}]},zconsumables:{xtype:"grid",itemId:"consumable_grid",store:"VehicleConsumableStore",cls:"hIndexbar",title:T("title.consumable_item"),flex:1,columns:[{header:"Key",dataIndex:"key",hidden:true},{header:T("label.item"),dataIndex:"consumable_item"},{header:T("label.health_rate"),dataIndex:"health_rate",xtype:"progresscolumn"},{header:T("label.status"),dataIndex:"status",align:"right",renderer:function(a){if(a){return T("label."+a)}return""}},{xtype:"actioncolumn",width:50,align:"center",items:[{icon:"/resources/image/iconAddOn.png",tooltip:"Consumables replacement",handler:function(d,g,c){var f=d.up("pm_consumable").sub("vehicle_mileage").getValue();var a=d.store.getAt(g);var e=this.up("pm_consumable");var b={data:{vehicle_id:a.data.vehicle_id,consumable_item:a.data.consumable_item,miles_last_repl:f,last_repl_date:new Date()}};e.showConsumableChange(b)}}]},{xtype:"actioncolumn",width:50,align:"center",items:[{icon:"/resources/image/iconRefreshOn.png",tooltip:"Reset",handler:function(c,d,b){var a=c.store.getAt(d);Ext.Ajax.request({url:"/vehicle_consumable/reset",method:"POST",params:{vehicle_id:a.data.vehicle_id,consumable_item:a.data.consumable_item},success:function(f){var g=Ext.JSON.decode(f.responseText);if(g.success){GreenFleet.msg(T("label.success"),g.msg);var e=Ext.getStore("VehicleConsumableStore");e.getProxy().extraParams.vehicle_id=a.data.vehicle_id;e.load()}else{Ext.MessageBox.alert(T("label.failure"),g.msg)}},failure:function(e){Ext.MessageBox.alert(T("label.failure"),e.responseText)}})}}]}]},zconsumable_history:{xtype:"grid",itemId:"consumable_history_grid",store:"ConsumableHistoryStore",cls:"hIndexbar",title:T("title.consumable_change_history"),flex:1,autoScroll:true,columns:[{header:T("label.item"),dataIndex:"consumable_item"},{header:T("label.repl_date"),dataIndex:"last_repl_date",xtype:"datecolumn",format:F("date")},{header:T("label.repl_mileage")+" (km)",dataIndex:"miles_last_repl"},{header:T("label.worker"),dataIndex:"worker"},{header:T("label.component"),dataIndex:"component"},{header:T("label.cost"),dataIndex:"cost"},{header:T("label.comment"),dataIndex:"comment"}],listeners:{itemdblclick:function(d,a,e,f,b,c){d.up("pm_consumable").showConsumableChange(a)}}},zcenter_separator:{xtype:"panel",width:5},zconsumable_form:{xtype:"form",itemId:"consumable_form",cls:"hIndexbarZero",bodyPadding:10,title:T("title.consumable_details"),flex:1,layout:{type:"vbox",align:"stretch"},defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"consumable_item",fieldLabel:T("label.item")},{name:"repl_unit",fieldLabel:T("label.repl_unit")},{name:"repl_mileage",fieldLabel:T("label.repl_mileage")+" (km)"},{name:"repl_time",fieldLabel:T("label.repl_time")+" (month)"},{fieldLabel:T("label.last_repl_date"),name:"last_repl_date",xtype:"datefield",format:F("date")},{fieldLabel:T("label.miles_last_repl")+" (km)",name:"miles_last_repl"},{fieldLabel:T("label.miles_since_last_repl")+" (km)",name:"miles_since_last_repl"},{fieldLabel:T("label.next_repl_date"),name:"next_repl_date",xtype:"datefield",format:F("date")},{fieldLabel:T("label.next_repl_mileage")+" (km)",name:"next_repl_mileage"},{fieldLabel:T("label.accrued_cost"),name:"accrued_cost"},{fieldLabel:T("label.status"),name:"status"}]},showConsumableStatus:function(a){this.consumableStatusWin(a).show()},showConsumableChange:function(a){this.consumableChangeWin(a).show()},consumableStatusWin:function(a){return new Ext.Window({title:a.data.consumable_item+" "+T("label.status"),modal:true,listeners:{show:function(c,b){c.down("form").loadRecord(a)}},items:[{xtype:"form",itemId:"consumable_status_form",bodyPadding:10,cls:"hIndexbar",width:500,defaults:{xtype:"textfield",anchor:"100%"},items:[{xtype:"fieldset",title:T("label.consumable_item"),defaultType:"textfield",layout:"anchor",collapsible:true,padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{name:"vehicle_id",fieldLabel:T("label.vehicle_id"),disabled:true},{name:"consumable_item",fieldLabel:T("label.consumable_item"),disabled:true},{name:"repl_unit",fieldLabel:T("label.repl_unit"),disabled:true},{name:"repl_mileage",fieldLabel:T("label.repl_mileage"),disabled:true},{name:"repl_time",fieldLabel:T("label.repl_time")+"(month)",disabled:true}]},{xtype:"fieldset",title:a.data.consumable_item,defaultType:"textfield",layout:"anchor",padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{name:"last_repl_date",fieldLabel:T("label.last_repl_date"),xtype:"datefield",format:F("date"),value:new Date()},{xtype:"numberfield",name:"miles_last_repl",fieldLabel:T("label.miles_last_repl"),minValue:0,step:1000},{name:"next_repl_date",fieldLabel:T("label.next_repl_date"),xtype:"datefield",format:F("date"),value:new Date()},{xtype:"numberfield",name:"next_repl_mileage",fieldLabel:T("label.next_repl_mileage"),minValue:0,step:1000},{xtype:"numberfield",name:"accrued_cost",fieldLabel:T("label.accrued_cost"),minValue:0,step:1000},{xtype:"numberfield",name:"health_rate",fieldLabel:T("label.health_rate"),minValue:0,step:0.1},{name:"status",xtype:"textfield",fieldLabel:T("label.status")}]}],fbar:[{xtype:"button",text:T("button.save"),handler:function(){var c=this.up("window");var b=c.down("form");b.getForm().submit({url:"/vehicle_consumable/save",submitEmptyText:false,waitMsg:T("msg.saving"),params:{vehicle_id:a.data.vehicle_id,consumable_item:a.data.consumable_item},success:function(e,f){if(f.result.success){GreenFleet.msg(T("label.success"),T("msg.processed_successfully"));c.close();var d=Ext.getStore("VehicleConsumableStore");d.getProxy().extraParams.vehicle_id=a.data.vehicle_id;d.load()}else{Ext.Msg.alert(T("label.failure"),f.result.msg)}},failure:function(d,e){switch(e.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert(T("label.failure"),T("msg.invalid_form_values"));break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert(T("label.failure"),T("msg.failed_to_ajax"));break;case Ext.form.action.Action.SERVER_INVALID:Ext.Msg.alert(T("label.failure"),e.result.msg)}}})}},{xtype:"button",text:T("button.cancel"),handler:function(){this.up("window").close()}}]}]})},consumableChangeWin:function(a){return new Ext.Window({title:a.data.consumable_item+" "+T("label.replacement"),modal:true,listeners:{show:function(c,b){c.down("form").loadRecord(a)}},items:[{xtype:"form",itemId:"consumable_change_form",bodyPadding:10,cls:"hIndexbar",width:500,defaults:{xtype:"textfield",anchor:"100%"},items:[{xtype:"fieldset",title:T("label.consumable_item"),defaultType:"textfield",layout:"anchor",collapsible:true,padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{name:"vehicle_id",fieldLabel:T("label.vehicle_id"),disabled:true},{name:"consumable_item",fieldLabel:T("label.consumable_item"),disabled:true}]},{xtype:"fieldset",title:T("label.replacement"),defaultType:"textfield",layout:"anchor",padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{xtype:"datefield",name:"last_repl_date",fieldLabel:T("label.repl_date"),format:F("date"),maxValue:new Date()},{xtype:"numberfield",name:"miles_last_repl",fieldLabel:T("label.repl_mileage"),minValue:0,step:1000,maxValue:500000},{xtype:"numberfield",name:"cost",fieldLabel:T("label.cost"),minValue:0,step:1000,value:0,allowBlank:false},{name:"worker",fieldLabel:T("label.worker")},{name:"component",fieldLabel:T("label.component")},{xtype:"textarea",rows:8,name:"comment",fieldLabel:T("label.comment")}]}]}],fbar:[{xtype:"button",text:T("button.save"),handler:function(){var c=this.up("window");var b=c.down("form");b.getForm().submit({url:"/vehicle_consumable/replace",submitEmptyText:false,waitMsg:T("msg.saving"),params:{vehicle_id:a.data.vehicle_id,consumable_item:a.data.consumable_item},success:function(e,f){if(f.result.success){GreenFleet.msg(T("label.success"),T("msg.processed_successfully"));c.close();var d=Ext.getStore("VehicleConsumableStore");d.getProxy().extraParams.vehicle_id=a.data.vehicle_id;d.load();d=Ext.getStore("ConsumableHistoryStore");d.getProxy().extraParams.vehicle_id=a.data.vehicle_id;d.getProxy().extraParams.consumable_item=a.data.consumable_item;d.load()}else{Ext.Msg.alert(T("label.failure"),f.result.msg)}},failure:function(d,e){switch(e.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert(T("label.failure"),T("msg.invalid_form_values"));break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert(T("label.failure"),T("msg.failed_to_ajax"));break;case Ext.form.action.Action.SERVER_INVALID:Ext.Msg.alert(T("label.failure"),e.result.msg)}}})}},{xtype:"button",text:T("button.cancel"),handler:function(){this.up("window").close()}}]})}});Ext.define("GreenFleet.view.common.ProgressColumn",{extend:"Ext.grid.column.Column",alias:"widget.progresscolumn",cls:"x-progress-column",progressCls:"x-progress",progressText:"{0} %",constructor:function(c){var d=this,b=Ext.apply({},c),a=d.progressCls;d.callParent([b]);d.renderer=function(e,g){var h,f;f=Math.floor(e*d.getWidth(true));e=Ext.isFunction(b.renderer)?b.renderer.apply(this,arguments)||e:e;h=Ext.String.format(d.progressText,Math.round(e*100));g.tdCls+=" "+a+" "+a+"-"+d.ui;e='<div class="'+a+"-text "+a+'-text-back"><div>'+h+'</div></div><div class="'+a+'-bar" style="width: '+f+'px;"><div class="'+a+'-text"><div>'+h+"</div></div></div>";return e}},destroy:function(){delete this.renderer;return this.callParent(arguments)}});Ext.define("GreenFleet.view.management.VehicleConsumableGrid",{extend:"Ext.container.Container",alias:"widget.management_vehicle_consumable_grid",title:T("title.vehicle_consumable"),initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildGrid(this));this.sub("edit_consumables_grid").on("edit",function(c,d){var b=c.record.data;Ext.Ajax.request({url:"/vehicle_consumable/save",method:"POST",params:{key:b.key,vehicle_id:b.vehicle_id,consumable_item:b.consumable_item,repl_unit:b.repl_unit,repl_mileage:b.repl_mileage,repl_time:b.repl_time,last_repl_date:b.last_repl_date,miles_last_repl:b.miles_last_repl,next_repl_mileage:b.next_repl_mileage,next_repl_date:b.next_repl_date,mode:"updateMaster"},success:function(e){var f=Ext.JSON.decode(e.responseText);if(f.success){GreenFleet.msg(T("label.success"),f.key)}else{Ext.MessageBox.alert(T("label.failure"),f.msg)}},failure:function(e){Ext.MessageBox.alert(T("label.failure"),e.responseText)}})})},buildGrid:function(a){var b=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,autoCancel:false});var c=Ext.create("Ext.grid.Panel",{itemId:"edit_consumables_grid",title:T("title.vehicle_consumables"),frame:true,store:"VehicleConsumableStore",plugins:[b],vehicleId:"",columns:[{header:"Key",dataIndex:"key",hidden:true},{header:"Vehicle",dataIndex:"vehicle_id",hidden:true},{header:T("label.consumable_item"),dataIndex:"consumable_item"},{header:T("label.repl_unit"),dataIndex:"repl_unit",width:100,editor:{xtype:"codecombo",allowBlank:false,name:"repl_unit",group:"ReplacementUnit"}},{xtype:"numbercolumn",header:T("label.repl_mileage")+" (km)",dataIndex:"repl_mileage",width:105,editor:{xtype:"numberfield",allowBlank:false,minValue:0,maxValue:500000}},{xtype:"numbercolumn",header:T("label.repl_time")+" (month)",dataIndex:"repl_time",width:105,editor:{xtype:"numberfield",allowBlank:false,minValue:0,maxValue:120}},{header:T("label.last_repl_date"),dataIndex:"last_repl_date",width:100,xtype:"datecolumn",format:F("date")},{xtype:"numbercolumn",header:T("label.miles_last_repl")+" (km)",dataIndex:"miles_last_repl",width:125},{header:T("label.next_repl_mileage")+" (km)",dataIndex:"next_repl_mileage",width:130},{header:T("label.next_repl_date"),dataIndex:"next_repl_date",width:90,xtype:"datecolumn",format:F("date")},{header:T("label.accrued_cost"),dataIndex:"accrued_cost",width:90},{header:T("label.health_rate"),dataIndex:"health_rate",xtype:"progresscolumn",width:120},{header:T("label.status"),dataIndex:"status",width:80}]});return c}});Ext.define("GreenFleet.view.form.RepairForm",{extend:"Ext.form.Panel",alias:"widget.repair_form",autoScroll:true,layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;this.callParent()},setVehicleId:function(a){this.sub("vehicle_id").setValue(a)},items:[{xtype:"fieldset",title:"Vehicle",defaultType:"textfield",layout:"anchor",collapsible:true,padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{itemId:"vehicle_id",name:"vehicle_id",fieldLabel:T("label.vehicle_id")}]},{xtype:"fieldset",title:"Repair",defaultType:"textfield",layout:"anchor",padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{name:"repair_date",fieldLabel:T("label.repair_date"),xtype:"datefield",format:F("date"),value:new Date()},{xtype:"numberfield",name:"repair_mileage",fieldLabel:T("label.repair_mileage")+" (km)"},{name:"repair_man",fieldLabel:T("label.repair_man")},{name:"repair_shop",fieldLabel:T("label.repair_shop")},{xtype:"numberfield",name:"cost",fieldLabel:T("label.cost"),minValue:0},{xtype:"textarea",name:"content",fieldLabel:T("label.content")},{name:"comment",xtype:"textarea",fieldLabel:T("label.comment")}]}],buttons:[{text:T("button.save"),handler:function(){var a=this.up("form");a.getForm().submit({url:"/repair/save",submitEmptyText:false,waitMsg:T("msg.saving"),success:function(b,c){if(c.result.success){GreenFleet.msg(T("label.success"),T("msg.processed_successfully"))}else{Ext.Msg.alert(T("label.failure"),c.result.msg)}},failure:function(b,c){switch(c.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert(T("label.failure"),T("msg.invalid_form_values"));break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert(T("label.failure"),T("msg.failed_to_ajax"));break;case Ext.form.action.Action.SERVER_INVALID:Ext.Msg.alert(T("label.failure"),c.result.msg)}}})}},{text:T("button.cancel"),handler:function(){}}]});Ext.define("GreenFleet.view.management.Location",{extend:"Ext.container.Container",alias:"widget.management_location",title:T("titla.location"),entityUrl:"location",importUrl:"location/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.location_list")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.buildList(this),{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},items:[this.buildForm(this),this.zmap]}]}];this.callParent(arguments);this.sub("map").on("afterrender",function(c){a.setGeocoder(new google.maps.Geocoder());var b=new google.maps.LatLng(System.props.lattitude,System.props.longitude);var d={zoom:10,minZoom:3,maxZoom:19,center:b,mapTypeId:google.maps.MapTypeId.ROADMAP};a.setMap(new google.maps.Map(c.getEl().down(".map").dom,d))});this.on("activate",function(){google.maps.event.trigger(a.getMap(),"resize");a.markCenter()});this.sub("grid").on("itemclick",function(c,b){a.sub("form").loadRecord(b);a.refreshMap(new google.maps.LatLng(b.data.lat,b.data.lng),b.data.rad)});this.sub("name_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("name_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").store.load()})},getGeocoder:function(){return this.geocoder},setGeocoder:function(a){this.geocoder=a},getMap:function(){return this.map},setMap:function(a){this.map=a},getMarker:function(){return this.marker},setMarker:function(a){if(this.marker){this.marker.setMap(null)}this.marker=a},getCircle:function(){return this.circle},setCircle:function(a){if(this.circle){this.circle.setMap(null)}this.circle=a},markCenter:function(){this.setMarker(this.createMarker(this.map.getCenter()))},refreshMap:function(b,a){if(!b){return}this.map.setCenter(b);this.setMarker(null);this.setMarker(this.createMarker(b));if(!a){a=this.sub("form_radius").getValue()}this.refreshCircle(a)},refreshLocation:function(b,a){this.refreshMap(b,a);this.sub("form_lattitude").setValue(b.lat());this.sub("form_longitude").setValue(b.lng())},refreshLocByAddr:function(a){var b=this;this.geocoder.geocode({address:a},function(e,d){if(d==google.maps.GeocoderStatus.OK){var c=e[0].geometry.location;b.refreshLocation(c)}else{b.setMarker(null);Ext.Msg.alert("Failed to search!","Address ("+a+") Not Found!")}})},moveMarker:function(b){var c=this;var a=b.getPosition();this.geocoder.geocode({latLng:a},function(e,d){if(d==google.maps.GeocoderStatus.OK){c.refreshLocation(a);c.sub("form_address").setValue(e[0].formatted_address)}else{c.map.setCenter(a);Ext.Msg.alert("Failed to search!","Couldn't find address by position ["+a.lat()+", "+a.lng()+"]!")}})},refreshCircle:function(a){if(!this.marker){return}if(!a){a=this.sub("form_radius").getValue()}this.setCircle(null);if(a){var e=this.map;var b=this.marker;this.setCircle(this.createCircle(b.getPosition(),a));var c=this.circle.getBounds();var f=c.getNorthEast();var d=c.getSouthWest();this.sub("form_radius").setValue(a);this.sub("form_lat_hi").setValue(f.lat());this.sub("form_lng_hi").setValue(f.lng());this.sub("form_lat_lo").setValue(d.lat());this.sub("form_lng_lo").setValue(d.lng())}},createMarker:function(a){var c=this;var b=new google.maps.Marker({position:a,map:c.map,draggable:true});if(this.marker&&this.marker.dragend_listener){google.maps.event.removeListener(this.marker.dragend_listener)}b.dragend_listener=google.maps.event.addListener(b,"dragend",function(){c.moveMarker(b)});return b},createCircle:function(b,a){if(!b){return}if(!a){a=this.sub("form_radius").getValue()}var c=this;var d=new google.maps.Circle({map:this.map,center:b,radius:a,strokeColor:"red",editable:true});if(this.circle&&this.circle.radius_change_listener){google.maps.event.removeListener(this.circle.radius_change_listener)}d.radius_change_listener=google.maps.event.addListener(d,"radius_changed",function(){c.radiusChanged(d.getRadius())});return d},radiusChanged:function(a){if(this.marker){this.refreshCircle(a)}},search:function(){this.sub("grid").store.clearFilter();this.sub("grid").store.filter([{property:"name",value:this.sub("name_filter").getValue()}])},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"LocationStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"name",text:T("label.name"),type:"string"},{dataIndex:"addr",text:T("label.address"),type:"string"},{dataIndex:"lat",text:T("label.lattitude"),type:"float"},{dataIndex:"lng",text:T("label.longitude"),type:"float"},{dataIndex:"rad",text:T("label.radius")+" (m)",type:"int"},{dataIndex:"lat_lo",text:T("label.lattitude_min"),type:"float"},{dataIndex:"lng_lo",text:T("label.longitude_min"),type:"float"},{dataIndex:"lat_hi",text:T("label.lattitude_max"),type:"float"},{dataIndex:"lng_hi",text:T("label.longitude_max"),type:"float"},{dataIndex:"expl",text:T("label.desc"),type:"string"},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],viewConfig:{},tbar:[T("label.location"),{xtype:"textfield",name:"name_filter",itemId:"name_filter",hideLabel:true,width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}],bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:"LocationStore",cls:"pagingtoolbar",displayInfo:true,displayMsg:"Displaying locations {0} - {1} of {2}",emptyMsg:"No locations to display"}}},buildForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.location_details"),autoScroll:true,height:395,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"name",fieldLabel:T("label.name")},{xtype:"fieldcontainer",fieldLabel:T("label.address"),layout:"hbox",defaults:{hideLabel:true},items:[{itemId:"form_address",xtype:"textfield",name:"addr",fieldLabel:T("label.address"),flex:1},{xtype:"button",text:T("button.search"),margin:"0 0 0 5",handler:function(d,e){var c=d.up("management_location");var b=d.up("fieldcontainer").down("textfield").getValue();c.refreshLocByAddr(b)}}]},{itemId:"form_lattitude",name:"lat",xtype:"textfield",fieldLabel:T("label.lattitude")},{itemId:"form_longitude",name:"lng",xtype:"textfield",fieldLabel:T("label.longitude")},{itemId:"form_radius",name:"rad",xtype:"numberfield",fieldLabel:T("label.radius")+" (m)",minValue:0,step:100,listeners:{change:function(e,d,b,c){e.up("management_location").radiusChanged(d)}}},{name:"expl",fieldLabel:T("label.desc")},{itemId:"form_lat_lo",name:"lat_lo",fieldLabel:T("label.lattitude_min")},{itemId:"form_lng_lo",name:"lng_lo",fieldLabel:T("label.longitude_min")},{itemId:"form_lat_hi",name:"lat_hi",fieldLabel:T("label.lattitude_max")},{itemId:"form_lng_hi",name:"lng_hi",fieldLabel:T("label.longitude_max")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}},zmap:{xtype:"panel",title:T("title.set_the_location"),cls:"paddingPanel backgroundGray borderLeftGray",itemId:"map",flex:1,html:'<div class="map"></div>'}});Ext.define("GreenFleet.view.management.Alarm",{extend:"Ext.panel.Panel",alias:"widget.management_alarm",title:T("titla.alarm"),entityUrl:"alarm",importUrl:"alarm/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.alarm_list")+"</div>"},initComponent:function(){var a=this;this.callParent(arguments);this.add(this.buildList(this));this.add(this.buildForm(this));this.sub("grid").on("itemclick",function(c,b){var d=b.data.name;Ext.Ajax.request({url:"/alarm/find",method:"GET",params:{name:d},success:function(e){var f=Ext.JSON.decode(e.responseText);if(f.success){b.data.vehicles=f.vehicles;a.sub("form").loadRecord(b)}else{Ext.MessageBox.alert(T("label.failure"),e.responseText)}},failure:function(e){Ext.MessageBox.alert(T("label.failure"),e.responseText)}})});this.sub("grid").on("render",function(b){a.sub("form_location").store.load()});this.sub("name_filter").on("change",function(c,b){a.search()});this.down("#search_reset").on("click",function(){a.sub("name_filter").setValue("")});this.down("#search").on("click",function(){a.sub("grid").store.load()})},search:function(){this.sub("grid").store.clearFilter();this.sub("grid").store.filter([{property:"name",value:this.sub("name_filter").getValue()}])},buildList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"AlarmStore",autoScroll:true,flex:1,columns:[new Ext.grid.RowNumberer(),{dataIndex:"name",text:T("label.name"),type:"string"},{dataIndex:"evt_type",text:T("label.event_type"),type:"string"},{dataIndex:"evt_name",text:T("label.event_name"),type:"string"},{dataIndex:"evt_trg",text:T("label.event_trigger"),type:"string"},{dataIndex:"type",text:T("label.type"),type:"string"},{dataIndex:"always",text:T("label.period_always"),type:"boolean"},{dataIndex:"enabled",text:T("label.enabled"),type:"boolean"},{dataIndex:"from_date",text:T("label.from_date"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"to_date",text:T("label.to_date"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"created_at",text:T("label.created_at"),xtype:"datecolumn",format:F("datetime"),width:120},{dataIndex:"updated_at",text:T("label.updated_at"),xtype:"datecolumn",format:F("datetime"),width:120}],tbar:[T("label.name"),{xtype:"textfield",name:"name_filter",itemId:"name_filter",hideLabel:true,width:200},{text:T("button.search"),itemId:"search"},{text:T("button.reset"),itemId:"search_reset"}],bbar:{xtype:"pagingtoolbar",itemId:"pagingtoolbar",store:"AlarmStore",cls:"pagingtoolbar",displayInfo:true,displayMsg:"Displaying alarms {0} - {1} of {2}",emptyMsg:"No alarms to display"}}},buildForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.alarm_details"),autoScroll:true,flex:1,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"name",fieldLabel:T("label.name"),allowBlank:false},{xtype:"codecombo",name:"evt_type",group:"AlarmEventType",fieldLabel:T("label.event_type"),allowBank:false,listeners:{change:function(d,c,b){d.up("form").down("fieldset").setVisible(c=="location")}}},{name:"enabled",fieldLabel:T("label.enabled"),xtype:"checkboxfield",flex:1,checked:true,},{xtype:"fieldset",title:T("label.location"),hidden:true,layout:"anchor",defaults:{anchor:"100%"},items:[{itemId:"form_location",name:"evt_name",fieldLabel:T("label.location"),xtype:"combo",queryMode:"local",store:"LocationStore",displayField:"name",valueField:"name",allowBlank:false},{itemId:"form_vehicles",name:"vehicles",xtype:"textfield",fieldLabel:T("label.vehicle"),allowBlank:false},{xtype:"codecombo",name:"evt_trg",group:"LocationEvent",fieldLabel:T("label.event_trigger"),allowBlank:false}]},{name:"dest",fieldLabel:T("label.destination"),emptyText:T("msg.select_users"),allowBlank:false},{xtype:"codecombo",name:"type",group:"AlarmType",fieldLabel:T("label.type"),allowBlank:false},{xtype:"container",layout:"hbox",items:[{name:"always",fieldLabel:T("label.period_always"),xtype:"checkboxfield",flex:1,checked:true,handler:function(f,e){var c=f.up("management_alarm");var b=c.sub("form_from_date");var d=c.sub("form_to_date");b.setVisible(!e);d.setVisible(!e)}},{itemId:"form_from_date",name:"from_date",fieldLabel:T("label.from_date"),xtype:"datefield",format:F("date"),margin:"0 30 0 0",flex:1,hidden:true},{itemId:"form_to_date",name:"to_date",fieldLabel:T("label.to_date"),xtype:"datefield",format:F("date"),flex:1,hidden:true}]},{xtype:"textarea",name:"msg",fieldLabel:T("label.message"),height:100,allowBlank:false},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.created_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}},zmap:{xtype:"panel",title:T("title.set_the_location"),cls:"paddingPanel backgroundGray borderLeftGray",itemId:"map",flex:1,html:'<div class="map"></div>'}});Ext.define("GreenFleet.view.management.VehicleRunStatus",{extend:"Ext.Container",alias:"widget.management_vehicle_runstatus",title:T("title.vehicle_runstatus"),entityUrl:"vehicle_run",importUrl:"vehicle_run/import",afterImport:function(){},layout:{align:"stretch",type:"vbox"},chartPanel:null,initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.vehicle_runstatus")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.zvehiclelist(a),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.zrunstatus,this.zrunstatus_chart]}]}],this.callParent();this.sub("vehicle_list").on("itemclick",function(e,b){var c=a.sub("runstatus_grid").store;var d=c.getProxy();d.extraParams.select=["vehicle","month","month_str","run_dist","run_time","consmpt","co2_emss","effcc","oos_cnt","mnt_cnt","mnt_time"];d.extraParams.vehicle=b.data.id;d.extraParams.from_year=a.sub("from_year").getValue();d.extraParams.to_year=a.sub("to_year").getValue();d.extraParams.from_month=a.sub("from_month").getValue();d.extraParams.to_month=a.sub("to_month").getValue();c.load({scope:a,callback:function(){a.refreshChart()}})});this.sub("chart_panel").on("resize",function(b,e,d,c){if(a.chartPanel){a.resizeChart()}});this.sub("id_filter").on("change",function(c,b){a.searchVehicles(false)});this.sub("reg_no_filter").on("change",function(c,b){a.searchVehicles(false)});this.sub("combo_chart_type").setValue("column");this.sub("combo_chart").setValue("run_dist");this.sub("combo_view").setValue("monthly_view")},searchVehicles:function(b){if(b){this.sub("vehicle_list").store.load()}else{this.sub("vehicle_list").store.clearFilter(true);var a=this.sub("id_filter").getValue();var c=this.sub("reg_no_filter").getValue();if(a||c){this.sub("vehicle_list").store.filter([{property:"id",value:a},{property:"registration_number",value:c}])}}},zvehiclelist:function(a){return{xtype:"gridpanel",itemId:"vehicle_list",store:"VehicleBriefStore",title:T("title.vehicle_list"),width:280,autoScroll:true,columns:[{dataIndex:"id",text:T("label.id"),flex:1},{dataIndex:"registration_number",text:T("label.reg_no"),flex:1}],tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",width:60},T("label.reg_no"),{xtype:"textfield",name:"reg_no_filter",itemId:"reg_no_filter",width:65}," ",{xtype:"button",text:T("button.search"),handler:function(b){b.up("management_vehicle_runstatus").searchVehicles(true)}}]}},zrunstatus:{xtype:"panel",cls:"hIndexbar",title:T("title.runstatus_history"),flex:1,autoScroll:true,items:[{xtype:"grid",itemId:"runstatus_grid",store:"VehicleRunStore",flex:1,columns:[{text:T("label.month"),dataIndex:"month_str"},{header:T("label.run_dist")+" (km)",dataIndex:"run_dist"},{header:T("label.run_time")+" (min)",dataIndex:"run_time"},{header:T("label.fuel_consumption")+" (l)",dataIndex:"consmpt"},{header:T("label.co2_emissions")+" (g/km)",dataIndex:"co2_emss"},{header:T("label.fuel_efficiency")+" (km/l)",dataIndex:"effcc"},{header:T("label.outofservice_count"),dataIndex:"oos_cnt"},{header:T("label.maintenance_count"),dataIndex:"mnt_cnt"},{header:T("label.maintenance_time")+" (min)",dataIndex:"mnt_time"}]}],tbar:[T("label.view")+" : ",{xtype:"combo",itemId:"combo_view",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"monthly_view",desc:T("label.monthly_view")},{name:"yearly_view",desc:T("label.yearly_view")}]}),listeners:{change:function(c,b,a){}}},T("label.chart_type")+" : ",{xtype:"combo",itemId:"combo_chart_type",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"column",desc:T("label.column")},{name:"line",desc:T("label.line")}]}),listeners:{change:function(c,b,a){var d=c.up("management_vehicle_runstatus");d.refreshChart()}}},T("label.period")+" : ",{xtype:"combo",name:"from_year",itemId:"from_year",displayField:"year",valueField:"year",value:new Date().getFullYear()-1,store:"YearStore",width:60},{xtype:"combo",name:"from_month",itemId:"from_month",displayField:"month",valueField:"month",value:new Date().getMonth()+2,store:"MonthStore",width:40}," ~ ",{xtype:"combo",name:"to_year",itemId:"to_year",displayField:"year",valueField:"year",value:new Date().getFullYear(),store:"YearStore",width:60},{xtype:"combo",name:"to_month",itemId:"to_month",displayField:"month",valueField:"month",value:new Date().getMonth()+1,store:"MonthStore",width:40},T("label.chart")+" : ",{xtype:"combo",itemId:"combo_chart",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc","unit"],data:[{name:"run_dist",desc:T("label.run_dist"),unit:"(km)"},{name:"run_time",desc:T("label.run_time"),unit:"(min)"},{name:"rate_of_oper",desc:T("label.rate_of_oper"),unit:"(%)"},{name:"consmpt",desc:T("label.fuel_consumption"),unit:"(l)"},{name:"co2_emss",desc:T("label.co2_emissions"),unit:"(g/km)"},{name:"effcc",desc:T("label.fuel_efficiency"),unit:"(km/l)"},{name:"oos_cnt",desc:T("label.outofservice_count"),unit:""},{name:"mnt_cnt",desc:T("label.maintenance_count"),unit:""},{name:"mnt_time",desc:T("label.maintenance_time"),unit:""}]}),listeners:{change:function(c,b,a){var d=c.up("management_vehicle_runstatus");if(b!="driving_habit"){d.refreshChart()}else{d.refreshRadarChart()}}}}]},zrunstatus_chart:{xtype:"panel",itemId:"chart_panel",cls:"hIndexbar",title:T("title.runstatus_chart"),flex:1,autoScroll:true},refreshChart:function(){var c=this.sub("chart_panel");var a=null;var p=null;try{a=c.getWidth();p=c.getHeight()}catch(f){return}var k=this.sub("combo_chart_type").getValue();var j=this.sub("combo_chart");var l=j.getValue();var n=this.sub("runstatus_grid").store;var o=j.store.data;var h="";var m="";for(var b=0;b<o.length;b++){var d=o.items[b].data;if(l==d.name){h=d.desc;m=d.unit;break}}if(l=="rate_of_oper"){this.setRateOfOper(n)}var g=this.buildChart(k,n,l,h,m,0,a,p);c.removeAll();c.add(g);this.chartPanel=g},setRateOfOper:function(a){a.each(function(b){var d=b.get("month_str");var c=b.get("run_time");var e=c?((c*100)/(30*24*60)):0;e=Ext.util.Format.number(e,"0.00");b.data.rate_of_oper=e})},refreshRadarChart:function(){var c=this.sub("runstatus_grid").store;var b=this.sub("chart_panel");var e=b.getWidth();var a=b.getHeight();b.removeAll();var d=this.buildRadar(c,e,a);b.add(d);this.chartPanel=d},resizeChart:function(e,b){var a=this.sub("chart_panel");if(!e){e=a.getWidth()}if(!b){b=a.getHeight()}var c=a.down("panel");c.setWidth(e-25);c.setHeight(b-45);var d=c.down("chart");d.setWidth(e-25);d.setHeight(b-50)},buildRadar:function(b,c,a){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,insetPadding:20,legend:{position:"right"},axes:[{type:"Radial",position:"radial",label:{display:true}}],series:[{showInLegend:true,type:"radar",xField:"month_str",yField:"run_dist",style:{opacity:0.4}},{showInLegend:true,type:"radar",xField:"month_str",yField:"run_time",style:{opacity:0.4}},{showInLegend:true,type:"radar",xField:"month_str",yField:"consmpt",style:{opacity:0.4}},{showInLegend:true,type:"radar",xField:"month_str",yField:"co2_emss",style:{opacity:0.4}},{showInLegend:true,type:"radar",xField:"month_str",yField:"effcc",style:{opacity:0.4}}]}]}},buildChart:function(e,b,d,g,f,h,c,a){return{xtype:"panel",autoscroll:true,cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,shadow:true,insetPadding:5,theme:"Base:gradients",axes:[{type:"Numeric",position:"left",fields:[d],label:{renderer:Ext.util.Format.numberRenderer("0,0")},title:g,minimum:h},{type:"Category",position:"bottom",fields:["month_str"],title:T("label.month")}],series:[{type:e,axis:"left",xField:"month_str",yField:d,showInLegend:true,tips:{trackMouse:true,width:140,height:25,renderer:function(j,i){this.setTitle(j.get("month_str")+" : "+j.get(d)+f)}},highlight:{segment:{margin:20}},label:{field:d,display:"insideEnd",contrast:true,color:"#333",font:"14px Arial",}}]}]}}});Ext.define("GreenFleet.view.management.DriverRunStatus",{extend:"Ext.Container",alias:"widget.management_driver_runstatus",title:T("title.driver_runstatus"),entityUrl:"driver_run",importUrl:"driver_run/import",afterImport:function(){},layout:{align:"stretch",type:"vbox"},chartPanel:null,initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.driver_runstatus")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.zvehiclelist(a),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.zrunstatus,this.zrunstatus_chart]}]}],this.callParent();this.sub("driver_list").on("itemclick",function(e,b){var c=a.sub("runstatus_grid").store;var d=c.getProxy();d.extraParams.driver=b.data.id;d.extraParams.from_year=a.sub("from_year").getValue();d.extraParams.to_year=a.sub("to_year").getValue();d.extraParams.from_month=a.sub("from_month").getValue();d.extraParams.to_month=a.sub("to_month").getValue();d.extraParams.select=["driver","year","month","month_str","run_dist","run_time","consmpt","co2_emss","effcc","sud_accel_cnt","sud_brake_cnt","eco_drv_time","ovr_spd_time","inc_cnt"];c.load({scope:a,callback:function(){a.setGridTitle(b.get("name"));a.refreshChart()}})});this.sub("chart_panel").on("resize",function(b,e,d,c){if(a.chartPanel){a.resizeChart()}});this.sub("id_filter").on("change",function(c,b){a.searchDrivers(false)});this.sub("name_filter").on("change",function(c,b){a.searchDrivers(false)});this.sub("combo_chart_type").setValue("column");this.sub("combo_chart").setValue("run_dist");this.sub("combo_view").setValue("monthly_view")},setGridTitle:function(a){var b=a?T("title.runstatus_history")+" ("+a+") ":T("title.runstatus_history");this.sub("runstatus_panel").setTitle(b)},searchDrivers:function(c){if(c){this.sub("driver_list").store.load()}else{this.sub("driver_list").store.clearFilter(true);var b=this.sub("id_filter").getValue();var a=this.sub("name_filter").getValue();if(b||a){this.sub("driver_list").store.filter([{property:"id",value:b},{property:"name",value:a}])}}},zvehiclelist:function(a){return{xtype:"gridpanel",itemId:"driver_list",store:"DriverStore",title:T("title.driver_list"),width:260,autoScroll:true,columns:[{dataIndex:"id",text:T("label.id"),flex:1},{dataIndex:"name",text:T("label.name"),flex:1}],tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",width:60},T("label.name"),{xtype:"textfield",name:"name_filter",itemId:"name_filter",width:65}," ",{xtype:"button",text:T("button.search"),handler:function(b){b.up("management_driver_runstatus").searchDrivers(true)}}]}},zrunstatus:{xtype:"panel",itemId:"runstatus_panel",cls:"hIndexbar",title:T("title.runstatus_history"),flex:1,autoScroll:true,items:[{xtype:"grid",itemId:"runstatus_grid",store:"DriverRunStore",columns:[{dataIndex:"month_str",text:T("label.datetime"),xtype:"datecolumn",format:F("date")},{header:T("label.run_dist")+" (km)",dataIndex:"run_dist"},{header:T("label.run_time")+" (min)",dataIndex:"run_time"},{header:T("label.fuel_consumption")+" (l)",dataIndex:"consmpt"},{header:T("label.co2_emissions")+" (g/km)",dataIndex:"co2_emss"},{header:T("label.fuel_efficiency")+" (km/l)",dataIndex:"effcc"},{header:T("label.x_count",{x:T("label.sudden_accel")}),dataIndex:"sud_accel_cnt"},{header:T("label.x_count",{x:T("label.sudden_brake")}),dataIndex:"sud_brake_cnt"},{header:T("label.x_time",{x:T("label.eco_driving")})+" (min)",dataIndex:"eco_drv_time"},{header:T("label.x_time",{x:T("label.over_speeding")})+" (min)",dataIndex:"ovr_spd_time"},{header:T("label.x_count",{x:T("label.incident")}),dataIndex:"inc_cnt"}]}],tbar:[T("label.view")+" : ",{xtype:"combo",itemId:"combo_view",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"monthly_view",desc:T("label.monthly_view")},{name:"yearly_view",desc:T("label.yearly_view")}]}),listeners:{change:function(c,b,a){}}},T("label.chart_type")+" : ",{xtype:"combo",itemId:"combo_chart_type",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"column",desc:T("label.column")},{name:"line",desc:T("label.line")}]}),listeners:{change:function(c,b,a){var d=c.up("management_driver_runstatus");d.refreshChart()}}},T("label.period")+" : ",{xtype:"combo",name:"from_year",itemId:"from_year",displayField:"year",valueField:"year",value:new Date().getFullYear()-1,store:"YearStore",width:60},{xtype:"combo",name:"from_month",itemId:"from_month",displayField:"month",valueField:"month",value:new Date().getMonth()+2,store:"MonthStore",width:40}," ~ ",{xtype:"combo",name:"to_year",itemId:"to_year",displayField:"year",valueField:"year",value:new Date().getFullYear(),store:"YearStore",width:60},{xtype:"combo",name:"to_month",itemId:"to_month",displayField:"month",valueField:"month",value:new Date().getMonth()+1,store:"MonthStore",width:40},T("label.chart")+" : ",{xtype:"combo",itemId:"combo_chart",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc","unit"],data:[{name:"run_dist",desc:T("label.run_dist"),unit:"(km)"},{name:"run_time",desc:T("label.run_time"),unit:"(min)"},{name:"consmpt",desc:T("label.fuel_consumption"),unit:"(l)"},{name:"co2_emss",desc:T("label.co2_emissions"),unit:"(g/km)"},{name:"effcc",desc:T("label.fuel_efficiency"),unit:"(km/l)"},{name:"sud_accel_cnt",desc:T("label.x_count",{x:T("label.sudden_accel")}),unit:""},{name:"sud_brake_cnt",desc:T("label.x_count",{x:T("label.sudden_brake")}),unit:""},{name:"eco_drv_time",desc:T("label.x_time",{x:T("label.eco_driving")}),unit:"(min)"},{name:"ovr_spd_time",desc:T("label.x_time",{x:T("label.over_speeding")}),unit:"(min)"},{name:"inc_cnt",desc:T("label.x_count",{x:T("label.incident")}),unit:""},{name:"driving_habit",desc:T("label.driving_habit"),unit:""}]}),listeners:{change:function(c,b,a){c.up("management_driver_runstatus").refreshChart()}}}]},zrunstatus_chart:{xtype:"panel",itemId:"chart_panel",cls:"hIndexbar",title:T("title.runstatus_chart"),flex:1,autoScroll:true,layout:{align:"stretch",type:"hbox"}},resizeChart:function(e,b){var a=this.sub("chart_panel");if(!e){e=a.getWidth()}if(!b){b=a.getHeight()}var c=a.down("panel");c.setWidth(e-25);c.setHeight(b-45);var d=c.down("chart");d.setWidth(e-25);d.setHeight(b-50)},refreshChart:function(){var a=this.sub("combo_chart").getValue();if(a=="driving_habit"){this.refreshRadarChart()}else{this.refreshColumnChart()}},refreshColumnChart:function(){var c=this.sub("chart_panel");var a=null;var p=null;try{a=c.getWidth();p=c.getHeight()}catch(f){return}var k=this.sub("combo_chart_type").getValue();var j=this.sub("combo_chart");var l=j.getValue();var n=this.sub("runstatus_grid").store;var o=j.store.data;var h="";var m="";for(var b=0;b<o.length;b++){var d=o.items[b].data;if(l==d.name){h=d.desc;m=d.unit;break}}var g=this.buildChart(k,n,l,h,m,0,a,p);c.removeAll();c.add(g);this.chartPanel=g},refreshRadarChart:function(){var k=this.sub("runstatus_grid").store;var i=0;var h=0;var e=0;var b=0;var l=0;var g=0;k.each(function(p){if(p.get("driver")){i+=1}if(p.get("eco_drv_time")){h+=p.get("eco_drv_time")}if(p.get("effcc")){e+=p.get("effcc")}if(p.get("ovr_spd_time")){b+=p.get("ovr_spd_time")}if(p.get("sud_accel_cnt")){l+=p.get("sud_accel_cnt")}if(p.get("sud_brake_cnt")){g+=p.get("sud_brake_cnt")}});h=h/i;e=e/i;b=b/i;l=l/i;g=g/i;var j=[{name:T("label.x_time",{x:T("label.eco_driving")}),value:h},{name:T("label.fuel_efficiency"),value:e},{name:T("label.x_time",{x:T("label.over_speeding")}),value:b},{name:T("label.x_count",{x:T("label.sudden_accel")}),value:l},{name:T("label.x_count",{x:T("label.sudden_brake")}),value:g},];var o=Ext.create("Ext.data.JsonStore",{fields:["name","value"],autoDestroy:true,data:j});var n=Ext.create("Ext.data.JsonStore",{fields:["name","value"],autoDestroy:true,data:[{name:T("label.eco_drv_index"),value:3}]});var f=this.sub("chart_panel");var a=f.getWidth();var m=f.getHeight();f.removeAll();var d=this.buildRadar(o,a,m);var c=this.buildGuageChart(n,a,m);f.add(d);f.add(c);this.chartPanel=d},buildChart:function(e,b,d,g,f,h,c,a){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,shadow:true,insetPadding:5,theme:"Base:gradients",axes:[{type:"Numeric",position:"left",fields:[d],label:{renderer:Ext.util.Format.numberRenderer("0,0")},title:g,minimum:h},{type:"Category",position:"bottom",fields:["month_str"],title:T("label.month")}],series:[{type:e,axis:"left",xField:"month_str",yField:d,showInLegend:true,tips:{trackMouse:true,width:140,height:25,renderer:function(j,i){this.setTitle(j.get("month_str")+" : "+j.get(d)+f)}},highlight:{segment:{margin:20}},label:{field:d,display:"insideEnd",contrast:true,color:"#333",font:"14px Arial",}}]}]}},buildRadar:function(b,c,a){c=c/2;return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,insetPadding:20,legend:{position:"bottom"},axes:[{type:"Radial",position:"radial",label:{display:true}}],series:[{showInLegend:false,showMarkers:true,type:"radar",xField:"name",yField:"value",style:{opacity:0.4},markerConfig:{radius:3,size:5},tips:{trackMouse:true,width:140,height:25,renderer:function(d){return this.setTitle(d.data.name+":"+Ext.util.Format.number(d.data.value,"0.00"))}},}]}]}},buildGuageChart:function(b,c,a){c=c/2;return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,insetPadding:20,legend:{position:"bottom"},axes:[{type:"gauge",position:"gauge",minimum:0,maximum:5,steps:5,margin:-5,label:{display:"rotate",color:"#000",field:"name",renderer:function(d){return T("label.grade")+" "+d}}}],series:[{type:"gauge",field:"value",showInLegend:true,highlight:true,donut:40,colorSet:["#3AA8CB","#fff"]}]}]}}});Ext.define("GreenFleet.view.management.DriverSpeedSection",{extend:"Ext.Container",alias:"widget.management_driver_speed",title:T("title.driver_speed_section"),entityUrl:"driver_run",layout:{align:"stretch",type:"vbox"},chartPanel:null,initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.driver_speed_section")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.zvehiclelist(a),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.zrunstatus,this.zrunstatus_chart]}]}],this.callParent();this.sub("driver_list").on("itemclick",function(e,b){var c=a.sub("runstatus_grid").store;var d=c.getProxy();d.extraParams.driver=b.data.id;d.extraParams.from_year=a.sub("from_year").getValue();d.extraParams.to_year=a.sub("to_year").getValue();d.extraParams.from_month=a.sub("from_month").getValue();d.extraParams.to_month=a.sub("to_month").getValue();c.load({scope:a,callback:function(){a.setGridTitle(b.get("name"));a.setChartTitle();a.refreshChart()}})});this.sub("runstatus_grid").on("itemclick",function(c,b){a.setChartTitle(b.get("month_str"));a.refreshByMonth(b)});this.sub("chart_panel").on("resize",function(b,e,d,c){if(a.chartPanel){a.resizeChart()}});this.sub("id_filter").on("change",function(c,b){a.searchDrivers(false)});this.sub("name_filter").on("change",function(c,b){a.searchDrivers(false)});this.sub("combo_chart_type").setValue("column");this.sub("combo_view").setValue("monthly_view")},setGridTitle:function(a){var b=a?T("title.runstatus_history")+" ("+a+") ":T("title.runstatus_history");this.sub("runstatus_grid").setTitle(b)},setChartTitle:function(a){var b=a?T("label.speed_section")+" ("+a+") "+T("label.chart"):T("label.speed_section")+T("label.chart");this.sub("chart_panel").setTitle(b)},searchDrivers:function(c){if(c){this.sub("driver_list").store.load()}else{this.sub("driver_list").store.clearFilter(true);var b=this.sub("id_filter").getValue();var a=this.sub("name_filter").getValue();if(b||a){this.sub("driver_list").store.filter([{property:"id",value:b},{property:"name",value:a}])}}},zvehiclelist:function(a){return{xtype:"gridpanel",itemId:"driver_list",store:"DriverStore",title:T("title.driver_list"),width:260,autoScroll:true,columns:[{dataIndex:"id",text:T("label.id"),flex:1},{dataIndex:"name",text:T("label.name"),flex:1}],tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",width:60},T("label.name"),{xtype:"textfield",name:"name_filter",itemId:"name_filter",width:65}," ",{xtype:"button",text:T("button.search"),handler:function(b){b.up("management_driver_speed").searchDrivers(true)}}]}},zrunstatus:{xtype:"gridpanel",itemId:"runstatus_grid",store:"DriverSpeedStore",cls:"hIndexbar",title:T("title.runstatus_history"),autoScroll:true,flex:1,columns:[{dataIndex:"month_str",text:T("label.month"),},{header:T("label.lessthan_km_min",{km:10}),dataIndex:"spd_lt10"},{header:T("label.lessthan_km_min",{km:20}),dataIndex:"spd_lt20"},{header:T("label.lessthan_km_min",{km:30}),dataIndex:"spd_lt30"},{header:T("label.lessthan_km_min",{km:40}),dataIndex:"spd_lt40"},{header:T("label.lessthan_km_min",{km:50}),dataIndex:"spd_lt50"},{header:T("label.lessthan_km_min",{km:60}),dataIndex:"spd_lt60"},{header:T("label.lessthan_km_min",{km:70}),dataIndex:"spd_lt70"},{header:T("label.lessthan_km_min",{km:80}),dataIndex:"spd_lt80"},{header:T("label.lessthan_km_min",{km:90}),dataIndex:"spd_lt90"},{header:T("label.lessthan_km_min",{km:100}),dataIndex:"spd_lt100"},{header:T("label.lessthan_km_min",{km:110}),dataIndex:"spd_lt110"},{header:T("label.lessthan_km_min",{km:120}),dataIndex:"spd_lt120"},{header:T("label.lessthan_km_min",{km:130}),dataIndex:"spd_lt130"},{header:T("label.lessthan_km_min",{km:140}),dataIndex:"spd_lt140"},{header:T("label.lessthan_km_min",{km:150}),dataIndex:"spd_lt150"},{header:T("label.lessthan_km_min",{km:160}),dataIndex:"spd_lt160"}],tbar:[T("label.view")+" : ",{xtype:"combo",itemId:"combo_view",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"monthly_view",desc:T("label.monthly_view")},{name:"yearly_view",desc:T("label.yearly_view")}]}),listeners:{change:function(c,b,a){}}},T("label.chart_type")+" : ",{xtype:"combo",itemId:"combo_chart_type",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"column",desc:T("label.column")},{name:"radar",desc:T("label.radar")}]}),listeners:{change:function(c,b,a){var d=c.up("management_driver_speed");d.refreshChart()}}},T("label.period")+" : ",{xtype:"combo",name:"from_year",itemId:"from_year",displayField:"year",valueField:"year",value:new Date().getFullYear()-1,store:"YearStore",width:60},{xtype:"combo",name:"from_month",itemId:"from_month",displayField:"month",valueField:"month",value:new Date().getMonth()+2,store:"MonthStore",width:40}," ~ ",{xtype:"combo",name:"to_year",itemId:"to_year",displayField:"year",valueField:"year",value:new Date().getFullYear(),store:"YearStore",width:60},{xtype:"combo",name:"to_month",itemId:"to_month",displayField:"month",valueField:"month",value:new Date().getMonth()+1,store:"MonthStore",width:40},]},zrunstatus_chart:{xtype:"panel",itemId:"chart_panel",cls:"hIndexbar",title:T("title.speed_section_chart"),flex:1,autoScroll:true},refreshChart:function(){var a=this.sub("combo_chart_type").getValue();if(a=="radar"){this.refreshRadarChart()}else{this.refreshColumnChart()}},refreshColumnChart:function(){var b=this.sub("chart_panel");var h=null;var a=null;try{h=b.getWidth();a=b.getHeight()}catch(i){return}var d=[];var c=this.sub("runstatus_grid").store;c.each(function(j){var o=(j.get("spd_lt10")+j.get("spd_lt20")+j.get("spd_lt30"));var l=(j.get("spd_lt40")+j.get("spd_lt50")+j.get("spd_lt60"));var m=(j.get("spd_lt70")+j.get("spd_lt80")+j.get("spd_lt90"));var e=(j.get("spd_lt90")+j.get("spd_lt100")+j.get("spd_lt110")+j.get("spd_lt120"));var k=(j.get("spd_lt130")+j.get("spd_lt140")+j.get("spd_lt150")+j.get("spd_lt160"));var n={month_str:j.get("month_str"),value1:o,desc1:"0 ~ 30(km)",value2:l,desc2:"40 ~ 60(km)",value3:m,desc3:"70 ~ 90(km)",value4:e,desc4:"100 ~ 120(km)",value5:k,desc5:"130 ~ (km)"};d.push(n)});var f=Ext.create("Ext.data.JsonStore",{fields:["month_str","value1","value2","value3","value4","value5","desc1","desc2","desc3","desc4","desc5"],autoDestroy:true,data:d});var g=this.buildColumnChart(f,0,h,a);b.removeAll();b.add(g);this.chartPanel=g},refreshRadarChart:function(){var f=this.sub("runstatus_grid").store;var g=0;var r=0;var a=0;var h=0;var s=0;var b=0;var i=0;var t=0;var c=0;var l=0;var u=0;var d=0;var n=0;var v=0;var e=0;var p=0;f.each(function(w){g+=w.get("spd_lt10");r+=w.get("spd_lt20");a+=w.get("spd_lt30");h+=w.get("spd_lt40");s+=w.get("spd_lt50");b+=w.get("spd_lt60");i+=w.get("spd_lt70");t+=w.get("spd_lt80");c+=w.get("spd_lt90");l+=w.get("spd_lt100");u+=w.get("spd_lt110");d+=w.get("spd_lt120");n+=w.get("spd_lt130");v+=w.get("spd_lt140");e+=w.get("spd_lt150");p+=w.get("spd_lt160")});var j=Ext.create("Ext.data.JsonStore",{fields:["name","value"],autoDestroy:true,data:[{name:"0~10(km)",value:g},{name:"10~20(km)",value:r},{name:"20~30(km)",value:a},{name:"30~40(km)",value:h},{name:"40~50(km)",value:s},{name:"50~60(km)",value:b},{name:"60~70(km)",value:i},{name:"70~80(km)",value:t},{name:"80~90(km)",value:c},{name:"90~100(km)",value:l},{name:"100~110(km)",value:u},{name:"110~120(km)",value:d},{name:"120~130(km)",value:n},{name:"130~140(km)",value:v},{name:"140~150(km)",value:e},{name:"150(km)~",value:p}]});var o=this.sub("chart_panel");var q=o.getWidth();var m=o.getHeight();o.removeAll();var k=this.buildRadarChart(j,q,m);o.add(k);this.chartPanel=k},resizeChart:function(e,b){var a=this.sub("chart_panel");if(!e){e=a.getWidth()}if(!b){b=a.getHeight()}var c=a.down("panel");c.setWidth(e-25);c.setHeight(b-45);var d=c.down("chart");d.setWidth(e-25);d.setHeight(b-50)},buildRadarChart:function(b,c,a){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,insetPadding:20,legend:{position:"right"},axes:[{type:"Radial",position:"radial",label:{display:true}}],series:[{showInLegend:false,showMarkers:true,type:"radar",xField:"name",yField:"value",style:{opacity:0.4},markerConfig:{radius:3,size:5}}]}]}},buildColumnChart:function(b,d,c,a){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,shadow:true,insetPadding:20,theme:"Base:gradients",legend:{position:"left"},axes:[{type:"Numeric",position:"left",fields:["value1","value2","value3","value4","value5"],title:T("label.time")+"("+T("label.minute_s")+")",minimum:d},{type:"Category",position:"bottom",fields:["month_str"],title:T("label.month"),}],series:[{type:"column",axis:"left",xField:"month_str",yField:["value1","value2","value3","value4","value5"],title:["0 ~ 30(km)","40 ~ 60(km)","70 ~ 90(km)","100 ~ 120(km)","130 ~ (km)"],showInLegend:true,tips:{trackMouse:true,width:100,height:25,renderer:function(f,e){this.setTitle(e.value[0]+" : "+e.value[1])}},highlight:{segment:{margin:20}},label:{field:["value1","value2","value3","value4","value5"],display:"insideEnd",contrast:true,color:"#333",font:"11px Arial"}}]}]}},refreshByMonth:function(a){var b=this.sub("combo_chart_type").getValue();if(b=="radar"){this.refreshRadarChartByMonth(a)}else{this.refreshColumnChartByMonth(a)}},refreshRadarChartByMonth:function(c){var g=this.createChartData(c);var f=Ext.create("Ext.data.JsonStore",{fields:["name","value"],autoDestroy:true,data:g});var b=this.sub("chart_panel");var e=b.getWidth();var a=b.getHeight();b.removeAll();var d=this.buildRadarByMonth(f,e,a);b.add(d);this.chartPanel=d},refreshColumnChartByMonth:function(c){var b=this.sub("chart_panel");var f=b.getWidth();var a=b.getHeight();var g=this.createChartData(c);var d=Ext.create("Ext.data.JsonStore",{fields:["name","value"],autoDestroy:true,data:g});var e=this.buildChartByMonth(d,0,f,a);b.removeAll();b.add(e);this.chartPanel=e},createChartData:function(a){return[{name:"0~10(km)",value:a.get("spd_lt10")},{name:"10~20(km)",value:a.get("spd_lt20")},{name:"20~30(km)",value:a.get("spd_lt30")},{name:"30~40(km)",value:a.get("spd_lt40")},{name:"40~50(km)",value:a.get("spd_lt50")},{name:"50~60(km)",value:a.get("spd_lt60")},{name:"60~70(km)",value:a.get("spd_lt70")},{name:"70~80(km)",value:a.get("spd_lt80")},{name:"80~90(km)",value:a.get("spd_lt90")},{name:"90~100(km)",value:a.get("spd_lt100")},{name:"100~110(km)",value:a.get("spd_lt110")},{name:"110~120(km)",value:a.get("spd_lt120")},{name:"120~130(km)",value:a.get("spd_lt130")},{name:"130~140(km)",value:a.get("spd_lt140")},{name:"140~150(km)",value:a.get("spd_lt150")},{name:"150(km)~",value:a.get("spd_lt160")}]},buildRadarByMonth:function(b,c,a){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,insetPadding:20,legend:{position:"right"},axes:[{type:"Radial",position:"radial",label:{display:true}}],series:[{showInLegend:false,showMarkers:true,type:"radar",xField:"name",yField:"value",style:{opacity:0.4},markerConfig:{radius:3,size:5}}]}]}},buildChartByMonth:function(b,d,c,a){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:c-25,height:a-45,items:[{xtype:"chart",animate:true,store:b,width:c-25,height:a-50,shadow:true,insetPadding:20,theme:"Base:gradients",legend:{position:"left"},axes:[{type:"Numeric",position:"left",fields:["value"],title:T("label.time")+"("+T("label.minute_s")+")",minimum:d},{type:"Category",position:"bottom",fields:["name"],title:T("label.speed_section")+"(km)",}],series:[{type:"column",axis:"left",xField:"name",yField:["value"],showInLegend:false,tips:{trackMouse:true,width:100,height:25,renderer:function(f,e){this.setTitle(e.value[0]+"(km) : "+e.value[1])}},highlight:{segment:{margin:20}}}]}]}}});Ext.define("GreenFleet.view.dashboard.Reports",{extend:"Ext.Container",alias:"widget.dashboard_report",layout:{type:"vbox",align:"stretch"},title:T("menu.dashboard"),initComponent:function(){var a=this;this.items=[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.reportlist(),{itemId:"report_view",xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.dashboard_body()]}]}],this.callParent();this.sub("report_list").on("itemclick",function(c,b){a.sub("report_view").removeAll();a.sub("report_view").add(a.dashboard_body(b.get("id")))})},dashboard_body:function(a){if(!a){a="vehicle_summary"}return{xtype:"dashboard_"+a,itemId:"dashboard_panel",cls:"hIndexbar",title:T("report.report")+" Test",flex:1,autoScroll:true}},zvehiclelist:{xtype:"gridpanel",itemId:"driver_list",store:"DriverStore",title:T("title.driver_list"),width:260,autoScroll:true,columns:[{dataIndex:"id",text:T("label.id"),flex:1},{dataIndex:"name",text:T("label.name"),flex:1}]},reportlist:function(){return{xtype:"gridpanel",itemId:"report_list",store:Ext.create("Ext.data.Store",{fields:["id","name"],data:[{id:"vehicle_summary",name:T("report.vehicle_summary")},{id:"driver_summary",name:T("report.driver_summary")},{id:"vehicle_effcc_rel",name:T("report.vehicle_effcc_rel")},{id:"driver_effcc_rel",name:T("report.driver_effcc_rel")},{id:"habit_effcc_rel",name:T("report.habit_effcc_rel")},{id:"incident_effcc_rel",name:T("report.incident_effcc_rel")},{id:"consumable_effcc_rel",name:T("report.consumable_effcc_rel")}]}),title:T("title.report_list"),width:180,autoScroll:true,columns:[{dataIndex:"name",text:T("label.name"),flex:1}]}},});Ext.define("GreenFleet.view.dashboard.VehicleRunningSummary",{extend:"Ext.Container",alias:"widget.dashboard_vehicle_summary",layout:{align:"stretch",type:"vbox"},chartPanel:null,initComponent:function(){var a=this;this.items=[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.zdatagrid,this.zchartpanel]}]}],this.callParent();this.sub("chart_panel").on("resize",function(b,e,d,c){if(a.chartPanel){a.resizeChart()}})},zdatagrid:{itemId:"datagrid_panel",xtype:"panel",flex:1,cls:"hIndexbar",title:T("report.runtime_by_vehicles")+T("label.parentheses_x",{x:T("label.minute_s")}),autoScroll:true,items:[{xtype:"grid",itemId:"data_grid",features:[{groupHeaderTpl:"Group : {name}",ftype:"groupingsummary"}],store:Ext.create("Ext.data.Store",{groupField:"year",fields:["vehicle","year","mon_1","mon_2","mon_3","mon_4","mon_5","mon_6","mon_7","mon_8","mon_9","mon_10","mon_11","mon_12","sum"],data:[]}),autoScroll:true,columnLines:true,columns:[{text:T("label.year"),dataIndex:"year",width:50},{text:T("label.vehicle"),dataIndex:"vehicle",width:80,summaryType:"count",summaryRenderer:function(a){return Ext.String.format("{0} {1}",T("label.total"),a)}},{text:T("label.month"),columns:[{dataIndex:"mon_1",text:"1",width:60},{dataIndex:"mon_2",text:"2",width:60},{dataIndex:"mon_3",text:"3",width:60},{dataIndex:"mon_4",text:"4",width:60},{dataIndex:"mon_5",text:"5",width:60},{dataIndex:"mon_6",text:"6",width:60},{dataIndex:"mon_7",text:"7",width:60},{dataIndex:"mon_8",text:"8",width:60},{dataIndex:"mon_9",text:"9",width:60},{dataIndex:"mon_10",text:"10",width:60},{dataIndex:"mon_11",text:"11",width:60},{dataIndex:"mon_12",text:"12",width:60}]},{header:T("label.sum"),dataIndex:"sum",width:100,summaryType:"sum",summaryRenderer:function(a){a=Ext.util.Format.number(a,"0.00");return Ext.String.format("{0} {1}",T("label.total"),a)}}]}],tbar:[T("label.chart_type")+" : ",{xtype:"combo",itemId:"combo_chart_type",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"by_vehicles",desc:T("report.by_vehicles")},{name:"by_years",desc:T("report.by_years")}]}),listeners:{change:function(c,b,a){var d=c.up("dashboard_vehicle_summary");d.refresh()}}},T("title.vehicle_group"),{xtype:"combo",itemId:"combo_vehicle_group",padding:"3 0 0 0",displayField:"desc",valueField:"id",store:"VehicleGroupStore",listeners:{change:function(c,b,a){var d=c.up("dashboard_vehicle_summary");d.refresh()}}},T("label.period")+" : ",{xtype:"combo",name:"from_year",itemId:"from_year",displayField:"year",valueField:"year",value:new Date().getFullYear()-1,store:"YearStore",width:60},{xtype:"combo",name:"from_month",itemId:"from_month",displayField:"month",valueField:"month",value:new Date().getMonth()+2,store:"MonthStore",width:40}," ~ ",{xtype:"combo",name:"to_year",itemId:"to_year",displayField:"year",valueField:"year",value:new Date().getFullYear(),store:"YearStore",width:60},{xtype:"combo",name:"to_month",itemId:"to_month",displayField:"month",valueField:"month",value:new Date().getMonth()+1,store:"MonthStore",width:40},T("label.chart")+" : ",{xtype:"combo",itemId:"combo_chart",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","type","desc","unit"],data:[{name:"run_time",type:"int",desc:T("report.runtime_by_vehicles"),unit:T("label.parentheses_x",{x:T("label.minute_s")})},{name:"rate_of_oper",type:"float",desc:T("report.oprate_by_vehicles"),unit:"%"},{name:"run_dist",type:"float",desc:T("report.rundist_by_vehicles"),unit:"(km)"},{name:"consmpt",type:"float",desc:T("report.consumption_by_vehicles"),unit:"(l)"},{name:"co2_emss",type:"float",desc:T("report.co2_emissions_by_vehicles"),unit:"(g/km)"},{name:"effcc",type:"float",desc:T("report.efficiency_by_vehicles"),unit:"(km/l)"},{name:"oos_cnt",type:"int",desc:T("report.oos_cnt_by_vehicles"),unit:""},{name:"mnt_cnt",type:"int",desc:T("report.mnt_cnt_by_vehicles"),unit:""},{name:"mnt_time",type:"int",desc:T("report.mnt_time_by_vehicles"),unit:T("label.parentheses_x",{x:T("label.minute_s")})},{name:"mttr",type:"float",desc:T("report.mttr_by_vehicles"),unit:""},{name:"mtbf",type:"float",desc:T("report.mtbf_by_vehicles"),unit:""},]}),listeners:{change:function(c,b,a){var d=c.up("dashboard_vehicle_summary");d.refresh()}}},{text:T("button.search"),itemId:"search",handler:function(a){var b=a.up("dashboard_vehicle_summary");b.refresh()}}]},zchartpanel:{xtype:"panel",itemId:"chart_panel",cls:"hIndexbar",title:T("label.chart"),flex:1,autoScroll:true},getChartInfo:function(){var e=this.sub("combo_chart").getValue();if(!e){e="run_time"}var c=null;var b=this.sub("combo_chart").store.data;for(var a=0;a<b.length;a++){var d=b.items[a].data;if(e==d.name){c=d;break}}return c},refresh:function(){var a=this.sub("data_grid");var f=this.sub("combo_vehicle_group");var c=this.sub("from_year").getValue();var i=this.sub("to_year").getValue();var g=this.sub("from_month").getValue();var d=this.sub("to_month").getValue();var b=this.getChartInfo();this.sub("datagrid_panel").setTitle(b.desc+b.unit);var h=Ext.getStore("VehicleRunStore");var e=h.getProxy();e.extraParams.from_year=c;e.extraParams.from_month=g;e.extraParams.to_year=i;e.extraParams.to_month=d;if(f.getValue()){e.extraParams.vehicle_group=f.getValue()}h.load({scope:this,callback:function(k,j,m){var l=[];Ext.each(k,function(p){var n=p.data.vehicle;var t=p.data.year;var r=p.data.month;var w=p.get(b.name);if("rate_of_oper"==b.name){var u=p.data.run_time;w=u?((u*100)/(30*60*24)):0}else{if("mttr"==b.name){var s=p.data.oos_cnt;var o=p.data.mnt_time;w=(s&&o)?(o/s):0}else{if("mtbf"==b.name){var u=p.data.run_time;var o=p.data.mnt_time;var s=p.data.oos_cnt;w=s?((u-o>0)?((u-o)/s):0):0}}}if(b.type=="float"){w=parseFloat(Ext.util.Format.number(w,"0.00"))}var q=null;Ext.each(l,function(x){if(n==x.vehicle&&t==x.year){q=x}});var v="mon_"+r;if(q==null){q={vehicle:n,year:t,sum:w};q[v]=w;l.push(q)}else{q[v]=w;if(w&&w>0){q.sum=q.sum+w}}});if(b.type=="float"){Ext.each(l,function(n){n.sum=parseFloat(Ext.util.Format.number(n.sum,"0.00"))})}a.store.loadData(l);this.refreshChart(l,b.desc,b.unit)}})},refreshChart:function(b,g,i){var c=this.sub("chart_panel");var a=null;var j=null;try{a=c.getWidth();j=c.getHeight()}catch(d){return}var h=this.sub("combo_chart_type").getValue();var f=("by_years"==h)?this.refreshChartByYear(b,a,j,g,i):this.refreshChartByVehicle(b,a,j,g,i);c.removeAll();c.add(f);this.chartPanel=f},refreshChartByVehicle:function(c,a,n,j,m){var g=[];var b=[];var f=[];var h=["vehicle"];var k=[];var i=0;Ext.each(c,function(o){var r=o.vehicle;var q=o.year;var p=false;Ext.each(g,function(s){if(s==q){p=true}});if(!p){f.push(""+q);g.push(q);b.push(q+"_sum");h.push(q+"_sum")}});Ext.each(c,function(o){var s=o.vehicle;var q=o.year;var p=o.sum;var r=null;Ext.each(k,function(t){if(s==t.vehicle){r=t}});if(!r){r={vehicle:s};k.push(r)}r[q+"_sum"]=p});var l=Ext.create("Ext.data.Store",{fields:h,data:k});var e="vehicle";var d=T("label.vehicle");return this.buildChart(l,e,d,b,j,f,m,0,a,n)},refreshChartByYear:function(c,a,n,j,m){var g=[];var b=[];var f=[];var h=["year"];var k=[];var i=0;Ext.each(c,function(o){var r=o.vehicle;var q=o.year;var p=false;Ext.each(g,function(s){if(s==r){p=true}});if(!p){f.push(r);g.push(r);b.push(r+"_sum");h.push(r+"_sum")}});Ext.each(c,function(o){var s=o.vehicle;var q=o.year;var p=o.sum;var r=null;Ext.each(k,function(t){if(q==t.year){r=t}});if(!r){r={year:q};k.push(r)}r[s+"_sum"]=p});var l=Ext.create("Ext.data.Store",{fields:h,data:k});var e="year";var d=T("label.year");return this.buildChart(l,e,d,b,j,f,m,0,a,n)},resizeChart:function(e,b){var a=this.sub("chart_panel");if(!e){e=a.getWidth()}if(!b){b=a.getHeight()}var c=a.down("panel");c.setWidth(e-25);c.setHeight(b-45);var d=c.down("chart");d.setWidth(e-25);d.setHeight(b-50)},buildChart:function(i,d,c,b,f,e,h,g,a,j){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:a-25,height:j-45,items:[{xtype:"chart",animate:true,store:i,width:a-25,height:j-50,shadow:true,insetPadding:5,theme:"Base:gradients",legend:{position:"left"},axes:[{type:"Numeric",position:"left",fields:b,title:f+h,minimum:g},{type:"Category",position:"bottom",fields:[d],title:c}],series:[{type:"column",axis:"left",xField:d,yField:b,title:e,showInLegend:true,tips:{trackMouse:true,width:140,height:25,renderer:function(l,k){this.setTitle(k.value[0]+" : "+k.value[1])}},highlight:{segment:{margin:20}},label:{field:b,display:"insideEnd",contrast:true,color:"#333",font:"14px Arial",}}]}]}}});Ext.define("GreenFleet.view.dashboard.DriverRunningSummary",{extend:"Ext.Container",alias:"widget.dashboard_driver_summary",layout:{align:"stretch",type:"vbox"},chartPanel:null,initComponent:function(){var a=this;this.items=[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.zdatagrid,this.zchartpanel]}]}],this.callParent();this.sub("chart_panel").on("resize",function(b,e,d,c){if(a.chartPanel){a.resizeChart()}})},zdatagrid:{itemId:"datagrid_panel",xtype:"panel",flex:1,cls:"hIndexbar",title:T("report.runtime_by_drivers")+T("label.parentheses_x",{x:T("label.minute_s")}),autoScroll:true,items:[{xtype:"grid",itemId:"data_grid",features:[{groupHeaderTpl:"Group : {name}",ftype:"groupingsummary"}],store:Ext.create("Ext.data.Store",{groupField:"year",fields:["driver","year","mon_1","mon_2","mon_3","mon_4","mon_5","mon_6","mon_7","mon_8","mon_9","mon_10","mon_11","mon_12","sum"],data:[]}),autoScroll:true,columnLines:true,columns:[{text:T("label.year"),dataIndex:"year",width:50},{text:T("label.driver"),dataIndex:"driver",width:80,summaryType:"count",summaryRenderer:function(a){return Ext.String.format("{0} {1}",T("label.total"),a)}},{text:T("label.month"),columns:[{dataIndex:"mon_1",text:"1",width:60},{dataIndex:"mon_2",text:"2",width:60},{dataIndex:"mon_3",text:"3",width:60},{dataIndex:"mon_4",text:"4",width:60},{dataIndex:"mon_5",text:"5",width:60},{dataIndex:"mon_6",text:"6",width:60},{dataIndex:"mon_7",text:"7",width:60},{dataIndex:"mon_8",text:"8",width:60},{dataIndex:"mon_9",text:"9",width:60},{dataIndex:"mon_10",text:"10",width:60},{dataIndex:"mon_11",text:"11",width:60},{dataIndex:"mon_12",text:"12",width:60}]},{header:T("label.sum"),dataIndex:"sum",width:100,summaryType:"sum",summaryRenderer:function(a){a=Ext.util.Format.number(a,"0.00");return Ext.String.format("{0} {1}",T("label.total"),a)}}]}],tbar:[T("label.chart_type")+" : ",{xtype:"combo",itemId:"combo_chart_type",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","desc"],data:[{name:"by_drivers",desc:T("report.by_drivers")},{name:"by_years",desc:T("report.by_years")}]}),listeners:{change:function(c,b,a){var d=c.up("dashboard_driver_summary");d.refresh()}}},T("title.driver_group"),{xtype:"combo",itemId:"combo_driver_group",padding:"3 0 0 0",displayField:"desc",valueField:"id",store:"DriverGroupStore",listeners:{change:function(c,b,a){var d=c.up("dashboard_driver_summary");d.refresh()}}},T("label.period")+" : ",{xtype:"combo",name:"from_year",itemId:"from_year",displayField:"year",valueField:"year",value:new Date().getFullYear()-1,store:"YearStore",width:60},{xtype:"combo",name:"from_month",itemId:"from_month",displayField:"month",valueField:"month",value:new Date().getMonth()+2,store:"MonthStore",width:40}," ~ ",{xtype:"combo",name:"to_year",itemId:"to_year",displayField:"year",valueField:"year",value:new Date().getFullYear(),store:"YearStore",width:60},{xtype:"combo",name:"to_month",itemId:"to_month",displayField:"month",valueField:"month",value:new Date().getMonth()+1,store:"MonthStore",width:40},T("label.chart")+" : ",{xtype:"combo",itemId:"combo_chart",padding:"3 0 0 0",displayField:"desc",valueField:"name",store:Ext.create("Ext.data.Store",{fields:["name","type","desc","unit"],data:[{name:"run_time",type:"int",desc:T("report.runtime_by_drivers"),unit:T("label.parentheses_x",{x:T("label.minute_s")})},{name:"rate_of_oper",type:"float",desc:T("report.oprate_by_drivers"),unit:"(%)"},{name:"run_dist",type:"float",desc:T("report.rundist_by_drivers"),unit:"(km)"},{name:"consmpt",type:"float",desc:T("report.consumption_by_drivers"),unit:"(l)"},{name:"co2_emss",type:"float",desc:T("report.co2_emissions_by_drivers"),unit:"(g/km)"},{name:"effcc",type:"float",desc:T("report.efficiency_by_drivers"),unit:"(km/l)"},{name:"sud_accel_cnt",type:"int",desc:T("report.sud_accel_cnt_by_drivers"),unit:""},{name:"sud_brake_cnt",type:"int",desc:T("report.sud_brake_cnt_by_drivers"),unit:""},{name:"eco_drv_time",type:"int",desc:T("report.eco_drv_time_by_drivers"),unit:T("label.parentheses_x",{x:T("label.minute_s")})},{name:"ovr_spd_time",type:"int",desc:T("report.ovr_spd_time_by_drivers"),unit:T("label.parentheses_x",{x:T("label.minute_s")})},{name:"inc_cnt",type:"int",desc:T("report.inc_cnt_by_drivers"),unit:""}]}),listeners:{change:function(c,b,a){var d=c.up("dashboard_driver_summary");d.refresh()}}},{text:T("button.search"),itemId:"search",handler:function(a){var b=a.up("dashboard_driver_summary");b.refresh()}}]},zchartpanel:{xtype:"panel",itemId:"chart_panel",cls:"hIndexbar",title:T("label.chart"),flex:1,autoScroll:true},getChartInfo:function(){var e=this.sub("combo_chart").getValue();if(!e){e="run_time"}var c=null;var b=this.sub("combo_chart").store.data;for(var a=0;a<b.length;a++){var d=b.items[a].data;if(e==d.name){c=d;break}}return c},refresh:function(){var a=this.sub("data_grid");var c=this.sub("from_year").getValue();var i=this.sub("to_year").getValue();var g=this.sub("from_month").getValue();var e=this.sub("to_month").getValue();var b=this.getChartInfo();this.sub("datagrid_panel").setTitle(b.desc+b.unit);var d=this.sub("combo_driver_group").getValue();var h=Ext.getStore("DriverRunStore");var f=h.getProxy();f.extraParams.from_year=c;f.extraParams.from_month=g;f.extraParams.to_year=i;f.extraParams.to_month=e;if(d){f.extraParams.driver_group=d}h.load({scope:this,callback:function(k,j,m){var l=[];Ext.each(k,function(n){var t=n.data.driver;var s=n.data.year;var u=n.data.month;var p=n.get(b.name);if(b.name=="rate_of_oper"){var r=n.data.run_time;p=r?((r*100)/(30*60*24)):0}if(b.type=="float"){p=parseFloat(Ext.util.Format.number(p,"0.00"))}var o=null;Ext.each(l,function(v){if(t==v.driver&&s==v.year){o=v}});var q="mon_"+u;if(o==null){o={driver:t,year:s,sum:p};o[q]=p;l.push(o)}else{o[q]=p;if(p&&p>0){o.sum=o.sum+p}}});if(b.type=="float"){Ext.each(l,function(n){n.sum=parseFloat(Ext.util.Format.number(n.sum,"0.00"))})}a.store.loadData(l);this.refreshChart(l,b.desc,b.unit)}})},refreshChart:function(b,g,i){var c=this.sub("chart_panel");var a=null;var j=null;try{a=c.getWidth();j=c.getHeight()}catch(d){return}var h=this.sub("combo_chart_type").getValue();var f=("by_years"==h)?this.refreshChartByYear(b,a,j,g,i):this.refreshChartByDriver(b,a,j,g,i);c.removeAll();c.add(f);this.chartPanel=f},refreshChartByDriver:function(c,a,n,j,m){var g=[];var b=[];var f=[];var h=["driver"];var k=[];var i=0;Ext.each(c,function(o){var r=o.driver;var q=o.year;var p=false;Ext.each(g,function(s){if(s==q){p=true}});if(!p){f.push(""+q);g.push(q);b.push(q+"_sum");h.push(q+"_sum")}});Ext.each(c,function(o){var s=o.driver;var q=o.year;var p=o.sum;var r=null;Ext.each(k,function(t){if(s==t.driver){r=t}});if(!r){r={driver:s};k.push(r)}r[q+"_sum"]=p});var l=Ext.create("Ext.data.Store",{fields:h,data:k});var e="driver";var d=T("label.driver");return this.buildChart(l,e,d,b,j,f,m,0,a,n)},refreshChartByYear:function(d,a,n,j,m){var c=[];var b=[];var g=[];var h=["year"];var k=[];var i=0;Ext.each(d,function(o){var r=o.driver;var q=o.year;var p=false;Ext.each(c,function(s){if(s==r){p=true}});if(!p){g.push(r);c.push(r);b.push(r+"_sum");h.push(r+"_sum")}});Ext.each(d,function(o){var s=o.driver;var q=o.year;var p=o.sum;var r=null;Ext.each(k,function(t){if(q==t.year){r=t}});if(!r){r={year:q};k.push(r)}r[s+"_sum"]=p});var l=Ext.create("Ext.data.Store",{fields:h,data:k});var f="year";var e=T("label.year");return this.buildChart(l,f,e,b,j,g,m,0,a,n)},resizeChart:function(e,b){var a=this.sub("chart_panel");if(!e){e=a.getWidth()}if(!b){b=a.getHeight()}var c=a.down("panel");c.setWidth(e-25);c.setHeight(b-45);var d=c.down("chart");d.setWidth(e-25);d.setHeight(b-50)},buildChart:function(i,d,c,b,f,e,h,g,a,j){return{xtype:"panel",cls:"paddingPanel healthDashboard paddingAll10",width:a-25,height:j-45,items:[{xtype:"chart",animate:true,store:i,width:a-25,height:j-50,shadow:true,insetPadding:5,theme:"Base:gradients",legend:{position:"left"},axes:[{type:"Numeric",position:"left",fields:b,title:f+h,minimum:g},{type:"Category",position:"bottom",fields:[d],title:c}],series:[{type:"column",axis:"left",xField:d,yField:b,title:e,showInLegend:true,tips:{trackMouse:true,width:140,height:25,renderer:function(l,k){this.setTitle(k.value[0]+" : "+k.value[1])}},highlight:{segment:{margin:20}},label:{field:b,display:"insideEnd",contrast:true,color:"#333",font:"14px Arial",}}]}]}}});Ext.define("GreenFleet.view.management.DriverGroup",{extend:"Ext.container.Container",alias:"widget.management_driver_group",title:T("title.driver_group"),entityUrl:"driver_group",importUrl:"driver_group/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},currentDriverGroup:"",initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.driver_group_list")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.buildDriverGroupList(this),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.buildDriverGroupForm(this),this.buildGroupedDriverList(this)]}]}],this.callParent(arguments);this.sub("grid").on("itemclick",function(c,b){a.currentDriverGroup=b.get("id");a.sub("form").getForm().reset();a.sub("form").loadRecord(b)});this.sub("form_driver_group_key").on("change",function(d,c){if(c){var b=a.sub("grid").store.findRecord("key",c);if(b){a.currentDriverGroup=b.get("id");a.sub("grouped_drivers_grid").setTitle(T("title.drivers_by_group")+" ["+b.get("id")+"]");a.sub("form").setTitle(T("title.group_details")+" ["+b.get("id")+"]");a.searchGroupedDrivers()}}});this.sub("grouped_drivers_grid").store.on("beforeload",function(c,b,d){b.params=b.params||{};b.params.driver_group_id=a.currentDriverGroup});this.down("#search_all_drivers").on("click",function(){a.searchAllDrivers(true)});this.down("#search_reset_all_drivers").on("click",function(){a.sub("all_drivers_id_filter").setValue("");a.sub("all_drivers_name_filter").setValue("")});this.sub("all_drivers_id_filter").on("change",function(c,b){a.searchAllDrivers(false)});this.sub("all_drivers_name_filter").on("change",function(c,b){a.searchAllDrivers(false)});this.sub("all_drivers_grid").store.on("beforeload",function(e,d,f){d.params=d.params||{};var c=a.sub("all_drivers_id_filter");var b=a.sub("all_drivers_name_filter");d.params.driver_id=c.getSubmitValue();d.params.name=b.getSubmitValue()});this.down("button[itemId=moveLeft]").on("click",function(c){if(!a.currentDriverGroup){Ext.MessageBox.alert(T("msg.none_selected"),T("msg.select_x_first",{x:T("label.driver_group")}));return}var d=a.sub("all_drivers_grid").getSelectionModel().getSelection();if(!d||d.length==0){Ext.MessageBox.alert(T("msg.none_selected"),"Select the drivers to add driver group ["+a.currentDriverGroup+"]");return}var e=[];for(var b=0;b<d.length;b++){e.push(d[b].data.id)}Ext.Ajax.request({url:"/driver_relation/save",method:"POST",params:{driver_group_id:a.currentDriverGroup,driver_id:e},success:function(f){var g=Ext.JSON.decode(f.responseText);if(g.success){a.sub("all_drivers_grid").getSelectionModel().deselectAll(true);a.searchGroupedDrivers();GreenFleet.msg(T("label.success"),g.msg)}else{Ext.MessageBox.alert(T("label.failure"),g.msg)}},failure:function(f){Ext.MessageBox.alert(T("label.failure"),f.responseText)}})});this.down("button[itemId=moveRight]").on("click",function(c){if(!a.currentDriverGroup){Ext.Msg.alert(T("msg.none_selected"),T("msg.select_x_first",{x:T("label.driver_group")}));return}var d=a.sub("grouped_drivers_grid").getSelectionModel().getSelection();if(!d||d.length==0){Ext.Msg.alert(T("msg.none_selected"),"Select the drivers to remove from driver group ["+a.currentDriverGroup+"]");return}var e=[];for(var b=0;b<d.length;b++){e.push(d[b].data.id)}Ext.Ajax.request({url:"/driver_relation/delete",method:"POST",params:{driver_group_id:a.currentDriverGroup,driver_id:e},success:function(f){var g=Ext.JSON.decode(f.responseText);if(g.success){a.searchGroupedDrivers();GreenFleet.msg(T("label.success"),g.msg)}else{Ext.MessageBox.alert(T("label.failure"),g.msg)}},failure:function(f){Ext.MessageBox.alert(T("label.failure"),f.responseText)}})})},searchAllDrivers:function(c){if(c){this.sub("all_drivers_grid").store.load()}else{this.sub("all_drivers_grid").store.clearFilter(true);var b=this.sub("all_drivers_id_filter").getValue();var a=this.sub("all_drivers_name_filter").getValue();if(b||a){this.sub("all_drivers_grid").store.filter([{property:"id",value:b},{property:"name",value:a}])}}},searchGroupedDrivers:function(){this.sub("grouped_drivers_pagingtoolbar").moveFirst()},buildDriverGroupList:function(a){return{xtype:"gridpanel",itemId:"grid",store:"DriverGroupStore",title:T("title.driver_group"),width:320,columns:[new Ext.grid.RowNumberer(),{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"id",text:T("label.group"),width:100},{dataIndex:"desc",text:T("label.desc"),width:220}]}},buildGroupedDriverList:function(a){return{xtype:"panel",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"gridpanel",itemId:"grouped_drivers_grid",store:"DriverByGroupStore",title:T("title.drivers_by_group"),flex:18.5,cls:"hIndexbarZero",selModel:new Ext.selection.CheckboxModel(),columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"id",text:T("label.id")},{dataIndex:"name",text:T("label.name")},{dataIndex:"division",text:T("label.division"),type:"string"},{dataIndex:"title",text:T("label.title"),type:"string"},{dataIndex:"social_id",text:T("label.social"),type:"string"},{dataIndex:"phone_no_1",text:T("label.phone_x",{x:1}),type:"string"},{dataIndex:"phone_no_2",text:T("label.phone_x",{x:2}),type:"string"}],bbar:{xtype:"pagingtoolbar",itemId:"grouped_drivers_pagingtoolbar",store:"DriverByGroupStore",cls:"pagingtoolbar",displayInfo:true,displayMsg:"Displaying drivers {0} - {1} of {2}",emptyMsg:"No drivers to display"}},{xtype:"panel",flex:1,layout:{type:"vbox",align:"center",pack:"center"},items:[{xtype:"button",itemId:"moveLeft",text:"<<"},{xtype:"label",margins:"5 0 5 0"},{xtype:"button",itemId:"moveRight",text:">>"}]},{xtype:"gridpanel",itemId:"all_drivers_grid",store:"DriverBriefStore",title:T("title.driver_list"),flex:10,cls:"hIndexbarZero",autoScroll:true,selModel:new Ext.selection.CheckboxModel(),columns:[{dataIndex:"key",text:"Key",hidden:true},{dataIndex:"image_clip",text:"Image",renderer:function(b){var c="<img src='";if(b){c+="download?blob-key="+b}else{c+="resources/image/bgVehicle.png"}c+="' width='80' height='80'/>";return c}},{dataIndex:"id",text:T("label.id")},{dataIndex:"name",text:T("label.name")}],tbar:[T("label.id"),{xtype:"textfield",name:"all_drivers_id_filter",itemId:"all_drivers_id_filter",hideLabel:true,width:70},T("label.name"),{xtype:"textfield",name:"all_drivers_name_filter",itemId:"all_drivers_name_filter",hideLabel:true,width:70}," ",{text:T("button.search"),itemId:"search_all_drivers"}," ",{text:T("button.reset"),itemId:"search_reset_all_drivers"}],bbar:{xtype:"pagingtoolbar",itemId:"all_drivers_pagingtoolbar",store:"DriverBriefStore",cls:"pagingtoolbar",displayInfo:true,displayMsg:"Displaying drivers {0} - {1} of {2}",emptyMsg:"No drivers to display"}}]}},buildDriverGroupForm:function(a){return{xtype:"form",itemId:"form",bodyPadding:10,cls:"hIndexbar",title:T("title.group_details"),height:170,defaults:{xtype:"textfield",anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true,itemId:"form_driver_group_key"},{name:"id",fieldLabel:T("label.group")},{name:"desc",fieldLabel:T("label.desc")},{xtype:"datefield",name:"updated_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")},{xtype:"datefield",name:"created_at",disabled:true,fieldLabel:T("label.updated_at"),format:F("datetime")}],dockedItems:[{xtype:"entity_form_buttons",confirmMsgSave:T("msg.confirm_save"),confirmMsgDelete:T("msg.confirm_delete"),loader:{fn:function(b){a.sub("grid").store.load(b)},scope:a}}]}}});Ext.define("GreenFleet.view.pm.Maintenance",{extend:"Ext.Container",alias:"widget.pm_maintenance",title:T("title.maintenance"),layout:{align:"stretch",type:"vbox"},initComponent:function(){var a=this;this.items=[{html:"<div class='listTitle'>"+T("title.maintenance")+"</div>"},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.zvehiclelist(a),{xtype:"container",flex:1,cls:"borderRightGray",layout:{align:"stretch",type:"vbox"},items:[this.zmaintenances]}]}],this.callParent();this.sub("vehicle_info").on("itemdblclick",function(d,c){var b=(selectionModel.lastSelected)?selectionModel.lastSelected.data.id:""});this.sub("vehicle_info").on("selectionchange",function(b,e,d){var c=(b.lastSelected)?b.lastSelected.data.id:"";a.sub("maintenance_grid").setTitle(T("title.maintenance_history")+"("+c+")");a.refresh_maintenance_grid(c)});this.sub("maintenance_grid").on("itemdblclick",function(c,b){a.popup_maint(b)});this.sub("id_filter").on("change",function(c,b){a.searchVehicles(false)});this.sub("reg_no_filter").on("change",function(c,b){a.searchVehicles(false)})},searchVehicles:function(c){var b=this.sub("vehicle_info").store;if(c){b.load()}else{b.clearFilter(true);var a=this.sub("id_filter").getValue();var d=this.sub("reg_no_filter").getValue();b.filter([{property:"id",value:a},{property:"registration_number",value:d}])}},zvehiclelist:function(a){return{xtype:"gridpanel",itemId:"vehicle_info",store:"VehicleImageBriefStore",title:T("title.vehicle_list"),width:300,autoScroll:true,startRepair:function(){alert("정비시작")},columns:[{dataIndex:"id",text:T("label.id"),width:100},{dataIndex:"registration_number",text:T("label.reg_no"),width:100},{dataIndex:"status",text:T("label.status"),}],tbar:[T("label.id"),{xtype:"textfield",name:"id_filter",itemId:"id_filter",width:65},T("label.reg_no"),{xtype:"textfield",name:"reg_no_filter",itemId:"reg_no_filter",width:70},{xtype:"button",text:T("button.search"),handler:function(b){b.up("pm_maintenance").searchVehicles(true)}}]}},zmaintenances:{xtype:"grid",itemId:"maintenance_grid",store:"RepairStore",cls:"hIndexbar",title:T("title.maintenance_history"),flex:1,columns:[{header:"Key",dataIndex:"key",hidden:true},{header:T("label.vehicle_id"),dataIndex:"vehicle_id",hidden:true},{header:T("label.repair_date"),dataIndex:"repair_date",xtype:"datecolumn",format:F("date")},{header:T("label.x_time",{x:T("label.repair")})+T("label.parentheses_x",{x:T("label.minute_s")}),dataIndex:"repair_time",},{header:T("label.next_repair_date"),dataIndex:"next_repair_date",xtype:"datecolumn",format:F("date")},{header:T("label.repair_mileage")+" (km)",dataIndex:"repair_mileage",width:120},{header:T("label.repair_man"),dataIndex:"repair_man"},{header:T("label.repair_shop"),dataIndex:"repair_shop"},{header:T("label.cost"),dataIndex:"cost"},{header:T("label.content"),dataIndex:"content",flex:1}],bbar:[{xtype:"tbfill"},{xtype:"button",text:T("button.add"),handler:function(a,b){var c=a.up("pm_maintenance");c.popup_maint()}}]},refresh_maintenance_grid:function(a){var b=this.sub("maintenance_grid").store;b.getProxy().extraParams.vehicle_id=a;b.load()},popup_maint:function(b){var c=this.sub("vehicle_info").getSelectionModel();var a=(c.lastSelected)?c.lastSelected.data.id:"";var e=new Date();e.setMilliseconds(e.getMilliseconds()+(1000*60*60*24*30*3));if(!b){b={data:{vehicle_id:a,repair_date:new Date(),next_repair_date:e}}}var d=this.maintwin(this,b);d.show()},maintwin:function(b,a){return new Ext.Window({title:T("title.add_repair"),modal:true,listeners:{show:function(d,c){d.down("form").loadRecord(a)}},items:[{xtype:"form",itemId:"repair_win",bodyPadding:10,cls:"hIndexbar",width:500,defaults:{xtype:"textfield",anchor:"100%"},items:[{xtype:"fieldset",title:T("label.vehicle"),defaultType:"textfield",layout:"anchor",collapsible:true,padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{name:"key",fieldLabel:"Key",hidden:true},{itemId:"vehicle_id",name:"vehicle_id",fieldLabel:T("label.vehicle_id")}]},{xtype:"fieldset",title:T("label.repair"),defaultType:"textfield",layout:"anchor",padding:"10,5,5,5",defaults:{anchor:"100%"},items:[{name:"repair_date",fieldLabel:T("label.repair_date"),xtype:"datefield",format:F("date")},{name:"repair_time",fieldLabel:T("label.x_time",{x:T("label.repair")})+T("label.parentheses_x",{x:T("label.minute_s")}),xtype:"numberfield"},{name:"next_repair_date",fieldLabel:T("label.next_repair_date"),xtype:"datefield",format:F("date")},{xtype:"numberfield",name:"repair_mileage",fieldLabel:T("label.repair_mileage")+" (km)",minValue:0,step:1000},{name:"repair_man",fieldLabel:T("label.repair_man")},{name:"repair_shop",fieldLabel:T("label.repair_shop")},{xtype:"numberfield",name:"cost",fieldLabel:T("label.cost"),minValue:0,step:1000},{xtype:"textarea",name:"content",fieldLabel:T("label.content")},{name:"comment",xtype:"textarea",fieldLabel:T("label.comment")}]}]}],buttons:[{text:T("button.save"),handler:function(){var d=this.up("window");var c=d.down("form");c.getForm().submit({url:"/repair/save",submitEmptyText:false,waitMsg:T("msg.saving"),success:function(e,f){if(f.result.success){GreenFleet.msg(T("label.success"),T("msg.processed_successfully"));b.refresh_maintenance_grid(e.getRecord().data.vehicle_id);d.close()}else{Ext.Msg.alert(T("label.failure"),f.result.msg)}},failure:function(e,f){switch(f.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert(T("label.failure"),T("msg.invalid_form_values"));break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert(T("label.failure"),T("msg.failed_to_ajax"));break;case Ext.form.action.Action.SERVER_INVALID:Ext.Msg.alert(T("label.failure"),f.result.msg)}}})}},{text:T("button.cancel"),handler:function(){this.up("window").close()}}]})}});Ext.define("GreenFleet.view.management.Schedule",{extend:"Ext.container.Container",alias:"widget.management_schedule",title:T("titla.schedule"),entityUrl:"task",importUrl:"task/import",afterImport:function(){this.sub("grid").store.load();this.sub("form").getForm().reset()},layout:{align:"stretch",type:"vbox"},items:{html:"<div class='listTitle'>"+T("title.schedule")+"</div>"},initComponent:function(){var b=this;this.callParent(arguments);var a=this.buildCalendar(b);this.add(a)},buildCalendar:function(a){var b=Ext.getStore("CalendarStore");var c=Ext.getStore("EventStore");c.load();var d=Ext.create("Extensible.calendar.CalendarPanel",{calendarStore:b,eventStore:c,flex:1});return d}});Ext.define("GreenFleet.view.overview.Overview",{extend:"Ext.Container",alias:"widget.overview",id:"overview",layout:{type:"border",padding:"0 5 5 5"},initComponent:function(){this.items=[{id:"overview-header",region:"north",xtype:"box",cls:"pageTitle",html:"<h1>"+T("menu.overview")+"</h1>",height:35},{xtype:"container",region:"center",layout:"border",items:[this.zwest,this.zportal()]}];this.callParent(arguments);var a=this},zwest:{id:"overview-vehicle-group",xtype:"grid_vg1_portlet",region:"west",animCollapse:true,width:280,minWidth:150,maxWidth:310,split:true,collapsible:true},zeast:{id:"overview-driver-group",xtype:"grid_dg1_portlet",region:"east",animCollapse:true,width:280,minWidth:150,maxWidth:310,split:true,collapsible:true},zportal:function(){return{id:"overview-portal",xtype:"portalpanel",region:"center",items:[{id:"col-1",items:[{id:"portlet-1-1",title:T("title.running_distance"),tools:this.getTools(),height:230,items:{xtype:"chart_v1_portlet",height:230,chartType:"mileage"},listeners:{close:Ext.bind(this.onPortletClose,this)}},{id:"portlet-1-2",title:T("title.schedule"),tools:this.getTools(),height:300,items:{xtype:"calendar_portlet",height:300},listeners:{close:Ext.bind(this.onPortletClose,this)}}]},{id:"col-2",items:[{id:"portlet-2-1",title:T("title.vehicle_health"),tools:this.getTools(),height:230,items:{xtype:"chart_v1_portlet",height:230,chartType:"health"},listeners:{close:Ext.bind(this.onPortletClose,this)}},{id:"portlet-2-2",title:T("portlet.latest_incident_x",{x:"5"}),tools:this.getTools(),height:300,items:{xtype:"grid_i1_portlet",height:300},listeners:{close:Ext.bind(this.onPortletClose,this)}}]},{id:"col-3",items:[{id:"portlet-3-1",title:T("title.vehicle_age"),tools:this.getTools(),height:230,items:{xtype:"chart_v1_portlet",height:230,chartType:"age"},listeners:{close:Ext.bind(this.onPortletClose,this)}},{id:"portlet-3-2",title:T("portlet.upcomming_x_replacement",{x:T("label.consumable_item")}),tools:this.getTools(),items:{xtype:"grid_c1_portlet",height:300},listeners:{close:Ext.bind(this.onPortletClose,this)}}]}]}},getTools:function(){return[{xtype:"tool",type:"gear",handler:function(d,c,b,a){var f=b.ownerCt;f.items.items[0].reload()}}]},onPortletClose:function(a){GreenFleet.msg("Close","'"+a.title+"' was removed")}});Ext.define("GreenFleet.view.portlet.Portlet",{extend:"Ext.panel.Panel",alias:"widget.portlet",layout:"fit",anchor:"100%",frame:true,closable:true,collapsible:true,animCollapse:true,draggable:{moveOnDrag:false},cls:"x-portlet",doClose:function(){if(!this.closing){this.closing=true;this.el.animate({opacity:0,callback:function(){this.fireEvent("close",this);this[this.closeAction]()},scope:this})}}});Ext.define("GreenFleet.view.portlet.PortalPanel",{extend:"Ext.panel.Panel",alias:"widget.portalpanel",cls:"x-portal",bodyCls:"x-portal-body",defaultType:"portalcolumn",autoScroll:true,manageHeight:false,initComponent:function(){var a=this;this.layout={type:"column"};this.callParent();this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},beforeLayout:function(){var c=this.layout.getLayoutItems(),b=c.length,a=["x-portal-column-first","x-portal-column-last"],d,f,e;for(d=0;d<b;d++){f=c[d];f.columnWidth=1/b;e=(d==b-1);if(!d){if(e){f.addCls(a)}else{f.addCls("x-portal-column-first");f.removeCls("x-portal-column-last")}}else{if(e){f.addCls("x-portal-column-last");f.removeCls("x-portal-column-first")}else{f.removeCls(a)}}}return this.callParent(arguments)},initEvents:function(){this.callParent();this.dd=Ext.create("GreenFleet.view.portlet.PortalDropZone",this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}this.callParent()}});Ext.define("GreenFleet.view.portlet.PortalColumn",{extend:"Ext.container.Container",alias:"widget.portalcolumn",layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.define("GreenFleet.view.portlet.PortalDropZone",{extend:"Ext.dd.DropTarget",constructor:function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);this.superclass.constructor.call(this,a.body,b);a.body.ddScrollConfig=this.ddScrollConfig},ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(a,f,d,b,h,g){return{portal:this.portal,panel:d.panel,columnIndex:b,column:h,position:g,data:d,source:a,rawEvent:f,status:this.dropAllowed}},notifyOver:function(u,t,v){var d=t.getXY(),a=this.portal,p=u.proxy;if(!this.grid){this.grid=this.getGrid()}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b}else{if(this.lastCW!=b){this.lastCW=b;this.grid=this.getGrid()}}var o=0,c=0,n=this.grid.columnX,q=n.length,m=false;for(q;o<q;o++){c=n[o].x+n[o].w;if(d[0]<c){m=true;break}}if(!m){o--}var i,g=0,r=0,l=false,k=a.items.getAt(o),s=k.items.items,j=false;q=s.length;for(q;g<q;g++){i=s[g];r=i.el.getHeight();if(r===0){j=true}else{if((i.el.getY()+(r/2))>d[1]){l=true;break}}}g=(l&&i?g:k.items.getCount())+(j?-1:0);var f=this.createEvent(u,t,v,o,k,g);if(a.fireEvent("validatedrop",f)!==false&&a.fireEvent("beforedragover",f)!==false){p.getProxy().setWidth("auto");if(i){u.panelProxy.moveProxy(i.el.dom.parentNode,l?i.el.dom:null)}else{u.panelProxy.moveProxy(k.el.dom,null)}this.lastPos={c:k,col:o,p:j||(l&&i)?g:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",f);return f.status}else{return f.status}},notifyOut:function(){delete this.grid},notifyDrop:function(l,h,g){delete this.grid;if(!this.lastPos){return}var j=this.lastPos.c,f=this.lastPos.col,k=this.lastPos.p,a=l.panel,b=this.createEvent(l,h,g,f,j,k!==false?k:j.items.getCount());if(this.portal.fireEvent("validatedrop",b)!==false&&this.portal.fireEvent("beforedrop",b)!==false){Ext.suspendLayouts();a.el.dom.style.display="";l.panelProxy.hide();l.proxy.hide();if(k!==false){j.insert(k,a)}else{j.add(a)}Ext.resumeLayouts(true);this.portal.fireEvent("drop",b);var m=this.scrollPos.top;if(m){var i=this.portal.body.dom;setTimeout(function(){i.scrollTop=m},10)}}delete this.lastPos;return true},getGrid:function(){var a=this.portal.body.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.body);GreenFleet.view.portlet.PortalDropZone.superclass.unreg.call(this)}});Ext.define("GreenFleet.view.portlet.GridI1Portlet",{extend:"Ext.grid.Panel",alias:"widget.grid_i1_portlet",stripeRows:true,columnLines:true,store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"datetime",type:"date",dateFormat:"time"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"}],data:[]}),columns:[{text:T("label.datetime"),sortable:true,dataIndex:"datetime",xtype:"datecolumn",format:F("datetime"),width:110},{text:T("label.vehicle"),width:70,sortable:true,dataIndex:"vehicle_id"},{text:T("label.driver"),width:70,sortable:true,dataIndex:"driver_id"}],initComponent:function(){var a=this;this.callParent(arguments);this.reload()},reload:function(){var a=this;this.setLoading(true);Ext.Ajax.request({url:"/incident",method:"GET",params:{page:1,limit:5},success:function(c){var d=Ext.JSON.decode(c.responseText);if(d.success){var b=d.items;a.store.loadData(b);Ext.defer(function(){a.setLoading(false)},100)}else{Ext.MessageBox.alert(T("label.failure"),d.msg)}},failure:function(b){Ext.MessageBox.alert(T("label.failure"),b.responseText)}})}});Ext.define("GreenFleet.view.portlet.GridVG1Portlet",{extend:"Ext.panel.Panel",alias:"widget.grid_vg1_portlet",layout:{type:"accordion",animate:true},animCollapse:true,split:true,collapsible:true,year:null,month:null,initComponent:function(){this.callParent(arguments);if(!this.year){var a=new Date();this.year=a.getFullYear();this.month=a.getMonth()+1}this.title="차량 그룹별 운행 정보 ["+this.year+"-"+this.month+"]";this.addVehicleGroupTab(this)},addVehicleGroupTab:function(a){Ext.getStore("VehicleGroupStore").load({scope:a,callback:function(c,b,d){Ext.each(c,function(f){var e=0;var g={items:a.addVehicleGroupContent(a,f),title:f.data.desc,autoScroll:true,border:true,iconCls:"nav",isLoaded:false,seqOrder:e++,listeners:{expand:function(h){if(!h.isLoaded){a.loadData(a,h.items.items[0].store,f);h.isLoaded=true}}}};a.add(g);if(e==1){a.loadData(a,g.items.store,f);g.isLoaded=true}})}})},addVehicleGroupContent:function(a,b){var c={xtype:"gridpanel",store:Ext.create("Ext.data.Store",{fields:["vehicle_id","run_time","run_dist","consmpt"],data:[]}),stripeRows:true,columnLines:true,columns:[{text:T("label.vehicle"),width:60,sortable:true,dataIndex:"vehicle_id"},{text:T("label.run_time"),width:70,sortable:true,renderer:function(d){return d+" ("+T("label.minute_s")+")"},dataIndex:"run_time"},{text:T("label.run_dist"),width:70,sortable:true,renderer:function(d){return d+" (km)"},dataIndex:"run_dist"},{text:T("label.fuel_consumption"),width:70,sortable:true,renderer:function(d){return d+" (l)"},dataIndex:"consmpt"}]};return c},loadData:function(a,c,b){Ext.Ajax.request({url:"/report/vehicle_group",method:"GET",params:{group_id:b.data.id,report_type:"run_summary",year:a.year,month:a.month},success:function(d){var e=Ext.JSON.decode(d.responseText);if(e.success){var g=e.items;var f={vehicle_id:"Toatl",run_time:0,run_dist:0,consmpt:0};Ext.each(g,function(h){f.run_time+=h.run_time;f.run_dist+=h.run_dist;f.consmpt+=h.consmpt});g.push(f);c.loadData(g)}else{Ext.MessageBox.alert(T("label.failure"),e.msg)}},failure:function(d){Ext.MessageBox.alert(T("label.failure"),d.responseText)}})}});Ext.define("GreenFleet.view.portlet.GridDG1Portlet",{extend:"Ext.panel.Panel",alias:"widget.grid_dg1_portlet",title:"운전자 그룹별 정보",layout:{type:"accordion",animate:true},animCollapse:true,split:true,collapsible:true,initComponent:function(){this.callParent(arguments);this.addDriverGroupTab(this)},addDriverGroupTab:function(a){Ext.getStore("DriverGroupStore").load({scope:a,callback:function(c,b,d){Ext.each(c,function(e){a.add({html:a.addDriverGroupContent(a,e),title:e.data.desc,autoScroll:true,border:true,iconCls:"nav"})})}})},addDriverGroupContent:function(a,b){return"<div>"+b.data.desc+" 그룹 차량 운행 정보 서머리</div>"}});Ext.define("GreenFleet.view.portlet.ChartV1Portlet",{extend:"Ext.panel.Panel",alias:"widget.chart_v1_portlet",chartType:"health",chartPanel:null,initComponent:function(){var a=this;this.callParent(arguments);this.chartPanel=this.healthChart();this.add(this.chartPanel);this.reload()},reload:function(){var a=this;this.setLoading(true);Ext.Ajax.request({url:"/dashboard/health/vehicle",method:"GET",params:{health_type:a.chartType},success:function(c){var d=Ext.JSON.decode(c.responseText);if(d.success){var b=d.items;var e=a.findRecord(b,a.chartType);a.chartPanel.items[0].store.loadData(e.summary);Ext.defer(function(){a.setLoading(false)},100)}else{Ext.MessageBox.alert(T("label.failure"),d.msg)}},failure:function(b){Ext.MessageBox.alert(T("label.failure"),b.responseText)}})},findRecord:function(a,c){for(var b=0;b<a.length;b++){if(a[b].name==c){return a[b]}}return null},healthChart:function(){var a=this;return{xtype:"panel",cls:"paddingPanel healthDashboard",height:a.height-5,items:[{xtype:"chart",animate:true,store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"name",type:"string",convert:function(c,b){if(a.chartType=="health"){return T("label."+c)}else{return c}}},"value"],data:[]}),width:245,height:a.height-20,shadow:false,legend:{position:"bottom",labelFont:"6px",boxStroke:"#cfcfcf"},insetPadding:10,theme:"Base:gradients",series:[{type:"pie",field:"value",showInLegend:true,donut:false,tips:{trackMouse:true,width:140,height:25,renderer:function(g,f){var e=0;a.chartPanel.items[0].store.each(function(h){e+=h.get("value")});var b=g.get("name");var d=g.get("value");var c=Math.round(d/e*100);this.setTitle(b+" : "+d+"("+c+"%)")}},highlight:{segment:{margin:5}},label:{field:"name",display:"rotate",contrast:true,font:"10px Arial"}}]}]}}});Ext.define("GreenFleet.view.portlet.ChartV2Portlet",{extend:"Ext.panel.Panel",alias:"widget.chart_v2_portlet",chartType:"mileage",chartPanel:null,store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"name",type:"string",convert:function(b,a){return T("label."+b)}},"value"],data:[]}),initComponent:function(){var a=this;this.callParent(arguments);this.chartPanel=this.healthChart();this.add(this.chartPanel);this.reload()},reload:function(){var a=this;this.setLoading(true);Ext.Ajax.request({url:"/dashboard/health/vehicle",method:"GET",params:{health_type:a.chartType},success:function(c){alert("instance-id : "+a.id+", chart-id "+a.chartPanel.id+", chart type : "+a.chartType);var d=Ext.JSON.decode(c.responseText);if(d.success){if(d.health_type!=a.chartType){return}var b=d.items;var e=a.findRecord(b,a.chartType);a.store.loadData(e.summary);Ext.defer(function(){a.setLoading(false)},100)}else{Ext.MessageBox.alert(T("label.failure"),d.msg)}},failure:function(b){Ext.MessageBox.alert(T("label.failure"),b.responseText)}})},findRecord:function(a,c){for(var b=0;b<a.length;b++){if(a[b].name==c){return a[b]}}return null},healthChart:function(){var a=this;return{xtype:"panel",cls:"paddingPanel healthDashboard",height:a.height-5,items:[{xtype:"chart",animate:true,store:this.store,width:245,height:a.height-20,shadow:false,legend:{position:"bottom",labelFont:"6px",boxStroke:"#cfcfcf"},insetPadding:10,theme:"Base:gradients",series:[{type:"pie",field:"value",showInLegend:true,donut:false,tips:{trackMouse:true,width:140,height:25,renderer:function(g,f){var e=0;a.store.each(function(h){e+=h.get("value")});var b=g.get("name");var d=g.get("value");var c=Math.round(d/e*100);this.setTitle(b+" : "+d+"("+c+"%)")}},highlight:{segment:{margin:5}},label:{field:"name",display:"rotate",contrast:true,font:"10px Arial"}}]}]}}});Ext.define("GreenFleet.view.portlet.CalendarPortlet",{extend:"Ext.panel.Panel",alias:"widget.calendar_portlet",layout:{align:"stretch",type:"vbox"},initComponent:function(){var b=this;this.callParent(arguments);var a=this.buildCalendar(b);this.add(a)},buildCalendar:function(a){var b=Ext.getStore("CalendarStore");var c=Ext.getStore("EventStore");c.load();var d=Ext.create("Extensible.calendar.CalendarPanel",{calendarStore:b,eventStore:c,flex:1,readOnly:true,showDayView:false,showMultiDayView:false,showMonthView:false,showMultiWeekView:false});return d}});Ext.define("GreenFleet.view.portlet.GridC1Portlet",{extend:"Ext.grid.Panel",alias:"widget.grid_c1_portlet",store:Ext.create("Ext.data.ArrayStore",{fields:[{name:"vehicle_id",type:"string"},{name:"consumable_item",type:"string"},{name:"health_rate",type:"float"},{name:"status",type:"string"}],data:[]}),stripeRows:true,columnLines:true,columns:[{text:T("label.vehicle"),width:50,sortable:true,dataIndex:"vehicle_id"},{text:T("label.consumable_item"),width:100,sortable:true,dataIndex:"consumable_item"},{text:T("label.health_rate"),width:60,sortable:true,dataIndex:"health_rate",renderer:function(a){return(Ext.util.Format.number(a*100,"00"))+("%")}},{text:T("label.status"),width:70,sortable:true,dataIndex:"status",renderer:function(a){return T("label."+a)}}],initComponent:function(){var a=this;this.callParent(arguments);this.reload()},reload:function(){var a=this;this.setLoading(true);Ext.Ajax.request({url:"/vehicle_consumable/by_health_rate",method:"GET",params:{health_rate:0.98},success:function(c){var d=Ext.JSON.decode(c.responseText);if(d.success){var b=d.items;a.store.loadData(b);Ext.defer(function(){a.setLoading(false)},100)}else{Ext.MessageBox.alert(T("label.failure"),d.msg)}},failure:function(b){Ext.MessageBox.alert(T("label.failure"),b.responseText)}})},});Ext.define("GreenFleet.store.CompanyStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"name",type:"string"},{name:"desc",type:"string"},{name:"timezone",type:"int"},{name:"language",type:"string"},{name:"image_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"company",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.UserStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:250,fields:[{name:"key",type:"string"},{name:"email",type:"string"},{name:"company",type:"string"},{name:"name",type:"string"},{name:"admin",type:"boolean"},{name:"enabled",type:"boolean"},{name:"language",type:"string"},{name:"image_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"user",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.CodeGroupStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"group",type:"string"},{name:"desc",type:"string"}],data:[{group:"V-Type1",desc:"Type 1 of Vehicles"},{group:"V-Type2",desc:"Type 2 of Vehicles"},{group:"V-Type3",desc:"Type 3 of Vehicles"},{group:"V-Size",desc:"Size of Vehicles"},{group:"V-Maker",desc:"Vehicle Makers"},{group:"V-Model",desc:"Vehicle Model"},{group:"V-BirthYear",desc:"Vehicle Birth-Years"},{group:"V-Seat",desc:"Count of Seat of Vehicle"},{group:"V-Fuel",desc:"Types of Fuel of Vehicle"},{group:"ResvPurpose",desc:"Type of Reservation Purpose"},{group:"ResvStatus",desc:"Status of Reservation"},{group:"EmployeeTitle",desc:"Titles of Employee"},{group:"Division",desc:"Devisions of Company"},{group:"ReplacementUnit",desc:"Unit of Consumables Replacement Cycle"},{group:"AlarmEventType",desc:"Alarm Event Type"},{group:"AlarmType",desc:"Alarm Type"},{group:"LocationEvent",desc:"Location Event"}]});Ext.define("GreenFleet.store.CodeStore",{extend:"Ext.data.Store",autoLoad:true,pageSize:10000,fields:[{name:"key",type:"string"},{name:"group",type:"string"},{name:"code",type:"string"},{name:"desc",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"code",reader:{type:"json",root:"items",totalProperty:"total"}},groupField:"group",groupDir:"DESC",substore:function(a){if(!this.substores){return null}return this.substores[a]},listeners:{load:function(b,a,c){if(!c){return}b.substores={};groups=b.getGroups();Ext.each(groups,function(d){b.substores[d.name]=Ext.create("Ext.data.Store",{model:"GreenFleet.model.Code",data:d.children})})}}});Ext.define("GreenFleet.store.VehicleStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:1000,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"manufacturer",type:"string"},{name:"fuel_type",type:"string"},{name:"vehicle_type",type:"string"},{name:"birth_year",type:"int"},{name:"ownership_type",type:"string"},{name:"status",type:"string"},{name:"health_status",type:"string"},{name:"image_clip",type:"string"},{name:"total_distance",type:"float"},{name:"remaining_fuel",type:"float"},{name:"lattitude",type:"float"},{name:"driver_id",type:"string"},{name:"terminal_id",type:"string"},{name:"longitude",type:"float"},{name:"location",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"vehicle",reader:{type:"json",root:"items",totalProperty:"total",successProperty:"success"}}});Ext.define("GreenFleet.store.VehicleMapStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:1000,fields:[{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"status",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"location",type:"string"}],proxy:{type:"ajax",url:"vehicle",extraParams:{select:["id","registration_number","status","driver_id","lattitude","longitude"]},reader:{type:"json",root:"items",totalProperty:"total"}},listeners:{load:function(a,b,c){if(c){Ext.getStore("VehicleFilteredStore").loadData(b)}}}});Ext.define("GreenFleet.store.VehicleFilteredStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:1000,fields:[{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"status",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"location",type:"string"}]});Ext.define("GreenFleet.store.VehicleInfoStore",{extend:"GreenFleet.store.VehicleStore"});Ext.define("GreenFleet.store.VehicleBriefStore",{extend:"Ext.data.Store",autoLoad:true,pageSize:1000,fields:[{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"image_clip",type:"string"}],proxy:{type:"ajax",url:"vehicle",extraParams:{select:["id","registration_number","image_clip"]},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.DriverStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:1000,fields:[{name:"key",type:"string"},{name:"name",type:"string"},{name:"id",type:"string"},{name:"division",type:"string"},{name:"title",type:"string"},{name:"social_id",type:"string"},{name:"phone_no_1",type:"string"},{name:"phone_no_2",type:"string"},{name:"image_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"driver",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.DriverBriefStore",{extend:"Ext.data.Store",autoLoad:true,pageSize:1000,fields:[{name:"name",type:"string"},{name:"id",type:"string"},{name:"image_clip",type:"string"}],proxy:{type:"ajax",url:"driver",extraParams:{select:["id","name","image_clip"]},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.ReservationStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"reserved_date",type:"date",dateFormat:"time"},{name:"driver_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"vehicle_type",type:"string"},{name:"delivery_place",type:"string"},{name:"destination",type:"string"},{name:"purpose",type:"string"},{name:"status",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"reservation",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.IncidentStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:25,fields:[{name:"key",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"velocity",type:"float"},{name:"impulse_abs",type:"float"},{name:"impulse_x",type:"float"},{name:"impulse_y",type:"float"},{name:"impulse_z",type:"float"},{name:"impulse_threshold",type:"float"},{name:"obd_connected",type:"boolean"},{name:"confirm",type:"boolean"},{name:"engine_temp",type:"float"},{name:"engine_temp_threshold",type:"float"},{name:"video_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:"incident",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.IncidentByVehicleStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:25,fields:[{name:"key",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"velocity",type:"float"},{name:"impulse_abs",type:"float"},{name:"impulse_x",type:"float"},{name:"impulse_y",type:"float"},{name:"impulse_z",type:"float"},{name:"impulse_threshold",type:"float"},{name:"obd_connected",type:"boolean"},{name:"confirm",type:"boolean"},{name:"engine_temp",type:"float"},{name:"engine_temp_threshold",type:"float"},{name:"video_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:"incident",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.IncidentViewStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:25,fields:[{name:"key",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"velocity",type:"float"},{name:"impulse_abs",type:"float"},{name:"impulse_x",type:"float"},{name:"impulse_y",type:"float"},{name:"impulse_z",type:"float"},{name:"impulse_threshold",type:"float"},{name:"obd_connected",type:"boolean"},{name:"confirm",type:"boolean"},{name:"engine_temp",type:"float"},{name:"engine_temp_threshold",type:"float"},{name:"video_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:"incident",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.IncidentLogStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:1000,fields:[{name:"key",type:"string"},{name:"incident",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"velocity",type:"float"},{name:"accelate_x",type:"float"},{name:"accelate_y",type:"float"},{name:"accelate_z",type:"float"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"ASC"}],proxy:{type:"ajax",url:"incident_log",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.TrackStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"velocity",type:"float"},{name:"updated_at",type:"date",dateFormat:"time"},{name:"created_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:"track",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.VehicleTypeStore",{extend:"Ext.data.Store",storeId:"vehicletype_store",fields:["name","desc"],data:[{name:"A",desc:"A 800-"},{name:"B",desc:"B 800~1000"},{name:"C",desc:"C 1000~1500"},{name:"D",desc:"D 1500~1800"},{name:"E",desc:"E 1800~2000"},{name:"F",desc:"F 2000+"}]});Ext.define("GreenFleet.store.OwnershipStore",{extend:"Ext.data.Store",storeId:"ownership_store",fields:["name","desc"],data:[{name:"A",desc:"A Self"},{name:"B",desc:"B Company"},{name:"C",desc:"C Rent"}]});Ext.define("GreenFleet.store.VehicleStatusStore",{extend:"Ext.data.Store",storeId:"vehiclestatus_store",fields:["status","desc"],data:[{status:"",desc:"-"},{status:"Running",desc:"Running"},{status:"Incident",desc:"Incident"},{status:"Idle",desc:"Idle"},{status:"Maint",desc:"Maintenance"}]});Ext.define("GreenFleet.store.CheckinDataStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"terminal_id",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"distance",type:"float"},{name:"running_time",type:"integer"},{name:"less_than_10km",type:"int"},{name:"less_than_20km",type:"int"},{name:"less_than_30km",type:"int"},{name:"less_than_40km",type:"int"},{name:"less_than_50km",type:"int"},{name:"less_than_60km",type:"int"},{name:"less_than_70km",type:"int"},{name:"less_than_80km",type:"int"},{name:"less_than_90km",type:"int"},{name:"less_than_100km",type:"int"},{name:"less_than_110km",type:"int"},{name:"less_than_120km",type:"int"},{name:"less_than_130km",type:"int"},{name:"less_than_140km",type:"int"},{name:"less_than_150km",type:"int"},{name:"less_than_160km",type:"int"},{name:"engine_start_time",type:"date",dateFormat:"time"},{name:"engine_end_time",type:"date",dateFormat:"time"},{name:"average_speed",type:"float"},{name:"max_speed",type:"int"},{name:"fuel_consumption",type:"float"},{name:"fuel_efficiency",type:"float"},{name:"sudden_accel_count",type:"int"},{name:"sudden_brake_count",type:"int"},{name:"idle_time",type:"int"},{name:"eco_driving_time",type:"int"},{name:"over_speed_time",type:"int"},{name:"co2_emissions",type:"float"},{name:"max_cooling_water_temp",type:"float"},{name:"avg_battery_volt",type:"float"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:"checkin_data",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.TrackByVehicleStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"number"},{name:"longitude",type:"number"},{name:"created_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:"track",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.RecentIncidentStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:5,fields:[{name:"key",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lattitude",type:"float"},{name:"longitude",type:"float"},{name:"velocity",type:"float"},{name:"impulse_abs",type:"float"},{name:"impulse_x",type:"float"},{name:"impulse_y",type:"float"},{name:"impulse_z",type:"float"},{name:"impulse_threshold",type:"float"},{name:"obd_connected",type:"boolean"},{name:"confirm",type:"boolean"},{name:"engine_temp",type:"float"},{name:"engine_temp_threshold",type:"float"},{name:"video_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:"incident",extraParams:{confirm:false},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.TerminalStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:1000,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"serial_no",type:"string"},{name:"buying_date",type:"date",dateFormat:"time"},{name:"comment",type:"string"},{name:"image_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"terminal",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.TerminalBriefStore",{extend:"Ext.data.Store",autoLoad:true,fields:[{name:"id",type:"string"},{name:"serial_no",type:"string"}],proxy:{type:"ajax",url:"terminal",extraParams:{select:["id","serial_no"]},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.TimeZoneStore",{extend:"Ext.data.Store",fields:["value","display"],data:[{value:-12,display:"(GMT -12:00) Eniwetok, Kwajalein"},{value:-11,display:"(GMT -11:00) Midway Island, Samoa"},{value:-10,display:"(GMT -10:00) Hawaii"},{value:-9,display:"(GMT -9:00) Alaska"},{value:-8,display:"(GMT -8:00) Pacific Time (US &amp; Canada)"},{value:-7,display:"(GMT -7:00) Mountain Time (US &amp; Canada)"},{value:-6,display:"(GMT -6:00) Central Time (US &amp; Canada), Mexico City"},{value:-5,display:"(GMT -5:00) Eastern Time (US &amp; Canada), Bogota, Lima"},{value:-4,display:"(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz"},{value:-3.5,display:"(GMT -3:30) Newfoundland"},{value:-3,display:"(GMT -3:00) Brazil, Buenos Aires, Georgetown"},{value:-2,display:"(GMT -2:00) Mid-Atlantic"},{value:-1,display:"(GMT -1:00 hour) Azores, Cape Verde Islands"},{value:0,display:"(GMT) Western Europe Time, London, Lisbon, Casablanca"},{value:1,display:"(GMT +1:00 hour) Brussels, Copenhagen, Madrid, Paris"},{value:2,display:"(GMT +2:00) Kaliningrad, South Africa"},{value:3,display:"(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg"},{value:3.5,display:"(GMT +3:30) Tehran"},{value:4,display:"(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi"},{value:4.5,display:"(GMT +4:30) Kabul"},{value:5,display:"(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent"},{value:5.5,display:"(GMT +5:30) Bombay, Calcutta, Madras, New Delhi"},{value:5.75,display:"(GMT +5:45) Kathmandu"},{value:6,display:"(GMT +6:00) Almaty, Dhaka, Colombo"},{value:7,display:"(GMT +7:00) Bangkok, Hanoi, Jakarta"},{value:8,display:"(GMT +8:00) Beijing, Perth, Singapore, Hong Kong"},{value:9,display:"(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk"},{value:9.5,display:"(GMT +9:30) Adelaide, Darwin"},{value:10,display:"(GMT +10:00) Eastern Australia, Guam, Vladivostok"},{value:11,display:"(GMT +11:00) Magadan, Solomon Islands, New Caledonia"},{value:12,display:"(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka"}]});Ext.define("GreenFleet.store.LanguageCodeStore",{extend:"Ext.data.Store",fields:[{name:"value",type:"string"},{name:"display",type:"string"}],data:[{value:"en",display:T("language.en")},{value:"ko",display:T("language.ko")},{value:"cn",display:T("language.cn")}]});Ext.define("GreenFleet.store.VehicleGroupStore",{extend:"Ext.data.Store",autoLoad:true,pageSize:10,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"desc",type:"string"},{name:"vehicles",type:"auto"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"vehicle_group",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.VehicleByGroupStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:10,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"manufacturer",type:"string"},{name:"vehicle_type",type:"string"},{name:"birth_year",type:"int"},{name:"ownership_type",type:"string"},{name:"status",type:"string"},{name:"total_distance",type:"float"}],proxy:{type:"ajax",url:"vehicle_group/vehicles",reader:{type:"json",root:"items",totalProperty:"total",successProperty:"success"}}});Ext.define("GreenFleet.store.VehicleImageBriefStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:1000,fields:[{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"status",type:"string"},{name:"image_clip",type:"string"}],proxy:{type:"ajax",url:"vehicle",extraParams:{select:["id","registration_number","status","image_clip"]},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.ConsumableCodeStore",{extend:"Ext.data.Store",storeId:"consumable_code_store",fields:[{name:"key",type:"string"},{name:"name",type:"string"},{name:"repl_unit",type:"string"},{name:"fst_repl_mileage",type:"int"},{name:"fst_repl_time",type:"int"},{name:"repl_mileage",type:"int"},{name:"repl_time",type:"int"},{name:"desc",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],pageSize:1000,proxy:{type:"ajax",url:"consumable_code",extraParams:{},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.VehicleConsumableStore",{extend:"Ext.data.Store",storeId:"vehicle_consumable_store",fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"consumable_item",type:"string"},{name:"repl_unit",type:"string"},{name:"repl_mileage",type:"int"},{name:"repl_time",type:"int"},{name:"last_repl_date",type:"date",dateFormat:"time"},{name:"miles_last_repl",type:"int"},{name:"miles_since_last_repl",type:"int"},{name:"next_repl_mileage",type:"int"},{name:"next_repl_date",type:"date",dateFormat:"time"},{name:"accrued_cost",type:"float"},{name:"health_rate",type:"float"},{name:"status",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],pageSize:1000,proxy:{type:"ajax",url:"vehicle_consumable",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.ConsumableHistoryStore",{extend:"Ext.data.Store",storeId:"consumable_history_store",fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"consumable_item",type:"string"},{name:"last_repl_date",type:"date",dateFormat:"time"},{name:"miles_last_repl",type:"int"},{name:"worker",type:"string"},{name:"component",type:"string"},{name:"cost",type:"int"},{name:"comment",type:"string"},{name:"created_at",type:"date",dateFormat:"time"}],pageSize:1000,proxy:{type:"ajax",url:"vehicle_consumable/history",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.RepairStore",{extend:"Ext.data.Store",storeId:"repair_store",fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"repair_date",type:"date",dateFormat:"time"},{name:"repair_time",type:"int",},{name:"next_repair_date",type:"date",dateFormat:"time"},{name:"repair_mileage",type:"int"},{name:"repair_man",type:"string"},{name:"repair_shop",type:"string"},{name:"content",type:"string"},{name:"cost",type:"int"},{name:"comment",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],pageSize:1000,sorters:[{property:"repair_date",direction:"DESC"}],proxy:{type:"ajax",url:"repair",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.VehicleByHealthStore",{extend:"Ext.data.Store",autoLoad:true,pageSize:1000,fields:[{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"vehicle_type",type:"string"},{name:"birth_year",type:"int"},{name:"total_distance",type:"float"},{name:"health_status",type:"string"}],sorters:[{property:"id",direction:"ASC"}],proxy:{type:"ajax",url:"vehicle/byhealth",extraParams:{select:["id","registration_number","vehicle_type","birth_year","total_distance","health_status"]},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.DashboardConsumableStore",{extend:"Ext.data.Store",storeId:"dashboard_consumable_store",fields:[{name:"consumable",type:"string"},{name:"summary",type:"auto"}],pageSize:1000,proxy:{type:"ajax",url:"dashboard/health/consumable",extraParams:{},reader:{type:"json",root:"items"}}});Ext.define("GreenFleet.store.DashboardVehicleStore",{extend:"Ext.data.Store",storeId:"dashboard_vehicle_store",fields:[{name:"name",type:"string"},{name:"summary",type:"auto"}],pageSize:1000,proxy:{type:"ajax",url:"dashboard/health/vehicle",extraParams:{},reader:{type:"json",root:"items"}}});Ext.define("GreenFleet.store.LocationStore",{extend:"Ext.data.Store",storeId:"location_store",fields:[{name:"name",type:"string"},{name:"addr",type:"string"},{name:"lat",type:"float"},{name:"lng",type:"float"},{name:"rad",type:"int"},{name:"lat_lo",type:"float"},{name:"lat_hi",type:"float"},{name:"lng_lo",type:"float"},{name:"lng_hi",type:"float"},{name:"expl",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],pageSize:20,sorters:[{property:"updated_at",direction:"DESC"}],proxy:{type:"ajax",url:"location",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.AlarmStore",{extend:"Ext.data.Store",storeId:"alarm_store",fields:[{name:"name",type:"string"},{name:"evt_type",type:"string"},{name:"evt_name",type:"string"},{name:"evt_trg",type:"string"},{name:"type",type:"string"},{name:"always",type:"boolean"},{name:"enabled",type:"boolean"},{name:"from_date",type:"date",dateFormat:"time"},{name:"to_date",type:"date",dateFormat:"time"},{name:"vehicles",type:"string"},{name:"dest",type:"string"},{name:"msg",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],pageSize:20,sorters:[{property:"updated_at",direction:"DESC"}],proxy:{type:"ajax",url:"alarm",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.VehicleRunStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"key",type:"string"},{name:"vehicle",type:"string"},{name:"year",type:"integer",},{name:"month",type:"integer",},{name:"month_str",type:"string",},{name:"run_dist",type:"float"},{name:"run_time",type:"integer"},{name:"consmpt",type:"float"},{name:"co2_emss",type:"float"},{name:"effcc",type:"float"},{name:"oos_cnt",type:"integer"},{name:"mnt_cnt",type:"integer"},{name:"mnt_time",type:"integer"}],sorters:[{property:"year",direction:"ASC"},{property:"month",direction:"ASC"}],proxy:{type:"ajax",url:"vehicle_run",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.DriverRunStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"driver",type:"string"},{name:"year",type:"integer"},{name:"month",type:"integer"},{name:"month_str",type:"string",},{name:"run_dist",type:"float"},{name:"run_time",type:"integer"},{name:"consmpt",type:"float"},{name:"co2_emss",type:"float"},{name:"effcc",type:"float"},{name:"sud_accel_cnt",type:"integer"},{name:"sud_brake_cnt",type:"integer"},{name:"eco_drv_time",type:"integer"},{name:"ovr_spd_time",type:"integer"},{name:"inc_cnt",type:"integer"}],sorters:[{property:"year",direction:"ASC"},{property:"month",direction:"ASC"}],proxy:{type:"ajax",url:"driver_run",extraParams:{select:["driver","year","month","run_dist","run_time","consmpt","co2_emss","effcc","sud_accel_cnt","sud_brake_cnt","eco_drv_time","ovr_spd_time","inc_cnt"]},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.DriverSpeedStore",{extend:"Ext.data.Store",autoLoad:false,fields:[{name:"driver",type:"string"},{name:"year",type:"integer"},{name:"month",type:"integer"},{name:"month_str",type:"string",},{name:"spd_lt10",type:"integer"},{name:"spd_lt20",type:"integer"},{name:"spd_lt30",type:"integer"},{name:"spd_lt40",type:"integer"},{name:"spd_lt50",type:"integer"},{name:"spd_lt60",type:"integer"},{name:"spd_lt70",type:"integer"},{name:"spd_lt80",type:"integer"},{name:"spd_lt90",type:"integer"},{name:"spd_lt100",type:"integer"},{name:"spd_lt110",type:"integer"},{name:"spd_lt120",type:"integer"},{name:"spd_lt130",type:"integer"},{name:"spd_lt140",type:"integer"},{name:"spd_lt150",type:"integer"},{name:"spd_lt160",type:"integer"}],sorters:[{property:"year",direction:"ASC"},{property:"month",direction:"ASC"}],proxy:{type:"ajax",url:"driver_run/speed",extraParams:{select:["driver","year","month","month_str","spd_lt10","spd_lt20","spd_lt30","spd_lt40","spd_lt50","spd_lt60","spd_lt70","spd_lt80","spd_lt90","spd_lt100","spd_lt110","spd_lt120","spd_lt130","spd_lt140","spd_lt150","spd_lt160"]},reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.YearStore",{extend:"Ext.data.Store",fields:["year"],data:[{year:2001},{year:2002},{year:2003},{year:2004},{year:2005},{year:2006},{year:2007},{year:2008},{year:2009},{year:2010},{year:2011},{year:2012}]});Ext.define("GreenFleet.store.MonthStore",{extend:"Ext.data.Store",fields:["month"],data:[{month:1},{month:2},{month:3},{month:4},{month:5},{month:6},{month:7},{month:8},{month:9},{month:10},{month:11},{month:12}]});Ext.define("GreenFleet.store.DriverGroupStore",{extend:"Ext.data.Store",autoLoad:true,pageSize:1000,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"desc",type:"string"},{name:"drivers",type:"auto"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:"driver_group",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.DriverByGroupStore",{extend:"Ext.data.Store",autoLoad:false,pageSize:10,fields:[{name:"key",type:"string"},{name:"name",type:"string"},{name:"id",type:"string"},{name:"division",type:"string"},{name:"title",type:"string"},{name:"social_id",type:"string"},{name:"phone_no_1",type:"string"},{name:"phone_no_2",type:"string"},{name:"image_clip",type:"string"}],proxy:{type:"ajax",url:"driver_group/drivers",reader:{type:"json",root:"items",totalProperty:"total",successProperty:"success"}}});Ext.define("GreenFleet.store.VehicleGroupCountStore",{extend:"Ext.data.Store",autoLoad:true,pageSize:10,fields:[{name:"id",type:"string"},{name:"expl",type:"string"},{name:"count",type:"integer"}],proxy:{type:"ajax",url:"vehicle_group/group_count",reader:{type:"json",root:"items",totalProperty:"total"}}});Ext.define("GreenFleet.store.CalendarStore",{extend:"Extensible.calendar.data.MemoryCalendarStore",storeId:"calendar_store",autoLoad:true,data:{calendars:[{id:1,title:"Maintenence",color:2},{id:2,title:"Consumables",color:22},{id:3,title:"Reservation",color:7},{id:4,title:"Task",color:26}]}});Ext.define("GreenFleet.store.EventStore",{extend:"Extensible.calendar.data.EventStore",storeId:"event_store",autoLoad:true,proxy:{type:"ajax",url:"task",reader:{type:"json",root:"items",totalProperty:"total"},writer:{url:"task",type:"json",nameProperty:"mapping"},listeners:{exception:function(d,b,a,c){Ext.Msg.alert("Server Error",b.responseText)}}},listeners:{beforesync:function(a,b){if(a.destroy){this.getProxy().extraParams.mode="destroy"}if(a.update){this.getProxy().extraParams.mode="update"}if(a.create){this.getProxy().extraParams.mode="create"}}}});Ext.define("GreenFleet.controller.ApplicationController",{extend:"Ext.app.Controller",requires:["GreenFleet.store.IncidentLogChartStore","GreenFleet.view.management.Profile","GreenFleet.view.common.ImportPopup"],stores:["CompanyStore","UserStore","CodeGroupStore","CodeStore","VehicleStore","VehicleMapStore","VehicleFilteredStore","VehicleInfoStore","VehicleBriefStore","DriverStore","DriverBriefStore","ReservationStore","IncidentStore","IncidentByVehicleStore","IncidentViewStore","IncidentLogStore","TrackStore","VehicleTypeStore","OwnershipStore","VehicleStatusStore","CheckinDataStore","TrackByVehicleStore","RecentIncidentStore","TerminalStore","TerminalBriefStore","TimeZoneStore","LanguageCodeStore","VehicleGroupStore","VehicleByGroupStore","VehicleImageBriefStore","ConsumableCodeStore","VehicleConsumableStore","ConsumableHistoryStore","RepairStore","VehicleByHealthStore","DashboardConsumableStore","DashboardVehicleStore","LocationStore","AlarmStore","VehicleRunStore","DriverRunStore","DriverSpeedStore","YearStore","MonthStore","DriverGroupStore","DriverByGroupStore","VehicleGroupCountStore","CalendarStore","EventStore"],models:["Code"],views:["viewport.Center","viewport.North","viewport.West","viewport.East","Brand","MainMenu","SideMenu","management.Company","management.User","management.Code","management.VehicleGroup","management.ConsumableCode","management.Vehicle","management.Terminal","management.Reservation","management.Incident","management.Driver","management.Track","management.CheckinData","monitor.Map","monitor.CheckinByVehicle","monitor.InfoByVehicle","monitor.Information","monitor.IncidentView","common.CodeCombo","form.TimeZoneCombo","form.DateTimeField","form.SearchField","common.EntityFormButtons","dashboard.VehicleHealth","dashboard.ConsumableHealth","pm.Consumable","common.ProgressColumn","management.VehicleConsumableGrid","form.RepairForm","management.Location","management.Alarm","management.VehicleRunStatus","management.DriverRunStatus","management.DriverSpeedSection","dashboard.Reports","dashboard.VehicleRunningSummary","dashboard.DriverRunningSummary","management.DriverGroup","pm.Maintenance","management.Schedule","overview.Overview","portlet.Portlet","portlet.PortalPanel","portlet.PortalColumn","portlet.PortalDropZone","portlet.GridI1Portlet","portlet.GridVG1Portlet","portlet.GridDG1Portlet","portlet.ChartV1Portlet","portlet.ChartV2Portlet","portlet.CalendarPortlet","portlet.GridC1Portlet"],init:function(){this.control({viewport:{afterrender:this.onViewportRendered}})},onViewportRendered:function(){}});Ext.Loader.setConfig({enabled:true,paths:{GreenFleet:"app"}});Ext.define("GreenFleet",{singleton:true,mixins:{msg:"GreenFleet.mixin.Msg",user:"GreenFleet.mixin.User",mixin:"GreenFleet.mixin.Mixin",ui:"GreenFleet.mixin.UI",state:"GreenFleet.mixin.State",subitem:"GreenFleet.mixin.SubItem",util:"GreenFleet.mixin.Import"}});var console=console||{log:function(){},trace:function(){}};Ext.require(["GreenFleet.view.Viewport","GreenFleet.controller.ApplicationController","GreenFleet.controller.MainController","GreenFleet.controller.FileController"]);Ext.onReady(function(){Ext.application({name:"GreenFleet",autoCreateViewport:false,controllers:["GreenFleet.controller.ApplicationController","GreenFleet.controller.FileController","GreenFleet.controller.MainController"],launch:function(){Ext.create("GreenFleet.view.Viewport").show()}})});
