/*6a727259e63e1d61d3fac8d86b4d812b032e1330*/Ext.define("HatioBB.mixin.User",function(){var a;var c=function(d){a=d};var b=function(d){return a[d]};return{login:{set:c,get:b}}}());Ext.define("HatioBB.mixin.SubItem",function(){Ext.Container.implement({sub:function(a){if(!this.subitems){this.subitems={}}if(!this.subitems[a]){this.subitems[a]=this.down("[itemId="+a+"]")}return this.subitems[a]}});return{}}());Ext.define("HatioBB.mixin.Setting",function(){var d=[{id:"autofit",value:false},{id:"refreshTerm",value:-1},{id:"dockPosition",value:"right"},{id:"auto_max_zoom",value:16}];Ext.define("HatioBB.mixin.Setting.Model",{extend:"Ext.data.Model",config:{fields:[{name:"id",type:"string"},{name:"value",type:"auto"}],proxy:{type:"localstorage",id:"hatiobb-settings"}}});var c=Ext.create("Ext.data.Store",{model:"HatioBB.mixin.Setting.Model",autoSync:true});function b(g){var e=c.getById(g);if(e){return e.get("value")}else{return null}}function a(h,i){var g=c.getById(h);var e;if(!g){var j=Ext.create("HatioBB.mixin.Setting.Model",{id:h,value:undefined});c.add(j);g=c.getById(h)}g.set("value",i);g.commit();return e}Ext.define("HatioBB.mixin.Setting.Inner",{mixins:["Ext.mixin.Observable"],set:function(h,g){var e=a(h,g);this.fireEvent(h,g,e)},get:function(e){return b(e)}});c.on("load",function(g,e){for(var h=0;h<d.length;h++){if(!g.getById(d[h].id)){a(d[h].id,d[h].value)}}});try{c.load()}catch(f){c.getProxy().clear();c.load()}return{setting:Ext.create("HatioBB.mixin.Setting.Inner")}}());Ext.define("HatioBB.mixin.Label",function(){function a(c){this.setValues(c);var b=this.span_=document.createElement("div");this.span_.setAttribute("class","mapTipID");var d=this.div_=document.createElement("div");d.appendChild(b);d.style.cssText="position: absolute; display: none"}a.prototype=new google.maps.OverlayView;a.prototype.onAdd=function(){var c=this.getPanes().overlayMouseTarget;c.appendChild(this.div_);this.show=true;var b=this;this.listeners_=[google.maps.event.addListener(this,"position_changed",function(){b.draw()}),google.maps.event.addListener(this,"text_changed",function(){b.draw()}),google.maps.event.addListener(this,"zindex_changed",function(){b.draw()})]};a.prototype.setVisible=function(b){this.show=b;this.draw()};a.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_);for(var c=0,b=this.listeners_.length;c<b;++c){google.maps.event.removeListener(this.listeners_[c])}};a.prototype.draw=function(){var c=this.getProjection();if(!c){return}var b=c.fromLatLngToDivPixel(this.get("position"));var f=this.div_;var d=parseInt(this.get("xoffset"))||0;var e=parseInt(this.get("yoffset"))||0;f.style.left=b.x+d+"px";f.style.top=b.y+e+"px";f.style.display=this.show?"block":"none";this.span_.innerHTML=this.get("text").toString()};return{label:{create:function(b){return new a(b)}}}}());Ext.define("HatioBB.mixin.Nav",function(){var d,g;var e=function(){if(!d){d=Ext.getCmp("content")}return d};var f=function(){if(!g){g=Ext.getCmp("header")}return g};function b(h){var i=e().getComponent(h);if(!i){e().removeAll();i=e().add({xtype:h})}e().setActiveItem(i);f().setActiveStatus(i.getId());return i}function a(){var h=e().getComponent("vehicle");if(!h){e().removeAll();h=e().add({xtype:"vehicle"})}e().setActiveItem(h);f().clearActiveStatus();return h}function c(){var h=e().getComponent("driver");if(!h){e().removeAll();h=e().add({xtype:"driver"})}e().setActiveItem(h);f().clearActiveStatus();return h}return{nav:{monitor:b,vehicle:a,driver:c}}}());Ext.define("HatioBB.mixin.Map",function(){var a=function(d,c,f){if(d!==undefined&&c!==undefined){var e=new google.maps.LatLng(d,c);geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:e},function(h,g){if(g==google.maps.GeocoderStatus.OK){if(h[0]){f(h[0].formatted_address)}}else{f("Geocoder fails due to : "+g)}})}};function b(g,l,f,k,m){var e=Math.PI*g/180;var d=Math.PI*f/180;var j=Math.PI*l/180;var h=Math.PI*k/180;var c=l-k;var n=Math.PI*c/180;var i=Math.sin(e)*Math.sin(d)+Math.cos(e)*Math.cos(d)*Math.cos(n);i=Math.acos(i);i=i*180/Math.PI;i=i*60*1.1515;if(m=="K"){i=i*1.609344}if(m=="N"){i=i*0.8684}return i}return{map:{getLocation:a,distance:b}}}());Ext.define("HatioBB.view.Setting",{extend:"Ext.form.Panel",xtype:"setting",constructor:function(a){a.items=this.buildItems();this.callParent(arguments);this.on("erased",function(){this.destroy()})},buildItems:function(){var b=[{xtype:"fieldset",items:[{xtype:"toolbar",title:T("label.setting"),docked:"top"},{xtype:"togglefield",label:T("label.autofit"),name:"autofit",value:HatioBB.setting.get("autofit"),listeners:{change:function(f,e,c,d){HatioBB.setting.set(f.getName(),!!d)}}},{xtype:"selectfield",label:T("label.refreshterm"),name:"refreshTerm",valueField:"value",displayField:"display",value:HatioBB.setting.get("refreshTerm"),listeners:{change:function(d,c){HatioBB.setting.set(d.getName(),c)}},store:{data:[{value:-1,display:T("label.refresh_none")},{value:3,display:"3"+T("label.second_s")},{value:5,display:"5"+T("label.second_s")},{value:10,display:"10"+T("label.second_s")},{value:30,display:"30"+T("label.second_s")},{value:60,display:"1"+T("label.minute_s")},{value:300,display:"5"+T("label.minute_s")}]}},{xtype:"selectfield",label:T("label.dockPosition"),name:"dockPosition",valueField:"value",displayField:"display",value:HatioBB.setting.get("dockPosition"),listeners:{change:function(d,c){HatioBB.setting.set(d.getName(),c)}},store:{data:[{value:"left",display:T("label.left")},{value:"right",display:T("label.right")}]}}]},{xtype:"button",text:T("label.logout"),docked:"bottom",listeners:{tap:function(){Ext.Msg.confirm("Logout","Are you sure you want to be signed out ?",function(c){if(c==="yes"){document.location.href="/logout"}})}}}];var a=this.buildByScreen();if(a){b.push(a)}b.push(this.buildInformation());return b},buildByScreen:function(){var a=Ext.getCmp("content");var b=[];while(a&&typeof(a.getActiveItem)==="function"){a=a.getActiveItem();if(!a){break}if(a.buildSettings&&typeof(a.buildSettings)==="function"){b=Ext.Array.merge(b,a.buildSettings())}}if(b.length){return{xtype:"fieldset",title:T("label.setting_by_screen"),items:b}}else{return null}},buildInformation:function(){return{xtype:"fieldset",title:T("label.system_info"),items:[{xtype:"textfield",label:T("label.version"),value:HatioBB.setting.get("version"),disabled:true},{xtype:"textfield",label:T("label.user"),value:HatioBB.login.get("name")+"("+HatioBB.login.get("email")+")",disabled:true},{xtype:"textfield",label:T("label.company"),value:HatioBB.login.get("company"),disabled:true}]}},config:{left:0,top:0,modal:true,showAnimation:"fadeIn",hideOnMaskTap:true,hideAnimation:"fadeOut",width:400,height:500,scrollable:true}});Ext.define("HatioBB.controller.monitor.Info",{extend:"Ext.app.Controller",config:{refs:{info:"monitor_info"},control:{info:{initialize:"onInit"}}},onInit:function(){var a=this;this.getInfo().on("painted",function(){HatioBB.setting.on("vehicle",a.onSelectVehicle,a);HatioBB.setting.on("driver",a.onSelectDriver,a);a.getInfo().refresh()});this.getInfo().on("erased",function(){HatioBB.setting.un("vehicle",a.onSelectVehicle,a);HatioBB.setting.un("driver",a.onSelectDriver,a)})},onSelectVehicle:function(){if(this.getInfo().onProcessing){return}var a=Ext.getStore("VehicleMapStore");var b=a.findRecord("id",HatioBB.setting.get("vehicle"));this.getInfo().setVehicle(b)},onSelectDriver:function(){if(this.getInfo().onProcessing){return}var a=Ext.getStore("VehicleMapStore");var b=a.findRecord("driver_id",HatioBB.setting.get("driver"));this.getInfo().setVehicle(b)}});Ext.define("HatioBB.store.VehicleFilteredStore",{extend:"Ext.data.Store",config:{autoLoad:false,pageSize:1000,fields:[{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"status",type:"string"},{name:"driver_id",type:"string"},{name:"lat",type:"float"},{name:"lng",type:"float"},{name:"location",type:"string"},{name:"image_clip",type:"string"}]}});Ext.define("HatioBB.store.VehicleStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,pageSize:1,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"manufacturer",type:"string"},{name:"fuel_type",type:"string"},{name:"vehicle_type",type:"string"},{name:"birth_year",type:"int"},{name:"ownership_type",type:"string"},{name:"status",type:"string"},{name:"health_status",type:"string"},{name:"image_clip",type:"string"},{name:"total_distance",type:"float"},{name:"remaining_fuel",type:"float"},{name:"lat",type:"float"},{name:"driver_id",type:"string"},{name:"terminal_id",type:"string"},{name:"lng",type:"float"},{name:"location",type:"string"},{name:"eco_index",type:"int"},{name:"avg_effcc",type:"float"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/vehicle":"data/vehicle.json",reader:{type:"json",rootProperty:"items",totalProperty:"total",successProperty:"success"}}}});Ext.define("HatioBB.store.RecentIncidentStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteSort:true,remoteFilter:true,pageSize:8,fields:[{name:"key",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lat",type:"float"},{name:"lng",type:"float"},{name:"velocity",type:"float"},{name:"impulse_abs",type:"float"},{name:"impulse_x",type:"float"},{name:"impulse_y",type:"float"},{name:"impulse_z",type:"float"},{name:"impulse_threshold",type:"float"},{name:"obd_connected",type:"boolean"},{name:"confirm",type:"boolean"},{name:"engine_temp",type:"float"},{name:"engine_temp_threshold",type:"float"},{name:"video_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/incident":"data/incident.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.VehicleMapStore",{extend:"Ext.data.Store",config:{pageSize:1000,autoLoad:false,fields:[{name:"id",type:"string"},{name:"registration_number",type:"string"},{name:"status",type:"string"},{name:"driver_id",type:"string"},{name:"lat",type:"float"},{name:"lng",type:"float"},{name:"location",type:"string"},{name:"image_clip",type:"string"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/vehicle":"data/vehicle_brief.json",extraParams:{select:["id","registration_number","status","driver_id","lat","lng","image_clip"]},reader:{type:"json",rootProperty:"items",totalProperty:"total"}},listeners:{load:function(a,b,c){if(c){Ext.getStore("VehicleFilteredStore").setData(b)}}}}});Ext.define("HatioBB.store.DriverStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,pageSize:1,fields:[{name:"key",type:"string"},{name:"name",type:"string"},{name:"id",type:"string"},{name:"division",type:"string"},{name:"title",type:"string"},{name:"social_id",type:"string"},{name:"phone_no_1",type:"string"},{name:"phone_no_2",type:"string"},{name:"image_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/driver":"data/driver.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.DriverBriefStore",{extend:"Ext.data.Store",config:{autoLoad:false,pageSize:1000,fields:[{name:"name",type:"string"},{name:"id",type:"string"},{name:"image_clip",type:"string"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/driver":"data/driver_brief.json",extraParams:{select:["id","name","image_clip"]},reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.VehicleGroupStore",{extend:"Ext.data.Store",config:{pageSize:1000,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"desc",type:"string"},{name:"vehicles",type:"auto"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/vehicle_group":"data/vehicle_group.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.DriverGroupStore",{extend:"Ext.data.Store",config:{autoLoad:false,pageSize:1000,fields:[{name:"key",type:"string"},{name:"id",type:"string"},{name:"desc",type:"string"},{name:"drivers",type:"auto"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/driver_group":"data/driver_group.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.TrackByVehicleStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lat",type:"number"},{name:"lng",type:"number"},{name:"datetime",type:"number"},{name:"created_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/track":"data/track.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.IncidentByVehicleStore",{extend:"Ext.data.Store",config:{autoLoad:false,pageSize:4,remoteFilter:true,remoteSort:true,fields:[{name:"key",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lat",type:"float"},{name:"lng",type:"float"},{name:"velocity",type:"float"},{name:"impulse_abs",type:"float"},{name:"impulse_x",type:"float"},{name:"impulse_y",type:"float"},{name:"impulse_z",type:"float"},{name:"impulse_threshold",type:"float"},{name:"obd_connected",type:"boolean"},{name:"confirm",type:"boolean"},{name:"engine_temp",type:"float"},{name:"engine_temp_threshold",type:"float"},{name:"video_clip",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/incident":"data/incident_by_vehicle.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.IncidentLogStore",{extend:"Ext.data.Store",config:{autoLoad:false,pageSize:1000,remoteFilter:true,fields:[{name:"key",type:"string"},{name:"incident",type:"string"},{name:"datetime",type:"date",dateFormat:"time"},{name:"terminal_id",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lat",type:"float"},{name:"lng",type:"float"},{name:"velocity",type:"float"},{name:"accelate_x",type:"float"},{name:"accelate_y",type:"float"},{name:"accelate_z",type:"float"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"ASC"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/incident_log":"data/incident_log.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.DashboardVehicleStore",{extend:"Ext.data.Store",storeId:"dashboard_vehicle_store",config:{fields:[{name:"name",type:"string"},{name:"summary",type:"auto"}],pageSize:1000,proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/report/service":"data/dashboard/health/vehicle.json",extraParams:{id:"vehicle_health",health_type:"health"},reader:{type:"json",rootProperty:"items"}}}});Ext.define("HatioBB.store.VehicleConsumableStore",{extend:"Ext.data.Store",config:{remoteFilter:true,fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"consumable_item",type:"string"},{name:"repl_unit",type:"string"},{name:"repl_mileage",type:"int"},{name:"repl_time",type:"int"},{name:"last_repl_date",type:"date",dateFormat:"time"},{name:"miles_last_repl",type:"int"},{name:"miles_since_last_repl",type:"int"},{name:"next_repl_mileage",type:"int"},{name:"next_repl_date",type:"date",dateFormat:"time"},{name:"accrued_cost",type:"float"},{name:"health_rate",type:"float"},{name:"status",type:"string"},{name:"created_at",type:"date",dateFormat:"time"},{name:"updated_at",type:"date",dateFormat:"time"}],pageSize:1000,proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/vehicle_consumable":"data/vehicle_consumable.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.DriverRunStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,groupField:"year",fields:[{name:"driver",type:"string"},{name:"year",type:"integer"},{name:"month",type:"integer"},{name:"month_str",type:"string",},{name:"run_dist",type:"float"},{name:"run_time",type:"integer"},{name:"consmpt",type:"float"},{name:"co2_emss",type:"float"},{name:"effcc",type:"float"},{name:"eco_index",type:"integer"},{name:"sud_accel_cnt",type:"integer"},{name:"sud_brake_cnt",type:"integer"},{name:"eco_drv_time",type:"integer"},{name:"ovr_spd_time",type:"integer"},{name:"idle_time",type:"integer"},{name:"inc_cnt",type:"integer"}],sorters:[{property:"year",direction:"ASC"},{property:"month",direction:"ASC"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/driver_run":"data/driver_run.json",extraParams:{select:["driver","year","month","run_dist","run_time","consmpt","co2_emss","effcc","sud_accel_cnt","sud_brake_cnt","eco_drv_time","ovr_spd_time","inc_cnt"]},reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.VehicleRunStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,groupField:"year",fields:[{name:"key",type:"string"},{name:"vehicle",type:"string"},{name:"year",type:"integer",},{name:"month",type:"integer",},{name:"month_str",type:"string",},{name:"run_dist",type:"float"},{name:"run_time",type:"integer"},{name:"consmpt",type:"float"},{name:"co2_emss",type:"float"},{name:"effcc",type:"float"},{name:"eco_index",type:"integer"},{name:"sud_accel_cnt",type:"integer"},{name:"sud_brake_cnt",type:"integer"},{name:"eco_drv_time",type:"integer"},{name:"ovr_spd_time",type:"integer"},{name:"idle_time",type:"integer"},{name:"oos_cnt",type:"integer"},{name:"mnt_cnt",type:"integer"},{name:"mnt_time",type:"integer"}],sorters:[{property:"year",direction:"ASC"},{property:"month",direction:"ASC"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/vehicle_run":"data/vehicle_run.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.YearStore",{extend:"Ext.data.Store",config:{fields:["year"],data:[]},constructor:function(b){var a=new Date().getFullYear();b.data=b.data||[];for(var c=0;c<10;c++){b.data.push({year:a-c})}this.callParent(arguments)}});Ext.define("HatioBB.store.DashboardConsumableStore",{extend:"Ext.data.Store",config:{storeId:"dashboard_consumable_store",fields:[{name:"consumable",type:"string"},{name:"summary",type:"auto"}],pageSize:1000,proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/dashboard/health/consumable":"data/dashboard/health/consumable.json",extraParams:{},reader:{type:"json",rootProperty:"items"}}}});Ext.define("HatioBB.store.TrackStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,fields:[{name:"key",type:"string"},{name:"vehicle_id",type:"string"},{name:"driver_id",type:"string"},{name:"lat",type:"number"},{name:"lng",type:"number"},{name:"velocity",type:"number"},{name:"datetime",type:"date",dateFormat:"time"},{name:"created_at",type:"date",dateFormat:"time"}],sorters:[{property:"datetime",direction:"DESC"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/track":"data/track.json",reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.DailyReportStore",{extend:"Ext.data.Store",config:{autoLoad:false,fields:[{name:"driving",type:"auto"},{name:"maint",type:"auto"},{name:"consumable",type:"auto"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/report/service":"data/daily_report.json",extraParams:{id:"daily_driving_log"},reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.VehicleSummaryStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,pageSize:1,fields:[{name:"vehicle",type:"auto"},{name:"consumables",type:"auto"},{name:"maint",type:"auto"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/vehicle/summary":"data/vehicle_summary.json",reader:{type:"json",rootProperty:"items",totalProperty:"total",successProperty:"success"}}}});Ext.define("HatioBB.store.DriverSummaryStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,pageSize:1,fields:[{name:"id",type:"string"},{name:"name",type:"string"},{name:"division",type:"string"},{name:"title",type:"string"},{name:"social_id",type:"string"},{name:"phone_no_1",type:"string"},{name:"image_clip",type:"string"},{name:"total_distance",type:"float"},{name:"total_run_time",type:"integer"},{name:"avg_effcc",type:"float"},{name:"eco_index",type:"integer"},{name:"eco_run_rate",type:"integer"},{name:"run_time_of_month",type:"integer"},{name:"run_dist_of_month",type:"float"},{name:"consmpt_of_month",type:"float"},{name:"effcc_of_month",type:"float"},{name:"eco_drv_time_of_month",type:"integer"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/driver/summary":"data/driver_summary.json",reader:{type:"json",totalProperty:"total",successProperty:"success"}}}});Ext.define("HatioBB.store.MonthlyReportStore",{extend:"Ext.data.Store",config:{autoLoad:false,fields:[{name:"driving",type:"auto"},{name:"maint",type:"auto"},{name:"consumable",type:"auto"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/report/service":"data/monthly_report.json",extraParams:{id:"monthly_driving_log"},reader:{type:"json",rootProperty:"items",totalProperty:"total"}}}});Ext.define("HatioBB.store.VehicleRepairStore",{extend:"Ext.data.Store",config:{autoLoad:false,remoteFilter:true,pageSize:1,fields:[{name:"repair_date",type:"date",dateFormat:"time"},{name:"vehicle_id",type:"string"},{name:"repair_time",type:"string"},{name:"repair_mileage",type:"string"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/repair":"data/vehicle_repair.json",extraParams:{},reader:{type:"json",rootProperty:"items",totalProperty:"total",successProperty:"success"}}}});Ext.define("HatioBB.store.DailyReportStore3",{extend:"Ext.data.Store",config:{autoLoad:false,fields:[{name:"driver_id",type:"string"},{name:"driver_name",type:"string"},{name:"average_speed",type:"float"},{name:"max_speed",type:"int"},{name:"fuel_efficiency",type:"float"},{name:"co2_emissions",type:"float"},{name:"running_time",type:"int"},{name:"eco_driving_time",type:"int"},{name:"idle_time",type:"int"},{name:"over_speed_time",type:"int"},{name:"sudden_accel_count",type:"int"},{name:"sudden_brake_count",type:"int"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/report/service":"data/daily_report3.json",extraParams:{id:"daily_driving_habit"},reader:{type:"json",rootProperty:"items",totalProperty:"total",successProperty:"success"}}}});Ext.define("HatioBB.store.EfficiencyReportStore",{extend:"Ext.data.Store",config:{autoLoad:false,fields:[{name:"year",type:"int"},{name:"month",type:"int"},{name:"effcc",type:"float"},{name:"consmpt",type:"float"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/report/service":"data/efficiency_report.json",extraParams:{id:"fuel",type:"report"},reader:{type:"json",rootProperty:"items",totalProperty:"total",successProperty:"success"}}}});Ext.define("HatioBB.store.EcoDrivingReportStore",{extend:"Ext.data.Store",config:{autoLoad:false,fields:[{name:"year",type:"int"},{name:"month",type:"int"},{name:"eco_index",type:"float"},{name:"eco_driving",type:"float"}],proxy:{type:"ajax",url:window.location.pathname.indexOf("/m/")===0?"/report/service":"data/eco_driving_report.json",extraParams:{id:"eco"},reader:{type:"json",rootProperty:"items",totalProperty:"total",successProperty:"success"}}}});Ext.define("HatioBB.view.Content",{extend:"Ext.Panel",xtype:"content",config:{title:"GreenFleets",layout:"card",items:[{id:"header",xtype:"header",docked:"top"},{id:"launch",cls:"launchscreen",scrollable:true}]}});Ext.define("HatioBB.view.Header",{extend:"Ext.TitleBar",xtype:"header",config:{title:"GreenFleets",items:[{itemId:"map",target:"monitor_map",align:"left",cls:"headerView navMap",width:50},{itemId:"info",target:"monitor_info",align:"left",cls:"headerView navInfo"},{itemId:"incident",target:"monitor_incident",align:"left",cls:"headerView navIncident"},{itemId:"setting",iconCls:"settings9",iconMask:true,align:"right"},{iconCls:"chat3",iconMask:true,align:"right"},{itemId:"refresh",iconCls:"refresh",iconMask:true,align:"right"},{itemId:"collapse",iconCls:"window",iconMask:true,align:"right"}]},setActiveStatus:function(b){var a=this.down("button[target="+b+"]");Ext.Array.each(a.up().query("button"),function(c){if(a===c){c.addCls("active")}else{c.removeCls("active")}})},clearActiveStatus:function(){Ext.Array.each(this.query("button"),function(a){a.removeCls("active")})}});Ext.define("HatioBB.view.monitor.Map",{extend:"Ext.Map",xtype:"monitor_map",id:"monitor_map",config:{useCurrentLocation:false,mapOptions:{zoom:10,maxZoom:19,minZoom:3,center:new google.maps.LatLng(System.props.lat,System.props.lng),mapTypeId:google.maps.MapTypeId.ROADMAP}},initialize:function(){this.callParent();var a=this;var b=Ext.getStore("VehicleFilteredStore");this.on("painted",function(){if(b.isLoaded()){a.refreshMap(b)}b.on("refresh",a.refreshMap,a);HatioBB.setting.on("vehicle",a.onSelectVehicle,a);HatioBB.setting.on("driver",a.onSelectDriver,a)});this.on("erased",function(){b.un("refresh",a.refreshMap,a);HatioBB.setting.un("vehicle",a.onSelectVehicle,a);HatioBB.setting.un("driver",a.onSelectDriver,a)});this.on("resize",function(){google.maps.event.trigger(a.getMap(),"resize")});this.element.on({delegate:"div.bubbleWrap div.close",tap:function(c){a.clearInfoWindow()}});this.element.on({delegate:"div.showVehicleTrack",tap:function(c){a.fireEvent("tracktap",a.selectedMarker.record)}});this.element.on({delegate:"div.showVehicleInfo",tap:function(c){a.fireEvent("vehicletap",a.selectedMarker.record)}});this.element.on({delegate:"div.showDriverInfo",tap:function(c){a.fireEvent("drivertap",a.selectedMarker.driver_record)}})},refresh:function(){Ext.getStore("VehicleMapStore").load()},onSelectVehicle:function(){var a=Ext.getStore("VehicleFilteredStore");a.clearFilter(true);a.filter("id",HatioBB.setting.get("vehicle"))},onSelectDriver:function(){var a=Ext.getStore("VehicleFilteredStore");a.clearFilter(true);a.filter("driver_id",HatioBB.setting.get("driver"))},destroy:function(){this.resetMarkers();this.callParent()},getMarkers:function(){if(!this.markers){this.markers={}}return this.markers},resetMarkers:function(){for(var a in this.markers){google.maps.event.clearListeners(this.markers[a]);this.markers[a].setMap(null)}this.clearInfoWindow();this.markers={}},clearInfoWindow:function(){if(this.infowindow){this.infowindow.setVisible(false)}},refreshMap:function(d){var c=this;this.resetMarkers();var b={Running:"resources/images/statusDriving.png",Idle:"resources/images/statusStop.png",Incident:"resources/images/statusIncident.png",Maint:"resources/images/statusMaint.png"};var g;var e=function(){c.clearInfoWindow();var i=this;var h=i.record;var m=Ext.getStore("DriverBriefStore").getById(h.get("driver_id"));i.driver_record=m;c.selectedMarker=i;var k="resources/images/bgDriver.png";if(m&&m.get("image_clip")){if(HatioBB.setting.get("app_mode")){k="/download?blob-key="+m.get("image_clip")}else{k=m.get("image_clip")}}var j="resources/images/bgVehicle.png";if(h&&h.get("image_clip")){if(HatioBB.setting.get("app_mode")){j="/download?blob-key="+h.get("image_clip")}else{j=h.get("image_clip")}}var l=['<div class="bubbleWrap status'+h.get("status")+'">','<div class="close"></div>','<div class="infoCell">','<img src="'+j+'">','<div class="showVehicleInfo">ID : '+h.get("id")+"<br/>"+h.get("registration_number")+"</div>","</div>",'<div class="infoCell">','<img src="'+k+'">',m?'<div class="showDriverInfo">ID : '+m.get("id")+"<br/>"+m.get("name")+"</div>":'<div class="showDriverInfo">'+T("label.nodriver")+"</div>","</div>",'<div class="showVehicleTrack">'+T("title.tracking_recent_driving")+"</div>","</div>"].join("");if(!c.infowindow){c.infowindow=HatioBB.label.create({map:this.getMap(),xoffset:-110,yoffset:-150})}c.infowindow.bindTo("position",i,"position");c.infowindow.set("text",l);c.infowindow.setVisible(true)};d.each(function(i){var j=i.get("id");var k=new google.maps.LatLng(i.get("lat"),i.get("lng"));var h=new google.maps.Marker({position:k,map:c.getMap(),icon:b[i.get("status")],record:i});if(!g){g=new google.maps.LatLngBounds(k,k)}else{g.extend(k)}c.getMarkers()[j]=h;google.maps.event.addListener(h,"click",e)},this);if(!g){var a=new google.maps.LatLng(System.props.lat,System.props.lng);this.getMap().setCenter(a);if(d.isLoaded()){var f=['<div class="bubbleWrap statusIdle">',"<div>위치 정보를 찾을 수 없습니다.</div>","</div>"].join("");if(!c.infowindow){c.infowindow=HatioBB.label.create({map:this.getMap()})}c.infowindow.set("position",a);c.infowindow.set("text",f);c.infowindow.setVisible(true)}}else{if(g.isEmpty()||g.getNorthEast().equals(g.getSouthWest())){setTimeout(function(){c.getMap().setCenter(g.getNorthEast());c.getMap().setZoom(HatioBB.setting.get("auto_max_zoom")||16);var i=c.getMarkers();for(var h in i){google.maps.event.trigger(i[h],"click")}},500)}else{if(HatioBB.setting.get("autofit")){this.getMap().fitBounds(g)}}}}});Ext.define("HatioBB.view.monitor.Info",{extend:"Ext.Panel",xtype:"monitor_info",id:"monitor_info",config:{layout:"fit",items:[{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"container",height:135,cls:"grayBg",layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",title:T("title.vehicle_information"),cls:"marginT10 marginL10",layout:{type:"hbox",align:"stretch"},items:[{xtype:"image",itemId:"vehicleImage",cls:"imgVehicle"},{xtype:"image",itemId:"driverImage",cls:"imgDriver"},{xtype:"panel",itemId:"briefInfo",height:100,data:null,tpl:['<div class="infoID {status}">{id} ({registration_number})</div>','<tpl if="driver_id">','<div class="infoText">'+T("label.driver")+" : {driver_id} ({driver_name})</div>","<tpl else>",'<div class="infoText">'+T("label.driver")+" : "+T("label.nodriver")+"</div>","</tpl>",'<div class="infoText">'+T("label.location")+" : {location}</div>"]}]}]},{xtype:"track",queryOn:null,flex:1}]}]},refresh:function(){this.setVehicle();this.down("track").fireEvent("refresh")},setVehicle:function(b){var l=this;if(!b){var i=HatioBB.setting.get("vehicle");if(i){b=Ext.getStore("VehicleMapStore").findRecord("id",i);if(!b&&!this.isHidden()){setTimeout(function(){l.setVehicle()},3000);return}}else{var j=HatioBB.setting.get("driver");if(j){b=Ext.getStore("VehicleMapStore").findRecord("driver_id",i)}else{return}}}if(!b){return}var i=i||b.get("id");var j=j||b.get("driver_id");try{this.onProcessing=true;if(i&&(i!==HatioBB.setting.get("vehicle"))){HatioBB.setting.set("vehicle",i)}if(j&&(j!==HatioBB.setting.get("driver_id"))){HatioBB.setting.set("driver",j)}}finally{this.onProcessing=false}var h=Ext.getStore("VehicleMapStore");var f=h.findRecord("id",b.get("id"));var e=f.get("image_clip");var g=l.sub("vehicleImage");if(e){if(HatioBB.setting.get("app_mode")){g.setSrc("/download?blob-key="+e)}else{g.setSrc(e)}}else{g.setSrc("resources/images/bgVehicle.png")}var d=Ext.getStore("DriverBriefStore");var a=d.findRecord("id",b.get("driver_id"));var k,c;if(a){k=a.get("id");c=a.get("image_clip")}var m=l.sub("driverImage");if(c){if(HatioBB.setting.get("app_mode")){m.setSrc("/download?blob-key="+c)}else{m.setSrc(c)}}else{m.setSrc("resources/images/bgDriver.png")}if(a){b.set("driver_name",a.get("name"))}b.set("location","Resolving ..");HatioBB.map.getLocation(b.get("lat"),b.get("lng"),function(n){b.set("location",n);var o=l.down("[itemId=briefInfo]");if(o){o.setData(b.getData())}});this.sub("briefInfo").setData(b.getData())}});Ext.define("HatioBB.view.report.AreaChart",{extend:"Ext.Carousel",xtype:"rpt_area",requires:["Ext.Carousel","Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Area","Ext.chart.series.Line","Ext.data.JsonStore"],config:{direction:"vertical",cls:"grayBg"},constructor:function(b){var a=new Ext.create("Ext.data.JsonStore",{fields:["name","data1","data2","data3","2003","2004","2005","2006","2007","2008","2009","2010","iphone","android","ipad"],data:this.generateData(5,20)});b.items=[this.buildChart(a),this.buildTable(a)];this.callParent(arguments)},generateData:function(d,b){var c=[],a;b=(!b&&b!==0)?20:b;for(a=0;a<(d||12);a++){c.push({name:Ext.Date.monthNames[a%12],data1:Math.floor(Math.max((Math.random()*100),b)),data2:Math.floor(Math.max((Math.random()*100),b)),data3:Math.floor(Math.max((Math.random()*100),b)),2003:Math.floor(Math.max((Math.random()*100),b)),2004:Math.floor(Math.max((Math.random()*100),b)),2005:Math.floor(Math.max((Math.random()*100),b)),2006:Math.floor(Math.max((Math.random()*100),b)),2007:Math.floor(Math.max((Math.random()*100),b)),2008:Math.floor(Math.max((Math.random()*100),b)),2009:Math.floor(Math.max((Math.random()*100),b)),2010:Math.floor(Math.max((Math.random()*100),b)),iphone:Math.floor(Math.max((Math.random()*100),b)),android:Math.floor(Math.max((Math.random()*100),b)),ipad:Math.floor(Math.max((Math.random()*100),b))})}return c},buildChart:function(a){return{xtype:"chart",store:a,themeCls:"area1",theme:"Demo",animate:true,toolbar:null,legend:{position:{portrait:"right",landscape:"bottom"},labelFont:"20px Arial"},axes:[{type:"Numeric",position:"left",fields:["2003","2004","2005","2006","2007","2008","2009"],title:"Number of Hits",minimum:0,adjustMinimumByMajorUnit:0},{type:"Category",position:"bottom",fields:["name"],title:"Month of the Year"}],series:[{type:"area",highlight:false,axis:"left",xField:"name",yField:["2003","2004","2005","2006","2007","2008","2009"]}]}},buildTable:function(a){return{xtype:"panel",cls:"paddingAll15",data:a.config.data,tpl:["<table class=dataGrid>","<tr>","<th>"+T("label.name")+"</th>","<th>Data1</th>","<th>Data2</th>","<th>Data3</th>","<th>2003</th>","<th>2004</th>","<th>2005</th>","<th>2006</th>","<th>2007</th>","<th>2008</th>","<th>2009</th>","<th>2010</th>","<th>iPhone</th>","<th>Android</th>","<th>iPad</th>","</tr>",'<tpl for=".">',"<tr>","<td>{name}</td>","<td>{data1}</td>","<td>{data2}</td>","<td>{data3}</td>","<td>{2003}</td>","<td>{2004}</td>","<td>{2005}</td>","<td>{2006}</td>","<td>{2007}</td>","<td>{2008}</td>","<td>{2009}</td>","<td>{2010}</td>","<td>{iphone}</td>","<td>{android}</td>","<td>{ipad}</td>","</tr>","</tpl>","</table>"]}}});Ext.define("HatioBB.view.report.BarChart",{extend:"Ext.Carousel",xtype:"rpt_bar",requires:["Ext.Carousel","Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Area","Ext.chart.series.Line","Ext.data.JsonStore"],config:{direction:"vertical",cls:"grayBg"},constructor:function(b){var a=new Ext.create("Ext.data.JsonStore",{fields:["name","data1","data2","data3","2003","2004","2005","2006","2007","2008","2009","2010","iphone","android","ipad"],data:this.generateData(5,20)});b.items=[this.buildChart(a),this.buildTable(a)];this.callParent(arguments)},generateData:function(d,b){var c=[],a;b=(!b&&b!==0)?20:b;for(a=0;a<(d||12);a++){c.push({name:Ext.Date.monthNames[a%12],data1:Math.floor(Math.max((Math.random()*100),b)),data2:Math.floor(Math.max((Math.random()*100),b)),data3:Math.floor(Math.max((Math.random()*100),b)),2003:Math.floor(Math.max((Math.random()*100),b)),2004:Math.floor(Math.max((Math.random()*100),b)),2005:Math.floor(Math.max((Math.random()*100),b)),2006:Math.floor(Math.max((Math.random()*100),b)),2007:Math.floor(Math.max((Math.random()*100),b)),2008:Math.floor(Math.max((Math.random()*100),b)),2009:Math.floor(Math.max((Math.random()*100),b)),2010:Math.floor(Math.max((Math.random()*100),b)),iphone:Math.floor(Math.max((Math.random()*100),b)),android:Math.floor(Math.max((Math.random()*100),b)),ipad:Math.floor(Math.max((Math.random()*100),b))})}return c},buildChart:function(a){return{xtype:"chart",store:a,themeCls:"bar1",theme:"Demo",animate:true,shadow:false,toolbar:null,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"17px Arial"},axes:[{type:"Numeric",position:"bottom",fields:["2008","2009","2010"],label:{renderer:function(b){return b.toFixed(0)}},title:"Number of Hits",minimum:0},{type:"Category",position:"left",fields:["name"],title:"Month of the Year"}],series:[{type:"bar",xField:"name",yField:["2008","2009","2010"],axis:"bottom",highlight:true,showInLegend:true}]}},buildTable:function(a){return{xtype:"panel",cls:"paddingAll15",data:a.config.data,tpl:["<table class=dataGrid>","<tr>","<th>"+T("label.name")+"</th>","<th>Data1</th>","<th>Data2</th>","<th>Data3</th>","<th>2003</th>","<th>2004</th>","<th>2005</th>","<th>2006</th>","<th>2007</th>","<th>2008</th>","<th>2009</th>","<th>2010</th>","<th>iPhone</th>","<th>Android</th>","<th>iPad</th>","</tr>",'<tpl for=".">',"<tr>","<td>{name}</td>","<td>{data1}</td>","<td>{data2}</td>","<td>{data3}</td>","<td>{2003}</td>","<td>{2004}</td>","<td>{2005}</td>","<td>{2006}</td>","<td>{2007}</td>","<td>{2008}</td>","<td>{2009}</td>","<td>{2010}</td>","<td>{iphone}</td>","<td>{android}</td>","<td>{ipad}</td>","</tr>","</tpl>","</table>"]}}});Ext.define("HatioBB.view.report.ColumnChart",{extend:"Ext.Carousel",xtype:"rpt_column",requires:["Ext.Carousel","Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Column","Ext.data.JsonStore"],config:{direction:"vertical",cls:"grayBg"},constructor:function(b){var a=new Ext.create("Ext.data.JsonStore",{fields:["name","data1","data2","data3","2003","2004","2005","2006","2007","2008","2009","2010","iphone","android","ipad"],data:this.generateData(5,20)});b.items=[this.buildChart(a),this.buildTable(a)];this.callParent(arguments)},generateData:function(d,b){var c=[],a;b=(!b&&b!==0)?20:b;for(a=0;a<(d||12);a++){c.push({name:Ext.Date.monthNames[a%12],data1:Math.floor(Math.max((Math.random()*100),b)),data2:Math.floor(Math.max((Math.random()*100),b)),data3:Math.floor(Math.max((Math.random()*100),b)),2003:Math.floor(Math.max((Math.random()*100),b)),2004:Math.floor(Math.max((Math.random()*100),b)),2005:Math.floor(Math.max((Math.random()*100),b)),2006:Math.floor(Math.max((Math.random()*100),b)),2007:Math.floor(Math.max((Math.random()*100),b)),2008:Math.floor(Math.max((Math.random()*100),b)),2009:Math.floor(Math.max((Math.random()*100),b)),2010:Math.floor(Math.max((Math.random()*100),b)),iphone:Math.floor(Math.max((Math.random()*100),b)),android:Math.floor(Math.max((Math.random()*100),b)),ipad:Math.floor(Math.max((Math.random()*100),b))})}return c},buildChart:function(a){return{xtype:"chart",store:a,themeCls:"column1",animate:{easing:"bounceOut",duration:750},shadow:false,toolbar:null,gradients:[{id:"v-1",angle:0,stops:{0:{color:"rgb(212, 40, 40)"},100:{color:"rgb(117, 14, 14)"}}},{id:"v-2",angle:0,stops:{0:{color:"rgb(180, 216, 42)"},100:{color:"rgb(94, 114, 13)"}}},{id:"v-3",angle:0,stops:{0:{color:"rgb(43, 221, 115)"},100:{color:"rgb(14, 117, 56)"}}},{id:"v-4",angle:0,stops:{0:{color:"rgb(45, 117, 226)"},100:{color:"rgb(14, 56, 117)"}}},{id:"v-5",angle:0,stops:{0:{color:"rgb(187, 45, 222)"},100:{color:"rgb(85, 10, 103)"}}}],axes:[{type:"Numeric",position:"left",fields:["2009"],minimum:0,maximum:100,label:{renderer:function(b){return b.toFixed(0)}},title:"Number of Hits"},{type:"Category",position:"bottom",fields:["name"],title:"Month of the Year"}],series:[{type:"column",axis:"left",highlight:true,renderer:function(e,f,d,c,b){d.fill="url(#v-"+(c%colors.length+1)+")";return d},label:{field:"2009"},xField:"name",yField:"2009"}]}},buildTable:function(a){return{xtype:"panel",cls:"paddingAll15",data:a.config.data,tpl:["<table class=dataGrid>","<tr>","<th>"+T("label.name")+"</th>","<th>Data1</th>","<th>Data2</th>","<th>Data3</th>","<th>2003</th>","<th>2004</th>","<th>2005</th>","<th>2006</th>","<th>2007</th>","<th>2008</th>","<th>2009</th>","<th>2010</th>","<th>iPhone</th>","<th>Android</th>","<th>iPad</th>","</tr>",'<tpl for=".">',"<tr>","<td>{name}</td>","<td>{data1}</td>","<td>{data2}</td>","<td>{data3}</td>","<td>{2003}</td>","<td>{2004}</td>","<td>{2005}</td>","<td>{2006}</td>","<td>{2007}</td>","<td>{2008}</td>","<td>{2009}</td>","<td>{2010}</td>","<td>{iphone}</td>","<td>{android}</td>","<td>{ipad}</td>","</tr>","</tpl>","</table>"]}}});Ext.define("HatioBB.view.report.LineChart",{extend:"Ext.Carousel",xtype:"rpt_line",requires:["Ext.Carousel","Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Area","Ext.chart.series.Line","Ext.data.JsonStore"],config:{direction:"vertical",cls:"grayBg"},constructor:function(b){var a=new Ext.create("Ext.data.JsonStore",{fields:["name","data1","data2","data3","2003","2004","2005","2006","2007","2008","2009","2010","iphone","android","ipad","etc"],data:this.generateData(12,20)});b.items=[this.buildChart(a),this.buildTable(a)];this.callParent(arguments)},generateData:function(d,b){var c=[],a;b=(!b&&b!==0)?20:b;for(a=0;a<(d||12);a++){c.push({name:Ext.Date.monthNames[a%12],data1:Math.floor(Math.max((Math.random()*100),b)),data2:Math.floor(Math.max((Math.random()*100),b)),data3:Math.floor(Math.max((Math.random()*100),b)),2003:Math.floor(Math.max((Math.random()*100),b)),2004:Math.floor(Math.max((Math.random()*100),b)),2005:Math.floor(Math.max((Math.random()*100),b)),2006:Math.floor(Math.max((Math.random()*100),b)),2007:Math.floor(Math.max((Math.random()*100),b)),2008:Math.floor(Math.max((Math.random()*100),b)),2009:Math.floor(Math.max((Math.random()*100),b)),2010:Math.floor(Math.max((Math.random()*100),b)),iphone:Math.floor(Math.max((Math.random()*100),b)),android:Math.floor(Math.max((Math.random()*100),b)),ipad:Math.floor(Math.max((Math.random()*100),b)),etc:Math.floor(Math.max((Math.random()*100),b))})}return c},buildChart:function(a){return{xtype:"chart",themeCls:"line1",theme:"Demo",store:a,animate:true,toolbar:null,legend:{position:"bottom"},axes:[{type:"Numeric",minimum:0,maximum:100,position:"left",fields:["iphone","android","ipad"],title:"Number of Hits",minorTickSteps:1,roundToDecimal:true,decimals:0},{type:"Category",position:"bottom",fields:["name"],title:"Month of the Year"}],series:[{type:"line",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"left",xField:"name",yField:"iphone",title:"iPhone"},{type:"line",highlight:{size:7,radius:7},fill:true,axis:"left",smooth:true,xField:"name",yField:"android",title:"Android"},{type:"line",highlight:{size:7,radius:7},axis:"left",smooth:true,xField:"name",yField:"ipad",title:"iPad"}]}},buildTable:function(a){return{xtype:"panel",cls:"paddingAll15",data:a.config.data,tpl:["<table class=dataGrid>","<tr>","<th>Name</th>","<th>Data1</th>","<th>Data2</th>","<th>Data3</th>","<th>2003</th>","<th>2004</th>","<th>2005</th>","<th>2006</th>","<th>2007</th>","<th>2008</th>","<th>2009</th>","<th>2010</th>","<th>iPhone</th>","<th>Android</th>","<th>iPad</th>","<th>etc</th>","</tr>",'<tpl for=".">',"<tr>","<td>{name}</td>","<td>{data1}</td>","<td>{data2}</td>","<td>{data3}</td>","<td>{2003}</td>","<td>{2004}</td>","<td>{2005}</td>","<td>{2006}</td>","<td>{2007}</td>","<td>{2008}</td>","<td>{2009}</td>","<td>{2010}</td>","<td>{iphone}</td>","<td>{android}</td>","<td>{ipad}</td>","<td>{etc}</td>","</tr>","</tpl>","</table>"]}}});Ext.define("HatioBB.view.report.PieChart",{extend:"Ext.Carousel",xtype:"rpt_pie",requires:["Ext.Carousel","Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Pie","Ext.chart.series.Line","Ext.data.JsonStore"],config:{direction:"vertical",cls:"grayBg"},constructor:function(b){var a=new Ext.create("Ext.data.JsonStore",{fields:["name","data1","data2","data3","2003","2004","2005","2006","2007","2008","2009","2010","iphone","android","ipad"],data:this.generateData(5,20)});b.items=[this.buildChart(a),this.buildTable(a)];this.callParent(arguments)},generateData:function(d,b){var c=[],a;b=(!b&&b!==0)?20:b;for(a=0;a<(d||12);a++){c.push({name:Ext.Date.monthNames[a%12],data1:Math.floor(Math.max((Math.random()*100),b)),data2:Math.floor(Math.max((Math.random()*100),b)),data3:Math.floor(Math.max((Math.random()*100),b)),2003:Math.floor(Math.max((Math.random()*100),b)),2004:Math.floor(Math.max((Math.random()*100),b)),2005:Math.floor(Math.max((Math.random()*100),b)),2006:Math.floor(Math.max((Math.random()*100),b)),2007:Math.floor(Math.max((Math.random()*100),b)),2008:Math.floor(Math.max((Math.random()*100),b)),2009:Math.floor(Math.max((Math.random()*100),b)),2010:Math.floor(Math.max((Math.random()*100),b)),iphone:Math.floor(Math.max((Math.random()*100),b)),android:Math.floor(Math.max((Math.random()*100),b)),ipad:Math.floor(Math.max((Math.random()*100),b))})}return c},buildChart:function(a){return{xtype:"chart",store:a,themeCls:"pie1",theme:"Demo",shadow:false,animate:true,toolbar:null,insetPadding:20,legend:{position:"left"},interactions:[{type:"reset",confirm:true},{type:"rotate"},"itemhighlight",{type:"iteminfo",gesture:"longpress",listeners:{show:function(c,e,b){var d=e.storeItem;b.setHtml(["<ul><li><b>Month: </b>"+d.get("name")+"</li>","<li><b>Value: </b> "+d.get("2007")+"</li></ul>"].join(""))}}}],series:[{type:"pie",field:"2007",showInLegend:true,highlight:false,listeners:{labelOverflow:function(b,c){c.useCallout=true}},callouts:{renderer:function(c,b){c.label.setAttributes({text:b.get("name")},true)},filter:function(){return false},box:{},lines:{"stroke-width":2,offsetFromViz:20},label:{font:"italic 14px Arial"},styles:{font:"14px Arial"}},label:{field:"name"}}]}},buildTable:function(a){return{xtype:"panel",cls:"paddingAll15",data:a.config.data,tpl:["<table class=dataGrid>","<tr>","<th>Name</th>","<th>Data1</th>","<th>Data2</th>","<th>Data3</th>","<th>2003</th>","<th>2004</th>","<th>2005</th>","<th>2006</th>","<th>2007</th>","<th>2008</th>","<th>2009</th>","<th>2010</th>","<th>iPhone</th>","<th>Android</th>","<th>iPad</th>","</tr>",'<tpl for=".">',"<tr>","<td>{name}</td>","<td>{data1}</td>","<td>{data2}</td>","<td>{data3}</td>","<td>{2003}</td>","<td>{2004}</td>","<td>{2005}</td>","<td>{2006}</td>","<td>{2007}</td>","<td>{2008}</td>","<td>{2009}</td>","<td>{2010}</td>","<td>{iphone}</td>","<td>{android}</td>","<td>{ipad}</td>","</tr>","</tpl>","</table>"]}}});Ext.define("HatioBB.view.report.DailyReport",{extend:"Ext.Panel",xtype:"dailyreport",config:{layout:"fit",},constructor:function(a){a.items=[{docked:"top"},this.buildReport(),{docked:"bottom"}];this.callParent(arguments);this.refresh()},refresh:function(){var a=this;var b={};var c=Ext.getStore("DailyReportStore");c.load(function(e){var d=e[0].data;b.driving=d.driving;b.maint=d.maint;b.consummable=d.consumable;a.down("[itemId=report]").setData(b)})},buildReport:function(){return{xtype:"panel",itemId:"report",data:{},cls:"bgHGradient",scrollable:"vertical",tpl:['<div class="reportWrap">','<div class="reportMain">','<div class="reportTitle">'+T("report.daily_driving_report")+" <span>{date}</span></div>",'<table frame="void" rules="all">',"<tr>","<th>"+T("label.driver_id")+"</th>","<th>"+T("label.vehicle_id")+"</th>",'<th rowspan="2">'+T("label.run_dist")+"</th>",'<th rowspan="2">'+T("label.run_time")+"</th>",'<th rowspan="2">'+T("label.fuel_consumption")+"</th>",'<th rowspan="2">'+T("label.fuel_efficiency")+"</th>","</tr>","<tr>","<th>"+T("label.name")+"</th>","<th>"+T("label.reg_no")+"</th>","</tr>",'<tpl for="driving">',"<tr>","<td>{driver_id}</td>","<td>{vehicle_id}</td>",'<td rowspan="2">{run_dist}</td>','<td rowspan="2">{run_time}</td>','<td rowspan="2">{consmpt}</td>','<td rowspan="2">{effcc}</td>',"</tr>","<tr>","<td>{driver_name}</td>","<td>{reg_no}</td>","</tr>","</tpl>","</table>","</div>",'<div class="reportSub">','<div class="reportTitle">'+T("title.maintenance")+T("report.report")+"</div>",'<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.vehicle_id")+"</th>","<th>"+T("label.reg_no")+"</th>","<th>"+T("label.comment")+"</th>","</tr>",'<tpl for="maint">',"<tr>","<td>{vehicle_id}</td>","<td>{reg_no}</td>","<td>{comment}</td>","</tr>","</tpl>","</table>",'<div class="reportTitle">'+T("label.consumable_repl")+T("report.report")+"</div>",'<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.vehicle_id")+"</th>","<th>"+T("label.reg_no")+"</th>","<th>"+T("label.consumable_item")+"</th>","</tr>",'<tpl for="consummable">',"<tr>","<td>{vehicle_id}</td>","<td>{reg_no}</td>","<td>{item}</td>","</tr>","</tpl>","</table>","</div>","</div>",]}}});Ext.define("HatioBB.view.report.DailyReport2",{extend:"Ext.Panel",xtype:"dailyreport2",config:{layout:"fit",},constructor:function(a){a.items=[{docked:"top"},this.buildReport(),{docked:"bottom"}];this.callParent(arguments);this.refresh()},refresh:function(){var a=this;var b={};var c=Ext.getStore("DailyReportStore");c.load(function(e){var d=e[0].data;b.driving=d.driving;b.maint=d.maint;b.consummable=d.consumable;a.down("[itemId=report]").setData(b)})},buildReport:function(){return{xtype:"panel",itemId:"report",data:{},cls:"bgHGradient",scrollable:"vertical",tpl:['<div class="reportWrap type2">','<div class="reportLayoutFull">','<div class="reportTitle">'+T("report.daily_driving_report")+" <span>{date}</span></div>",'<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.driver_id")+"</th>","<th>"+T("label.name")+"</th>","<th>"+T("label.vehicle_id")+"</th>","<th>"+T("label.reg_no")+"</th>","<th>"+T("label.run_dist")+"</th>","<th>"+T("label.run_time")+"</th>","<th>"+T("label.fuel_consumption")+"</th>","<th>"+T("label.fuel_efficiency")+"</th>","</tr>",'<tpl for="driving">',"<tr>","<td>{driver_id}</td>",'<td class="alignCenter">{driver_name}</td>','<td class="alignCenter">{vehicle_id}</td>','<td class="alignCenter">{reg_no}</td>','<td class="alignRight">{run_dist}</td>','<td class="alignRight">{run_time}</td>','<td class="alignRight">{consmpt}</td>','<td class="alignCenter">{effcc}</td>',"</tr>","</tpl>","</table>","</div>","</div>",'<div class="reportLayoutHalf">','<div class="reportTitle">'+T("title.maintenance")+T("report.report")+"</div>",'<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.vehicle_id")+"</th>","<th>"+T("label.reg_no")+"</th>","<th>"+T("label.comment")+"</th>","</tr>",'<tpl for="maint">',"<tr>",'<td class="alignCenter">{vehicle_id}</td>','<td class="alignCenter">{reg_no}</td>','<td class="alignCenter">{comment}</td>',"</tr>","</tpl>","</table>","</div>","</div>",'<div class="reportLayoutHalf">','<div class="reportTitle">'+T("label.consumable_repl")+T("report.report")+"</div>",'<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.vehicle_id")+"</th>","<th>"+T("label.reg_no")+"</th>","<th>"+T("label.consumable_item")+"</th>","</tr>",'<tpl for="consummable">',"<tr>",'<td class="alignCenter">{vehicle_id}</td>','<td class="alignCenter">{reg_no}</td>','<td class="alignCenter">{item}</td>',"</tr>","</tpl>","</table>","</div>","</div>","</div>",]}}});Ext.define("HatioBB.view.report.DailyReport3",{extend:"Ext.Panel",xtype:"dailyreport3",config:{cls:"grayBg",layout:"fit"},constructor:function(a){a.items=[{docked:"top"},this.buildReport(),{docked:"bottom"}];this.callParent(arguments);this.refresh()},refresh:function(){var a=this;var b=Ext.getStore("DailyReportStore3");b.load(function(c){var f=[];for(var d=0;d<c.length;d++){var e=c[d].data;f.push(e)}a.down("[itemId=report]").setData(f)})},buildReport:function(){return{xtype:"panel",itemId:"report",data:{},cls:"bgHGradient",scrollable:"vertical",tpl:['<div class="reportWrap type2">','<div class="reportLayoutFull">','<div class="reportTitle"> 일일 운전습관 리포트<span>{date}</span></div>','<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.driver_id")+"</th>","<th>"+T("label.driver")+T("label.name")+"</th>","<th>"+T("label.average_speed")+"</th>","<th>"+T("label.highest_speed")+"</th>","<th>"+T("label.fuel_efficiency")+"</th>","<th>"+T("label.co2_emissions")+"</th>","<th>"+T("label.total_run_time")+"</th>","<th>"+T("label.eco_drv_time")+"</th>","<th>"+T("label.idle_time")+"</th>","<th>"+T("label.ovr_spd_time")+"</th>","<th>"+T("label.sud_accel_cnt")+"</th>","<th>"+T("label.sud_brake_cnt")+"</th>","</tr>",'<tpl for=".">',"<tr>",'<td class="alignCenter">{driver_id}</td>','<td class="alignCenter">{driver_name}</td>','<td class="alignCenter">{average_speed}</td>','<td class="alignCenter">{max_speed}</td>','<td class="alignCenter">{fuel_efficiency}</td>','<td class="alignCenter">{co2_emissions}</td>','<td class="alignCenter">{running_time}</td>','<td class="alignCenter">{eco_driving_time}</td>','<td class="alignCenter">{idle_time}</td>','<td class="alignCenter">{over_speed_time}</td>','<td class="alignCenter">{sudden_accel_count}</td>','<td class="alignCenter">{sudden_brake_count}</td>',"</tr>","</tpl>","</table>","</div>","</div>","</div>",]}}});Ext.define("HatioBB.view.report.MonthlyReport",{extend:"Ext.Panel",xtype:"monthlyreport",config:{cls:"grayBg",layout:"fit"},constructor:function(a){a.items=[{docked:"top"},this.buildReport(),{docked:"bottom"}];this.callParent(arguments);this.refresh()},refresh:function(){var a=this;var b={};var c=Ext.getStore("MonthlyReportStore");c.load(function(e){var d=e[0].data;b.driving=d.driving;b.maint=d.maint;b.consummable=d.consumable;a.down("[itemId=report]").setData(b)})},buildReport:function(){return{xtype:"panel",itemId:"report",data:{},cls:"bgHGradient",scrollable:"vertical",tpl:['<div class="reportWrap type2">','<div class="reportLayoutFull">','<div class="reportTitle"> 주행 추이 리포트<span>{date}</span></div>','<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.year")+"</th>","<th>"+T("label.month")+"</th>","<th>"+T("label.run_dist")+"</th>","<th>"+T("label.run_time")+"</th>","<th>"+T("label.fuel_consumption")+"</th>","<th>"+T("label.fuel_efficiency")+"</th>","</tr>",'<tpl for="driving">',"<tr>",'<td class="alignCenter">{year}</td>','<td class="alignCenter">{month}</td>','<td class="alignCenter">{run_dist}</td>','<td class="alignCenter">{run_time}</td>','<td class="alignCenter">{consmpt}</td>','<td class="alignCenter">{effcc}</td>',"</tr>","</tpl>","</table>","</div>","</div>",'<div class="reportLayoutHalf">','<div class="reportTitle">정비 추이 리포트</div>','<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.year")+"</th>","<th>"+T("label.month")+"</th>","<th>"+T("label.times")+"</th>","</tr>",'<tpl for="maint">',"<tr>",'<td class="alignCenter">{year}</td>','<td class="alignCenter">{month}</td>','<td class="alignCenter">{count}</td>',"</tr>","</tpl>","</table>","</div>","</div>",'<div class="reportLayoutHalf">','<div class="reportTitle">소모품 교체 리포트</div>','<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.consumable_item")+"</th>","<th>"+T("label.times")+"</th>","</tr>",'<tpl for="consummable">',"<tr>",'<td class="alignCenter">{part}</td>','<td class="alignCenter">{count}</td>',"</tr>","</tpl>","</table>","</div>","</div>","</div>",]}}});Ext.define("HatioBB.view.chart.vehicle.VehicleHealth",{extend:"Ext.Panel",xtype:"chart_v_health",requires:["Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Pie"],config:{title:T("title.vehicle_health"),cls:"grayBg",layout:"fit"},constructor:function(b){var a=this;b.items=[this.buildChart()];this.callParent(arguments);var c=Ext.getStore("DashboardVehicleStore");c.load({scope:this,callback:function(e,d,h){var g=[];for(var f=0;f<e.length;f++){if(e[f].data.name==="health"){g=e[f].get("summary");break}}a.down("chart").getStore().setData(g)}})},buildChart:function(){return{xtype:"chart",itemId:"xxx",themeCls:"pie1",theme:"Demo",shadow:false,animate:true,toolbar:null,insetPadding:20,legend:{position:"left",labelFont:"10px",boxStroke:"#cfcfcf"},store:Ext.create("Ext.data.JsonStore",{fields:["name","value"],data:[]}),interactions:["reset","rotate","itemhighlight",{type:"iteminfo",gesture:"longpress",listeners:{show:function(c,d,b){var a=d.storeItem;b.setHtml(["<b>Vehicles in the "+a.get("name")+" state :</b>","<ul><li> Count : "+a.get("value")+"</li></ul>"].join(""))}}}],series:[{type:"pie",field:"value",showInLegend:true,donut:false,tips:{trackMouse:true,width:140,height:25,renderer:function(f,e){var d=0;store.each(function(g){d+=g.get(idx)});var a=f.get("name");var c=f.get("value");var b=Math.round(c/d*100);this.setTitle(a+" : "+c+"("+b+"%)")}},colorSet:["#00aa00","#ffff00","#aa0000"],highlight:{segment:{margin:20}},label:{field:"name",display:"rotate",contrast:true,font:"14px Arial"}}]}}});Ext.define("HatioBB.view.report.EfficiencyReport",{extend:"Ext.Carousel",xtype:"efficiencyreport",requires:["Ext.Carousel","Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Column","Ext.chart.series.Line","Ext.data.JsonStore"],config:{direction:"vertical",cls:"grayBg"},constructor:function(b){var a=this;b.items=[this.buildChart(),this.buildTable()];this.callParent(arguments);var c=Ext.getStore("EfficiencyReportStore");c.load({scope:this,callback:function(e,d,j){var h=[];for(var f=0;f<e.length;f++){var g=e[f].data;h.push(g)}a.down("chart").getStore().setData(h);a.down("[itemId=report]").setData(h)}})},buildChart:function(){return{xtype:"chart",itemId:"xxx",theme:"Demo",animate:true,shadow:false,toolbar:null,flex:1,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"17px Arial"},store:Ext.create("Ext.data.JsonStore",{fields:["year","month","effcc","consmpt"],data:[]}),axes:[{type:"Category",position:"bottom",fields:["month"],title:"Month of the Year"},{type:"Numeric",position:"left",fields:["consmpt"],title:T("label.fuel_consumption"),minimum:0},{type:"Numeric",position:"right",fields:["effcc"],title:T("label.fuel_efficiency"),minimum:0}],series:[{type:"column",highlight:{size:7,radius:7},smooth:true,axis:"left",xField:"month",yField:["consmpt"],title:T("label.fuel_consumption")},{type:"line",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"right",xField:"month",yField:"effcc",title:T("label.fuel_efficiency")}]}},buildTable:function(){return{xtype:"panel",itemId:"report",cls:"paddingAll15",data:{},tpl:["<table class=dataGrid>","<tr>","<th>"+T("label.year")+"/"+T("label.month")+"</th>","<th>"+T("label.fuel_efficiency")+"</th>","<th>"+T("label.fuel_consumption")+"</th>","</tr>",'<tpl for=".">',"<tr>",'<td class="alignCenter">{year}/{month}</td>','<td class="alignCenter">{effcc}</td>','<td class="alignCenter">{consmpt}</td>',"</tr>","</tpl>","</table>",]}}});Ext.define("HatioBB.view.report.EcoDrivingReport",{extend:"Ext.Carousel",xtype:"ecodrivingreport",requires:["Ext.Carousel","Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Column","Ext.chart.series.Line","Ext.data.JsonStore"],config:{direction:"vertical",cls:"grayBg"},constructor:function(b){var a=this;b.items=[this.buildChart(),this.buildTable()];this.callParent(arguments);var c=Ext.getStore("EcoDrivingReportStore");c.load({scope:this,callback:function(e,d,j){var h=[];for(var f=0;f<e.length;f++){var g=e[f].data;h.push(g)}a.down("chart").getStore().setData(h);a.down("[itemId=report]").setData(h)}})},buildChart:function(){return{xtype:"chart",itemId:"xxx",theme:"Demo",animate:true,shadow:false,toolbar:null,flex:1,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"20px Arial"},store:Ext.create("Ext.data.JsonStore",{fields:["year","month","eco_index","eco_driving"],data:[]}),axes:[{type:"Category",position:"bottom",fields:["month"],title:"Month of the Year"},{type:"Numeric",position:"left",fields:["eco_index"],title:T("label.eco_index"),minimum:0},{type:"Numeric",position:"right",fields:["eco_driving"],title:T("label.eco_driving"),minimum:0}],series:[{type:"column",highlight:{size:7,radius:7},smooth:true,axis:"left",xField:"month",yField:["eco_index"],title:T("label.eco_index")},{type:"line",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"right",xField:"month",yField:"eco_driving",title:T("label.eco_driving")}]}},buildTable:function(){return{xtype:"panel",cls:"paddingAll15",itemId:"report",data:{},tpl:["<table class=dataGrid>","<tr>","<th>"+T("label.year")+"</th>","<th>"+T("label.month")+"</th>","<th>"+T("label.eco_index")+"</th>","<th>"+T("label.eco_driving")+"</th>","</tr>",'<tpl for=".">',"<tr>",'<td class="alignCenter">{year}</td>','<td class="alignCenter">{month}</td>','<td class="alignCenter">{eco_index}</td>','<td class="alignCenter">{eco_driving}</td>',"</tr>","</tpl>","</table>"]}}});Ext.define("HatioBB.view.monitor.Track",{extend:"Ext.Panel",xtype:"track",config:{cls:"grayBg",layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",height:45,cls:"shotHList",layout:{type:"hbox",align:"stretch"},items:[{xtype:"button",itemId:"today",cls:"trackTab today",flex:1,maxWidth:160,tpl:'<div class="trackLabel"><span>{date}</span>'+T("label.today")+"</div>"},{xtype:"button",itemId:"yesterday",cls:"trackTab yesterday",flex:1,maxWidth:160,tpl:'<div class="trackLabel"><span>{date}</span>'+T("label.yesterday")+"</div>"},{xtype:"button",itemId:"ago2days",cls:"trackTab ago2days",flex:1,maxWidth:160,tpl:'<div class="trackLabel"><span>{date}</span>'+T("label.ago2days")+"</div>"},{xtype:"button",itemId:"ago3days",cls:"trackTab ago3days",flex:1,maxWidth:160,tpl:'<div class="trackLabel"><span>{date}</span>'+T("label.ago3days")+"</div>"}]},{xtype:"map",useCurrentLocation:false,flex:1,mapOptions:{zoom:10,maxZoom:19,minZoom:3,center:new google.maps.LatLng(System.props.lat,System.props.lng),mapTypeId:google.maps.MapTypeId.ROADMAP}}]},refresh:function(){this.fireEvent("refresh")},resetTrackLines:function(){if(this.tracklines){Ext.Array.each(this.tracklines,function(a){a.setMap(null)})}this.tracklines=[]},unselectTrip:function(){this.clearInfoWindow();if(this.selectedTrack){this.selectedTrack.setOptions({strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:4})}},addTrackLine:function(c,h,m,k,b){var j=this;this.tracklines.push(m);var l=m.getPath();var g=new google.maps.Marker({position:l.getAt(0),map:c});var e=new google.maps.Marker({position:l.getAt(l.getLength()-1),icon:"resources/images/iconStartPoint.png",map:c});this.addTripMarkers(g);this.addTripMarkers(e);var f=0;l.forEach(function(i){var n=new google.maps.Marker({position:i,icon:"resources/images/iconPin.png",map:c,visible:false,trace:h[f++]});j.addPathMarkers(n);google.maps.event.addListener(n,"click",a)});function a(q){var i=this;j.clearInfoWindow();var o=this.trace;var p=o.get("lat");var n=o.get("lng");HatioBB.map.getLocation(p,n,function(r){var s=['<div class="bubbleWrap">','<div class="close"></div>','<div class="trackBubble">',"<div>"+r+"</div>","<div><span>"+T("label.latitude")+"/"+T("label.longitude")+"</span>"+o.get("lat").toFixed(2)+" / "+o.get("lng").toFixed(2)+"</div>","<div><span>"+T("label.velocity")+"</span>"+o.get("velocity")+" KM/H</div>","<div><span>"+T("label.time")+"</span>"+Ext.Date.format(o.get("datetime"),"Y-m-d H:i:s")+"</div>","</div>","</div>"].join("");if(!j.infowindow){j.infowindow=HatioBB.label.create({map:i.getMap(),xoffset:-110,yoffset:-150})}j.infowindow.set("position",q.latLng);j.infowindow.set("text",s);j.infowindow.setVisible(true)})}function d(t){var p=this;j.unselectTrip();j.selectedTrack=m;m.setOptions({strokeColor:"#CF0000",strokeOpacity:0.7,strokeWeight:6});var v=m.getPath();var n=Ext.Date.format(h[h.length-1].get("datetime"),"Y-m-d H:i:s");var r=Ext.Date.format(h[0].get("datetime"),"Y-m-d H:i:s");var q=h[0].get("driver_id");var i=h[0].get("vehicle_id");var u=Ext.getStore("DriverBriefStore").getById(q);var o=Ext.getStore("VehicleMapStore").getById(i);var s=['<div class="bubbleWrap">','<div class="close"></div>','<div class="trackBubble">',"<div><span>"+T("label.vehicle")+"</span>"+i+" - "+o.get("registration_number")+"</div>","<div><span>"+T("label.driver")+"</span>"+q+" - "+u.get("name")+"</div>","<div><span>주행시작</span>"+n+"</div>","<div><span>주행종료</span>"+r+"</div>","<div><span>"+T("label.average_speed")+"</span>"+Math.floor(k)+" KM/H</div>","<div><span>"+T("label.run_dist")+"</span>"+b.toFixed(2)+" KM</div>","</div>","</div>"].join("");if(!j.infowindow){j.infowindow=HatioBB.label.create({map:p.getMap(),xoffset:-110,yoffset:-150})}j.infowindow.set("position",t.latLng);j.infowindow.set("text",s);j.infowindow.setVisible(true)}google.maps.event.addListener(m,"click",d);google.maps.event.addListener(g,"click",d);google.maps.event.addListener(e,"click",d)},getTrackLines:function(){return this.tracklines},getPathMarkers:function(){return this.pathMarkers},setPathMarkers:function(a){if(this.pathMarkers){Ext.each(this.pathMarkers,function(b){b.setMap(null)})}this.pathMarkers=a},addPathMarkers:function(a){if(!this.pathMarkers){this.pathMarkers=[]}this.pathMarkers.push(a)},resetPathMarkers:function(){if(this.pathMarkers){Ext.each(this.pathMarkers,function(a){a.setMap(null)})}this.pathMarkers=null},getTripMarkers:function(){return this.tripMarkers},setTripMarkers:function(a){if(this.tripMarkers){Ext.each(this.tripMarkers,function(b){b.setMap(null)})}this.tripMarkers=a},addTripMarkers:function(a){if(!this.tripMarkers){this.tripMarkers=[]}this.tripMarkers.push(a)},resetTripMarkers:function(){if(this.tripMarkers){Ext.each(this.tripMarkers,function(a){a.setMap(null)})}this.tripMarkers=null},clearInfoWindow:function(){if(this.infowindow){this.infowindow.setVisible(false)}},getInfoWindow:function(){return this.infowindow},setInfoWindow:function(a){if(this.infowindow){this.infowindow.setMap(null)}this.infowindow=a}});Ext.define("HatioBB.view.nav.NavMenu",{extend:"Ext.dataview.List",xtype:"nav_menu",requires:["Ext.dataview.List"],initialize:function(){this.callParent()},config:{disclosure:true,grouped:true,itemTpl:'<div class="menu"><strong>{text}</strong></div>'}});Ext.define("HatioBB.view.nav.NavVehicle",{extend:"Ext.dataview.List",xtype:"nav_vehicle",requires:["Ext.dataview.List"],initialize:function(){this.callParent();var a=this;this.on("painted",function(){HatioBB.setting.on("vehicle",a.onVehicle,a);a.onVehicle()});this.on("erased",function(){HatioBB.setting.un("vehicle",a.onVehicle,a)})},config:{title:T("title.vehicle_list"),cls:"x-button-icon",disclosure:true,store:"VehicleMapStore",itemTpl:'<div class="iconVehicle"><strong>{id}</strong> {registration_number}</div>',onItemDisclosure:true},onVehicle:function(){var a=HatioBB.setting.get("vehicle");if(a){this.select(this.getStore().find("id",a))}}});Ext.define("HatioBB.view.nav.NavDriver",{extend:"Ext.dataview.List",xtype:"nav_driver",requires:["Ext.dataview.List"],initialize:function(){this.callParent();var a=this;this.on("painted",function(){HatioBB.setting.on("driver",a.onDriver,a);a.onDriver()});this.on("erased",function(){HatioBB.setting.un("driver",a.onDriver,a)})},config:{title:T("title.driver_list"),disclosure:true,store:"DriverBriefStore",itemTpl:'<div class="iconDriver"><strong>{id}</strong> {name}</div>',onItemDisclosure:true},onDriver:function(){var a=HatioBB.setting.get("driver");if(a){this.select(this.getStore().find("id",a))}}});Ext.define("HatioBB.view.nav.NavFav",{extend:"Ext.Panel",xtype:"nav_fav",requires:["Ext.dataview.List"],config:{title:"Favorites",layout:"vbox",items:[{tpl:["<div>123</div>"].join("")}],record:null}});Ext.define("HatioBB.view.nav.NavComm",{extend:"Ext.Panel",xtype:"nav_comm",requires:["Ext.dataview.List"],config:{title:"Communication",layout:"vbox",items:[{tpl:["<div>123</div>"].join("")}],record:null}});Ext.define("HatioBB.view.nav.NavNoti",{extend:"Ext.Panel",xtype:"nav_noti",requires:["Ext.dataview.List"],config:{title:"Notification",layout:"vbox",items:[{tpl:["<div>123</div>"].join("")}],record:null}});Ext.define("HatioBB.view.nav.NavReport",{extend:"Ext.dataview.List",xtype:"nav_report",requires:["Ext.dataview.List","HatioBB.view.chart.vehicle.VehicleHealth"],config:{title:T("title.report_list"),disclosure:true,store:Ext.create("Ext.data.Store",{fields:["reportId","desc"],data:[{reportId:"dailyreport",name:"Daily Report",desc:"Daily Report"},{reportId:"dailyreport2",name:"Daily Report2",desc:"Daily Report2"},{reportId:"dailyreport3",name:"Daily Report3",desc:"Daily Report3"},{reportId:"monthlyreport",name:"Monthly Report",desc:"Monthly Report"},{reportId:"chart_v_health",name:"Vehicle Health Report",desc:"Vehicle Health Report"},{reportId:"ecodrivingreport",name:"Eco-Driving Report",desc:"Eco-Driving Report"},{reportId:"rpt_pie",name:"Vehicle Stat. Report",desc:"Vehicle Stat. Report"},{reportId:"rpt_pie",name:"Driver Stat. Report",desc:"Driver Stat. Report"},{reportId:"rpt_pie",name:"Driving Report",desc:"Driving Report"},{reportId:"efficiencyreport",name:"Efficiency Report",desc:"Efficiency Report"}]}),itemTpl:'<div class="iconChart"><strong>{desc}</strong></div>'}});Ext.define("HatioBB.view.chart.vehicle.Accel",{extend:"Ext.Panel",xtype:"chart_v_accel",requires:["Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Line",],config:{title:T("title.chart_v_accel"),cls:"grayBg",layout:"fit"},constructor:function(b){var a=this;this.callParent(arguments);var c=this.add(this.buildChart());this.loadHandler=function(e,d,f){c.getStore().setData(d)};Ext.getStore("IncidentLogStore").on("load",this.loadHandler)},destroy:function(){Ext.getStore("IncidentLogStore").un("load",this.loadHandler);this.callParent(arguments)},buildChart:function(){var a=Ext.create("Ext.data.JsonStore",{fields:["datetime","accelate_x","accelate_y","accelate_z","velocity"]});return{xtype:"chart",itemId:"chart",animate:true,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"20px Arial",itemSpacing:5,padding:0,boxStroke:"transparent",boxFill:"transparent"},store:a,axes:[{title:T("label.acceleration"),type:"Numeric",position:"left",fields:["accelate_x","accelate_y","accelate_z"]},{title:T("label.velocity"),type:"Numeric",position:"right",fields:["velocity"]},{title:T("label.time"),type:"Time",position:"bottom",fields:["datetime"],dateFormat:"H:i:s",step:[Ext.Date.SECOND,1],label:{rotate:{degrees:45}}}],series:[{type:"line",highlight:{size:7,radius:7},fill:false,smooth:true,axis:"left",title:T("label.accelerate_x",{x:"X"}),xField:"datetime",yField:"accelate_x"},{type:"line",highlight:{size:7,radius:7},fill:false,smooth:true,axis:"left",title:T("label.accelerate_x",{x:"Y"}),xField:"datetime",yField:"accelate_y"},{type:"line",highlight:{size:7,radius:7},fill:false,smooth:true,axis:"left",title:T("label.accelerate_x",{x:"Z"}),xField:"datetime",yField:"accelate_z"},{type:"line",highlight:{size:7,radius:7},fill:false,smooth:true,axis:"right",title:T("label.velocity"),xField:"datetime",yField:"velocity"}]}}});Ext.define("HatioBB.view.driver.Summary",{extend:"Ext.form.Panel",requires:["Ext.form.FieldSet"],xtype:"driver_summary",config:{scrollable:true,cls:"grayBg",layout:{type:"vbox",align:"stretch"}},constructor:function(b){b.items=[this.buildDriverInfo(),{xtype:"container",itemId:"links",height:45,cls:"shotHList marginT10 divHAlign",data:null,tpl:['<div class="iconTime">'+T("label.total_run_time")+"<span>{total_run_time} "+T("label.parentheses_min")+"</span></div>",'<div class="iconMap">Move to<span>Current Position Map</span></div>','<div class="iconTrack">Move to<span>Recent Running Track</span></div>',].join("")},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[this.buildRunningInfo(),this.buildEcoDrivingInfo()]}];this.callParent(arguments);var a=this;this.on("painted",function(){HatioBB.setting.on("driver",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("driver",this.refresh,this)});this.element.on({delegate:"div.iconMap",tap:function(){var c=Ext.getStore("VehicleMapStore").findRecord("driver_id",a.driver);if(c){a.fireEvent("showMap",c.get("id"))}}});this.element.on({delegate:"div.iconTrack",tap:function(){var c=Ext.getStore("VehicleMapStore").findRecord("driver_id",a.driver);if(c){a.fireEvent("showTrack",c.get("id"))}}})},refresh:function(){var b=this;if(HatioBB.setting.get("driver")===this.driver){return}var a=Ext.getStore("DriverSummaryStore");this.driver=HatioBB.setting.get("driver");a.clearFilter(true);a.filter("id",this.driver);a.load(function(d){var e=d[0].data;if(e.eco_run_rate==0){e.eco_run_rate=Math.floor((e.eco_drv_time_of_month/e.run_time_of_month)*100)}var c=Math.floor(e.eco_index/20);e.eco_level=["E","D","C","B","A"][c];e.cost_reduction=[50,40,30,20,10][c];e.total_distance_mile=(e.total_distance*0.621371192237334).toFixed(2);e.run_dist_mile=(e.run_dist*0.621371192237334).toFixed(2);e.run_dist_mile_of_month=(e.run_dist_of_month*0.621371192237334).toFixed(2);b.down("[itemId=briefInfo]").setData(e);b.down("[itemId=briefInfo2]").setData(e);b.down("[itemId=links]").setData(e);b.down("[itemId=ecoInfo]").setData(e);b.down("[itemId=runningInfo]").setData(e);var g=e.image_clip;var f=b.down("[itemId=driverImage]");if(g){if(HatioBB.setting.get("app_mode")){f.setSrc("/download?blob-key="+g)}else{f.setSrc(g)}}else{f.setSrc("resources/images/bgDriver.png")}})},buildDriverInfo:function(){return{xtype:"panel",title:T("title.driver_information"),cls:"marginT10 marginL10",layout:{type:"hbox",align:"stretch"},items:[{xtype:"image",itemId:"driverImage",cls:"imgDriver"},{xtype:"component",itemId:"briefInfo",flex:1,data:null,tpl:['<div class="infoID">'+T("label.id")+" : {id}</div>",'<div class="infoText">'+T("label.division")+" : {division}</div>",'<div class="infoText">'+T("label.title")+" : {title}</div>",]},{xtype:"component",itemId:"briefInfo2",flex:1,data:null,tpl:['<div class="infoID">'+T("label.name")+" : {name}</div>",'<div class="infoText">'+T("label.social_id")+" : {social_id}</div>",'<div class="infoText">'+T("label.phone_x",{x:1})+" : {phone_no_1}</div>",]}]}},buildRunningInfo:function(){return{xtype:"component",itemId:"runningInfo",data:null,flex:1,cls:"paddingT25 paddingR10 paddingL10",tpl:['<div class="distance">','<div class="total">'+T("label.total_distance")+'<span class="km">{total_distance} km</span><span class="mile">{total_distance_mile} mile</span></div>','<div class="current">'+T("label.mileage_of_month")+'<span class="km">{run_dist_of_month} km</span><span class="mile">{run_dist_mile_of_month} mile</span></div>',"</div>",'<div class="fuel">',"<div>"+T("label.consumption_of_month")+" : <span>{consmpt_of_month} ℓ</span></div>","<div>"+T("label.fuel_efficiency")+" : <span>{effcc_of_month} km/ℓ</span></div>","</div>"]}},buildEcoDrivingInfo:function(){return{xtype:"component",itemId:"ecoInfo",flex:1,cls:"bgHGrident",width:265,tpl:['<div class="subtitle">'+T("label.eco_level")+"</div>",'<div class="ecoLevel {eco_level}"></div>','<div class="ecoHBox">',"<div>"+T("label.avg_effcc")+"/"+T("label.official_effcc")+" <span>{eco_index}%</span></div>","<div>"+T("label.eco_run_rate")+"<span>{eco_run_rate}%</span></div>","</div>",'<div class="ecoComment">'+T("msg.driver_eco_drv_result_msg",{x:"{eco_level}",y:"{cost_reduction}"})].join("")}}});Ext.define("HatioBB.view.chart.driver.Running",{extend:"Ext.Panel",xtype:"chart_d_running",requires:["Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category"],config:{title:T("title.chart_d_running"),cls:"grayBg",layout:{type:"vbox",align:"stretch"}},constructor:function(b){var a=this;this.callParent(arguments);this.chartStore=Ext.create("Ext.data.JsonStore",{fields:["year","month","consmpt","oos_cnt","co2_emss","mnt_time","mnt_cnt","run_dist","run_time","effcc"],data:[]});this.add(this.buildRunChart(this.chartStore));this.add(this.buildFuelChart(this.chartStore));this.on("painted",function(){HatioBB.setting.on("driver",this.refresh,this);HatioBB.setting.on("fromYear",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("driver",this.refresh,this);HatioBB.setting.un("fromYear",this.refresh,this)})},getChart:function(){if(!this.chart){this.chart=this.getAt(0)}return this.chart},refresh:function(d,c){if(HatioBB.setting.get("driver")===this.driver&&HatioBB.setting.get("fromYear")===this.fromYear){return}var b=this;var d=Ext.getStore("DriverRunStore");var e=new Date().getFullYear();var a=new Date().getMonth()+1;this.driver=HatioBB.setting.get("driver");this.fromYear=HatioBB.setting.get("fromYear")||(e-1);d.load({params:{driver:this.driver,from_year:this.fromYear,to_year:e,from_month:1,to_month:a},callback:function(f){b.chartStore.setData(f)}})},buildRunChart:function(a){return{xtype:"chart",store:a,animate:true,shadow:false,toolbar:null,flex:1,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"17px Arial"},axes:[{type:"Category",position:"bottom",fields:["month_str"],title:"Month of the Year"},{type:"Numeric",position:"left",fields:["run_time"],title:"Run Minutes",minimum:0},{type:"Numeric",position:"right",fields:["run_dist"],title:"Run Distance",minimum:0}],series:[{type:"column",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"left",xField:"month_str",yField:"run_time",title:"Run Minutes"},{type:"line",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"right",xField:"month_str",yField:"run_dist",title:"Run Distance"}]}},buildFuelChart:function(a){return{xtype:"chart",store:a,animate:true,shadow:false,toolbar:null,flex:1,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"17px Arial"},axes:[{type:"Category",position:"bottom",fields:["month_str"],title:"Month of the Year"},{type:"Numeric",position:"left",fields:["consmpt"],title:"Fuel Consumption",minimum:0},{type:"Numeric",position:"right",fields:["effcc"],title:"Fuel Efficiency",minimum:0}],series:[{type:"column",highlight:{size:7,radius:7},smooth:true,axis:"left",xField:"month_str",yField:["consmpt"],title:"Fuel Consumption"},{type:"line",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"right",xField:"month_str",yField:"effcc",title:"Fuel Efficiency"}]}}});Ext.define("HatioBB.view.chart.driver.EcoRadar",{extend:"Ext.Panel",xtype:"chart_d_eco_radar",requires:["Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category"],config:{title:T("title.chart_d_eco_radar"),cls:"grayBg",layout:"fit"},constructor:function(b){var a=this;this.callParent(arguments);this.on("painted",function(){HatioBB.setting.on("driver",this.refresh,this);HatioBB.setting.on("fromYear",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("driver",this.refresh,this);HatioBB.setting.un("fromYear",this.refresh,this)})},refresh:function(d,c){if(HatioBB.setting.get("driver")===this.driver&&HatioBB.setting.get("fromYear")===this.fromYear){return}var b=this;var d=Ext.getStore("DriverRunStore");var e=new Date().getFullYear();var a=new Date().getMonth()+1;this.driver=HatioBB.setting.get("driver");this.fromYear=HatioBB.setting.get("fromYear")||(e-1);d.load({params:{driver:this.driver,from_year:this.fromYear,to_year:e,from_month:1,to_month:a},callback:function(i){var h=this.getGroups();var k={overSpdTime:{name:T("label.ovr_spd_time")},sudAccelCnt:{name:T("label.sud_accel_cnt")},sudBrakeCnt:{name:T("label.sud_brake_cnt")},idleTime:{name:T("label.idle_time")},ecoDrvTime:{name:T("label.eco_drv_time")},efficiency:{name:T("label.fuel_efficiency")},ecoIndex:{name:T("label.eco_index")},co2Emss:{name:T("label.co2_emissions")}};var g=[];Ext.Array.each(h,function(u){var r=u.name.toString();var m=u.children;var s=0;var q=0;var n=0;var v=0;var t=0;var p=0;var w=0;var l=0;var o=0;Ext.each(m,function(x){if(x.get("driver")){s+=1}if(x.get("eco_drv_time")){q+=x.get("eco_drv_time")}if(x.get("effcc")){n+=x.get("effcc")}if(x.get("ovr_spd_time")){v+=x.get("ovr_spd_time")}if(x.get("sud_accel_cnt")){t+=x.get("sud_accel_cnt")}if(x.get("sud_brake_cnt")){p+=x.get("sud_brake_cnt")}if(x.get("eco_index")){w+=x.get("eco_index")}if(x.get("co2_emss")){l+=x.get("co2_emss")}if(x.get("idle_time")){o+=x.get("idle_time")}});q=q/s;n=n/s;v=v/s;t=t/s;p=p/s;w=w/s;l=l/s;o=o/s;k.ecoIndex[r]=Math.floor(w/5);k.ecoDrvTime[r]=q;k.efficiency[r]=n;k.co2Emss[r]=Math.floor(l/10);k.overSpdTime[r]=v;k.sudAccelCnt[r]=t;k.sudBrakeCnt[r]=p;k.idleTime[r]=o;g.push(r)});var j=[];for(var f in k){j.push(k[f])}if(b.chart){b.remove(b.chart)}b.chart=b.add(b.buildChart(g,j))}})},buildChart:function(a,d){var b=Ext.create("Ext.data.JsonStore",{fields:Ext.Array.merge(a,["name"]),data:d});var c=Ext.Array.map(a,function(e){return{showInLegend:false,showMarkers:true,type:"radar",xField:"name",yField:e,style:{opacity:0.4},markerConfig:{radius:3,size:5}}});return{xtype:"chart",themeCls:"radar1",theme:"Demo",insetPadding:30,shadow:true,animate:true,store:b,interactions:["rotate","reset"],legend:{position:"bottom"},axes:[{type:"Radial",position:"radial",label:{display:true}}],series:c}}});Ext.define("HatioBB.view.vehicle.Summary",{extend:"Ext.Panel",xtype:"vehicle_summary",requires:["HatioBB.store.VehicleSummaryStore"],config:{scrollable:true,cls:"grayBg",layout:{type:"vbox",align:"stretch"}},constructor:function(b){b.items=[this.buildVehicleInfo(),{xtype:"component",itemId:"links",height:45,data:{},cls:"shotHList marginT10 divHAlign",tpl:['<div class="iconFuel">'+T("label.remaining_fuel")+"<span>{remaining_fuel}</span></div>",'<div class="iconTime">'+T("label.total_run_time")+"<span>{total_run_time} "+T("label.parentheses_min")+"</span></div>",'<div class="iconMap">Move to<span>Current Position Map</span></div>','<div class="iconTrack">Move to<span>Recent Running Track</span></div>'].join("")},{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",flex:1,layout:{type:"vbox",align:"stretch"},items:[this.buildRunningInfo(),this.buildConsumableInfo(),this.buildMaintenenceInfo()]},this.buildEcoDrivingInfo()]}];this.callParent(arguments);var a=this;this.on("painted",function(){HatioBB.setting.on("vehicle",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("vehicle",this.refresh,this)});this.element.on({delegate:"div.iconMap",tap:function(){a.fireEvent("showMap",a.vehicle)}});this.element.on({delegate:"div.iconTrack",tap:function(){a.fireEvent("showTrack",a.vehicle)}})},refresh:function(){var b=this;if(HatioBB.setting.get("vehicle")===this.vehicle){return}var a=Ext.getStore("VehicleSummaryStore");this.vehicle=HatioBB.setting.get("vehicle");a.clearFilter(true);a.filter("id",this.vehicle);a.load(function(d){var g=d[0].getData();var e=g.vehicle;var l=g.consumables;var c=g.maint;if(!e.eco_index){e.eco_index=Math.floor((e.avg_effcc/e.official_effcc)*100)}e.total_distance_mile=(e.total_distance*0.621371192237334).toFixed(2);e.run_dist_mile_of_month=(e.run_dist_of_month*0.621371192237334).toFixed(2);var k=Math.floor(e.eco_index/20);e.eco_level=["E","D","C","B","A"][k];e.cost_reduction=[50,40,30,20,10][k];var f=b.down("[itemId=vehicleImage]");if(e.image_clip){if(HatioBB.setting.get("app_mode")){f.setSrc("/download?blob-key="+e.image_clip)}else{f.setSrc(e.image_clip)}}else{f.setSrc("resources/images/bgVehicle.png")}b.down("[itemId=briefInfo]").setData(e);b.down("[itemId=briefInfo2]").setData(e);b.down("[itemId=links]").setData(e);b.down("[itemId=ecoInfo]").setData(e);b.down("[itemId=runningInfo]").setData(e);var j=Ext.Array.sort(l,function(n,m){return m.health_rate-n.health_rate});b.down("[itemId=consumableInfo]").setData(Ext.Array.map(j.slice(0,3),function(m){m.health_rate_max=Math.min(1,m.health_rate).toFixed(2)*100;m.health_rate=(m.health_rate*100).toFixed(2);return m}));var i=['<div class="subtitle">'+T("title.maintenance")+"</div>"];var h=c?T("msg.maint_on_x_next_y",{x:c.repair_date,y:c.next_repair_date}):T("msg.no_maint_history");i.push('<div class="itemCell">'+h+"</div>");b.down("[itemId=maintInfo]").setHtml(i.join(""))})},buildVehicleInfo:function(){return{xtype:"panel",title:T("title.vehicle_information"),cls:"marginT10 marginL10",layout:{type:"hbox",align:"stretch"},items:[{xtype:"image",itemId:"vehicleImage",cls:"imgVehicle"},{xtype:"component",itemId:"briefInfo",flex:1,data:null,tpl:['<div class="infoID {status}">{id}</div>','<div class="infoText">'+T("label.vehicle_type")+" : {vehicle_type}</div>",'<div class="infoText">'+T("label.manufacturer")+" : {manufacturer}</div>",]},{xtype:"component",itemId:"briefInfo2",flex:1,data:null,tpl:['<div class="infoID">'+T("label.reg_no")+" : {registration_number}</div>",'<div class="infoText">'+T("label.birth_year")+" : {birth_year}</div>",'<div class="infoText">'+T("label.fuel_type")+" : {fuel_type}</div>"]}]}},buildRunningInfo:function(){return{xtype:"component",itemId:"runningInfo",data:null,flex:1,cls:"paddingT25 paddingR10 paddingL10",tpl:['<div class="distance">','<div class="total">'+T("label.total_distance")+'<span class="km">{total_distance} km</span><span class="mile">{total_distance_mile} mile</span></div>','<div class="current">'+T("label.mileage_of_month")+'<span class="km">{run_dist_of_month} km</span><span class="mile">{run_dist_mile_of_month} mile</span></div>',"</div>",'<div class="fuel">',"<div>"+T("label.consumption_of_month")+" : <span>{consmpt_of_month} ℓ</span></div>","<div>"+T("label.fuel_efficiency")+" : <span>{effcc_of_month} km/ℓ</span></div>","</div>"]}},buildConsumableInfo:function(){return{xtype:"component",itemId:"consumableInfo",flex:1,cls:"summaryConsumable",tpl:['<div class="subtitle">'+T("title.consumable_item")+"</div>",'<tpl for=".">','<div class="itemCell">{consumable_item} <div class="percent"><span style="width:{health_rate_max}%">{health_rate}%</span></div></div>',"</tpl>"],}},buildMaintenenceInfo:function(){return{xtype:"component",itemId:"maintInfo",flex:1,cls:"summaryRepair",html:""}},buildEcoDrivingInfo:function(){return{xtype:"component",itemId:"ecoInfo",cls:"bgHGrident",width:265,tpl:['<div class="subtitle">'+T("label.eco_level")+"</div>",'<div class="ecoLevel {eco_level}"></div>','<div class="ecoHBox">',"<div>"+T("label.avg_effcc")+" / "+T("label.official_effcc")+" <span>{eco_index}%</span></div>","<div>"+T("label.eco_run_rate")+"<span>{eco_run_rate}%</span></div>","</div>",'<div class="ecoComment">'+T("msg.vehicle_eco_drv_result_msg",{x:"{eco_level}",y:"{cost_reduction}"})].join("")}}});Ext.define("HatioBB.view.chart.vehicle.Running",{extend:"Ext.Panel",xtype:"chart_v_running",requires:["Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category"],config:{title:T("title.chart_v_running"),cls:"grayBg",layout:{type:"vbox",align:"stretch"}},constructor:function(b){var a=this;this.callParent(arguments);this.chartStore=Ext.create("Ext.data.JsonStore",{fields:["year","month","consmpt","oos_cnt","co2_emss","mnt_time","mnt_cnt","run_dist","run_time","effcc"],data:[]});this.add(this.buildRunChart(this.chartStore));this.add(this.buildFuelChart(this.chartStore));this.on("painted",function(){HatioBB.setting.on("vehicle",this.refresh,this);HatioBB.setting.on("fromYear",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("vehicle",this.refresh,this);HatioBB.setting.un("fromYear",this.refresh,this)})},getChart:function(){if(!this.chart){this.chart=this.getAt(0)}return this.chart},refresh:function(d,c){if(HatioBB.setting.get("vehicle")===this.vehicle&&HatioBB.setting.get("fromYear")===this.fromYear){return}var b=this;var d=Ext.getStore("VehicleRunStore");var e=new Date().getFullYear();var a=new Date().getMonth()+1;this.vehicle=HatioBB.setting.get("vehicle");this.fromYear=HatioBB.setting.get("fromYear")||(e-1);d.load({params:{vehicle:this.vehicle,from_year:this.fromYear,to_year:e,from_month:1,to_month:a},callback:function(f){b.chartStore.setData(f)}})},buildRunChart:function(a){return{xtype:"chart",store:a,animate:true,shadow:false,toolbar:null,flex:1,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"17px Arial"},axes:[{type:"Category",position:"bottom",fields:["month_str"],title:"Month of the Year"},{type:"Numeric",position:"left",fields:["run_time"],title:"Run Minutes",minimum:0},{type:"Numeric",position:"right",fields:["run_dist"],title:"Run Distance",minimum:0}],series:[{type:"column",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"left",xField:"month_str",yField:"run_time",title:"Run Minutes"},{type:"line",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"right",xField:"month_str",yField:"run_dist",title:"Run Distance"}]}},buildFuelChart:function(a){return{xtype:"chart",store:a,animate:true,shadow:false,toolbar:null,flex:1,legend:{position:{portrait:"bottom",landscape:"bottom"},labelFont:"17px Arial"},axes:[{type:"Category",position:"bottom",fields:["month_str"],title:"Month of the Year"},{type:"Numeric",position:"left",fields:["consmpt"],title:"Fuel Consumption",minimum:0},{type:"Numeric",position:"right",fields:["effcc"],title:"Fuel Efficiency",minimum:0}],series:[{type:"column",highlight:{size:7,radius:7},smooth:true,axis:"left",xField:"month_str",yField:["consmpt"],title:"Fuel Consumption"},{type:"line",highlight:{size:7,radius:7},fill:true,smooth:true,axis:"right",xField:"month_str",yField:"effcc",title:"Fuel Efficiency"}]}}});Ext.define("HatioBB.view.chart.vehicle.Consumable",{extend:"Ext.Panel",xtype:"chart_v_consumable",requires:["Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category","Ext.chart.series.Column",],config:{title:T("title.chart_v_consumable"),cls:"grayBg",layout:"fit"},constructor:function(b){var a=this;this.callParent(arguments);var c=this.add(this.buildChart());this.on("painted",function(){HatioBB.setting.on("vehicle",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("vehicle",this.refresh,this)})},getChart:function(){if(!this.chart){this.chart=this.getAt(0)}return this.chart},refresh:function(){if(HatioBB.setting.get("vehicle")===this.vehicle){return}var b=this;this.vehicle=HatioBB.setting.get("vehicle");var a=Ext.getStore("VehicleConsumableStore");this.vehicle=HatioBB.setting.get("vehicle");a.load({params:{vehicle_id:this.vehicle},callback:function(c){b.getChart().getStore().setData(c)}})},buildChart:function(a){var a=new Ext.create("Ext.data.JsonStore",{fields:["consumable_item","health_rate","repl_unit","status","next_repl_mileage","miles_since_last_repl","repl_mileage","accrued_cost","repl_time","miles_last_repl"],data:[]});return{xtype:"chart",store:a,themeCls:"column1",animate:{easing:"bounceOut",duration:750},shadow:false,toolbar:null,gradients:[{id:"overdue",angle:0,stops:{0:{color:"rgb(212, 40, 40)"},70:{color:"rgb(212, 216, 42)"},100:{color:"rgb(14, 117, 14)"}}},{id:"impending",angle:0,stops:{0:{color:"rgb(242, 176, 40)"},20:{color:"rgb(212, 216, 42)"},100:{color:"rgb(14, 117, 14)"}}},{id:"healthy",angle:0,stops:{100:{color:"rgb(14, 117, 14)"}}}],axes:[{type:"Numeric",position:"left",fields:["health_rate"],grid:{stroke:"#ccc"},label:{renderer:function(b){return Math.floor(b*100)}},title:"Health Rate",majorTickSteps:10},{type:"Category",position:"bottom",fields:["consumable_item"],title:"Consumable Item",label:{rotate:{degrees:315}}}],series:[{type:"column",axis:"left",highlight:true,renderer:function(f,g,e,d,c){var b=g.get("health_rate");if(b>1){e.fill="url(#overdue)"}else{if(b>0.9){e.fill="url(#impending)"}else{e.fill="url(#healthy)"}}return e},listeners:{itemtap:function(b,c){}},label:{display:"outside","text-anchor":"middle",field:"status",orientation:"horizontal",color:"#333",},xField:"consumable_item",yField:"health_rate"}]}}});Ext.define("HatioBB.view.vehicle.Repair",{extend:"Ext.Panel",xtype:"vehicle_repair",config:{cls:"grayBg",layout:"fit"},constructor:function(a){a.items=[{docked:"top"},this.buildReport(),{docked:"bottom"}];this.callParent(arguments);this.on("painted",function(){HatioBB.setting.on("vehicle",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("vehicle",this.refresh,this)})},refresh:function(){var a=this;var b=Ext.getStore("VehicleRepairStore");this.vehicle=HatioBB.setting.get("vehicle");b.clearFilter(true);b.filter("vehicle_id",this.vehicle);b.load(function(c){var f=[];for(var d=0;d<c.length;d++){var e=c[d].data;e.repair_date=Ext.util.Format.date(e.repair_date,"Y-m-d");f.push(e)}a.down("[itemId=report]").setData(f)})},buildReport:function(){return{xtype:"panel",itemId:"report",data:{},cls:"bgHGradient",scrollable:"vertical",tpl:['<div class="reportWrap type2">','<div class="reportLayoutFull">','<div class="reportTitle">'+T("title.maintenance_history")+"<span></span></div>",'<div class="reportItem">','<table frame="hsides" rules="rows">',"<tr>","<th>"+T("label.repair_date")+"</th>","<th>"+T("label.repair_time")+T("label.parentheses_min")+"</th>","<th>"+T("label.repair_mileage")+" km</th>","</tr>",'<tpl for=".">',"<tr>",'<td class="alignCenter">{repair_date}</td>','<td class="alignCenter">{repair_time}</td>','<td class="alignCenter">{repair_mileage}</td>',"</tr>","</tpl>","</table>","</div>","</div>",]}}});Ext.define("HatioBB.view.chart.vehicle.EcoRadar",{extend:"Ext.Panel",xtype:"chart_v_eco_radar",requires:["Ext.chart.Chart","Ext.chart.axis.Numeric","Ext.chart.axis.Category"],config:{title:T("title.chart_v_eco_radar"),cls:"grayBg",layout:"fit"},constructor:function(b){var a=this;this.callParent(arguments);this.on("painted",function(){HatioBB.setting.on("vehicle",this.refresh,this);HatioBB.setting.on("fromYear",this.refresh,this);this.refresh()});this.on("erased",function(){HatioBB.setting.un("vehicle",this.refresh,this);HatioBB.setting.un("fromYear",this.refresh,this)})},refresh:function(d,c){if(HatioBB.setting.get("vehicle")===this.vehicle&&HatioBB.setting.get("fromYear")===this.fromYear){return}var b=this;var d=Ext.getStore("VehicleRunStore");var e=new Date().getFullYear();var a=new Date().getMonth()+1;this.vehicle=HatioBB.setting.get("vehicle");this.fromYear=HatioBB.setting.get("fromYear")||(e-1);d.load({params:{vehicle:this.vehicle,from_year:this.fromYear,to_year:e,from_month:1,to_month:a},callback:function(i){var h=this.getGroups();var k={overSpdTime:{name:T("label.ovr_spd_time")},sudAccelCnt:{name:T("label.sud_accel_cnt")},sudBrakeCnt:{name:T("label.sud_brake_cnt")},idleTime:{name:T("label.idle_time")},ecoDrvTime:{name:T("label.eco_drv_time")},efficiency:{name:T("label.fuel_efficiency")},ecoIndex:{name:T("label.eco_index")},co2Emss:{name:T("label.co2_emissions")}};var g=[];Ext.Array.each(h,function(u){var r=u.name.toString();var m=u.children;var s=0;var q=0;var n=0;var v=0;var t=0;var p=0;var w=0;var l=0;var o=0;Ext.each(m,function(x){if(x.get("vehicle")){s+=1}if(x.get("eco_drv_time")){q+=x.get("eco_drv_time")}if(x.get("effcc")){n+=x.get("effcc")}if(x.get("ovr_spd_time")){v+=x.get("ovr_spd_time")}if(x.get("sud_accel_cnt")){t+=x.get("sud_accel_cnt")}if(x.get("sud_brake_cnt")){p+=x.get("sud_brake_cnt")}if(x.get("eco_index")){w+=x.get("eco_index")}if(x.get("co2_emss")){l+=x.get("co2_emss")}if(x.get("idle_time")){o+=x.get("idle_time")}});q=q/s;n=n/s;v=v/s;t=t/s;p=p/s;w=w/s;l=l/s;o=o/s;k.ecoIndex[r]=Math.floor(w/5);k.ecoDrvTime[r]=q;k.efficiency[r]=n;k.co2Emss[r]=Math.floor(l/10);k.overSpdTime[r]=v;k.sudAccelCnt[r]=t;k.sudBrakeCnt[r]=p;k.idleTime[r]=o;g.push(r)});var j=[];for(var f in k){j.push(k[f])}if(b.chart){b.remove(b.chart)}b.chart=b.add(b.buildChart(g,j))}})},buildChart:function(a,d){var b=Ext.create("Ext.data.JsonStore",{fields:Ext.Array.merge(a,["name"]),data:d});var c=Ext.Array.map(a,function(e){return{showInLegend:false,showMarkers:true,type:"radar",xField:"name",yField:e,style:{opacity:0.4},markerConfig:{radius:3,size:5}}});return{xtype:"chart",themeCls:"radar1",theme:"Demo",insetPadding:30,shadow:true,animate:true,store:b,interactions:["rotate","reset"],legend:{position:"bottom"},axes:[{type:"Radial",position:"radial",label:{display:true}}],series:c}}});Ext.define("HatioBB.controller.Report",{extend:"Ext.app.Controller",requires:["HatioBB.view.report.AreaChart","HatioBB.view.report.BarChart","HatioBB.view.report.ColumnChart","HatioBB.view.report.LineChart","HatioBB.view.report.PieChart","HatioBB.view.report.DailyReport","HatioBB.view.report.DailyReport2","HatioBB.view.report.DailyReport3","HatioBB.view.report.MonthlyReport","HatioBB.view.chart.vehicle.VehicleHealth","HatioBB.view.report.EfficiencyReport","HatioBB.view.report.EcoDrivingReport"],config:{refs:{content:"content",header:"header",navReport:"nav_report"},control:{nav_report:{itemtap:"onItemTap"},"chart_v_health #xxx":{itemtap:function(a,b){Ext.Msg.alert("ItemTap",b);this.showReport("rpt_pie")}}}},onItemTap:function(b,c,d,a){this.showReport(a.get("reportId"))},showReport:function(b){var a=this.getContent().getComponent(b);if(!a){this.getContent().removeAll();a=this.getContent().add({xtype:b})}this.getContent().setActiveItem(a);this.getHeader().clearActiveStatus();return a}});Ext.define("HatioBB.controller.monitor.Track",{extend:"Ext.app.Controller",requires:["HatioBB.view.monitor.Track"],config:{refs:{track:"track",map:"track map",buttonDays:"track button",buttonToday:"track button[itemId=today]",buttonYesterday:"track button[itemId=yesterday]",buttonAgo2days:"track button[itemId=ago2days]",buttonAgo3days:"track button[itemId=ago3days]"},control:{track:{initialize:"onInit",refresh:"delayRefresh"},buttonDays:{tap:"onButtonDays"}}},onInit:function(){var a=this;var b=new Date();this.getButtonToday().setData({date:Ext.Date.format(b,"D Y-m-d")});b.setDate(b.getDate()-1);this.getButtonYesterday().setData({date:Ext.Date.format(b,"D Y-m-d")});b.setDate(b.getDate()-1);this.getButtonAgo2days().setData({date:Ext.Date.format(b,"D Y-m-d")});b.setDate(b.getDate()-1);this.getButtonAgo3days().setData({date:Ext.Date.format(b,"D Y-m-d")});function d(){var h=a.getTrack().getPathMarkers();if(!h){return}var f=Math.max(1,(16-a.getMap().getMap().getZoom())*3);var e=0;for(var g=0;g<h.length;g++){setTimeout(function(){h[e++].setOptions({visible:e%f?false:true,animation:google.maps.Animation.DROP})},g*20)}}function c(){a.getTrack().unselectTrip()}this.getTrack().on("painted",function(){switch(a.getTrack().config.queryOn){case"driver":HatioBB.setting.on("driver",a.refresh,a);break;case"vehicle":HatioBB.setting.on("vehicle",a.refresh,a);break;default:HatioBB.setting.on("driver",a.delayRefresh,a);HatioBB.setting.on("vehicle",a.delayRefresh,a)}a.delayRefresh()});this.getTrack().on("erased",function(){switch(a.getTrack().config.queryOn){case"driver":HatioBB.setting.un("driver",a.refresh,a);break;case"vehicle":HatioBB.setting.un("vehicle",a.refresh,a);break;default:HatioBB.setting.un("driver",a.delayRefresh,a);HatioBB.setting.un("vehicle",a.delayRefresh,a)}});this.getTrack().on("resize",function(){google.maps.event.trigger(a.getMap().getMap(),"resize")});google.maps.event.addListener(a.getMap().getMap(),"click",c);google.maps.event.addListener(a.getMap().getMap(),"zoom_changed",d)},onButtonDays:function(a){var c,b;c=new Date();c.setHours(0);c.setMinutes(0);c.setSeconds(0);c.setMilliseconds(0);this.getButtonToday().removeCls("x-button-active");this.getButtonYesterday().removeCls("x-button-active");this.getButtonAgo2days().removeCls("x-button-active");this.getButtonAgo3days().removeCls("x-button-active");switch(a.getItemId()){case"today":this.getButtonToday().addCls("x-button-active");break;case"yesterday":this.getButtonYesterday().addCls("x-button-active");c.setDate(c.getDate()-1);break;case"ago2days":this.getButtonAgo2days().addCls("x-button-active");c.setDate(c.getDate()-2);break;case"ago3days":this.getButtonAgo3days().addCls("x-button-active");c.setDate(c.getDate()-3);break}b=new Date(c.getTime()+24*60*60*1000);this.from=c;this.to=b;this.refresh(a)},delayRefresh:function(){if(this.onProcessing){return}this.onProcessing=true;var a=this;setTimeout(function(){try{a.refresh()}finally{a.onProcessing=false}},100)},refresh:function(c){var b=this;if(!c||!this.from||!this.to){var h,g;this.getButtonYesterday().removeCls("x-button-active");this.getButtonAgo2days().removeCls("x-button-active");this.getButtonAgo3days().removeCls("x-button-active");this.getButtonToday().addCls("x-button-active");h=new Date();h.setHours(0);h.setMinutes(0);h.setSeconds(0);h.setMilliseconds(0);g=new Date(h.getTime()+24*60*60*1000);this.from=h;this.to=g}var e,f;switch(this.getTrack().config.queryOn){case"driver":e=HatioBB.setting.get("driver");break;case"vehicle":f=HatioBB.setting.get("vehicle");break;default:e=HatioBB.setting.get("driver");f=HatioBB.setting.get("vehicle")}var a=Ext.getStore("TrackStore");var d=[{property:"date",value:Math.round(this.from.getTime()/1000)}];if(e){d.push({property:"driver_id",value:e})}if(f){d.push({property:"vehicle_id",value:f})}a.clearFilter(true);a.filter(d);a.load(function(i){b.refreshMap(i)})},refreshMap:function(f){var l=this;var c=this.getMap().getMap();this.getTrack().resetTrackLines();this.getTrack().setTripMarkers(null);this.getTrack().resetPathMarkers();this.getTrack().clearInfoWindow();var d;var i=[];var a,e,k;var j=[];var b=0;Ext.Array.each(f,function(n){if(!d){d=new google.maps.Polyline({map:c,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:4});path=d.getPath();if(k){path.push(e);i.push(k);j.push(k.get("velocity"))}}var q=n.get("lat");var o=n.get("lng");if(q!==0||o!==0){e=new google.maps.LatLng(q,o);if(!a){a=new google.maps.LatLngBounds(e,e)}else{a.extend(e)}}if(k&&(k.get("datetime")>n.get("datetime")+30*60*1000)){var p=Ext.Array.sum(j)/j.length;l.getTrack().addTrackLine(c,i,d,p,b);d=null;path=[];i=[];j=[];b=0}if(d){path.push(e);i.push(n);j.push(n.get("velocity"));if(i.length>1){b+=HatioBB.map.distance(k.get("lat"),k.get("lng"),n.get("lat"),n.get("lng"),"K")}}k=n});if(!a){var g=new google.maps.LatLng(System.props.lat,System.props.lng);a=new google.maps.LatLngBounds(g,g);var h=['<div class="bubbleWrap">',"<div>기간내 주행이력이 없습니다.</div>","</div>"].join("");if(!this.getTrack().getInfoWindow()){this.getTrack().setInfoWindow(HatioBB.label.create({map:c,xoffset:-110,yoffset:-100}))}else{this.getTrack().getInfoWindow().setMap(c)}this.getTrack().getInfoWindow().set("position",g);this.getTrack().getInfoWindow().set("text",h);this.getTrack().getInfoWindow().setVisible(true)}else{var m=Ext.Array.sum(j)/j.length;this.getTrack().addTrackLine(c,i,d,m,b)}if(a.isEmpty()||a.getNorthEast().equals(a.getSouthWest())){c.setCenter(a.getNorthEast())}else{c.fitBounds(a)}}});Ext.define("HatioBB.view.Nav",{extend:"Ext.navigation.View",xtype:"nav",requires:["Ext.dataview.List","HatioBB.view.nav.NavMenu","HatioBB.view.nav.NavVehicle","HatioBB.view.nav.NavDriver","HatioBB.view.nav.NavFav","HatioBB.view.nav.NavComm","HatioBB.view.nav.NavNoti","HatioBB.view.nav.NavReport"],config:{items:[{xtype:"container",cls:"mainNav",layout:{type:"vbox"},items:[{xtype:"button",id:"nav_vehicle",text:T("menu.vehicle"),cls:"navBtn",iconCls:"iconVehicle"},{xtype:"button",id:"nav_driver",text:T("menu.driver"),cls:"navBtn",iconCls:"iconDriver"},{xtype:"button",id:"nav_report",text:T("menu.report"),cls:"navBtn",iconCls:"iconReport"},{xtype:"panel",itemId:"status",height:115,layout:{type:"hbox",align:"stretch"},cls:"statusPanel",items:[{xtype:"button",itemId:"state_running",flex:1,cls:"btnDriving",state:"Running"},{xtype:"button",itemId:"state_idle",flex:1,cls:"btnStop",state:"Idle"},{xtype:"button",itemId:"state_incident",flex:1,cls:"btnIncident",state:"Incident"},{xtype:"button",itemId:"state_maint",flex:1,cls:"btnMaint",state:"Maint"}]},{xtype:"carousel",direction:"horizontal",flex:1,items:[{xtype:"panel",itemId:"incidents",scrollable:{direction:"vertical",directionLock:true},cls:"incidentPanel",html:T("title.incidents_alarm"),},{xtype:"panel",itemId:"vgroups",cls:"groupPanel vGroup",html:T("title.vehicle_group"),},{xtype:"panel",itemId:"dgroups",cls:"groupPanel dGroup",html:T("title.driver_group"),}]}]}]}});Ext.define("HatioBB.view.monitor.Incident",{extend:"Ext.TabPanel",requires:["HatioBB.view.chart.vehicle.Accel"],xtype:"monitor_incident",id:"monitor_incident",config:{tabBarPosition:"bottom"},constructor:function(b){b.items=[this.zInfo,this.zVideo,this.zChart];this.callParent(arguments);var a=this;this.storeHandler=function(d,c){a.refreshTrack(d,c)};a.getLogStore().on("load",this.storeHandler);a.items.items[0].on("activate",function(){a.refresh()});a.items.items[0].down("[itemId=confirm]").on("change",function(g,e,i,h,f){Ext.Ajax.request({url:"/incident/save",method:"POST",params:{key:a.incident.get("key"),confirm:f[0]?"on":"off"},success:function(c){if(f[0]){Ext.Msg.alert("성공","이상상황 정보가 확인 처리되었습니다. 이상상황 리스트에서 잠시 후 사라지게 됩니다. 리스트에서 유지하고 싶으면, 다시 미확인으로 변경하시기 바랍니다.",Ext.emptyFn)}else{Ext.Msg.alert("성공","이상상황 정보가 미확인 처리되었습니다. 이상상황 리스트에 다시 유지되게 됩니다. 리스트에서 제거하고 싶으면, 다시 확인으로 변경하시기 바랍니다.",Ext.emptyFn)}},failure:function(c){Ext.Msg.alert("실패","이상상황 정보가 확인 처리가 실패되였습니다.("+c.status+")",Ext.emptyFn);g.setValue(a.incident.get("confirm"))}})})},destroy:function(){this.getLogStore().un("load",this.storeHandler);this.callParent(arguments)},refresh:function(){this.setIncident()},setIncident:function(i){var l=this;if(!i){if(this.incident){i=this.incident}else{i=Ext.getStore("RecentIncidentStore").first();if(!i&&!this.isHidden()){setTimeout(function(){l.setIncident()},3000);return}}}if(!i||i.isDestroyed){return}this.incident=i;this.incident.set("obd_connected_text",this.incident.get("obd_connected")?"connected":"disconnected");HatioBB.setting.set("driver",i.get("driver_id"));HatioBB.setting.set("vehicle",i.get("vehicle_id"));var h=Ext.getStore("VehicleMapStore");var f=h.findRecord("id",i.get("vehicle_id"));var e=f.get("image_clip");var g=this.sub("vehicleImage");if(e){if(HatioBB.setting.get("app_mode")){g.setSrc("/download?blob-key="+e)}else{g.setSrc(e)}}else{g.setSrc("resources/images/bgVehicle.png")}i.set("registration_number",f.get("registration_number"));var d=Ext.getStore("DriverBriefStore");var b=d.findRecord("id",i.get("driver_id"));var k=b.get("id");var c=b.get("image_clip");var m=this.sub("driverImage");if(c){if(HatioBB.setting.get("app_mode")){m.setSrc("/download?blob-key="+c)}else{m.setSrc(c)}}else{m.setSrc("resources/images/bgDriver.png")}i.set("driver_name",b.get("name"));i.set("location","Resolving ..");this.getLocation(i.get("lat"),i.get("lng"),function(n){i.set("location",n);l.sub("briefInfo").setData(i.getData())});this.sub("briefInfo").setData(i.getData());this.sub("detailInfo").setData(i.getData());this.sub("confirm").setValue(i.get("confirm"));this.getLogStore().clearFilter(true);this.getLogStore().filter([{property:"incident",value:i.get("key")}]);this.getLogStore().load();var a="";var j=i.get("video_clip");if(j!=null&&j.length>1){if(j.indexOf("http")==0){a=j}else{a="/download?blob-key="+j}}this.sub("video").updateUrl([a])},getIncident:function(){return this.incident},getLogStore:function(){if(!this.logStore){this.logStore=Ext.getStore("IncidentLogStore")}return this.logStore},getMap:function(){if(!this.map){this.map=this.getAt(0).down("#map").getMap()}return this.map},getTrackLine:function(){return this.trackline},setTrackLine:function(a){if(this.trackline){this.trackline.setMap(null)}this.trackline=a},getMarker:function(){return this.marker},setMarker:function(a){if(this.marker){this.marker.setMap(null)}this.marker=a},setMarkers:function(a){if(this.markers){Ext.each(this.markers,function(b){b.setMap(null)})}this.markers=a},resetMarkers:function(){if(this.markers){Ext.each(this.markers,function(a){a.setMap(null)})}this.markers=null},clearInfoWindow:function(){if(this.infowindow){this.infowindow.setVisible(false)}},refreshTrack:function(k,d){this.setTrackLine(new google.maps.Polyline({map:this.getMap(),strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:4}));this.clearInfoWindow();var m=this.getTrackLine().getPath();var a;var c;Ext.Array.each(d,function(n){c=new google.maps.LatLng(n.get("lat"),n.get("lng"));m.push(c);if(!a){a=new google.maps.LatLngBounds(c,c)}else{a.extend(c)}});if(!a){return}if(a.isEmpty()||a.getNorthEast().equals(a.getSouthWest())){this.getMap().setCenter(a.getNorthEast())}else{this.getMap().fitBounds(a)}var h=m.getAt(0);if(h){var b=new google.maps.Marker({position:new google.maps.LatLng(h.lat(),h.lng()),icon:"resources/images/iconStartPoint.png",map:this.getMap()});var l=m.getAt(m.getLength()-1);var f=new google.maps.Marker({position:new google.maps.LatLng(l.lat(),l.lng()),map:this.getMap()});this.setMarkers([b,f])}var j=new google.maps.LatLng(this.getIncident().get("lat"),this.getIncident().get("lng"));this.setMarker(new google.maps.Marker({position:j,icon:new google.maps.MarkerImage("resources/images/iconIncidentPoint.png",null,null,new google.maps.Point(60,80)),map:this.getMap(),title:"incidentPoint"}));var g=this.incident.get("video_clip")?"동영상 정보를 추가로 확인해보실 수 있습니다.":"동영상 정보가 아직 도착하지 않았습니다. 잠시 후 다시 확인해 보세요.";var e=d.length>0?"가속 및 속도 정보를 더 확인해보실 수 있습니다.":"트래킹 정보가 아직 도착하지 않았습니다. 잠시 후 다시 확인해 보세요.";var i=['<div class="bubbleWrap statusIncident">',"<div>"+e+"</div>","<div>"+g+"</div>","</div>"].join("");if(!self.infowindow){self.infowindow=HatioBB.label.create({map:this.getMap(),xoffset:-110,yoffset:-170})}else{self.infowindow.setMap(this.getMap())}self.infowindow.set("position",j);self.infowindow.set("text",i);self.infowindow.setVisible(true);if(self.iw_pending){clearTimeout(self.iw_pending)}self.iw_pending=setTimeout(function(){self.infowindow.setVisible(false)},10000)},refreshChart:function(b,a){this.down("#chart").refresh()},getLocation:function(b,a,d){if(b!==undefined&&a!==undefined){var c=new google.maps.LatLng(b,a);geocoder=new google.maps.Geocoder();geocoder.geocode({latLng:c},function(f,e){if(e==google.maps.GeocoderStatus.OK){if(f[0]){d(f[0].formatted_address)}}else{console.log("Geocoder failed due to: "+e)}})}},zInfo:{xtype:"panel",itemId:"info",title:T("menu.overview"),iconCls:"iconsTab tabMap",cls:"grayBg",layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",itemId:"brief",layout:"hbox",cls:"marginT10 marginL10",height:125,items:[{xtype:"image",itemId:"driverImage",cls:"imgDriver"},{xtype:"image",itemId:"vehicleImage",cls:"imgVehicle"},{xtype:"panel",itemId:"briefInfo",flex:1,data:{driver_name:"",vehicle_name:"",location:"",datetime:""},tpl:['<div class="infoID">{driver_id}({driver_name}) , {vehicle_id}({registration_number})</div>','<div class="infoText">'+T("label.location")+" : {location}</div>",'<div class="infoText">'+T("label.time")+" : {datetime} </div>"]}]},{xtype:"panel",height:45,cls:"shotHList",layout:{type:"hbox",align:"stretch"},items:[{xtype:"togglefield",itemId:"confirm",name:"confirm"},{xtype:"container",itemId:"detailInfo",flex:1,cls:"divHAlign",data:{impulse_abs:"",engine_temp:""},tpl:['<div class="iconImplus">'+T("label.impulse")+" <span>{impulse_abs}({impulse_x},{impulse_y},{impulse_z})/{impulse_threshold}</span></div>",'<div class="iconETemp">'+T("label.engine_temp")+" <span>{engine_temp}/{engine_temp_threshold}</span></div>",'<div class="iconVelocity">'+T("label.velocity")+" <span>{velocity}</span></div>",'<div class="iconOBD">'+T("label.obd_connected")+" <span>{obd_connected_text}</span></div>"]}]},{xtype:"map",itemId:"map",flex:1,useCurrentLocation:false,mapOptions:{zoom:10,maxZoom:19,minZoom:3,center:null,mapTypeId:google.maps.MapTypeId.ROADMAP}}]},zVideo:{xtype:"panel",title:"Movie",layout:"fit",iconCls:"iconsTab tabMovie",items:[{xtype:"video",itemId:"video",posterUrl:"porsche.png"}]},zChart:{xtype:"chart_v_accel",title:T("label.chart"),layout:"fit",iconCls:"iconsTab tabChart",}});Ext.define("HatioBB.view.Main",{extend:"Ext.Container",xtype:"main",requires:["Ext.navigation.View","Ext.navigation.Bar","HatioBB.view.Nav","HatioBB.view.Content","HatioBB.view.Header","HatioBB.view.monitor.Map","HatioBB.view.monitor.Info","HatioBB.view.monitor.Incident"],constructor:function(b){b=b||{};b.items=this.buildItems();this.callParent([b]);var a=this;HatioBB.setting.on("dockPosition",function(c){Ext.getCmp("nav").setDocked(HatioBB.setting.get("dockPosition")).show()})},buildItems:function(){return[{id:"nav",cls:"nav",xtype:"nav",docked:HatioBB.setting.get("dockPosition"),width:255},{id:"content",xtype:"content"}]},config:{fullscreen:true,layout:{type:"card"}}});Ext.define("HatioBB.view.driver.Driver",{extend:"Ext.tab.Panel",requires:["HatioBB.view.driver.Summary","HatioBB.view.chart.driver.Running","HatioBB.view.chart.driver.EcoRadar","HatioBB.view.monitor.Track"],xtype:"driver",id:"driver",config:{tabBarPosition:"bottom",items:[{xtype:"driver_summary",iconCls:"iconsTab tabSummary",title:"Summary"},{xtype:"chart_d_running",iconCls:"iconsTab tabDrive",title:T("label.running")},{xtype:"chart_d_eco_radar",iconCls:"iconsTab tabEco",title:T("label.eco_driving")},{xtype:"track",iconCls:"iconsTab tabTrack",queryOn:"driver",title:T("menu.track")}]},buildSettings:function(){return[{xtype:"selectfield",label:T("label.fromYear"),name:"fromYear",valueField:"year",displayField:"year",value:HatioBB.setting.get("fromYear"),listeners:{change:function(b,a){HatioBB.setting.set("fromYear",a)}},store:"YearStore"}]},refresh:function(){var a=this.getActiveItem();if(a&&typeof(a.refresh)==="function"){a.refresh.call(a)}}});Ext.define("HatioBB.view.vehicle.Vehicle",{extend:"Ext.tab.Panel",requires:["HatioBB.view.vehicle.Summary","HatioBB.view.chart.vehicle.Running","HatioBB.view.chart.vehicle.Consumable","HatioBB.view.vehicle.Repair","HatioBB.view.chart.vehicle.EcoRadar"],xtype:"vehicle",id:"vehicle",config:{tabBarPosition:"bottom",items:[{xtype:"vehicle_summary",iconCls:"iconsTab tabSummary",title:"Summary"},{xtype:"chart_v_running",iconCls:"iconsTab tabDrive",title:T("label.running")},{xtype:"chart_v_consumable",iconCls:"iconsTab tabConsumable",title:T("menu.consumables")},{xtype:"vehicle_repair",iconCls:"iconsTab tabRepair",title:T("label.repair")},{xtype:"chart_v_eco_radar",iconCls:"iconsTab tabEco",title:T("label.eco_driving")},{xtype:"track",iconCls:"iconsTab tabTrack",queryOn:"vehicle",title:T("menu.track")}]},buildSettings:function(){return[{xtype:"selectfield",label:T("label.fromYear"),name:"fromYear",valueField:"year",displayField:"year",value:HatioBB.setting.get("fromYear"),listeners:{change:function(b,a){HatioBB.setting.set("fromYear",a)}},store:"YearStore"}]},refresh:function(){var a=this.getActiveItem();if(a&&typeof(a.refresh)==="function"){a.refresh.call(a)}}});Ext.define("HatioBB.controller.Main",{extend:"Ext.app.Controller",requires:["HatioBB.view.Setting","HatioBB.view.driver.Driver","HatioBB.view.vehicle.Vehicle"],config:{routes:{map:"onMap",info:"onInfo",incident:"onIncident"},refs:{main:"main",nav:"nav",content:"content",header:"header"},control:{"#ext-viewport":{orientationchange:"onOC"},"#content":{painted:"onHome"},"header #map":{tap:"onMap"},"header #info":{tap:"onInfo"},"header #incident":{tap:"onIncident"},"header #collapse":{tap:"onCollapse"},"header #setting":{tap:"onSetting"},"header #refresh":{tap:"onRefresh"},monitor_map:{drivertap:"onMapDriverTap",vehicletap:"onMapVehicleTap",tracktap:"onMapTrackTap"},"monitor_info #incidents button":{tap:"onIncident"},"monitor_info image":{tap:"onImage"},"monitor_incident image":{tap:"onImage"},vehicle_summary:{showMap:"onShowMap",showTrack:"onShowTrack"},driver_summary:{showMap:"onShowMap",showTrack:"onShowTrack"}}},onOC:function(d,b,a,c){if(b==="portrait"){this.getNav().setDocked(null).hide()}else{this.getNav().setDocked(HatioBB.setting.get("dockPosition")).show()}},onHome:function(){HatioBB.nav.monitor("monitor_map")},onMap:function(a,b){HatioBB.nav.monitor("monitor_map")},onInfo:function(a,b){HatioBB.nav.monitor("monitor_info")},onIncident:function(b,c){var a=HatioBB.nav.monitor("monitor_incident");if(b&&b.config&&b.config.incident){a.setIncident(b.config.incident)}else{a.setIncident()}},onCollapse:function(a,b){if(this.getNav().getDocked()){this.getNav().setDocked(null).hide()}else{this.getNav().setDocked(HatioBB.setting.get("dockPosition")).show()}},onSetting:function(a,b){Ext.create("HatioBB.view.Setting",{}).showBy(a)},onRefresh:function(a,c){var b=this.getContent().getActiveItem();if(typeof(b.refresh)==="function"){b.refresh()}},onMapTrackTap:function(a){HatioBB.nav.monitor("monitor_info");HatioBB.setting.set("monitoring_vehicle",a.get("id"));HatioBB.setting.set("vehicle",a.get("id"));HatioBB.setting.set("driver",a.get("driver_id"))},onMapDriverTap:function(a){HatioBB.setting.set("driver",a.get("id"));HatioBB.nav.driver()},onMapVehicleTap:function(a){HatioBB.setting.set("vehicle",a.get("id"));HatioBB.nav.vehicle()},onImage:function(a){if(a.config.itemId==="driverImage"){HatioBB.nav.driver()}else{HatioBB.nav.vehicle()}},onShowMap:function(a){HatioBB.nav.monitor("monitor_map");HatioBB.setting.set("vehicle",a)},onShowTrack:function(a){HatioBB.nav.monitor("monitor_info");HatioBB.setting.set("vehicle",a)}});Ext.define("HatioBB.controller.Nav",{extend:"Ext.app.Controller",requires:["HatioBB.view.driver.Driver","HatioBB.view.vehicle.Vehicle"],config:{refs:{main:"main",nav:"nav",content:"content",header:"header",incidents:"nav #incidents",status:"nav #status",stateRunning:"nav #state_running",stateIdle:"nav #state_idle",stateIncident:"nav #state_incident",stateMaint:"nav #state_maint",vgroups:"nav #vgroups",dgroups:"nav #dgroups"},control:{nav:{initialize:"onInitialize",destroy:"onDestroy"},"#nav_driver":{tap:"onDriver"},"#nav_vehicle":{tap:"onVehicle"},"#nav_report":{tap:"onReport"},"#nav_fav":{tap:"onFav"},"#nav_comm":{tap:"onComm"},"#nav_noti":{tap:"onNoti"},"nav #incidents button":{tap:"onIncident"},"nav #status button":{tap:"onStatus"},"nav #vgroups button":{tap:"onVGroup"},"nav #dgroups button":{tap:"onDGroup"},nav_driver:{itemtap:"onDriverItemTap",disclose:"onDriverDisclose"},nav_vehicle:{itemtap:"onVehicleItemTap",disclose:"onVehicleDisclose"}}},onInitialize:function(){var b=this;var a=Ext.getStore("RecentIncidentStore");a.filter("confirm",false);a.load();var e=Ext.getStore("VehicleMapStore");e.load();var d=Ext.getStore("DriverBriefStore");d.load();function c(f){if(b.incidentInterval){clearInterval(b.incidentInterval)}if(f>0){b.incidentInterval=setInterval(function(){a.load()},f*1000)}if(b.vehicleMapInterval){clearInterval(b.vehicleMapInterval)}if(f>0){b.vehicleMapInterval=setInterval(function(){e.load()},f*1000)}}HatioBB.setting.on({refreshTerm:c});c(HatioBB.setting.get("refreshTerm"));this.getIncidents().on({painted:function(){b.refreshIncidents(a);a.on("load",b.refreshIncidents,b)},erased:function(){a.un("load",b.refreshIncidents,b)},scope:b});this.getStatus().on({painted:function(){b.refreshStatus(e);e.on("load",b.refreshStatus,b)},erased:function(){e.un("load",b.refreshStatus,b)},scope:b});Ext.getStore("VehicleGroupStore").load(function(f){b.refreshVGroups(this)});Ext.getStore("DriverGroupStore").load(function(f){b.refreshDGroups(this)})},onDestroy:function(){clearInterval(this.incidentInterval);clearInterval(this.vehicleMapInterval)},onDriver:function(a,b){this.getNav().setNavigationBar(true);this.getNav().push({xtype:"nav_driver"})},onVehicle:function(a,b){this.getNav().setNavigationBar(true);this.getNav().push({xtype:"nav_vehicle"})},onReport:function(a,b){this.getNav().setNavigationBar(true);this.getNav().push({xtype:"nav_report"})},onFav:function(a,b){this.getNav().setNavigationBar(true);this.getNav().push({xtype:"nav_fav"})},onComm:function(a,b){this.getNav().setNavigationBar(true);this.getNav().push({xtype:"nav_comm"})},onNoti:function(a,b){this.getNav().setNavigationBar(true);this.getNav().push({xtype:"nav_noti"})},onIncident:function(b,c){var a=HatioBB.nav.monitor("monitor_incident");if(b&&b.config&&b.config.incident){a.setIncident(b.config.incident)}else{a.setIncident()}},onStatus:function(c,d){var b=Ext.getStore("VehicleFilteredStore");var a=this.getNav().down("#status");a._filtered=!a._filtered;if(a._filtered){b.clearFilter(true);b.filter("status",c.config.state)}else{b.clearFilter()}HatioBB.nav.monitor("monitor_map")},onVGroup:function(d,g){var c=d.config.group.get("id");var f=Ext.getStore("VehicleGroupStore").findRecord("id",c);var b=f?f.get("vehicles"):[];var a=Ext.getStore("VehicleFilteredStore");a.clearFilter(true);a.filterBy(function(e){return Ext.Array.indexOf(b,e.get("id"))>=0});HatioBB.nav.monitor("monitor_map")},onDGroup:function(d,g){var c=d.config.group.get("id");var f=Ext.getStore("DriverGroupStore").findRecord("id",c);var a=f?f.get("drivers"):[];var b=Ext.getStore("VehicleFilteredStore");b.clearFilter(true);b.filterBy(function(e){return Ext.Array.indexOf(a,e.get("driver_id"))>=0});HatioBB.nav.monitor("monitor_map")},onDriverItemTap:function(b,c,d,a){HatioBB.setting.set("driver",a.get("id"))},onDriverDisclose:function(d,a,c,b,f){d.select(b);HatioBB.nav.driver();HatioBB.setting.set("driver",a.get("id"))},onVehicleItemTap:function(b,c,d,a){HatioBB.setting.set("vehicle",a.get("id"))},onVehicleDisclose:function(d,a,c,b,f){d.select(b);HatioBB.nav.vehicle();HatioBB.setting.set("vehicle",a.get("id"))},refreshStatus:function(c){var b=0;var d=0;var e=0;var a=0;c.each(function(f){switch(f.get("status")){case"Running":b++;break;case"Idle":d++;break;case"Incident":e++;break;case"Maint":a++;break}});this.getStateRunning().setHtml(T("label.state_driving")+"</br><span>"+b+"</span>");this.getStateIdle().setHtml(T("label.state_idle")+"</br><span>"+d+"</span>");this.getStateIncident().setHtml(T("label.state_incident")+"</br><span>"+e+"</span>");this.getStateMaint().setHtml(T("label.state_maint")+"</br><span>"+a+"</span>")},refreshIncidents:function(a){var c=this.getIncidents();c.removeAll();var e=a.getCount();for(var b=0;b<e;b++){var d=a.getAt(b);c.add({xtype:"button",incident:d,html:'<a href="#">'+d.get("vehicle_id")+", "+d.get("driver_id")+"<span>"+Ext.Date.format(d.get("datetime"),"D Y-m-d H:i:s")+"</span></a>"})}},refreshVGroups:function(b){var a=this.getVgroups();a.removeAll();b.each(function(c){a.add({xtype:"button",group:c,html:'<a href="#">'+c.data.desc+"<span>("+c.data.vehicles.length+")</span></a>"})})},refreshDGroups:function(b){var a=this.getDgroups();a.removeAll();b.each(function(c){a.add({xtype:"button",group:c,html:'<a href="#">'+c.data.desc+"<span>("+c.data.drivers.length+")</span></a>"})})}});Ext.define("HatioBB",{singleton:true,mixins:{user:"HatioBB.mixin.User",subitem:"HatioBB.mixin.SubItem",setting:"HatioBB.mixin.Setting",label:"HatioBB.mixin.Label",nav:"HatioBB.mixin.Nav",map:"HatioBB.mixin.Map"}});Ext.application({name:"HatioBB",requires:["Ext.MessageBox","Ext.tab.Panel"],controllers:["Main","Nav","Report","monitor.Track","monitor.Info"],views:["Main","Setting"],stores:["VehicleFilteredStore","VehicleStore","RecentIncidentStore","VehicleMapStore","DriverStore","DriverBriefStore","VehicleGroupStore","DriverGroupStore","TrackByVehicleStore","IncidentByVehicleStore","IncidentLogStore","DashboardVehicleStore","VehicleConsumableStore","DriverRunStore","VehicleRunStore","YearStore","DashboardConsumableStore","TrackStore","DailyReportStore","VehicleSummaryStore","DriverSummaryStore","MonthlyReportStore","VehicleRepairStore","DailyReportStore3","EfficiencyReportStore","EcoDrivingReportStore"],icon:{57:"resources/icons/Icon.png",72:"resources/icons/Iconipad.png",114:"resources/icons/Icon2x.png",144:"resources/icons/Iconipad2x.png"},phoneStartupScreen:"resources/loading/Homescreen.jpg",tabletStartupScreen:"resources/loading/Homescreenipad.jpg",launch:function(){Ext.fly("appLoadingIndicator").destroy();HatioBB.setting.set("app_mode",(0===window.location.pathname.indexOf("/m/")));HatioBB.setting.set("version","0.5.20");Ext.Ajax.request({url:(HatioBB.setting.get("app_mode")===true)?"../user/find":"data/user.json",success:function(b){var a=Ext.JSON.decode(b.responseText);if(a.success&&a.enabled){HatioBB.login.set(a);Ext.Viewport.add(Ext.create("HatioBB.view.Main"))}else{Ext.Msg.confirm("Unauthorized User","Do you want to move to registration page ?",function(c){if(c=="yes"){document.location.href="/register"}else{document.location.href="/logout"}})}},failure:function(a){if(a.status>=400&&a.status<500){Ext.Msg.confirm("Unauthenticated User","Do you want to move to login page ?",function(b){if(b=="yes"){document.location.href="/logout"}})}else{Ext.Msg.alert("ERROR","[CODE: "+a.status+"] "+a.statusText)}}})},onUpdated:function(){Ext.Msg.confirm("Application Update","This application has just successfully been updated to the latest version. Reload now?",function(){window.location.reload()})}});